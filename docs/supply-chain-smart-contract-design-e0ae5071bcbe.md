# è®¾è®¡ä¾›åº”é“¾æ™ºèƒ½åˆçº¦

> åŸæ–‡ï¼š<https://betterprogramming.pub/supply-chain-smart-contract-design-e0ae5071bcbe>

## ç®€åŒ–å†œä¸šä¾›åº”é“¾ç½‘ç»œçš„è¿ä½œ

![](img/12189ab6578116cf7b54dfc11d77b064.png)

ä¾›åº”é“¾|ä½œè€…å›¾ç‰‡

å†œä¸šåœ¨ä¸ºå…¨çƒ 70 äº¿å…¬æ°‘æä¾›è¡£é£Ÿæ–¹é¢å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ã€‚è¶…è¿‡ 25%çš„ä¸–ç•Œäººå£å—é›‡äºå†œä¸šéƒ¨é—¨ã€‚ä¸ºäº†æ»¡è¶³å…¨çƒåŒ–ä¸–ç•Œçš„éœ€æ±‚ï¼Œå†œä¸šä¾›åº”é“¾å·²ç»å½¢æˆäº†æ¼«é•¿è€Œå¤æ‚çš„ç”Ÿäº§ã€åŠ å·¥ã€åˆ†é”€å’Œè¥é”€æ¸ é“ç½‘ç»œã€‚ä»–ä»¬ç”±å†œæ°‘ã€åŠ å·¥å•†ã€è´¸æ˜“å•†ã€ç‰©æµä¾›åº”å•†ã€é‡‘èå…¬å¸ã€æ¶ˆè´¹è€…å’Œè®¸å¤šå…¶ä»–äººç»„æˆï¼Œæ¯ä¸€ä¸ªäººçš„åˆ©ç›Šç»å¸¸æ˜¯å¤šç§å¤šæ ·å’Œç›¸äº’å†²çªçš„ã€‚

å†œä¸šæ˜¯å…¨çƒç»æµçš„ä¸»è¦è´¡çŒ®è€…ï¼Œæ¯å¹´çš„æ”¶å…¥è¶…è¿‡ 6 ä¸‡äº¿ç¾å…ƒã€‚è¿™ä¸ªè¡Œä¸šä¸ºä¸–ç•Œæä¾›äº†åŸºæœ¬å•†å“ï¼Œå¦‚å¤§ç±³ã€ç‰ç±³ã€å°éº¦å’Œç‰²ç•œã€‚ç„¶è€Œï¼Œå°½ç®¡å†œä¸šä¾›åº”é“¾åœ¨ä¸ºå…¨çƒæä¾›åŸºæœ¬äº§å“æ–¹é¢å‘æŒ¥ç€è‡³å…³é‡è¦çš„ä½œç”¨ï¼Œä½†å®ƒé¢ä¸´ç€è®¸å¤šè·¨åœ°åŸŸå’Œè·¨å•†å“çš„å…±åŒæŒ‘æˆ˜ã€‚

åŒºå—é“¾æŠ€æœ¯åˆ›é€ äº†å•ä¸€çš„çœŸç†æ¥æºã€‚è¿™å¯¹äºä¾›åº”é“¾æ¥è¯´å¾ˆé‡è¦ï¼Œå› ä¸ºä¾›åº”é“¾ä¸­çš„å¤šä¸ªå‚ä¸è€…å¹¶ä¸ä¸€å®šç›¸äº’ä¿¡ä»»ã€‚

åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬é‡‡ç”¨äº†ä¸€ç§å®ç”¨çš„æ–¹æ³•æ¥ç ”ç©¶ä»£ç ã€‚æœ¬æ–‡ä¸­çš„ä¾‹å­æ—¨åœ¨ç®€åŒ–å†œä¸šä¾›åº”é“¾çš„è¿ä½œã€‚å®ƒæé«˜äº†å†œæ°‘ã€ç»é”€å•†ã€é›¶å”®å•†å’Œæ¶ˆè´¹è€…ä¹‹é—´çš„é€æ˜åº¦å’Œæ•ˆç‡ã€‚

# æµç¨‹å›¾

![](img/60fb1913d0cc2bff64c6c7feeb5b03b5.png)

æµç¨‹å›¾

## åŠŸèƒ½

1.  Farmer åˆ›å»ºäº†ä¸€ä¸ªäº§å“ï¼Œå¹¶åˆ—å‡ºè¦ç”±ç»é”€å•†è´­ä¹°çš„äº§å“
2.  å†œæ°‘è¿é€äº§å“
3.  ç»é”€å•†æ¥æ”¶äº§å“ï¼ŒåŠ å·¥äº§å“ï¼ŒåŒ…è£…äº§å“ï¼Œå¹¶å°†å…¶æŠ•æ”¾å¸‚åœº
4.  é›¶å”®å•†ä»åˆ†é”€å•†å¤„è´­ä¹°äº§å“
5.  åˆ†é”€å•†å°†äº§å“è¿é€ç»™é›¶å”®å•†
6.  é›¶å”®å•†æ”¶åˆ°äº§å“å¹¶å°†å…¶å‡ºå”®
7.  æ¶ˆè´¹è€…è´­ä¹°äº§å“

## ç¯å¢ƒè®¾ç½®

è®©æˆ‘ä»¬å…‹éš†å­˜å‚¨åº“å¹¶å®‰è£…ä¾èµ–é¡¹:

```
git clone [https://github.com/ac12644/Supply-Chain.git](https://github.com/ac12644/Supply-Chain.git)
cd Supply-Chain
yarn or npm install
```

ç°åœ¨å¯¼èˆªåˆ°`/contracts`æ–‡ä»¶å¤¹ï¼Œå¹¶æŒ‰ç»™å®šæ–¹å¼åˆ›å»ºæ–‡ä»¶å¤¹:

æ‚¨å°†çœ‹åˆ°å››ä¸ªæ–‡ä»¶å¤¹:

*   `/access`æ–‡ä»¶å¤¹åŒ…å«å†œæ°‘ã€ç»é”€å•†ã€é›¶å”®å•†&æ¶ˆè´¹è€…çš„è§’è‰²
*   `/ownership`æ–‡ä»¶å¤¹åŒ…å«ä¸€ä¸ª solidity æ–‡ä»¶`Ownable.sol`ï¼Œå°†åŠŸèƒ½é™åˆ¶åœ¨é€‰å®šçš„åœ°å€ï¼Œç±»ä¼¼äºä½ åœ¨ [openzeppelin](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/access/Ownable.sol) ä¸Šçœ‹åˆ°çš„
*   `/supplyChain`æ–‡ä»¶å¤¹åŒ…å«äº†é“¾çš„ç»“æ„
*   `/utils`æ–‡ä»¶å¤¹åŒ…å«ä¸€ä¸ª`Context.sol`ï¼Œå®ƒæä¾›å…³äºå½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä¿¡æ¯ï¼ŒåŒ…æ‹¬äº‹åŠ¡çš„å‘é€è€…åŠå…¶æ•°æ®ï¼Œå–è‡ª [openzeppelin](https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/Context.sol) ã€‚

é¦–å…ˆä¸ºè§’è‰²è®¾è®¡ä¸€ä¸ªæ™ºèƒ½å¥‘çº¦ï¼Œä¸ºæ­¤æˆ‘ä»¬ä½¿ç”¨`/access`æ–‡ä»¶å¤¹ã€‚

## [è§’è‰². sol](https://github.com/ac12644/Supply-Chain-Smart-Contract/blob/main/contracts/access/Roles.sol)

è¯¥åˆåŒå°†ç”¨äºç®¡ç†å¹³å°ä¸Šçš„è§’è‰²ã€‚å®ƒæä¾›äº†æ·»åŠ ã€åˆ é™¤å’ŒæŸ¥è¯¢è§’è‰²ä¿¡æ¯çš„åŠŸèƒ½ã€‚è¿™å°†è¢«å¯¼å…¥åˆ°æˆ‘ä»¬çš„å…¶ä»–è§’è‰²æ™ºèƒ½åˆåŒä¸­ã€‚

1.  è®©æˆ‘ä»¬ä»åˆ›å»º`library Roles`å¼€å§‹:

```
library Roles {
  ...
}
```

2.ç°åœ¨ï¼Œæˆ‘ä»¬åˆ›å»º`struct Role`æ¥è®¾ç½®åœ°å€ã€‚ä¸ºæ­¤ï¼Œæ‚¨å¿…é¡»åˆ›å»ºä¸€ä¸ªæ˜ å°„ï¼Œå°†å¸ƒå°”å€¼ä¸­çš„åœ°å€æ˜ å°„åˆ°è½½ä½“ã€‚

æ‚¨å¿…é¡»åˆ›å»ºä¸€ä¸ªæ˜ å°„ï¼Œå°†åœ°å€æ˜ å°„åˆ°è½½ä½“çš„å¸ƒå°”å€¼ã€‚

```
library Roles {
  struct Role {
    mapping(address => bool) bearer;
  }
  ...
}
```

3.åˆ›å»ºå…·æœ‰å­˜å‚¨è§’è‰²çš„å†…éƒ¨å‡½æ•°`add`å’Œè´¦æˆ·åœ°å€ï¼Œä»¥æ£€æŸ¥è¯¥åœ°å€æ­£åœ¨ä¼ é€’æœªè¿æ¥çš„è´¦æˆ·ä¸”ä¹‹å‰æœªæ·»åŠ :

```
function add( Role storage role, address account) internal {
  require(account != address(0));  
  require(!has(role, account));
}
```

4.ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬åˆ›å»º`remove`å‡½æ•°ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬æ£€æŸ¥ä¼ é€’çš„åœ°å€ä¸æ˜¯å…³è”çš„å¸æˆ·ï¼Œå¹¶ä¸”è¯¥åœ°å€ç¡®å®å­˜åœ¨äºç»™å®šçš„è§’è‰²ä¸­ï¼Œæœ€åå°†å­˜å‚¨ä¸­çš„è§’è‰²å€¼è®¾ç½®ä¸º falseã€‚

```
function remove( Role storage role, address account) internal {
  require(account != address(0));  
  require(has(role, account));role.bearer[account] = false;
}
```

5.åœ¨æœ€åä¸€æ­¥ï¼Œåˆ›å»ºä¸€ä¸ªå‡½æ•°`has`æ¥æ£€æŸ¥å¸æˆ·æ˜¯å¦æœ‰è§’è‰²ï¼Œå®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼:

```
function remove( Role storage role, address account) 
  internal 
  view 
  returns (bool){
  require(account != address(0));  
  return role.bearer[account];
}
```

6.å®Œæˆåï¼Œæ‚¨çš„æ™ºèƒ½åˆçº¦çœ‹èµ·æ¥å¦‚ä¸‹æ‰€ç¤º:

è§’è‰². sol

## [å†œæ°‘è§’è‰²](https://github.com/ac12644/Supply-Chain-Smart-Contract/blob/main/contracts/access/FarmerRole.sol)

ç°åœ¨ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¹‹å‰çš„`Roles`åº“åˆåŒä¸ºå†œæ°‘åˆ›å»ºæ–°è§’è‰²ã€‚

1.  è®©æˆ‘ä»¬ä»åˆ›å»ºä¸€ä¸ªåˆåŒ`FarmerRole`æ–‡ä»¶å¼€å§‹ï¼Œå¹¶ä½¿ç”¨`struct Role` `Role`åº“ã€‚

```
contract FarmerRole is Context {
  using Roles for Roles.Role
  ...
}
```

2.å¦‚æœæˆåŠŸæ·»åŠ æˆ–åˆ é™¤å†œæ°‘ï¼Œåˆ›å»ºä¸¤ä¸ªäº‹ä»¶æ¥æ•è·ã€‚

```
event FarmerAdded(address indexed account); 
event FarmerRemoved(address indexed account);
```

3.é€šè¿‡ä»`Roles`åº“`struct Role`ç»§æ‰¿æ¥å®šä¹‰ä¸€ä¸ªç»“æ„`farmers`ã€‚

```
Roles.Role private farmers;
```

4.åˆåŒçš„éƒ¨ç½²åœ°å€å°†è¢«æ·»åŠ ä¸ºç¬¬ä¸€ä¸ªå†œæ°‘ã€‚ä½¿ç”¨åå®šçš„æ„é€ å‡½æ•°æ—¶ï¼Œå¿…é¡»æ‰§è¡Œåå®šçš„åˆå§‹è®¾ç½®ã€‚ä½¿ç”¨æ„é€ å‡½æ•°å°†ç¡®ä¿åœ¨åå®šåˆ›å»ºæœŸé—´è¿›è¡Œåˆå§‹åŒ–ã€‚

```
constructor() public { _addFarmer(_msgSender()); }
```

5.å®šä¹‰ä¸€ä¸ªä¿®é¥°ç¬¦æ¥æ£€æŸ¥è°ƒç”¨å‡½æ•°çš„åœ°å€æ˜¯å¦æœ‰åˆé€‚çš„è§’è‰²ã€‚

```
modifier onlyFarmer() { 
  require(isFarmer(_msgSender())); 
  _; 
}
```

6.åˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥æ£€æŸ¥åœ°å€æ˜¯å¦æ˜¯ farmerï¼Œå®ƒè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ã€‚

```
function isFarmer(address account) 
  public 
  view 
  returns (bool) 
  { 
    return farmers.has(account); 
  }
```

7.ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹æ·»åŠ å’Œåˆ é™¤`Farmer`è§’è‰²çš„å‡½æ•°ã€‚

`Farmer`è§’è‰²æ™ºèƒ½åˆçº¦å®Œæˆï¼Œè¯·çœ‹ä¸‹å›¾:

æ³•é»˜ç½—å°”.ç´¢å°”

ç±»ä¼¼åœ°ï¼Œæˆ‘ä»¬åˆ›å»ºå…¶ä»–è§’è‰²`[DistributorRole.sol](https://github.com/ac12644/Supply-Chain-Smart-Contract/blob/main/contracts/access/DistributorRole.sol)`ã€`[RetailerRole.sol](https://github.com/ac12644/Supply-Chain-Smart-Contract/blob/main/contracts/access/RetailerRole.sol)`å’Œ`[ConsumerRole.sol](https://github.com/ac12644/Supply-Chain-Smart-Contract/blob/main/contracts/access/ConsumerRole.sol)`ï¼Œæˆ‘ä»¬é‡å¤`[FarmerRole.sol](https://github.com/ac12644/Supply-Chain-Smart-Contract/blob/main/contracts/access/FarmerRole.sol)`ä¸­ç»™å‡ºçš„ç›¸åŒè¿‡ç¨‹ï¼Œåªæ˜¯æ ¹æ®è§’è‰²æ”¹å˜å‡½æ•°å’Œå˜é‡çš„åç§°ã€‚

ç°åœ¨ï¼Œè®©æˆ‘ä»¬è½¬åˆ°ä¸»åˆåŒ`[SupplyChain.sol](https://github.com/ac12644/Supply-Chain-Smart-Contract/blob/main/contracts/supplyChain/SupplyChain.sol)`ã€‚

## [ä¾›åº”é“¾](https://github.com/ac12644/Supply-Chain-Smart-Contract/blob/main/contracts/supplyChain/SupplyChain.sol)

è¿™ä¸ªæ™ºèƒ½åˆåŒåŒ…å«äº†ä¾›åº”é“¾èƒŒåçš„æ‰€æœ‰é€»è¾‘ã€‚ä¸€ä¸ªå†œæ°‘åˆ›é€ äº†ä¸€ç§äº§å“å¹¶æŠŠå®ƒæ”¾åœ¨å¸‚åœºä¸Šé”€å”®ï¼Œä¸€ä¸ªç»é”€å•†è´­ä¹°å®ƒï¼Œå–ç»™ä¸€ä¸ªé›¶å”®å•†ï¼Œç„¶åé›¶å”®å•†å†æŠŠå®ƒå–ç»™æ¶ˆè´¹è€…ã€‚æ•´ä¸ªè¿‡ç¨‹æ˜¯é€æ˜çš„ï¼ŒåŒºå—é“¾ä¸Šçš„æ¯ä¸ªäººéƒ½å¯ä»¥çœ‹åˆ°ï¼Œå› æ­¤æ²¡æœ‰å‡ºé”™æˆ–æ¬ºè¯ˆçš„æœºä¼šã€‚

1.  è®©æˆ‘ä»¬é¦–å…ˆå¯¼å…¥æˆ‘ä»¬ä¹‹å‰åˆ›å»ºçš„æ‰€æœ‰å¿…è¦çš„å¥‘çº¦ï¼Œå¹¶åˆ›å»ºä¸€ä¸ªå¥‘çº¦`SupplyChain`ã€‚

ä¾›åº”é“¾åˆåŒæ¨¡å¼

2.å­˜å‚¨å½“å‰è¿æ¥çš„ç”µå­é’±åŒ…çš„åœ°å€ã€‚è¯·åœ¨ä¹‹åä¿å­˜é’±åŒ…åœ°å€ã€‚

```
address owner;
```

3.ç”±å†œæ°‘ç”Ÿæˆçš„äº§å“ä»£ç å°åœ¨äº§å“ä¸Šï¼Œç”±ç»é”€å•†éªŒè¯ã€‚`productCode`å­˜å‚¨è¯¥å€¼ã€‚

```
uint256 productCode;
```

4.è®°å½•ç”±`Farmer`åˆ›å»ºçš„åº“å­˜å•ä½æ•°é‡ã€‚`stockUnit`å­˜å‚¨è¯¥å€¼ã€‚

```
uint256 stockUnit;
```

5.åˆ›å»ºæ˜ å°„`items`ï¼Œå°†äº§å“ä»£ç æ˜ å°„åˆ°ç¨åå°†åœ¨`struct`ä¸­åˆ›å»ºçš„é¡¹ç›®ã€‚

```
mapping(uint256 => Item) items;
```

6.å®šä¹‰ä¸€ä¸ªå…¬å…±æ˜ å°„`itemsHistory`ï¼Œå°†äº§å“ä»£ç æ˜ å°„åˆ°ä¸€ä¸ªæ•°ç»„`TxHash`ï¼Œè¯¥æ•°ç»„è·Ÿè¸ªäº§å“åœ¨ä¾›åº”é“¾ä¸­çš„è¡Œç¨‹â€”â€”ä»åº”ç”¨ç¨‹åºå‘é€ã€‚

```
mapping(uint256 => Txblocks) itemsHistory;
```

7.ç°åœ¨åˆ›å»ºä¸€ä¸ªå·ï¼Œç”¨ä»¥ä¸‹å€¼è·Ÿè¸ªäº§å“çš„ç”Ÿäº§è¿‡ç¨‹ï¼Œå¹¶å°†é»˜è®¤å·è®¾ç½®ä¸ºç”±å†œæ°‘ç”Ÿäº§ã€‚

ä¾›åº”é“¾æµç¨‹çš„çŠ¶æ€

6.åˆ›å»ºä¸€ä¸ªç»“æ„æ¥å­˜å‚¨æ‰€éœ€çš„æ‰€æœ‰äº§å“è¯¦ç»†ä¿¡æ¯ã€‚

é¡¹ç›®ç»“æ„

7.åˆ›å»ºä¸€ä¸ªç»“æ„æ¥å­˜å‚¨`farmer-distributor`ã€`distributor-retailer`å’Œ`retailer-consumer`ä¹‹é—´äº‹åŠ¡çš„å—åœ°å€ã€‚

```
struct Txblocks { 
  uint256 FTD; // block of farmerToDistributor 
  uint256 DTR; // block of DistributorToRetailer 
  uint256 RTC; // block of RetailerToConsumer 
}
```

8.ç°åœ¨ä¸ºæ‰€æœ‰å‡½æ•°åˆ›å»ºäº‹ä»¶ï¼Œè¿™äº›äº‹ä»¶å°†åœ¨ä½œä¸šæˆåŠŸå®Œæˆæ—¶å‘å‡ºã€‚

ä¾›åº”é“¾äº‹ä»¶

9.åˆ›å»ºä¸€ä¸ªä¿®é¥°ç¬¦ï¼Œæ£€æŸ¥åœ°å€æ˜¯å¦æ˜¯åˆåŒçš„æ‰€æœ‰è€…ã€‚

```
modifier only_Owner() {
  require(_msgSender() == owner);        
  _;    
}
```

10.å®šä¹‰ä¸€ä¸ªä¿®æ”¹é‡æ¥éªŒè¯`Caller`ï¼Œç„¶åå®šä¹‰å¦ä¸€ä¸ªä¿®æ”¹é‡æ¥æ£€æŸ¥æ”¯ä»˜çš„é‡‘é¢æ˜¯å¦è¶³ä»¥æ”¯ä»˜ä»·æ ¼ã€‚

11.ç°åœ¨ï¼Œæˆ‘ä»¬å®šä¹‰ä¿®æ”¹é‡æ¥æ£€æŸ¥äº§å“ä»£ç æ˜¯å¦å­˜åœ¨ï¼Œå¹¶æ›´æ–°äº§å“çš„å½“å‰çŠ¶æ€ã€‚

12.åˆ›å»ºä¸€ä¸ªæ„é€ å‡½æ•°æ¥è®¾ç½®æ‰€æœ‰è€…ã€åº“å­˜å•ä½å’Œäº§å“ä»£ç ã€‚

```
constructor() public payable {        
  owner = _msgSender();        
  stockUnit = 1;        
  productCode = 1;    
}
```

13.ç°åœ¨ï¼Œåˆ›å»ºä¸€ä¸ªå…è®¸æ‚¨å°†åœ°å€è½¬æ¢ä¸ºå¯æ”¯ä»˜åœ°å€çš„å‡½æ•°ã€‚

```
function _make_payable(address x) internal pure 
returns (address payable) { 
  return payable(address(uint160(x))); 
}
```

14.ä¸ºæ‰€æœ‰è€…åˆ›å»ºä¸€ä¸ª kill å‡½æ•°ï¼Œå°†åˆåŒä¸­å­˜å‚¨çš„æ‰€æœ‰å‰©ä½™ä¹™é†šå‘é€åˆ°æ‰€æœ‰è€…çš„åœ°å€ã€‚

```
function kill() public { 
  if (_msgSender() == owner) { 
    address payable ownerAddressPayable = _make_payable(owner);
    selfdestruct(ownerAddressPayable); 
  } 
}
```

15.ç°åœ¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå…è®¸`Farmer`åˆ›å»ºäº§å“çš„å‡½æ•°ã€‚

åˆ›å»ºäº§å“

16.è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå‡½æ•°ï¼Œå…è®¸å†œæ°‘é”€å”®æ‚¨åˆ›å»ºçš„äº§å“ï¼Œå¦ä¸€ä¸ªå‡½æ•°å…è®¸åˆ†é”€å•†ä»å†œæ°‘é‚£é‡Œè´­ä¹°äº§å“ã€‚

å‘åˆ†é”€å•†é”€å”®äº§å“çš„åŠŸèƒ½

17.å½“ç»é”€å•†è´­ä¹°äº§å“æ—¶ï¼Œå†œæ°‘éœ€è¦å‘è´§ï¼Œç»é”€å•†éœ€è¦æ”¶è´§ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åˆ›å»ºå‘è´§å’Œæ”¶è´§åŠŸèƒ½æ¥å®ç°è¿™ä¸€ç‚¹ã€‚

18.`Distributor`åˆ—å‡ºçš„äº§å“ç°åœ¨å¿…é¡»ç”±`Retailer`è´­ä¹°ã€‚åœ¨`Retailer`è´­ä¹°äº§å“åï¼Œ`Distributor`å°†äº§å“å‘é€ç»™`Retailer`ï¼Œåè€…éœ€è¦æ¥æ”¶äº§å“ã€‚ä¸ºæ­¤ï¼Œéœ€è¦åˆ›å»ºä¸‰ä¸ªå‡½æ•°:ä¸€ä¸ªç”¨äº`Retailer`è´­ä¹°äº§å“ï¼Œä¸€ä¸ªå…è®¸`Distributor`è¿é€äº§å“ï¼Œä¸€ä¸ªç”¨äº`Retailer`æ¥æ”¶äº§å“:

åŠ å·¥ã€åŒ…è£…å’Œé”€å”®æ¸…å•çš„åŠŸèƒ½

19.`Distributor`åˆ—å‡ºçš„äº§å“ç°åœ¨ç”±`Retailer`è´­ä¹°ã€‚åœ¨`Retailer`è´­ä¹°åï¼Œ`Distributor`ä¼šè¿é€äº§å“ï¼Œ`Retailer`ä¼šæ”¶åˆ°ã€‚ä¸ºæ­¤ï¼Œéœ€è¦åˆ›å»ºä¸‰ä¸ªå‡½æ•°:ä¸€ä¸ªç”¨äº`Retailer`è´­ä¹°äº§å“ï¼Œä¸€ä¸ªç”¨äº`Distributor`å‘è´§ï¼Œä¸€ä¸ªç”¨äº`Retailer`æ¥æ”¶äº§å“:

20.ç°åœ¨ï¼Œæˆ‘ä»¬è¿˜å‰©ä¸¤æ­¥ã€‚ç¬¬ä¸€æ­¥æ˜¯æŠŠäº§å“æ”¾åœ¨é›¶å”®å•†çš„è´§æ¶ä¸Šï¼Œè®©å®ƒä¸€ç›´æ”¾ç€ï¼Œç›´åˆ°æ¶ˆè´¹è€…å‡ºç°ã€‚ç¬¬äºŒæ­¥æ˜¯è®©æ¶ˆè´¹è€…è´­ä¹°è¯¥äº§å“ã€‚è®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹:

21.ç°åœ¨æ˜¯åˆ›å»ºè·å–äº§å“çš„å‡½æ•°çš„æ—¶å€™äº†:æˆ‘ä»¬åˆ›å»ºäº†ä¸‰ä¸ªå‡½æ•°`fetchItemBufferOne`ã€`fetchItemBufferTwo`å’Œ`fetchitemHistory`ã€‚

`fetchItemBufferOne`:è¯¥åŠŸèƒ½ä»…è·å–åˆ›å»ºæ—¶ç”Ÿæˆçš„äº§å“åˆ›å»ºä¿¡æ¯ã€‚

`fetchItemBufferTwo`:è·å–äº§å“ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ‰€æœ‰å‚ä¸è€…çš„åœ°å€

`fetchitemHistory`:è·å–å†œæ°‘åˆ°åˆ†é”€å•†ã€åˆ†é”€å•†åˆ°é›¶å”®å•†ã€é›¶å”®å•†åˆ°æ¶ˆè´¹è€…çš„æµç¨‹çš„å—æ•°æ®

è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›å‡½æ•°:

è·å–æ•°æ®çš„å‡½æ•°

æœ€åï¼Œæˆ‘ä»¬çš„ä¾›åº”é“¾æ™ºèƒ½åˆåŒå®Œæˆäº†ï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œçœ‹ä¸€ä¸‹æœ€ç»ˆåˆåŒ[ã€‚](https://github.com/ac12644/Supply-Chain-Smart-Contract/blob/main/contracts/supplyChain/SupplyChain.sol)

# æµ‹è¯•å’Œéƒ¨ç½²

ç°åœ¨ï¼Œæˆ‘ä»¬åœ¨å¤šè¾¹å½¢ç½‘ç»œä¸Šæµ‹è¯•ã€ç¼–è¯‘å’Œéƒ¨ç½²å¥‘çº¦ã€‚æˆ‘å·²ç»åŒ…å«äº†ä¸€ä¸ª[æµ‹è¯•æ–‡ä»¶](https://github.com/ac12644/Supply-Chain-Smart-Contract/blob/main/test/SupplyChain.js)ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å®ƒè¿›è¡Œæµ‹è¯•ã€‚æ‚¨è¿˜å¿…é¡»æ£€æŸ¥`[truffle-config.js](https://github.com/ac12644/Supply-Chain-Smart-Contract/blob/main/truffle-config.js)`ä¸­çš„é…ç½®ã€‚

è¦éƒ¨ç½²åˆåŒï¼Œè¯·è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
truffle develop$truffle(develop)> test
$truffle(develop)> deploy
```

æ­å–œğŸ¤©ï¼æ‚¨çš„åˆåŒå·²æˆåŠŸéƒ¨ç½²ã€‚

æ„Ÿè°¢é˜…è¯»ï¼

## æƒ³è¦æ›´å¤šå—ï¼Ÿ

[](/create-your-initial-coin-offering-ico-contract-in-ethereum-5a94ec3e2337) [## å¦‚ä½•åœ¨ä»¥å¤ªåŠåˆ›å»ºæ‚¨çš„åˆå§‹ç¡¬å¸å‘å”®(ICO)åˆåŒ

### è®©ä½ çš„ä¼—ç­¹æ›´è¿›ä¸€æ­¥

better ç¼–ç¨‹. pub](/create-your-initial-coin-offering-ico-contract-in-ethereum-5a94ec3e2337)