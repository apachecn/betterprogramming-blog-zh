<html>
<head>
<title>How to Create an Off-chain NFT Whitelist</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åˆ›å»ºç¦»çº¿NFTç™½åå•</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/how-to-create-an-off-chain-nft-whitelist-378ad40bff4e?source=collection_archive---------8-----------------------#2022-08-04">https://betterprogramming.pub/how-to-create-an-off-chain-nft-whitelist-378ad40bff4e?source=collection_archive---------8-----------------------#2022-08-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9f01" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">è¿™ç¯‡æŠ€æœ¯æ–‡ç« å°†æ¢è®¨NFTç™½åå•çš„æ¦‚å¿µï¼Œä»¥åŠå¦‚ä½•ä¸ºåŸºäºä»¥å¤ªåŠçš„NFTé›†åˆå®ç°è¿™ä¸€æ¦‚å¿µã€‚</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/fbfe3dfbef8dc7bb6329d44de5550577.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*vOscGBS2BaUIQp4Ei_3hPg.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae kv" href="https://unsplash.com/@theshubhamdhage?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Shubham Dhage </a>åœ¨<a class="ae kv" href="https://unsplash.com/@theshubhamdhage?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„</p></figure><p id="53b6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">é¦–å…ˆï¼Œè®©æˆ‘ä»¬æ¥å®šä¹‰ä»€ä¹ˆæ˜¯NFTç™½åå•:è¿™æ˜¯ä¸€ä¸ªè·å–é¢„å…ˆæ‰¹å‡†ç”¨äºé“¸é€ çš„åŠ å¯†é’±åŒ…åœ°å€çš„è¿‡ç¨‹ã€‚</p><p id="9795" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¿™æ˜¯ä¸€ç§é˜²æ­¢æ‰€è°“â€œå¤©ç„¶æ°”æˆ˜äº‰â€çš„å¸¸è§æ–¹æ³•ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäººä»¬æé«˜ä»–ä»¬æ„¿æ„æ”¯ä»˜çš„å¤©ç„¶æ°”ä»·æ ¼æ¥åˆ¶é€ NFTï¼Œä»¥ä¾¿ä»–ä»¬çš„äº¤æ˜“é¦–å…ˆè¢«æ¥å—ï¼Œå¹¶ä¸”å¯ä»¥æ˜¯ä¸€ç§æœ‰ç”¨çš„è¥é”€å·¥å…·ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œäººä»¬åœ¨é‡‡å–æŸäº›è¡ŒåŠ¨åè¢«æ·»åŠ åˆ°ç™½åå•ä¸­(ä¾‹å¦‚:ä½œä¸ºç­¾ç½²ç”µå­é‚®ä»¶ç®€è®¯çš„äº¤æ¢)ã€‚</p><p id="8e53" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æœ¬æ–‡å°†å¸¦æ‚¨äº†è§£åœ¨ä»¥å¤ªåŠåŒºå—é“¾ä¸Šä½¿ç”¨æ™ºèƒ½åˆçº¦å®ç°è¿™ç±»ç³»ç»Ÿçš„æ­¥éª¤ã€‚</p></div><div class="ab cl ls lt hu lu" role="separator"><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx ly"/><span class="lv bw bk lw lx"/></div><div class="ij ik il im in"><p id="56c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è™½ç„¶æœ‰å¤šç§æœ‰æ•ˆçš„æ–¹æ³•ï¼Œä½†æˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ª<em class="lz">ä¼˜æƒ åˆ¸</em>ç³»ç»Ÿï¼Œåœ¨è¯¥ç³»ç»Ÿä¸­ï¼Œé’±åŒ…åœ°å€ä»¥ä¸€ç§æ™ºèƒ½åˆçº¦å¯ä»¥éªŒè¯å…¶æ¥è‡ªå¯ä¿¡æ¥æºçš„æ–¹å¼è¿›è¡Œç¦»çº¿ç­¾åã€‚</p><p id="18a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å®Œæˆæœ¬æ–‡åï¼Œæ‚¨å°†èƒ½å¤Ÿ:</p><ul class=""><li id="5cc7" class="ma mb iq ky b kz la lc ld lf mc lj md ln me lr mf mg mh mi bi translated">å°†â€œç™½åå•â€åŠŸèƒ½æ·»åŠ åˆ°æ‚¨çš„æ™ºèƒ½åˆçº¦ä¸­ï¼Œè¿™å°†å…è®¸é¢„å…ˆæ‰¹å‡†çš„é’±åŒ…åˆ›é€ ä¸€ä¸ªå•ä¸€çš„NFTã€‚</li><li id="bd34" class="ma mb iq ky b kz mj lc mk lf ml lj mm ln mn lr mf mg mh mi bi translated">è®¾è®¡ä¸€ä¸ªä¸æ‚¨çš„æ™ºèƒ½åˆåŒç™½åå•ç›¸é›†æˆçš„webè§£å†³æ–¹æ¡ˆã€‚</li></ul><h1 id="a523" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">å®ƒå°†å¦‚ä½•å·¥ä½œï¼Ÿ</h1><h2 id="78e4" class="ng mp iq bd mq nh ni dn mu nj nk dp my lf nl nm na lj nn no nc ln np nq ne nr bi translated">äº§ç”Ÿ</h2><p id="0431" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">æ¯å¼ ä¼˜æƒ åˆ¸éƒ½æ˜¯ä¸€ä¸ªç®€å•çš„javascriptå¯¹è±¡ï¼ŒåŒ…å«ä¸€ä¸ªé’±åŒ…åœ°å€ï¼Œä½¿ç”¨ä¸€ä¸ªåªæœ‰æˆ‘ä»¬çŸ¥é“çš„ç§é’¥è¿›è¡Œç¦»çº¿ç­¾åã€‚</p><h2 id="2186" class="ng mp iq bd mq nh ni dn mu nj nk dp my lf nl nm na lj nn no nc ln np nq ne nr bi translated">æ£€ç´¢</h2><p id="f398" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">æˆ‘ä»¬çš„ä¼˜æƒ åˆ¸å°†å­˜åœ¨äºä¸€ä¸ªç®€å•çš„JSONæ–‡ä»¶ä¸­ï¼Œå¹¶å°†é€šè¿‡ä¸€ä¸ªç®€å•çš„APIå…¬å¼€ã€‚</p><h2 id="0d58" class="ng mp iq bd mq nh ni dn mu nj nk dp my lf nl nm na lj nn no nc ln np nq ne nr bi translated">æ¶ˆè´¹</h2><p id="53b9" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">å½“è°ƒç”¨æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦æ—¶ï¼Œå¯ä»¥ä½¿ç”¨ç”Ÿæˆçš„ä¼˜æƒ åˆ¸ç­¾åæ¥è¯æ˜æ¥æ”¶çš„æ•°æ®æ˜¯ç”±æˆ‘ä»¬ç”Ÿæˆçš„ã€‚</p><h1 id="06a6" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">è®©æˆ‘ä»¬å»ºé€ å®ƒ</h1><h2 id="b973" class="ng mp iq bd mq nh ni dn mu nj nk dp my lf nl nm na lj nn no nc ln np nq ne nr bi translated">äº§ç”Ÿ</h2><p id="1d62" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">è®©æˆ‘ä»¬ä»ç”Ÿæˆä¼˜æƒ åˆ¸å¼€å§‹ã€‚æˆ‘ä»¬å°†ä½¿ç”¨å…¬é’¥åŠ å¯†æ¥åŠ å¯†â€œä¼˜æƒ åˆ¸â€ä¸­çš„é’±åŒ…åœ°å€ã€‚</p><p id="7309" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸‹é¢çš„è„šæœ¬å…¬å¼€äº†ä¸€ä¸ªæ¥å—ä¸€ä¸ª<code class="fe nx ny nz oa b">address</code>å’Œ<code class="fe nx ny nz oa b">privateKey</code>å¹¶å°†è¿”å›ä¸€å¼ ä¼˜æƒ åˆ¸çš„<code class="fe nx ny nz oa b">createCoupon</code>å‡½æ•°ã€‚</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="5851" class="ng mp iq oa b gy of og l oh oi">const { ethers } = require(â€˜ethersâ€™);</span><span id="48a3" class="ng mp iq oa b gy oj og l oh oi">async function createCoupon(address, privateKey) {<br/>    // Weâ€™ll leverage the ethers library to create a new wallet<br/>    // that weâ€™ll use to sign the coupon with the private key.</span><span id="188d" class="ng mp iq oa b gy oj og l oh oi">    const signer = new ethers.Wallet(privateKey);</span><span id="3ea5" class="ng mp iq oa b gy oj og l oh oi">    // We need to encode the wallet address in a way that<br/>    // can be signed and later recovered from the smart contract.<br/>    // Hashing the address using the SHA-256 hashing algorithm<br/>    // is a good way to do this.</span><span id="0a0c" class="ng mp iq oa b gy oj og l oh oi">    const message = ethers.utils.solidityKeccak256(<br/>        [â€˜addressâ€™],<br/>        [address]<br/>    );</span><span id="8b04" class="ng mp iq oa b gy oj og l oh oi">    // Now we can sign the message using the private key.</span><span id="c241" class="ng mp iq oa b gy oj og l oh oi">    const signature = await   signer.signMessage(ethers.utils.arrayify(message));</span><span id="1bff" class="ng mp iq oa b gy oj og l oh oi">    // The signature can be expanded into itâ€™s underlying components<br/>    // which we can pass directly into the smart contract.<br/>    // If we didnâ€™t split the signature here â€” weâ€™d have to do it<br/>    // in the smart contract, which is a bit of a hassle.</span><span id="b056" class="ng mp iq oa b gy oj og l oh oi">    let { r, s, v } = ethers.utils.splitSignature(signature);</span><span id="188a" class="ng mp iq oa b gy oj og l oh oi">    return {r,s,v}<br/>}</span><span id="fa94" class="ng mp iq oa b gy oj og l oh oi">module.exports = {<br/>    createCoupon,<br/>}</span></pre><p id="e8ff" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘ä»¬å°†éœ€è¦ä¸€ä¸ªå¯†é’¥å¯¹æ¥ä½¿ç”¨â€”â€”ç”¨äºéƒ¨ç½²æ‚¨çš„åˆåŒçš„å¯†é’¥å¯¹ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœæ‚¨ä»ç„¶éœ€è¦ç”Ÿæˆä¸€ä¸ªå¯†é’¥å¯¹ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨å…ƒæ©ç å¿«é€Ÿåˆ›å»ºä¸€ä¸ªæ–°çš„walletï¼Œå¹¶ä»é‚£é‡Œå¯¼å‡ºç§é’¥ã€‚</p><p id="9313" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸‹é¢æ˜¯ä¸€ä¸ªå°çš„node.jsè„šæœ¬ï¼Œå®ƒå°†ç”Ÿæˆæˆ‘ä»¬çš„ä¼˜æƒ åˆ¸:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="a25f" class="ng mp iq oa b gy of og l oh oi">const { createCoupon } = require("./coupons");<br/>const fs = require('fs');<br/>require("dotenv").config();</span><span id="3403" class="ng mp iq oa b gy oj og l oh oi">// Insert private key corresponding to _couponSigner<br/>const privateKey = process.env.PRIVATE_KEY;</span><span id="1d71" class="ng mp iq oa b gy oj og l oh oi">// Populate with addresses to whitelist<br/>let addresses = [<br/>    // ..<br/>];</span><span id="f342" class="ng mp iq oa b gy oj og l oh oi">const main = async () =&gt; {<br/>    let output = [];<br/>    console.log('Generating...');<br/>    for (let i = 0; i &lt; addresses.length; i++) {<br/>        let signature = await createCoupon(addresses[i], 0, privateKey);<br/>        output.push({<br/>            wallet: mint[i],<br/>            r: signature.r,<br/>            s: signature.s,<br/>            v: signature.v<br/>        })<br/>    }</span><span id="2d50" class="ng mp iq oa b gy oj og l oh oi">// Save the generated coupons to a coupons.json file</span><span id="bfe3" class="ng mp iq oa b gy oj og l oh oi">let data = JSON.stringify(output);<br/>    fs.writeFileSync('coupons.json', data);<br/>    console.log('Done.');<br/>    console.log('Check the coupons.json file.');</span><span id="cfbe" class="ng mp iq oa b gy oj og l oh oi">};</span><span id="befa" class="ng mp iq oa b gy oj og l oh oi">const runMain = async () =&gt; {<br/>    try {<br/>        await main();<br/>        process.exit(0);<br/>    } catch (error) {<br/>        console.log(error);<br/>        process.exit(1);<br/>    }<br/>};</span><span id="1314" class="ng mp iq oa b gy oj og l oh oi">runMain();</span></pre><p id="dd16" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">é¦–å…ˆç¡®ä¿æ‚¨ç”¨å°†ç”¨äºç­¾åçš„é’±åŒ…çš„ç§é’¥å¡«å……äº†æ‚¨çš„<code class="fe nx ny nz oa b">.env</code>æ–‡ä»¶ã€‚ç„¶åï¼Œç”¨é’±åŒ…åœ°å€åˆ—è¡¨å¡«å……è„šæœ¬ä¸­çš„<code class="fe nx ny nz oa b">addresses</code>æ•°ç»„ã€‚</p><p id="72a0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¿è¡Œ<code class="fe nx ny nz oa b">node generateCoupons.js</code>ç”Ÿæˆä¼˜æƒ åˆ¸å¹¶ä¿å­˜åˆ°<code class="fe nx ny nz oa b">coupons.json</code>æ–‡ä»¶ä¸­ã€‚æå®šäº†ã€‚</p><h2 id="3149" class="ng mp iq bd mq nh ni dn mu nj nk dp my lf nl nm na lj nn no nc ln np nq ne nr bi translated">æ£€ç´¢</h2><p id="80f7" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">å› ä¸ºæ¯å¼ ä¼˜æƒ åˆ¸åªå¯¹ä¸€ä¸ªé’±åŒ…åœ°å€æœ‰æ•ˆï¼Œæ‰€ä»¥å¦‚æœä¼˜æƒ åˆ¸è¢«æš´éœ²å°±æ²¡æœ‰é£é™©ã€‚ç„¶è€Œï¼Œä¸ºäº†ä¿æŒç™½åå•çš„ç§å¯†æ€§ï¼Œå°†å®ƒéšè—åœ¨ä¸€ä¸ªAPIç«¯ç‚¹ä¹‹åä»ç„¶æ˜¯ä¸€ä¸ªå¥½ä¸»æ„ï¼Œè¯¥ç«¯ç‚¹å“åº”é’±åŒ…åœ°å€å¹¶åœ¨æ‰¾åˆ°æ—¶è¿”å›ç›¸åº”çš„ä¼˜æƒ åˆ¸ã€‚</p><p id="93c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è™½ç„¶ç¼–å†™ä¸€ä¸ªAPIæ¥æä¾›è¿™äº›ä¼˜æƒ åˆ¸è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ï¼Œä½†æ˜¯æˆ‘å¯ä»¥å‘æ‚¨å±•ç¤ºä½¿ç”¨ä¸‹é¢çš„ä»£ç æ¥æŸ¥æ‰¾å¹¶è¿”å›æ­£ç¡®çš„ä¼˜æƒ åˆ¸æ˜¯å¤šä¹ˆå®¹æ˜“:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="ff2c" class="ng mp iq oa b gy of og l oh oi">// retrieve the wallet from the query wallet<br/>const wallet = req.query.wallet</span><span id="6c01" class="ng mp iq oa b gy oj og l oh oi">// Find a coupon for the passed wallet address<br/>const c = coupons.filter(coupon =&gt; coupon.wallet.toLowerCase() === wallet.toLowerCase())</span><span id="a918" class="ng mp iq oa b gy oj og l oh oi">if (0 == c.length) {<br/>    return res.status(200).json({<br/>        coupon: null, <br/>        message: 'Coupon not found'<br/>    })<br/>}</span><span id="eab4" class="ng mp iq oa b gy oj og l oh oi">return res.status(200).json({coupon: c[0]})</span></pre><p id="b61d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ğŸ’¡<a class="ae kv" href="https://nextjs.org/" rel="noopener ugc nofollow" target="_blank"> Next.js </a>æ¡†æ¶æ˜¯æ„å»ºè¿™ä¸ªAPIå’Œå‰©ä¸‹çš„å‰ç«¯é€ å¸ç½‘ç«™çš„ç»ä½³é€‰æ‹©ã€‚</p><h2 id="fde5" class="ng mp iq bd mq nh ni dn mu nj nk dp my lf nl nm na lj nn no nc ln np nq ne nr bi translated">æ¶ˆè´¹</h2><p id="4675" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">åœ¨æˆ‘ä»¬çš„æ™ºèƒ½å¥‘çº¦ä¸­ï¼Œè®©æˆ‘ä»¬é¦–å…ˆå®šä¹‰ä¸€ä¸ª<code class="fe nx ny nz oa b">struct</code>æ¥è¡¨ç¤ºæˆ‘ä»¬çš„ä¼˜æƒ åˆ¸ã€‚</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="9c79" class="ng mp iq oa b gy of og l oh oi">struct Coupon {<br/>    bytes32 r;<br/>    bytes32 s;<br/>    uint8 v;<br/>}</span></pre><p id="9c3f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ‚¨å¯èƒ½ä¼šæ³¨æ„åˆ°ï¼Œè¿™çœ‹èµ·æ¥å·²ç»åƒæˆ‘ä»¬ç”¨Javascriptç”Ÿæˆçš„ä¼˜æƒ åˆ¸äº†ã€‚</p><p id="ad93" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨æˆ‘ä»¬çš„æ™ºèƒ½åˆçº¦ä¸­ï¼Œæˆ‘ä»¬éœ€è¦åšä¸€äº›äº‹æƒ…æ¥éªŒè¯ä¼˜æƒ åˆ¸æ˜¯æœ‰æ•ˆçš„ã€‚</p><ol class=""><li id="3704" class="ma mb iq ky b kz la lc ld lf mc lj md ln me lr ok mg mh mi bi translated">åˆ›å»ºä¸æˆ‘ä»¬åœ¨Javascriptä»£ç ä¸­åˆ›å»ºçš„ç›¸åŒçš„æ¶ˆæ¯æ‘˜è¦(åŒ…å«é’±åŒ…åœ°å€)ã€‚</li><li id="10af" class="ma mb iq ky b kz mj lc mk lf ml lj mm ln mn lr ok mg mh mi bi translated">ä½¿ç”¨æ¶ˆæ¯æ‘˜è¦æ¥æ¢å¤æˆ‘ä»¬ä¼˜æƒ åˆ¸çš„ç­¾åè€…ã€‚</li><li id="e079" class="ma mb iq ky b kz mj lc mk lf ml lj mm ln mn lr ok mg mh mi bi translated">ç¡®ä¿æ¢å¤çš„ç­¾åè€…å®é™…ä¸Šæ˜¯æˆ‘ä»¬ã€‚</li></ol><p id="e607" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨Solidityä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ç¼–å†™ä¸¤ä¸ªå†…éƒ¨å‡½æ•°æ¥å®ç°è¿™ä¸€ç‚¹:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="51e5" class="ng mp iq oa b gy of og l oh oi">// Recover the original signer by using the message digest and<br/>// the passed in coupon, to then confirm that the original<br/>// signer is in fact the _couponSigner set on this contract.</span><span id="c55b" class="ng mp iq oa b gy oj og l oh oi">function _isVerifiedCoupon(bytes32 digest, Coupon memory coupon)<br/>    internal<br/>    view<br/>    returns (bool)<br/>{<br/>    address signer = ecrecover(digest, coupon.v, coupon.r, coupon.s);<br/>    require(signer != address(0), "ECDSA: invalid signature");<br/>    return signer == _couponSigner;<br/>}</span><span id="dbe5" class="ng mp iq oa b gy oj og l oh oi">// Create the same message digest that we know the coupon created<br/>// in our JavaScript code has created.</span><span id="193c" class="ng mp iq oa b gy oj og l oh oi">function _createMessageDigest(address _address)<br/>    internal<br/>    pure<br/>    returns (bytes32)<br/>{<br/>    return keccak256(<br/>        abi.encodePacked(<br/>            "\x19Ethereum Signed Message:\n32",<br/>             keccak256(abi.encodePacked(_address))<br/>        )<br/>    );<br/>}</span></pre><p id="ca33" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥æ›´æ–°æˆ‘ä»¬çš„é“¸é€ åŠŸèƒ½ï¼Œä»¥ä½¿ç”¨æˆ‘ä»¬çš„æ–°ä¼˜æƒ åˆ¸ç³»ç»Ÿ:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="80b0" class="ng mp iq oa b gy of og l oh oi">function mint(Coupon memory coupon)<br/>    external<br/>    payable<br/>{</span><span id="c5db" class="ng mp iq oa b gy oj og l oh oi">    require(<br/>        _isVerifiedCoupon(_createMessageDigest(msg.sender), coupon),<br/>        "Coupon is not valid."<br/>    );</span><span id="3439" class="ng mp iq oa b gy oj og l oh oi">    // require that each wallet can only mint one token<br/>    require(<br/>        !_mintedAddresses[msg.sender],<br/>        "Wallet has already minted."<br/>    );</span><span id="9e30" class="ng mp iq oa b gy oj og l oh oi">    // Keep track of the fact that this wallet has minted a token<br/>    _mintedAddresses[msg.sender] = true;</span><span id="ded3" class="ng mp iq oa b gy oj og l oh oi">    // ...<br/>}</span></pre><p id="67b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘ä»¬åšåˆ°äº†ï¼ä¸ºäº†é˜²æ­¢ä¼˜æƒ åˆ¸è¢«é‡å¤ä½¿ç”¨ï¼Œè·Ÿè¸ªå·²ç»é“¸é€ çš„é’±åŒ…æ˜¯å¾ˆé‡è¦çš„ã€‚</p><p id="9484" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨é€ å¸ç½‘ç«™ä¸Šï¼Œæˆ‘ä»¬éœ€è¦åœ¨è°ƒç”¨é€ å¸å‡½æ•°æ—¶ä¼ é€’æˆ‘ä»¬çš„ä¼˜æƒ åˆ¸:</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="ecfe" class="ng mp iq oa b gy of og l oh oi">async function fetchCoupon(wallet) {<br/>    const res = await fetch(`/api/coupons?wallet=${wallet}`)</span><span id="bfe9" class="ng mp iq oa b gy oj og l oh oi">    return await res.json()<br/>}</span><span id="da19" class="ng mp iq oa b gy oj og l oh oi">async function mint(wallet) {<br/>    const coupon = await fetchCoupon(wallet)</span><span id="f6bd" class="ng mp iq oa b gy oj og l oh oi">    let tx = await contract.mint(coupon)</span><span id="94ff" class="ng mp iq oa b gy oj og l oh oi">    // ...</span><span id="18d4" class="ng mp iq oa b gy oj og l oh oi">}</span></pre><h1 id="4a33" class="mo mp iq bd mq mr ms mt mu mv mw mx my jw mz jx na jz nb ka nc kc nd kd ne nf bi translated">ç»“è®º</h1><p id="8cf9" class="pw-post-body-paragraph kw kx iq ky b kz ns jr lb lc nt ju le lf nu lh li lj nv ll lm ln nw lp lq lr ij bi translated">æ‚¨å·²ç»å­¦ä¹ äº†ä¸€ç§ç®€å•ã€å®‰å…¨ä¸”æœ‰æ•ˆçš„æ–¹æ³•æ¥å®æ–½NFTç™½åå•ã€‚</p><p id="c266" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¿™ç¯‡æ–‡ç« æ˜¯ä»æˆ‘å³å°†å‘è¡Œçš„æ–°ä¹¦ã€ŠNFTä½œå“é›†å¼€å‘è€…æŒ‡å—ã€‹ä¸­ç‰¹åˆ«æ”¹å†™çš„æ‘˜å½•ã€‚</p><pre class="kg kh ki kj gt ob oa oc od aw oe bi"><span id="a767" class="ng mp iq oa b gy of og l oh oi">If you'd like to get a head-start on learning to code an NFT Collection from scratch, check out my book: "<a class="ae kv" href="https://book.michaelstivala.com/" rel="noopener ugc nofollow" target="_blank">A developer's guide to launching an NFT Collection</a>" - use this link for 10% off!</span><span id="6b57" class="ng mp iq oa b gy oj og l oh oi"><a class="ae kv" href="https://twitter.com/MichaelStivala" rel="noopener ugc nofollow" target="_blank">Follow me on twitter</a> for more blockchain-related tips and tricks, and to follow along as I use my software development skills to build $10k/month in passive income.</span></pre></div></div>    
</body>
</html>