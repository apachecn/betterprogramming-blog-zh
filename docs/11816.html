<html>
<head>
<title>Demystifying GitOps â€” Ephemeral Pull Request Environments</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æ­å¼€æ•°å­—ç‰ˆæƒç®¡ç†çš„ç¥ç§˜é¢çº±â€”çŸ­æš‚çš„è¯·æ±‚è¯·æ±‚ç¯å¢ƒ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/demystifying-gitops-ephemeral-pull-request-environments-5f1032f01299?source=collection_archive---------12-----------------------#2022-04-19">https://betterprogramming.pub/demystifying-gitops-ephemeral-pull-request-environments-5f1032f01299?source=collection_archive---------12-----------------------#2022-04-19</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="fa56" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">å°†çŸ­æš‚ç¯å¢ƒç”¨äºéªŒæ”¶æµ‹è¯•ã€æ¸—é€æµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•æˆ–è´Ÿè½½æµ‹è¯•</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/3212e542420d617bc0a4802c94a9dd17.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*SPzybxN1JDN5E2Im"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@synkevych?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">ç½—æ›¼Â·è¾›å…‹ç»´å¥‡Â·ğŸ‡ºğŸ‡¦</a>åœ¨<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šçš„ç…§ç‰‡</p></figure><p id="0ac2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘æƒ³æ¼”ç¤ºå¦‚ä½•ä¸ºåœ¨GitHubä¸Šåˆ›å»ºçš„è¯·æ±‚è®¾ç½®ä¸´æ—¶ç¯å¢ƒã€‚è¿™å¯ä»¥åº”ç”¨äºArgo CDæ‹‰è¯·æ±‚ç”Ÿæˆå™¨æ”¯æŒçš„ä»»ä½•SCMã€‚æ²¡æœ‰ä¸€ç§æ–¹æ³•å’Œä¸€å¥—å·¥å…·æ¥å®ç°è¿™ç§ç‰¹æ€§ã€‚</p><p id="360e" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘å°†ä½¿ç”¨ä¸¤ç§ä¸åŒçš„Kubernetesé£æ ¼ä½œä¸ºæ‹‰è¯·æ±‚ç¯å¢ƒï¼Œç¬¬ä¸€ç§æ˜¯Kubernetesåç§°ç©ºé—´ï¼Œç¬¬äºŒç§æ˜¯è™šæ‹ŸKubernetesé›†ç¾¤ï¼Œå®ƒå¯ä»¥æä¾›æ›´å¥½çš„éš”ç¦»ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ls"><img src="../Images/8ba3d74b24c0f32a8572dd152366e0ca.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*LUo_ulLybI3y2-fP.png"/></div></div></figure><h1 id="23e3" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">æ‰€ç”¨å·¥å…·</strong></h1><ol class=""><li id="cdb9" class="ml mm iq ky b kz mn lc mo lf mp lj mq ln mr lr ms mt mu mv bi translated">Argo CDæ‹‰å–è¯·æ±‚ç”Ÿæˆå™¨:Argo CDæ‹‰å–è¯·æ±‚ç”Ÿæˆå™¨æ˜¯å…¶ä¸­ä¸€ä¸ªåº”ç”¨ç¨‹åºç”Ÿæˆå™¨ï¼Œç”¨äºç›‘è§†SCMçš„æ–°æ‹‰å–è¯·æ±‚ï¼Œç„¶åæ ¹æ®è¿™äº›æ‹‰å–è¯·æ±‚ç”Ÿæˆå¿…è¦çš„åº”ç”¨ç¨‹åºå®šä¹‰ã€‚</li><li id="536d" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">GithubåŠ¨ä½œ:GithubåŠ¨ä½œç”¨äºæ­¤åŠŸèƒ½çš„CIéƒ¨åˆ†ã€‚æ¯å½“ç”Ÿæˆæ–°çš„æ‹‰å–è¯·æ±‚æ—¶ï¼Œéƒ½ä¼šè§¦å‘ä¸€ä¸ªGithubæ“ä½œï¼Œä¸ºæ‹‰å–è¯·æ±‚çš„è¦ç´ åˆ†æ”¯ç”Ÿæˆå¹¶æ¨é€å®¹å™¨æ˜ åƒã€‚</li><li id="dfb4" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">vccluster:vcclusterç”¨äºæ­¤åŠŸèƒ½çš„è™šæ‹ŸKubernetesç¾¤é›†éƒ¨åˆ†ã€‚è¿™æ˜¯Loft Labsåœ¨K3Sã€K0Sæˆ–æ™®é€šK8Sçš„åŸºç¡€ä¸Šå¼€å‘çš„ä¸€æ¬¾å¾ˆæ£’çš„å·¥å…·ã€‚å¯¹äºè¿™ä¸ªæ¼”ç¤ºï¼Œæˆ‘å°è¯•äº†K3Så’ŒK0Sã€‚ç”±äºæˆ‘åœ¨K3Så®‰è£…è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜ï¼Œæœ€ç»ˆç‰ˆæœ¬ä¾èµ–äºK0Sã€‚</li><li id="1e96" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated">ArgoCD Secret Synchronizer:ä¸€ä¸ªæˆ‘ä¸ºå®éªŒç›®çš„å¼€å‘çš„è‡ªå®šä¹‰æ“ä½œç¬¦ï¼Œç”¨äºå°†Vclusteråˆ›å»ºçš„æœºå¯†ä¸Argo CD Clusterçš„æœºå¯†è¿›è¡ŒåŒæ­¥ã€‚é€šè¿‡ä½¿ç”¨è¯¥è¿è¥å•†ï¼Œæ¶ˆé™¤äº†æ‰‹åŠ¨å¹²é¢„è¦æ±‚ï¼Œå¹¶ä¸”æ‰€åˆ›å»ºçš„è™šæ‹Ÿé›†ç¾¤è¢«è‡ªåŠ¨æ·»åŠ åˆ°Argo CDç®¡ç†é›†ç¾¤çš„åˆ—è¡¨ä¸­ã€‚</li></ol><p id="b6f8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">é™¤äº†ä¸Šé¢è¿™äº›ä¹‹å¤–ï¼Œæ‚¨è¿˜éœ€è¦æœ‰ä¸€ä¸ªå…·æœ‰ç®¡ç†æƒé™çš„Kubernetesé›†ç¾¤(å¯ä»¥ä½¿ç”¨Killercodaï¼Œæœ‰å…³ç¤ºä¾‹åœºæ™¯ï¼Œè¯·å‚è§æ„ä»¶éƒ¨åˆ†)ï¼Œç”¨äºåº”ç”¨ç¨‹åºä»£ç çš„Githubå­˜å‚¨åº“ã€helm chartsã€Argo CD CRDså’ŒArgo CDåº”ç”¨ç¨‹åºèµ„æºå®šä¹‰ã€‚</p><h1 id="538a" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak"> Githubå­˜å‚¨åº“</strong></h1><ol class=""><li id="67dd" class="ml mm iq ky b kz mn lc mo lf mp lj mq ln mr lr ms mt mu mv bi translated"><code class="fe nb nc nd ne b"><a class="ae kv" href="https://github.com/a1tan/ephemeralenvironments" rel="noopener ugc nofollow" target="_blank"><strong class="ky ir">ephemeralenvironments</strong></a></code>:è¿™ä¸ªgitå­˜å‚¨åº“åŒ…å«Argo CD CRDsã€æ‹‰è¯·æ±‚<code class="fe nb nc nd ne b">applicationset</code>å®šä¹‰å’ŒArgo CDç§˜å¯†åŒæ­¥èµ„æºå®šä¹‰ã€‚æ‰€æœ‰è¿™äº›èµ„æºéƒ½ç”±kustomizationç®¡ç†ã€‚<code class="fe nb nc nd ne b">kustomization.yaml</code>æ–‡ä»¶å¯ä»¥åœ¨æ¯ä¸ªæ–‡ä»¶å¤¹ä¸­çœ‹åˆ°ã€‚</li></ol><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nf"><img src="../Images/f3ffb24f819efdafdd07ed814a1ad9cb.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*Bykvy8CaO7gddI52gVJB8Q.png"/></div></div></figure><p id="309d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¦‚æœæ‚¨æƒ³è¿è¡Œè¿™ä¸ªç¤ºä¾‹ï¼Œå…‹éš†è¿™ä¸ªgitå­˜å‚¨åº“å¹¶æ‰§è¡Œä¸‹é¢çš„ä¸¤ä¸ªå‘½ä»¤:</p><ul class=""><li id="bcfa" class="ml mm iq ky b kz la lc ld lf ng lj nh ln ni lr nj mt mu mv bi translated"><code class="fe nb nc nd ne b">kubectl apply -k ephemeralenvironments/managementstack/argocd</code></li><li id="0738" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr nj mt mu mv bi translated"><code class="fe nb nc nd ne b">kubectl apply -k ephemeralenvironments/managementstack/argocdapplications</code></li></ul><p id="96c4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç¬¬ä¸€ä¸ªå°†Argo CD CRDså’Œèµ„æºåº”ç”¨åˆ°ç”±<code class="fe nb nc nd ne b">kubeconfig</code>æ–‡ä»¶æŒ‡å‘çš„ç®¡ç†é›†ç¾¤ï¼Œç¬¬äºŒä¸ªåˆ›å»ºä¸€ä¸ª<code class="fe nb nc nd ne b">applicationset</code>å®šä¹‰ï¼Œè¯¥å®šä¹‰ä¸ºä¸Šè¿°äº”ä¸ªæ–‡ä»¶å¤¹ç”ŸæˆArgo CDåº”ç”¨ã€‚<a class="ae kv" href="https://www.katacoda.com/a1tan/scenarios/ephemeralenvironments" rel="noopener ugc nofollow" target="_blank">å¦‚æœæ‚¨æ„¿æ„ï¼Œæˆ‘ä»¬æ„å»ºäº†ä¸€ä¸ªKillecodaåœºæ™¯</a>æ¥æ¼”ç¤ºè¿™äº›æ­¥éª¤ã€‚</p><p id="76b7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">2.<code class="fe nb nc nd ne b"><a class="ae kv" href="https://github.com/a1tan/ephemeralcluster" rel="noopener ugc nofollow" target="_blank">ephemeralcluster</a></code> : <strong class="ky ir"> </strong>è¿™ä¸ªgitå­˜å‚¨åº“åŒ…å«ä»¥å£°æ˜æ–¹å¼éƒ¨ç½²Vclusterçš„èˆµå›¾ã€‚åœ¨ä¸Šé¢çš„<code class="fe nb nc nd ne b">ephemeralenvironments</code>ä»“åº“çš„<code class="fe nb nc nd ne b">pullrequests</code>ç›®å½•ä¸­æœ‰ä¸€ä¸ª<code class="fe nb nc nd ne b">applicationset</code>å®šä¹‰æŒ‡å‘è¿™ä¸ªä»“åº“ã€‚</p><p id="4685" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">3.<code class="fe nb nc nd ne b"><a class="ae kv" href="https://github.com/a1tan/app-ephemeraltest" rel="noopener ugc nofollow" target="_blank">app-ephemeraltest</a></code>:è¯¥åº“åŒ…å«ç¤ºä¾‹åº”ç”¨ç¨‹åºä»£ç (ä¸€ä¸ªç®€å•çš„dotnet api)ã€dockerfileã€helm chartã€GitHub actionså®šä¹‰ï¼Œç”¨äºä¸ºæ¯ä¸ªpullè¯·æ±‚æ„å»ºå’Œæ¨é€å›¾åƒï¼Œä»¥åŠåœ¨ç¤ºä¾‹åœºæ™¯ä¸­æ¼”ç¤ºçš„ç¤ºä¾‹pullè¯·æ±‚ã€‚<code class="fe nb nc nd ne b"><a class="ae kv" href="https://github.com/a1tan/app-ephemeraltest/tree/f-ephemeralpullrequest" rel="noopener ugc nofollow" target="_blank">f-ephemeralpullrequest</a></code>åˆ†æ”¯ç”¨äºè¯¥æ ·æœ¬ï¼Œå¹¶ä»è¯¥åˆ†æ”¯åˆ›å»ºæ ·æœ¬æ‹‰å–è¯·æ±‚ï¼Œä»¥åˆå¹¶åˆ°<code class="fe nb nc nd ne b">main</code>åˆ†æ”¯ã€‚</p><h1 id="dcf1" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">æ‹‰å–è¯·æ±‚ç”Ÿæˆå™¨</strong></h1><p id="e1c3" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">æ‹‰è¯·æ±‚ç”Ÿæˆå™¨æ˜¯Argo CDæ¨¡æ¿ç”Ÿæˆå™¨ä¹‹ä¸€ï¼Œå®ƒä½¿ç”¨SCM APIsæ¥è·å–æ‹‰è¯·æ±‚ä¿¡æ¯å¹¶ç”Ÿæˆå¿…è¦çš„åº”ç”¨ç¨‹åºå®šä¹‰ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<code class="fe nb nc nd ne b">applicationset</code>æ§åˆ¶å™¨ä»¥30ç§’çš„æ—¶é—´é—´éš”è½®è¯¢SCM APIsï¼Œå¦‚æœéœ€è¦å¯ä»¥æ›´æ”¹ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œå¦‚æœéœ€è¦ï¼ŒSCMs webhookä¹Ÿå¯ä»¥é…ç½®ä¸ºè§¦å‘<code class="fe nb nc nd ne b">applicationset</code>æ§åˆ¶å™¨ä»¥æ¶ˆé™¤ç­‰å¾…æ—¶é—´ã€‚</p><h2 id="19c9" class="nn lu iq bd lv no np dn lz nq nr dp md lf ns nt mf lj nu nv mh ln nw nx mj ny bi translated"><strong class="ak">éƒ¨ç½²åˆ°è™šæ‹Ÿé›†ç¾¤</strong></h2><p id="0f20" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">ä¸‹é¢ç»™å‡ºäº†ç”¨äºå°†ç¤ºä¾‹åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°è™šæ‹Ÿé›†ç¾¤çš„æ‹‰è¯·æ±‚ç”Ÿæˆå™¨:</p><pre class="kg kh ki kj gt nz ne oa ob aw oc bi"><span id="d622" class="nn lu iq ne b gy od oe l of og">apiVersion: argoproj.io/v1alpha1<br/>kind: ApplicationSet<br/>metadata:<br/>  name: sampleapps<br/>  namespace: argocd<br/>spec:<br/>  generators:<br/>  - pullRequest:<br/>      github:<br/>          owner: a1tan<br/>          repo: app-ephemeraltest<br/>      requeueAfterSeconds: 120<br/>  template:<br/>    metadata:<br/>      name: 'sampleapp-{{branch}}-{{number}}'<br/>    spec:<br/>      source:<br/>        repoURL: '<a class="ae kv" href="https://github.com/a1tan/app-ephemeraltest.git'" rel="noopener ugc nofollow" target="_blank">https://github.com/a1tan/app-ephemeraltest.git'</a><br/>        targetRevision: '{{head_sha}}'<br/>        path: charts/sampleapp<br/>        helm:<br/>          parameters:<br/>          - name: "image.tag"<br/>            value: "pull-{{head_sha}}"<br/>          - name: "environment"<br/>            value: "PR-Vcluster-Dev"<br/>      project: default<br/>      destination:<br/>        server: <a class="ae kv" href="https://cluster-{{branch}}-{{number}}.cluster-{{branch}}-{{number}}-namespace.svc.cluster.local" rel="noopener ugc nofollow" target="_blank">https://cluster-{{branch}}-{{number}}.cluster-{{branch}}-{{number}}-namespace.svc.cluster.local</a><br/>        namespace: 'sampleapp-{{branch}}-{{number}}-namespace'<br/>      syncPolicy:<br/>          automated:<br/>              allowEmpty: true<br/>              prune: true<br/>              selfHeal: true</span></pre><p id="394c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¿™ä¸ªæ‹‰è¯·æ±‚ç”Ÿæˆå™¨ç›‘å¬Githubå¸æˆ·â€œa1tanâ€å’Œå­˜å‚¨åº“<code class="fe nb nc nd ne b">app-ephemeraltest</code>ä¸Šçš„æ‹‰è¯·æ±‚ã€‚</p><p id="853c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å®ƒè¿˜å°†è½®è¯¢é—´éš”æ›´æ”¹ä¸º120ç§’ï¼Œè¿™åœ¨ç°å®ä¸–ç•Œä¸­å¯èƒ½å¾ˆçƒ¦äººã€‚å½“å®ƒæ£€æµ‹åˆ°ä¸€ä¸ªæ–°çš„æ‹‰è¯·æ±‚æ—¶ï¼Œå®ƒåˆ›å»ºä¸€ä¸ªç”¨<code class="fe nb nc nd ne b">sampleapp-{{branch}}-{{number}}</code>æ¨¡å¼å‘½åçš„åº”ç”¨ç¨‹åºã€‚å®ƒå°†åœ¨å¸¦æœ‰<code class="fe nb nc nd ne b">targetRevision: â€˜{{head_sha}}</code>çš„åˆ†æ”¯å’Œå¸¦æœ‰<code class="fe nb nc nd ne b">path: charts/sampleapp</code>çš„è·¯å¾„ä¸Šæ‰§è¡Œæœ€æ–°çš„æäº¤ã€‚å®ƒè¿˜å°†å›¾åƒæ ‡ç­¾è®¾ç½®ä¸º<code class="fe nb nc nd ne b">pull-{{head_sha}}</code>ï¼Œè¯¥æ ‡ç­¾æŒ‡å‘Github Actions CIç®¡é“æ„å»ºçš„æœ€æ–°pullè¯·æ±‚å›¾åƒã€‚è¿˜æœ‰å¦ä¸€ä¸ªå¤´ç›”å‚æ•°æ¥åŒºåˆ†è¿™ä¸ªéƒ¨ç½²å’Œä¸‹é¢çš„<code class="fe nb nc nd ne b">namespace</code>ç‰ˆæœ¬ã€‚</p><p id="5b47" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¯¹äºç›®çš„åœ°ï¼Œè¯¥<code class="fe nb nc nd ne b">applicationset</code>ä½¿ç”¨ä¸ä¸»<code class="fe nb nc nd ne b">kubernetes</code>é›†ç¾¤ä¸åŒçš„é›†ç¾¤å‚è€ƒä½œä¸º<code class="fe nb nc nd ne b">server: <a class="ae kv" href="https://cluster-{{branch}}-{{number}}.cluster-{{branch}}-{{number}}-namespace.svc.cluster.local" rel="noopener ugc nofollow" target="_blank">https://cluster-{{branch}}-{{number}}.cluster-{{branch}}-{{number}}-namespace.svc.cluster.local</a></code>ã€‚å®ƒå°†è¿™ä¸ªåº”ç”¨ç¨‹åºåº”ç”¨åˆ°ä¸€ä¸ªæ–°åˆ›å»ºçš„ä¸´æ—¶è™šæ‹Ÿé›†ç¾¤å®ä¾‹ã€‚</p><p id="02e0" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸‹é¢çš„æ‹‰è¯·æ±‚ç”Ÿæˆå™¨ä¹Ÿéƒ¨ç½²äº†æ­¤å®ä¾‹:</p><pre class="kg kh ki kj gt nz ne oa ob aw oc bi"><span id="29ac" class="nn lu iq ne b gy od oe l of og">apiVersion: argoproj.io/v1alpha1<br/>kind: ApplicationSet<br/>metadata:<br/>  name: ephemeralcluster<br/>  namespace: argocd<br/>spec:<br/>  generators:<br/>  - pullRequest:<br/>      github:<br/>          owner: a1tan<br/>          repo: app-ephemeraltest<br/>      requeueAfterSeconds: 120<br/>  template:<br/>    metadata:<br/>      name: 'cluster-{{branch}}-{{number}}'<br/>    spec:<br/>      source:<br/>        repoURL: '<a class="ae kv" href="https://github.com/a1tan/ephemeralcluster.git'" rel="noopener ugc nofollow" target="_blank">https://github.com/a1tan/ephemeralcluster.git'</a><br/>        targetRevision: 'main'<br/>        path: charts/vcluster<br/>        helm:<br/>          parameters:<br/>          - name: "syncer.extraArgs[0]"<br/>            value: "--out-kube-config-server=<a class="ae kv" href="https://cluster-{{branch}}-{{number}}.cluster-{{branch}}-{{number}}-namespace.svc.cluster.local" rel="noopener ugc nofollow" target="_blank">https://cluster-{{branch}}-{{number}}.cluster-{{branch}}-{{number}}-namespace.svc.cluster.local</a>"<br/>          - name: "syncer.extraArgs[1]"<br/>            value: "--tls-san=cluster-{{branch}}-{{number}}.cluster-{{branch}}-{{number}}-namespace.svc.cluster.local"<br/>      project: default<br/>      destination:<br/>        server: <a class="ae kv" href="https://kubernetes.default.svc" rel="noopener ugc nofollow" target="_blank">https://kubernetes.default.svc</a><br/>        namespace: 'cluster-{{branch}}-{{number}}-namespace'<br/>      syncPolicy:<br/>          automated:<br/>              allowEmpty: true<br/>              prune: true<br/>              selfHeal: true</span></pre><p id="3108" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨æ­¤<code class="fe nb nc nd ne b">applicationset</code>å®šä¹‰æœåŠ¡å™¨å¼•ç”¨ä¸åŒï¼Œ<code class="fe nb nc nd ne b">server: <a class="ae kv" href="https://kubernetes.default.svc" rel="noopener ugc nofollow" target="_blank">https://kubernetes.default.svc</a></code>ã€‚Vclusteréƒ¨ç½²åˆ°ä¸»ç¾¤é›†ä¸­çš„å‘½åç©ºé—´ã€‚å®ƒè¿˜æœ‰ä¸¤ä¸ªhelmå‚æ•°<code class="fe nb nc nd ne b">â€” out-kube-config-server</code>å’Œ<code class="fe nb nc nd ne b">â€” tls-san</code>ï¼Œä½¿åˆ›å»ºçš„Vclusterå¯ä»¥ä»Argo CDå®ä¾‹è®¿é—®ã€‚</p><p id="7348" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¯¥åº”ç”¨ç¨‹åºåœ¨<code class="fe nb nc nd ne b">main</code>ç¾¤é›†çš„<code class="fe nb nc nd ne b">cluster-{{branch}}-{{number}}-namespace</code>å‘½åç©ºé—´ä¸Šåˆ›å»ºæ‰€æœ‰Vclusterèµ„æºã€‚åœ¨è¿™ä¸ªåç§°ç©ºé—´ä¸Šè¿˜åˆ›å»ºäº†ä¸€ä¸ªåŒ…å«ç”¨äºè®¿é—®è¿™ä¸ªè™šæ‹Ÿé›†ç¾¤å®ä¾‹çš„<code class="fe nb nc nd ne b">kubeconfig</code>çš„å¯†ç ã€‚</p><p id="04d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe nb nc nd ne b">ArgoCDSecretSynchronizer</code>æ“ä½œå‘˜åˆ©ç”¨æ­¤<code class="fe nb nc nd ne b">kubeconfig</code>å¹¶åˆ›å»ºå¿…è¦çš„Argo CDç°‡ç§˜å¯†ã€‚è¿™æ ·ï¼Œä¸»é›†ç¾¤ä¸Šçš„Argo CDå®ä¾‹å¯ä»¥ç®¡ç†è™šæ‹Ÿé›†ç¾¤ä¸Šçš„ç¤ºä¾‹åº”ç”¨ç¨‹åºã€‚</p><h2 id="dfe5" class="nn lu iq bd lv no np dn lz nq nr dp md lf ns nt mf lj nu nv mh ln nw nx mj ny bi translated"><strong class="ak">éƒ¨ç½²åˆ°åç§°ç©ºé—´</strong></h2><p id="890b" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">è¿˜æœ‰ç¬¬ä¸‰ä¸ªæ‹‰è¯·æ±‚ç”Ÿæˆå™¨å®šä¹‰ï¼Œç”¨äºå°†ç¤ºä¾‹åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°ä¸»é›†ç¾¤ä¸Šçš„åç§°ç©ºé—´ã€‚</p><p id="16c3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¦‚æœæ‚¨éœ€è¦ä¸€ä¸ªæ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆï¼Œå¹¶ä¸”ä¸æƒ³ä¸ºæ¯ä¸ªæ‹‰è¯·æ±‚åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿé›†ç¾¤ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªè®¾ç½®ã€‚</p><pre class="kg kh ki kj gt nz ne oa ob aw oc bi"><span id="9abb" class="nn lu iq ne b gy od oe l of og">apiVersion: argoproj.io/v1alpha1<br/>kind: ApplicationSet<br/>metadata:<br/>  name: sampleapps-ns<br/>  namespace: argocd<br/>spec:<br/>  generators:<br/>  - pullRequest:<br/>      github:<br/>          owner: a1tan<br/>          repo: app-ephemeraltest<br/>      requeueAfterSeconds: 120<br/>  template:<br/>    metadata:<br/>      name: 'sampleapp-ns-{{branch}}-{{number}}'<br/>      # namespace: 'myapp-{{branch}}-{{number}}-namespace'<br/>    spec:<br/>      source:<br/>        repoURL: '<a class="ae kv" href="https://github.com/a1tan/app-ephemeraltest.git'" rel="noopener ugc nofollow" target="_blank">https://github.com/a1tan/app-ephemeraltest.git'</a><br/>        targetRevision: '{{head_sha}}'<br/>        path: charts/sampleapp<br/>        helm:<br/>          parameters:<br/>          - name: "image.tag"<br/>            value: "pull-{{head_sha}}"<br/>          - name: "environment"<br/>            value: "PR-Namespace-Dev"<br/>      project: default<br/>      destination:<br/>        server: <a class="ae kv" href="https://kubernetes.default.svc" rel="noopener ugc nofollow" target="_blank">https://kubernetes.default.svc</a><br/>        namespace: 'sampleapp-ns-{{branch}}-{{number}}-namespace'<br/>      syncPolicy:<br/>          automated:<br/>              allowEmpty: true<br/>              prune: true<br/>              selfHeal: true</span></pre><p id="170b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸å…¶ä»–ç¤ºä¾‹<code class="fe nb nc nd ne b">applicationset</code>å®šä¹‰çš„å”¯ä¸€åŒºåˆ«æ˜¯æœåŠ¡å™¨é€‰æ‹©å™¨<code class="fe nb nc nd ne b">server: <a class="ae kv" href="https://kubernetes.default.svc" rel="noopener ugc nofollow" target="_blank">https://kubernetes.default.svc</a></code>ã€‚é€šè¿‡è¿™ä¸ªæœåŠ¡å™¨é€‰æ‹©å™¨ï¼Œç¤ºä¾‹åº”ç”¨ç¨‹åºè¢«éƒ¨ç½²åˆ°<code class="fe nb nc nd ne b">main</code>é›†ç¾¤ä¸Šçš„<code class="fe nb nc nd ne b">sampleapp-ns-{{branch}}-{{number}}-namespace</code>åç§°ç©ºé—´ã€‚Helmç¯å¢ƒå‚æ•°çš„è®¾ç½®ä¹Ÿæœ‰æ‰€ä¸åŒï¼Œä»¥éªŒè¯åº”ç”¨ç¨‹åºçš„éƒ¨ç½²æ˜¯å¦æ­£ç¡®ã€‚</p><h1 id="2a68" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">æç¤º</strong></h1><p id="2634" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">è¦è®°ä½çš„ä¸€ç‚¹æ˜¯ï¼Œå¦‚æœä½ åœ¨ä½ çš„èˆµå›¾ä¸­ä½¿ç”¨ä¸€ä¸ªåˆ†æ”¯åç§°ä½œä¸ºä½ çš„æœåŠ¡åç§°ï¼Œè¦å°å¿ƒä½ çš„åˆ†æ”¯å‘½åç­–ç•¥ï¼Œå®ƒå¿…é¡»æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„DNSåç§°ã€‚å› æ­¤ï¼Œæ‚¨å¯ä»¥é€‰æ‹©â€œf-blablaâ€ç±»å‹çš„å‘½åï¼Œè€Œä¸æ˜¯ä½¿ç”¨feature/blablaç±»å‹çš„å‘½åã€‚</p><p id="314f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä½ å¯ä»¥åœ¨ä¸‹é¢æ‰¾åˆ°æˆ‘å› ä¸ºè¿™ä¸ªé”™è¯¯æ”¶åˆ°çš„é”™è¯¯ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oh"><img src="../Images/622c616fc79d0b81bcab15c3c770c20b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*89kUROoEPE2rYsuARYNGxg.png"/></div></div></figure><p id="965f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Githubé€Ÿç‡é™åˆ¶ä¹Ÿæ˜¯ä¸€ä¸ªå…³é”®é—®é¢˜ã€‚å¯¹äºè¿™ä¸ªç¤ºä¾‹çš„ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œæˆ‘ä½¿ç”¨äº†é»˜è®¤å€¼30ç§’ã€‚åœ¨å¤ªå¤šæ¬¡ä¸æˆåŠŸçš„åŒæ­¥å°è¯•åï¼Œæ”¶åˆ°ä¸‹é¢çš„é€Ÿç‡é™åˆ¶é”™è¯¯ï¼Œç„¶åæˆ‘å°†requeueå‘¨æœŸå¢åŠ åˆ°120ç§’ã€‚å¯¹äºè¿™äº›é€Ÿç‡é™åˆ¶ï¼ŒWebhooké…ç½®æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oi"><img src="../Images/b007bcfc912b57a24c97cd4ccbfd4f4d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*lJ645C7nfKGB97y61K4JfQ.png"/></div></div></figure><p id="af7a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸è¦å¿˜è®°åœ¨githubåŠ¨ä½œä¸Šä½¿ç”¨<code class="fe nb nc nd ne b">${{ github.event.pull_request.head.sha }}</code>æ¥è¯·æ±‚æäº¤shaã€‚ä½¿ç”¨æ­¤è¡¨è¾¾å¼æ ‡è®°æ‚¨çš„å›¾åƒï¼Œä»¥æˆåŠŸè·å–Argo CDä¸Šçš„ç‰¹å®šæ‹‰è¯·æ±‚å›¾åƒã€‚</p><h1 id="d602" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">ç»“è®º</strong></h1><p id="5607" class="pw-post-body-paragraph kw kx iq ky b kz mn jr lb lc mo ju le lf nk lh li lj nl ll lm ln nm lp lq lr ij bi translated">å¦‚æœæ‚¨å¸Œæœ›æ‚¨çš„ç‰¹æ€§åœ¨åˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¹‹å‰ç¬¦åˆdoneçš„å®šä¹‰ï¼Œé‚£ä¹ˆåˆ›å»ºæ‹‰è¯·æ±‚ç¯å¢ƒæ˜¯ä¸€ä¸ªå…³é”®æ­¥éª¤ã€‚</p><p id="707c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ‚¨å¯ä»¥ä½¿ç”¨çŸ­æš‚çš„ç¯å¢ƒè¿›è¡ŒéªŒæ”¶æµ‹è¯•ã€æ¸—é€æµ‹è¯•ã€ç«¯åˆ°ç«¯æµ‹è¯•æˆ–è´Ÿè½½æµ‹è¯•ã€‚ä¾èµ–æ€§ç®¡ç†æ˜¯æœ¬æ–‡ä¸­æˆ‘ä»¬æ²¡æœ‰æåˆ°çš„å¦ä¸€ä¸ªå…³é”®é—®é¢˜ã€‚</p><p id="a634" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å½“ç„¶ï¼Œå°†ä¸€ä¸ªç®€å•çš„åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ°ä¸€ä¸ªç¯å¢ƒä¸­æ˜¯ä¸å¤Ÿçš„ã€‚è¿™ä¸ªåº”ç”¨ç¨‹åºæœ‰å¾ˆå¤šä¾èµ–é¡¹ï¼ŒåŒ…æ‹¬æ•°æ®åº“ã€æ•°æ®åº“è¡¨ã€åˆ†å¸ƒå¼ç¼“å­˜æœåŠ¡ã€å¯†é’¥åº“ã€èº«ä»½æä¾›è€…ã€æ¶ˆæ¯ä»£ç†ï¼Œç”šè‡³æ ¹æ®æˆ‘ä»¬æƒ³è¦æµ‹è¯•çš„åœºæ™¯çš„å…¶ä»–æœåŠ¡ã€‚</p><p id="579c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ‰€æœ‰è¿™äº›éƒ½éœ€è¦ä»¥ä¸€ç§é€‚ç”¨äºè¿™ç§çŸ­æš‚ç¯å¢ƒçš„æ–¹å¼æ¥å®šä¹‰ã€‚æ‰“åŒ…æ–¹æ³•å’Œå·¥å…·ä¹Ÿè¢«ç¡®å®šæ¥ç®¡ç†è¿™æ ·çš„éœ€æ±‚ã€‚åœ¨åé¢çš„å¸–å­ä¸­ï¼Œæˆ‘æƒ³è¯¦ç»†é˜è¿°è¿™ä¸ªè¯é¢˜ã€‚</p><h1 id="2de2" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated"><strong class="ak">å·¥ä»¶</strong></h1><ul class=""><li id="5e2d" class="ml mm iq ky b kz mn lc mo lf mp lj mq ln mr lr nj mt mu mv bi translated"><a class="ae kv" href="https://killercoda.com/altanaltundemir/scenario/ephemeralenvironments" rel="noopener ugc nofollow" target="_blank">æ€æ‰‹ç§‘è¾¾åœºæ™¯</a></li><li id="89a8" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr nj mt mu mv bi translated"><a class="ae kv" href="https://github.com/a1tan/ephemeralenvironments" rel="noopener ugc nofollow" target="_blank">åº”ç”¨ç¨‹åºå®šä¹‰çš„Githubå­˜å‚¨åº“</a></li><li id="14c2" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr nj mt mu mv bi translated"><a class="ae kv" href="https://github.com/a1tan/app-ephemeraltest" rel="noopener ugc nofollow" target="_blank">ç¤ºä¾‹åº”ç”¨ç¨‹åºçš„Githubå­˜å‚¨åº“</a></li><li id="7bb5" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr nj mt mu mv bi translated">ã€Vclusterèµ„æºçš„Githubå­˜å‚¨åº“</li></ul><h1 id="ee1d" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">å‚è€ƒ</h1><ol class=""><li id="eb2c" class="ml mm iq ky b kz mn lc mo lf mp lj mq ln mr lr ms mt mu mv bi translated"><a class="ae kv" href="https://argocd-applicationset.readthedocs.io/en/stable/Generators-Pull-Request/" rel="noopener ugc nofollow" target="_blank">æ‹‰è¯·æ±‚å‘ç”Ÿå™¨</a></li><li id="ae11" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><a class="ae kv" href="https://www.vcluster.com/docs/getting-started/deployment" rel="noopener ugc nofollow" target="_blank"> Vcluster </a></li><li id="a8fd" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr ms mt mu mv bi translated"><a class="ae kv" href="https://github.com/a1tan/argocdsecretsynchronizer" rel="noopener ugc nofollow" target="_blank"> Argo CDç§˜å¯†åŒæ­¥å™¨</a></li></ol><h1 id="da3d" class="lt lu iq bd lv lw lx ly lz ma mb mc md jw me jx mf jz mg ka mh kc mi kd mj mk bi translated">ä»¥å‰çš„</h1><ul class=""><li id="8ac1" class="ml mm iq ky b kz mn lc mo lf mp lj mq ln mr lr nj mt mu mv bi translated"><a class="ae kv" href="https://medium.com/p/fbfee94f8188/edit" rel="noopener">æ­ç§˜GitOps-Bootstrapping Flux </a></li><li id="86b1" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr nj mt mu mv bi translated"><a class="ae kv" href="https://medium.com/@aaltundemir/demystifying-gitops-bootstrapping-argo-cd-4a861284f273" rel="noopener">æ­ç§˜GitOps-å¼•å¯¼Argo CD </a></li><li id="b0bd" class="ml mm iq ky b kz mw lc mx lf my lj mz ln na lr nj mt mu mv bi translated"><a class="ae kv" href="https://medium.com/@aaltundemir/demystifying-gitops-intro-2b9c3cbef404" rel="noopener">æ­ç§˜GitOps-ç®€ä»‹</a></li></ul></div></div>    
</body>
</html>