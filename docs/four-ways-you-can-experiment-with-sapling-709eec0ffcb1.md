# æˆ‘å¯¹ Sapling çš„ç¬¬ä¸€å°è±¡â€”â€”Meta çš„æ–° Git å®¢æˆ·ç«¯

> åŸæ–‡ï¼š<https://betterprogramming.pub/four-ways-you-can-experiment-with-sapling-709eec0ffcb1>

## å°è¯•å †å æ‹‰å–è¯·æ±‚

![](img/01fb5e394f4b3b7f3bd4be5662d3b0c8.png)

[Sapling](https://sapling-scm.com/docs/introduction/) æ˜¯ Meta å¼€å‘çš„æ–°æºç æ§åˆ¶ç³»ç»Ÿã€‚æœ€è¿‘ï¼Œå®ƒè·å¾—äº†ä¸ GitHub åˆä½œçš„èƒ½åŠ›ã€‚æˆ‘å¾ˆå¥½å¥‡å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œæ‰€ä»¥æˆ‘å†³å®šå°è¯•ä¸€ä¸‹ï¼Œå¹¶æœ€ç»ˆåœ¨æˆ‘å…¬å¸çš„ä»“åº“ä¸­æ¯å¤©ä½¿ç”¨å®ƒã€‚å¦‚æœä½ æƒ³å°è¯•ä¸€ä¸‹ï¼Œè¯·ç‚¹å‡»æŸ¥çœ‹ä»–ä»¬çš„æ–‡æ¡£ã€‚

![](img/3481b800e2e702a2efce2202e4fb4769.png)

æ³¨å†ŒåŠŸèƒ½çš„å †å  PRs ç¤ºä¾‹

# å †å å¼ PRs

å¼€å‘æ—¶ï¼Œæˆ‘é€šå¸¸ä¸ºæ¯ä¸ª PR åˆ›å»ºä¸€ä¸ªå•ç‹¬çš„æäº¤ï¼Œå¹¶å°†å®ƒä»¬å †å åœ¨ä¸€èµ·ã€‚

ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æ­£åœ¨å¼€å‘æ³¨å†ŒåŠŸèƒ½:ç”¨æˆ·è¾“å…¥ä»–ä»¬çš„ç”µå­é‚®ä»¶åœ°å€å’Œå¯†ç ï¼Œç„¶åæˆ‘ä»¬ç»™ä»–ä»¬å‘é€ä¸€å°æ¬¢è¿é‚®ä»¶ã€‚ä»åç«¯è§’åº¦æ¥çœ‹ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªæ–°ç”¨æˆ·ï¼ŒéªŒè¯è¯¥ç”¨æˆ·ä¸å­˜åœ¨ï¼Œç„¶åå‘é€ç”µå­é‚®ä»¶ã€‚æˆ‘ä»¬éœ€è¦æ¥è§¦ç¼“å­˜åŒ…çš„å®ç°ï¼Œæ·»åŠ ä¸€ä¸ªç”µå­é‚®ä»¶åŒ…ï¼Œç„¶åæœ€åå®ç°æ³¨å†Œé€»è¾‘ã€‚è¿™å¯ä»¥è¡¨ç¤ºä¸ºä¸€å † PRs:

1.  æ›´æ–°ç¼“å­˜åŒ…ä»¥æ·»åŠ æ–°æ–¹æ³•ã€‚
2.  æ·»åŠ ç”µå­é‚®ä»¶å‘é€ç³»ç»Ÿã€‚å®ƒä½¿ç”¨ç¼“å­˜åŒ…æ¥é˜²æ­¢å‘é€é‡å¤çš„ç”µå­é‚®ä»¶ã€‚
3.  å®ç°æ³¨å†Œé€»è¾‘ã€‚å°±çœ‹ä¸Šé¢ä¸¤ä¸ªå˜åŒ–äº†ã€‚

å¥½å¤„:è¿™æœ‰åŠ©äºè¯„å®¡äººå‘˜åˆ†ç¦»å…³æ³¨ç‚¹ã€‚è¾ƒå°çš„ã€å­¤ç«‹çš„å˜æ›´æ›´å®¹æ˜“è¢«å®¡æŸ¥ã€‚ä»–ä»¬å¯ä»¥é€ä¸ªæ£€æŸ¥ PRï¼Œæ¯ä¸ª PR åŒ…å«ç‹¬ç«‹çš„é€»è¾‘ã€‚å½“ç„¶ï¼Œé‚®ä»¶ç³»ç»Ÿä»ç„¶éœ€è¦æ›´æ–°ç¼“å­˜åŒ…ï¼Œä½†æˆ‘ä»¬ä»ç„¶å¯ä»¥å­¤ç«‹åœ°å®¡æŸ¥é‚®ä»¶ç³»ç»Ÿã€‚

å½“åŸç‚¹å¾—åˆ°æ›´æ–°æ—¶ï¼Œæˆ‘ä»¬å°†æå–å˜æ›´ï¼Œå¹¶åœ¨åŸç‚¹çš„åŸºç¡€ä¸Šé‡æ–°æ„å»º PRsï¼Œæ¨é€å˜æ›´ï¼Œè¿›è¡Œå®¡æ ¸ï¼Œå¹¶è¿›è¡Œåˆå¹¶ã€‚

ç¼ºç‚¹:å®ƒéœ€è¦çºªå¾‹æ¥ä¿æŒ PRs çš„å°å‹å’Œå­¤ç«‹ã€‚é€šå¸¸ï¼Œåœ¨åˆ¶å®šä¸Šå±‚ PRs æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¸‹å±‚ PRs è¿›è¡Œä¸€äº›æ›´æ”¹ã€‚è¿™å¯èƒ½å¾ˆçƒ¦äººï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»è·Ÿè¸ªå“ªäº› PR å‘ç”Ÿäº†ä»€ä¹ˆå˜åŒ–ï¼Œæˆ–è€…ä¸æ–­åœ°åœ¨ PR ä¹‹é—´åˆ‡æ¢ä»¥è¿›è¡Œæ›´æ”¹ï¼Œç„¶åé‡æ–°è°ƒæ•´ä¸Šé¢çš„ PRã€‚

```
git checkout mybranch/signup   # checkout sign up branch
vim features/signup/signup.go  # make changes to signup
vim lib/email/email.go         # make changes to email package

git add features/signup        # commit the signup changes        
git commit --amend             
git stash                      # stash the email changes
git checkout mybranch/email    # checkout email branch
git stash pop                  # apply the email changes
git add lib/email              # commit the email changes
git commit --amend
git checkout mybranch/signup   # checkout sign up branch again
git rebase mybranch/email      # rebase the signup branch on top of email branch
```

å¤ªå¤šçš„åˆ‡æ¢å’Œå¤ªå¤šçš„å‘½ä»¤éœ€è¦è¾“å…¥ã€‚ä¸€ç‚¹éƒ½ä¸å¥½ç©ã€‚

# è¾“å…¥æ ‘è‹—

Sapling æ˜¯ä¸€ä¸ªæ–°çš„ git å®¢æˆ·ç«¯ã€‚å®ƒé¼“åŠ±ä½¿ç”¨å †å å…¬å…³ã€‚å®ƒä¼šè‡ªåŠ¨åœ°å°† PRs ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°æ”¾åœ¨ä¸€èµ·ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨æ“ä½œã€‚

ç»™å®šä¸‹é¢çš„æäº¤ç»“æ„ï¼Œé€šè¿‡è°ƒç”¨`sl`å‘½ä»¤æ¥è¡¨ç¤ºï¼Œä¸‹é¢æ˜¯å®ƒçš„æ ·å­:

```
sl
  @  00f1749f6  30 minutes ago  oliver
  â”‚  implement user signup
  â”‚
  @  e0dbbc80e  50 minutes ago  oliver
  â”‚  implement email package
  â”‚
  o  4f6928029  Yesterday at   oliver
â•­â”€â•¯  update cache package
â”‚
o  876f46044  Today at 07:45  remote/main
```

æ ‘è‹—çš„å·¥ä½œæµç¨‹å¦‚ä¸‹:

```
sl goto 00f1749f6              # checkout the sign up code
vim features/signup/signup.go  # make changes to signup
vim lib/email/email.go         # make changes to email package

sl absorb                      # magic ğŸ‘»
```

åªéœ€ä¸€ä¸ªç®€å•çš„å‘½ä»¤`sl absorb`ï¼Œsapphire å°±ä¼š:

*   ä¿®æ”¹å¯¹ç”µå­é‚®ä»¶æäº¤çš„`email.go`æ›´æ”¹ã€‚
*   ä¿®æ”¹`signup.go`å¯¹æ³¨å†Œæäº¤çš„æ›´æ”¹ã€‚
*   å°†æ³¨å†Œæäº¤ç½®äºç”µå­é‚®ä»¶æäº¤ä¹‹ä¸Šã€‚

æ‚¨çš„æ›´æ”¹å°†è¢«å¸æ”¶åˆ° PRs ä¸­ï¼Œå¹¶ä¸” PRs å°†åœ¨å½¼æ­¤ä¹‹ä¸Šé‡æ–°å»ºç«‹åŸºç¡€ã€‚ä¸ç”¨åƒä»¥å‰é‚£æ ·æ‰‹åŠ¨æ“ä½œäº†ã€‚åªæœ‰ä¸€ä¸ªå‘½ä»¤ã€‚å¹²å¾—å¥½ï¼

# æˆ‘å¯¹æ ‘è‹—çš„ä½“éªŒ

æˆ‘å·²ç»ç”¨äº†å‡ ä¸ªæ˜ŸæœŸäº†ã€‚è¿™æ˜¯ä¸€ä¸ªæ–°å·¥å…·ï¼Œæ‰€ä»¥æœ‰ä¸€äº›é—®é¢˜ï¼Œä½†æ•´ä½“ä½“éªŒå¾ˆå¥½ã€‚

## å¸¸ç”¨å‘½ä»¤

æŸ¥çœ‹å­˜å‚¨åº“çŠ¶æ€:

*   `sl`:æ˜¾ç¤ºæäº¤å›¾(æˆ–æ™ºèƒ½æ—¥å¿—)
*   `sl status`:æ˜¾ç¤ºå½“å‰åˆ†æ”¯çš„çŠ¶æ€

åœ¨æäº¤ä¹‹é—´ç§»åŠ¨:

*   `sl goto <commit>`:ç­¾å‡ºæäº¤
*   `sl next`ã€`sl prev`:æ£€æŸ¥ä¸‹ä¸€ä¸ª/ä¸Šä¸€ä¸ªæäº¤

ä½¿ç”¨æäº¤:

*   `sl add`ã€`sl remove`ã€`sl forget`:æ·»åŠ /åˆ é™¤/å–æ¶ˆè·Ÿè¸ªæ–‡ä»¶
*   `sl commit`:æäº¤æ›´æ”¹ä½œä¸ºæ–°çš„æäº¤
*   `sl metaedit`:ç¼–è¾‘æäº¤æ¶ˆæ¯
*   `sl absorb`:å°†å˜åŒ–å¸æ”¶åˆ° PRs ä¸­ï¼Œå¹¶åœ¨ PRs çš„é¡¶éƒ¨é‡æ–°è®¾å®šåŸºç¡€
*   `sl rebase`:å°†é’»æ†æ’æ”¾ç³»ç»Ÿé‡æ–°ç½®äºå½¼æ­¤ä¹‹ä¸Š

å½“`git add`å°†æ‰€æœ‰æ›´æ”¹æ·»åŠ åˆ°æš‚å­˜åŒºæ—¶ï¼ŒåŒ…æ‹¬æ–°æ–‡ä»¶å’Œåˆ é™¤çš„æ–‡ä»¶ï¼Œç›¸åº”çš„å‘½ä»¤`sl add`å°†åªå°†æ–°æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒºã€‚è¦åˆ é™¤æ–‡ä»¶ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨`sl remove`ã€‚è¿™åœ¨æäº¤ä¾›åº”å•†æ–‡ä»¶æ—¶ä¼šæœ‰ç‚¹çƒ¦äººï¼Œå› ä¸ºæˆ‘ä»¬å¿…é¡»åˆ—å‡ºæ‰€æœ‰åˆ é™¤çš„æ–‡ä»¶æ¥åˆ é™¤å®ƒä»¬ã€‚æˆ‘ä¸ç¡®å®šæ˜¯å¦æœ‰æ›´å¥½çš„æ–¹æ³•ï¼Œä½†æ˜¯ä»£ç çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:

```
$ sl status

? vendor/github.com/sample/cache/v2/caching.go
? vendor/github.com/sample/cache/v2/stripe.go
! vendor/github.com/sample/cache/v2/deprecated.go
! vendor/github.com/sample/cache/v2/formatter.go
```

```
$ sl add vendor

A vendor/github.com/sample/cache/v2/caching.go
A vendor/github.com/sample/cache/v2/stripe.go
! vendor/github.com/sample/cache/v2/deprecated.go
! vendor/github.com/sample/cache/v2/formatter.go
```

```
# Have to list all deleted files to remove, is there a better way? ğŸ˜
$ sl remove vendor/github.com/sample/cache/v2/deprecated.go \
            vendor/github.com/sample/cache/v2/formatter.go

A vendor/github.com/sample/cache/v2/caching.go
A vendor/github.com/sample/cache/v2/stripe.go
R vendor/github.com/sample/cache/v2/deprecated.go
R vendor/github.com/sample/cache/v2/formatter.go 
```

æˆ‘ä»¬ä¸èƒ½åœ¨è¿™é‡Œä½¿ç”¨`sl remove vendor/github.com/sample/cache/v2`,å› ä¸ºå®ƒä¹Ÿå°†å¾ˆä¹æ„åˆ é™¤æ‰€æœ‰æ–°çš„/æ”¹å˜çš„æ–‡ä»¶ã€‚æˆ‘å¿…é¡»åˆ—å‡ºæ‰€æœ‰åˆ é™¤çš„æ–‡ä»¶ï¼Œä»æ ‘è‹—ä¸­åˆ é™¤å®ƒä»¬ã€‚

## å°† PRs æ¨é€åˆ° GitHub

Sapling æä¾›äº†ä¸¤ç§å°† PRs æ¨é€åˆ° GitHub çš„æ–¹å¼:`sl pr`å’Œ`sl ghstack`ã€‚æ¯ç§éƒ½æœ‰ä¸åŒçš„æƒè¡¡ã€‚æˆ‘æ›´å–œæ¬¢ä½¿ç”¨`sl pr`å‘½ä»¤ï¼Œå› ä¸ºå®ƒæä¾›äº†ä»¥ä¸‹åŠŸèƒ½:

*   å®ƒä¸ºæ¯æ¬¡æäº¤åˆ›å»ºä¸€ä¸ª PRã€‚
*   å®ƒæŒ‰ç…§æäº¤çš„é¡ºåºå°† PRs æ¨é€åˆ° GitHubã€‚
*   è¿™å¾ˆå®¹æ˜“ç†è§£ï¼Œå› ä¸ºæäº¤ç›¸äº’ä¹‹é—´å¾ˆå¥½åœ°å †å åœ¨ä¸€èµ·ã€‚
*   å®ƒè¿è¡Œè‰¯å¥½ï¼Œå¯ä»¥ç”¨ GitHub çš„ UI è¿›è¡ŒæŸ¥çœ‹ã€‚
*   å¦‚æœæ‚¨æ­£åœ¨æ‰§è¡Œä¸€ä¸ª forkï¼Œå®ƒä¸éœ€è¦å¯¹å­˜å‚¨åº“çš„å†™æƒé™ã€‚

`sl ghstack`å‘½ä»¤åˆ›å»ºä¸€ä¸ªæ›´å¤æ‚çš„é’»æ†æ’æ”¾ç³»ç»Ÿç½‘ç»œã€‚å¾ˆå¤šæ—¶å€™ï¼Œå®ƒæœªèƒ½æ¨åŠ¨å‡è´«æˆ˜ç•¥ã€‚å†è¯•ä¸€æ¬¡ï¼Œè¿˜æ˜¯ä¸è¡Œã€‚æ²¡æœ‰å¯ç”¨çš„ä¿®å¤ç¨‹åºã€‚ä¸å¾—ä¸å†æ¬¡å¤åˆ¶è¿™äº› PRsï¼Œå¹¶å†’ç€å‘æˆ‘çš„å…¬å¸ä»“åº“å‘é€åƒåœ¾é‚®ä»¶çš„é£é™©ã€‚ä¸æ¨èã€‚

![](img/c82f2a847a0deaa724251cd7c6c12f2e.png)

ä½¿ç”¨ GitHub çš„ç”¨æˆ·ç•Œé¢æŸ¥çœ‹æ ‘è‹— PRs

## å®¡æŸ¥ PRs

Sapling å»ºè®®ä½¿ç”¨ [reviewstack](https://reviewstack.dev) è¿›è¡Œå®¡æŸ¥ã€‚ä½†æ˜¯æˆ‘å‘ç°å®ƒé€Ÿåº¦æ…¢ï¼Œå“åº”æ…¢ï¼Œæœ‰æ—¶ä¼šç»™å‡ºé”™è¯¯çš„æ–‡ä»¶æ›´æ”¹ã€‚æˆ‘æ›´å–œæ¬¢ç”¨ GitHub çš„ UIã€‚å½“ç”¨`sl pr`æ¨ PRs æ—¶ï¼Œå®ƒä¸ºæ¯ä¸ª PR åˆ›å»ºä¸€ä¸ªæäº¤ã€‚è¿™æ ·å®¡æŸ¥è€…å°±å¯ä»¥æ‰“å¼€æœ€è¿‘çš„æäº¤å¹¶å®¡æŸ¥å˜æ›´ã€‚ä¸é€šå¸¸çš„å®¡æ ¸æµç¨‹ç›¸æ¯”ï¼Œåªéœ€å¤šç‚¹å‡»ä¸€æ¬¡ã€‚ä»¥ä¸‹æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹:

*   è½¬åˆ°æäº¤é€‰é¡¹å¡ã€‚
*   é€‰æ‹©æœ€æ–°æäº¤ã€‚
*   æŸ¥çœ‹å¹¶æ·»åŠ è¯„è®ºã€‚è¿™äº›è¯„è®ºå°†ç…§å¸¸å‡ºç°åœ¨ PR ä¸Šã€‚

## å…¶ä»–äº‹æƒ…

å®ƒéœ€è¦å…‹éš†ä¸€ä¸ªæ–°çš„å­˜å‚¨åº“ï¼Œæ‰€ä»¥æ‚¨ä¸èƒ½ä½¿ç”¨æ‚¨ç†Ÿæ‚‰çš„ git å‘½ä»¤ã€‚å®ƒä¸èƒ½ä¸æ‚¨ç°æœ‰çš„å·¥å…·ã€IDE ç­‰ä¸€èµ·å·¥ä½œã€‚æ‚¨å¿…é¡»ä½¿ç”¨`sl web` UI æ¥æŸ¥çœ‹æ›´æ”¹ã€‚

å°æ ‘è‹—å¾ˆæ£’ã€‚è™½ç„¶æœ‰ä¸€äº›éº»çƒ¦ï¼Œå¹¶ä¸”éœ€è¦ä¸€ä¸ªå°çš„å­¦ä¹ æ›²çº¿ï¼Œä½†æœ€ç»ˆè¿˜æ˜¯æœ‰å›æŠ¥çš„ã€‚å †å ã€æ¨é€å’Œå®¡æŸ¥ PRs è¦å®¹æ˜“å¾—å¤šã€‚è¯•è¯•çœ‹ï¼

ã€OliverNguyen.io/w/saplingã€‘äº¦å‘è¡¨äº[](https://olivernguyen.io/w/sapling/)**ã€‚**

```
*Want to Connect?

Connect with me [twitter.com/@_OliverNguyen](https://twitter.com/@_OliverNguyen). I share information about software development, 
JavaScript, Go, and other interesting things I learn.*
```