# å¦‚ä½•æ£€æŸ¥æ‚¨çš„ JavaScript åŒ…æ˜¯å¦æ”¯æŒæµè§ˆå™¨

> åŸæ–‡ï¼š<https://betterprogramming.pub/check-your-javascript-bundles-for-browser-support-d769c1fca4c>

## ä¸è¦å‘ä½¿ç”¨æ—§æµè§ˆå™¨çš„ç”¨æˆ·å‘é€æŸåçš„ä»£ç 

![](img/44db45c6831a3c073b05be7726859dd7.png)

è´¹ä¼¦èŒ¨Â·é˜¿å°”é©¬è¥¿åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šçš„ç…§ç‰‡

Internet Explorer å³å°†æ¶ˆå¤±ï¼Œæ¯ä¸ªäººéƒ½æ¬¢æ¬£é¼“èˆã€‚è‡ªåŠ¨æµè§ˆå™¨å’Œæ“ä½œç³»ç»Ÿæ›´æ–°è®©ç”¨æˆ·ä¿æŒæœ€æ–°çŠ¶æ€ã€‚ç„¶è€Œï¼Œæ€»ä¼šæœ‰ç”¨æˆ·ä½¿ç”¨ä¸æ”¯æŒæŸäº›åŠŸèƒ½çš„æµè§ˆå™¨è®¿é—®æ‚¨çš„ç½‘ç«™ã€‚è¿™å–å†³äºä½ çš„ç”¨æˆ·ç¾¤ã€‚å¦‚æœä½ çš„ä¸€äº›å®¢æˆ·æ˜¯ä¼ä¸šå…¬å¸ï¼Œå¯èƒ½ä¼šæœ‰å¾ˆå¤šç”¨æˆ·å› ä¸ºæŸäº›åŸå› ä¸å¾—ä¸ä½¿ç”¨ IE11 æˆ–è€…ä¸€ä¸ªéå¸¸è€çš„ Mozilla Firefoxã€‚

ç”šè‡³ä¸€äº›ç›¸å¯¹ç°ä»£çš„æµè§ˆå™¨ä¹Ÿä¸æ”¯æŒæ‰€æœ‰æœ€æ–°çš„ JavaScript ç‰¹æ€§ã€‚è™½ç„¶è°·æ­Œ Chrome é€šå¸¸æ˜¯æ–° JavaScript åŠŸèƒ½çš„æ—©æœŸé‡‡ç”¨è€…ï¼Œä½† Mozilla Firefox å’Œè‹¹æœ Safari å¹¶ä¸æ€»æ˜¯è·Ÿä¸Šè°·æ­Œ Chrome çš„æ­¥ä¼ã€‚

å°½ç®¡å¦‚æ­¤ï¼Œæ”¯æŒ IE11 é€šå¸¸æ¯”æ”¯æŒå…¶ä»–æµè¡Œçš„æµè§ˆå™¨æ›´å›°éš¾ã€‚çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼Œå½“ä½ çš„ Angular åº”ç”¨ç¨‹åºåœ¨ IE11 ä¸­ä¸å·¥ä½œæ—¶ï¼Œå¦‚ä½•ä¿®å¤å®ƒ:

[](https://medium.com/better-programming/how-to-fix-your-angular-app-when-its-not-working-in-ie11-eb24cb6d9920) [## å¦‚ä½•åœ¨ IE11 ä¸­ä¿®å¤ä¸å·¥ä½œçš„ Angular åº”ç”¨ç¨‹åº

### ä½¿ç”¨èšåˆå¡«å……æ”¯æŒæ–°åŠŸèƒ½

medium.com](https://medium.com/better-programming/how-to-fix-your-angular-app-when-its-not-working-in-ie11-eb24cb6d9920) 

è¦ç‚¹:å¦‚æœä½ æƒ³æ”¯æŒå¹¿æ³›çš„æµè§ˆå™¨ï¼ŒåŒ…æ‹¬ IE11 è¿™æ ·çš„è€æ­Œï¼Œé‚£ä¹ˆä½ éœ€è¦åœ¨ä½ çš„åº”ç”¨ç¨‹åºä¸­åŒ…å« polyfillsï¼Œå¹¶ç¡®ä¿æµè§ˆå™¨æ”¯æŒä½ æä¾›ç»™ç”¨æˆ·çš„ JavaScript æ–‡ä»¶ã€‚

# IE11 äº‹ä»¶

æœ€è¿‘ï¼Œæˆ‘ä»¬å¶ç„¶å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ ¹æœ¬ä¸èƒ½åœ¨ IE11 ä¸­å¯åŠ¨ã€‚é—®é¢˜å¾ˆå¿«å°±è¢«å‘ç°äº†:ä¸€äº›ä»£ç æ²¡æœ‰åƒé¢„æœŸçš„é‚£æ ·ä¼ è¾“ï¼Œæ‰€ä»¥ç”¨æˆ·ä¼šä¸‹è½½åŒ…å«ç®­å¤´å‡½æ•°çš„ JavaScript ä»£ç ï¼ŒIE11 æ ¹æœ¬ä¸æ”¯æŒã€‚ç„¶è€Œï¼Œæ£€æŸ¥ä½ çš„ç½‘ç«™æ—§æµè§ˆå™¨çš„å…¼å®¹æ€§æ˜¯ä¸€ä»¶éº»çƒ¦çš„äº‹æƒ…ã€‚å¦‚æœä½ æ²¡æœ‰ Windows ç”µè„‘ï¼Œé‚£ä¹ˆä½ æœ€å¥½ä½¿ç”¨ BrowserStack æˆ– LambdaTest è¿™æ ·çš„æœåŠ¡ã€‚ç„¶è€Œï¼Œè¿™é€šå¸¸éå¸¸ç¼“æ…¢å’Œéº»çƒ¦ã€‚

åœ¨å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰å‘ç°è¿™äº›é—®é¢˜çš„è§£å†³æ–¹æ¡ˆæ˜¯åœ¨éƒ¨ç½²ä¹‹å‰è¿è¡Œè‡ªåŠ¨åŒ–çš„ç«¯åˆ°ç«¯æµ‹è¯•ã€‚ç«¯åˆ°ç«¯æµ‹è¯•æ¨¡æ‹ŸçœŸå®çš„ç”¨æˆ·åœºæ™¯ï¼Œè¿™å…è®¸æ‚¨å¿«é€Ÿå‘ç°é”™è¯¯ã€‚æœ‰ä¸€äº›æµè¡Œçš„æµ‹è¯•æ¡†æ¶ï¼Œæ¯”å¦‚ [Cypress](https://www.cypress.io/) ã€‚ç„¶è€Œï¼Œè¿™äº›æµ‹è¯•çš„æ‰§è¡Œå¯èƒ½ä¼šèŠ±è´¹ä¸€äº›æ—¶é—´ï¼Œå¹¶ä¸”ä¸å•å…ƒæµ‹è¯•ç›¸æ¯”ï¼Œè¿™äº›æµ‹è¯•å¯èƒ½ä¼šæ›´åŠ å¤æ‚å’Œéš¾ä»¥ç»´æŠ¤ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè‡³å°‘è¿›è¡Œä¸€äº›ç«¯åˆ°ç«¯çš„æµ‹è¯•ä¼šç»™åº”ç”¨ç¨‹åºä½œä¸ºä¸€ä¸ªæ•´ä½“å·¥ä½œå¸¦æ¥ä¸€äº›ä¿¡å¿ƒã€‚

è‡ªåŠ¨åŒ–æµè§ˆå™¨æµ‹è¯•çš„é—®é¢˜æ˜¯ï¼Œå°½ç®¡è®¸å¤šæ¡†æ¶å’Œæµ‹è¯•è¿è¡Œè€…æ”¯æŒæœ€æ–°ç‰ˆæœ¬çš„ Chrome å’Œ Firefoxï¼Œä½† IE11 ç­‰æ—§æµè§ˆå™¨é€šå¸¸å¾—ä¸åˆ°å¾ˆå¥½çš„æ”¯æŒ(ä¾‹å¦‚ï¼Œé‡è§’å™¨)æˆ–æ ¹æœ¬ä¸æ”¯æŒ(ä¾‹å¦‚ï¼ŒCypress)ã€‚è¿™æ„å‘³ç€åœ¨æ‰€æœ‰å¸¸ç”¨çš„æµè§ˆå™¨ä¸Šè¿è¡Œè‡ªåŠ¨åŒ–æµ‹è¯•é€šå¸¸æ˜¯ä¸å¯è¡Œçš„ã€‚

# è®©æˆ‘ä»¬éªŒè¯ä¸€ä¸‹æˆ‘ä»¬çš„åŒ…åœ¨æ—§æµè§ˆå™¨ä¸­ä¹Ÿèƒ½å·¥ä½œ

ä¸€ä½åŒäº‹æœ‰ä¸€ä¸ªå¥½ä¸»æ„ï¼Œé‚£å°±æ˜¯é‡‡ç”¨å¦ä¸€ç§æ–¹æ³•ï¼Œè¿™ç§æ–¹æ³•å®ç°èµ·æ¥æ›´å¿«ï¼Œå¹¶ä¸”è‡³å°‘æä¾›äº†ä¸€äº›å®‰å…¨æ€§ï¼Œå³åº”ç”¨ç¨‹åºä»£ç ä¹Ÿå¯ä»¥åœ¨è¾ƒæ—§çš„æµè§ˆå™¨ä¸­å·¥ä½œã€‚æƒ³æ³•æ˜¯åœ¨æˆ‘ä»¬çš„æŒç»­é›†æˆç®¡é“ä¸­æ”¾ç½®å¦ä¸€ä¸ªæ£€æŸ¥ï¼Œåœ¨äº§å“æ„å»ºä¹‹åæ£€æŸ¥ç”Ÿæˆçš„åŒ…ã€‚è¿™å°†åœ¨ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰å‘ç°ç±»ä¼¼ä¸Šé¢æåˆ°çš„ arrow å‡½æ•°é—®é¢˜ã€‚

å½“ç„¶ï¼Œè¿™ç§ç®€å•çš„æ£€æŸ¥ä¸èƒ½æä¾›ä¸æ‰‹å·¥æˆ–è‡ªåŠ¨åŒ–æµ‹è¯•ç›¸åŒçš„æœ‰æ•ˆæ€§ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè¿™ä¸ªç®€å•çš„æ£€æŸ¥å¯ä»¥é˜²æ­¢å¼€å‘äººå‘˜åœ¨æ²¡æœ‰è‡ªå·±æ£€æŸ¥çš„æƒ…å†µä¸‹å‘å¸ƒå®Œå…¨æŸåçš„ä»£ç ã€‚

CI/CD ç®¡é“çš„åŸºæœ¬æ­¥éª¤å¦‚ä¸‹æ‰€ç¤º:

1.  è¿è¡Œæ„å»º(ä¾‹å¦‚ï¼Œå¯¹äº Angularï¼Œæ‚¨å¯ä»¥ä½¿ç”¨`ng build --prod`)ã€‚
2.  æ£€æŸ¥ç”Ÿæˆçš„åŒ…æ˜¯å¦æœ‰é—®é¢˜ã€‚å¦‚æœå­˜åœ¨é”™è¯¯ï¼Œåˆ™ CI ä½œä¸šåº”æ ‡è®°ä¸ºå¤±è´¥ï¼Œå¹¶ä¸”ä¸èƒ½ç»§ç»­æ‰§è¡Œåç»­æ­¥éª¤ï¼Œå¦‚éƒ¨ç½²ã€‚
3.  ç»§ç»­æ¥ä¸‹æ¥çš„æ­¥éª¤(ä¾‹å¦‚ï¼Œéƒ¨ç½²)ã€‚

æˆ‘ä»¬æ‰¾åˆ°äº†ä¸€ä¸ªåä¸º [ES Check](https://github.com/yowainwright/es-check) çš„ä¾¿åˆ©åº“ã€‚å®ƒå¯ä»¥ä½œä¸ºå¼€å‘ä¸“ç”¨çš„ä¾èµ–é¡¹ä¸ npm ä¸€èµ·å®‰è£…ï¼Œä½†ä¹Ÿå¯ä»¥ä½¿ç”¨ [npx](https://github.com/npm/npx) ç›´æ¥è°ƒç”¨ã€‚æ‚¨åªéœ€è¦å°†å®ƒæŒ‡å‘æ‚¨çš„åŒ…çš„ç›®å½•ï¼Œå¹¶å‘Šè¯‰å®ƒæ‚¨æƒ³è¦æ”¯æŒå“ªä¸ªç‰ˆæœ¬çš„ ECMAScript(è¯»:JavaScript)(ä¾‹å¦‚ï¼ŒES5)ã€‚è¿™ä¸ªè¿‡ç¨‹ä¸ä¼šè¶…è¿‡å‡ ç§’é’Ÿã€‚ä»¥ä¸‹æ˜¯ç›´æ¥æ‘˜è‡ªé¡¹ç›®æ–‡æ¡£çš„è§£é‡Šæ€§æ‘˜å½•:

> â€œåœ¨ç°ä»£ JavaScript ç‰ˆæœ¬ä¸­ï¼Œæ–‡ä»¶è¢«æ†ç»‘åœ¨ä¸€èµ·ï¼Œå› æ­¤å®ƒä»¬å¯ä»¥åœ¨æµè§ˆå™¨ä¸­ä»¥ä¼˜åŒ–çš„æ–¹å¼æä¾›ã€‚å¼€å‘äººå‘˜è®¤ä¸ºï¼Œæœªæ¥çš„ JavaScriptâ€”â€”åƒ ES8 ä¸€æ ·â€”â€”å°†ç”± Babel è¿™æ ·çš„å·¥å…·é€‚å½“åœ°è½¬æ¢(ä»æœªæ¥çš„ JavaScript å˜ä¸ºå½“å‰çš„ JavaScript)ã€‚æœ‰æ—¶ä¼šå‡ºç°æ–‡ä»¶æ— æ³•ä¼ è¾“çš„é—®é¢˜ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œè¿˜æ²¡æœ‰æœ‰æ•ˆçš„æ–¹æ³•æ¥æµ‹è¯•æœªä¼ è¾“çš„æ–‡ä»¶ã€‚ES Check å°±æ˜¯å¹²è¿™ä¸ªçš„ã€‚â€â€” [ES æ£€æŸ¥](https://github.com/dollarshaveclub/es-check)

# å¦‚ä½•ç”¨ ES Check æ£€æŸ¥ç”Ÿæˆçš„ JavaScript åŒ…

ç°åœ¨æˆ‘ä»¬å·²ç»äº†è§£äº†é—®é¢˜ï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•å°† ES æ£€æŸ¥çº³å…¥ CI æ¸ é“ã€‚

ä¸‹é¢æ˜¯ä¸€ä¸ªç®€åŒ–çš„ GitLab CI ç®¡é“:

```
# Run a full build
aot build:
  image: node:12.18.3
  script:
    # install dependencies
    - npm ci
    # run a full, production-ready build (this is a npm script)
    - npm run build:production
    # check es5 bundles for older browsers compatibility
    - **npx es-check es5 ./your-dist-folder/*.js --verbose**
```

æˆåŠŸè¿è¡Œ ES Check çš„è¾“å‡ºå¦‚ä¸‹æ‰€ç¤º:

```
ES-Check: Going to check files using version 5ES-Check: checking ./dist/common-es5.036d8a8f1d8ed1b18e05.jsES-Check: checking ./dist/main-es5.9c2c8a661140187e4316.jsES-Check: checking ./dist/modules-login-login-module-ngfactory-es5.91da0ff09285192d7330.jsES-Check: checking ./dist/modules-user-profile-user-profile-module-ngfactory-es5.68f5a6161704cb750f93.jsES-Check: checking ./dist/polyfills-es5.e3f8b2d4d82eeaed59a0.jsES-Check: checking ./dist/runtime-es5.934c3283cc8c6d77c916.jsES-Check: there were no ES version matching errors!  ğŸ‰
```

å¦‚æœæœ‰é—®é¢˜ï¼ŒES Check å°†å¯¼è‡´æ‚¨çš„ CI ä½œä¸šå¤±è´¥ï¼Œè¿™å°†é˜»æ­¢æ‚¨å‘å¸ƒåœ¨æ—§æµè§ˆå™¨ä¸­æ ¹æœ¬ä¸å·¥ä½œçš„ä»£ç ã€‚

## æ›´æ–°:ä¸º GitHub é¡¹ç›®å¼•å…¥ es-check-action

æœ€è¿‘ï¼Œæˆ‘åˆ›å»ºäº†`[es-check-action](https://github.com/marketplace/actions/es-check-action)`ï¼Œä¸€ä¸ªç®€å•ä¸”å¯é…ç½®çš„ GitHub åŠ¨ä½œæ¥è‡ªåŠ¨åŒ–è¿™ä¸ªè¿‡ç¨‹ã€‚æ“ä½œæ˜¯å•ç‹¬çš„ä»»åŠ¡ï¼Œæ‚¨å¯ä»¥ç»„åˆè¿™äº›ä»»åŠ¡æ¥åˆ›å»ºä½œä¸šå’Œè‡ªå®šä¹‰æ‚¨çš„å·¥ä½œæµã€‚æ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„æ“ä½œï¼Œæˆ–è€…ä½¿ç”¨å’Œå®šåˆ¶ GitHub ç¤¾åŒºå…±äº«çš„æ“ä½œã€‚è¿™ä¸ª GitHub åŠ¨ä½œæ ¹æ® es çš„æŒ‡å®šç‰ˆæœ¬æ£€æŸ¥ JavaScript æ–‡ä»¶ã€‚å¦‚æœæŒ‡å®šæ–‡ä»¶çš„ ES ç‰ˆæœ¬ä¸ ES ç‰ˆæœ¬å‚æ•°ä¸åŒ¹é…ï¼Œæ­¤æ“ä½œå°†å¼•å‘é”™è¯¯ã€‚

æˆ‘è®¡åˆ’å‘å¸ƒä¸€ä¸ªé€šç”¨çš„ GitHub åŠ¨ä½œæ•™ç¨‹ï¼Œæˆ‘å°†ç”¨è¿™ä¸ªåŠ¨ä½œä½œä¸ºä¾‹å­ã€‚

# ç»“è®º

æ„Ÿè°¢æ‚¨é˜…è¯»è¿™ç¯‡å…³äºå¦‚ä½•æ£€æŸ¥æµè§ˆå™¨æ”¯æŒçš„ JavaScript åŒ…çš„çŸ­æ–‡ã€‚å¦‚æ‚¨æ‰€è§ï¼Œå¾ˆå®¹æ˜“å°†è¿™ç§å¿«é€Ÿæ†ç»‘æ£€æŸ¥ä½œä¸º CI ç®¡é“çš„ä¸€éƒ¨åˆ†ã€‚ç„¶è€Œï¼Œè¿™å¹¶æ²¡æœ‰æ¶ˆé™¤å¯¹ä¸€äº›é€‚å½“çš„è‡ªåŠ¨æˆ–æ‰‹åŠ¨æµ‹è¯•çš„éœ€è¦ã€‚ä½ å¦‚ä½•æ£€æŸ¥ä½ çš„ç½‘ç»œåº”ç”¨ç¨‹åºçš„æµè§ˆå™¨å…¼å®¹æ€§ï¼Ÿè¯·åœ¨è¯„è®ºä¸­å‘Šè¯‰æˆ‘ã€‚