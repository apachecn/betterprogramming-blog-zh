<html>
<head>
<title>Swift: Beyond Switching on a Result</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Swift:è¶…è¶Šæ‰“å¼€ç»“æœ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/beyond-switch-swift-result-6e4a91cda6b6?source=collection_archive---------4-----------------------#2019-07-27">https://betterprogramming.pub/beyond-switch-swift-result-6e4a91cda6b6?source=collection_archive---------4-----------------------#2019-07-27</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="5768" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated"><strong class="ak">é›¨ç‡•ã€‚Result </strong>çš„æ½œåŠ›ä¸ä»…ä»…æ˜¯ä½¿ç”¨switchå­å¥è·å¾—å€¼/é”™è¯¯ã€‚è®©æˆ‘ä»¬çœ‹çœ‹ä½ èƒ½åšçš„å‡ ä»¶äº‹</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4eaf952d88b72f433e640173b4a17145.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*QgB30nu3zmyQR73Y"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae ky" href="https://unsplash.com/@hiteshchoudhary?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Hitesh Choudhary </a>åœ¨<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„</p></figure><h1 id="5f85" class="kz la it bd lb lc ld le lf lg lh li lj jz lk ka ll kc lm kd ln kf lo kg lp lq bi translated">è·å–æˆåŠŸå€¼ä½œä¸ºå¯é€‰å€¼</h1><p id="dd00" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½ åªéœ€è¦ä¸€ä¸ª<code class="fe mn mo mp mq b">Result</code>çš„æˆåŠŸå€¼ã€‚æœ‰äº†<code class="fe mn mo mp mq b">func get() throws -&gt; Success</code>ï¼Œå°±ä¸éœ€è¦ä½¿ç”¨switchå­å¥äº†ã€‚</p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="bc8b" class="mv la it mq b gy mw mx l my mz">let resultSuccess = Result&lt;Int, Error&gt;.success(1)<br/>let value = try? resultSuccess.get()<br/>// value is Optional(1)</span><span id="3885" class="mv la it mq b gy na mx l my mz">let resultFailure = Result&lt;Int, Error&gt;.failure(someError)<br/>let value2 = try? resultFailure.get()<br/>// value is nil</span></pre></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="3d7b" class="kz la it bd lb lc ni le lf lg nj li lj jz nk ka ll kc nl kd ln kf nm kg lp lq bi translated">å°†æŠ›å‡ºè¡¨è¾¾å¼è½¬æ¢ä¸ºç»“æœ</h1><p id="531c" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">è¿˜æœ‰å…¶ä»–æƒ…å†µï¼Œå½“ä½ æœ‰ä¸€ä¸ªæŠ›å‡ºè¡¨è¾¾å¼(ä¾‹å¦‚å‡½æ•°ã€é—­åŒ…â€¦â€¦)ä½†éœ€è¦ä¸€ä¸ª<code class="fe mn mo mp mq b">Result</code>æ¥ä»£æ›¿ã€‚ä»Šå¤©æ˜¯ä½ çš„å¹¸è¿æ—¥ï¼Œå› ä¸º<code class="fe mn mo mp mq b">Result</code>æœ‰ä¸€ä¸ª<code class="fe mn mo mp mq b">init</code>æ•æ‰æŠ›å‡ºçš„é”™è¯¯ã€‚</p><p id="40c8" class="pw-post-body-paragraph lr ls it lt b lu nn ju lw lx no jx lz ma np mc md me nq mg mh mi nr mk ml mm im bi translated"><code class="fe mn mo mp mq b">init(catching body: () throws -&gt; Success)</code></p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="886f" class="mv la it mq b gy mw mx l my mz">enum RandomError: Error {<br/>  case noNumber<br/>}</span><span id="ca51" class="mv la it mq b gy na mx l my mz">func random() throws -&gt; UInt {<br/>  if Bool.random() {<br/>    return UInt.random(in: 1...20)<br/>  } else {<br/>    throw RandomError.noNumber<br/>  }<br/>}</span><span id="3c49" class="mv la it mq b gy na mx l my mz">let randomResult: Result&lt;UInt, Error&gt; = Result { try random() }</span></pre></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="febc" class="kz la it bd lb lc ni le lf lg nj li lj jz nk ka ll kc nl kd ln kf nm kg lp lq bi translated">æ˜ å°„æˆåŠŸç±»å‹</h1><p id="678f" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">æœ‰æ—¶å€™ä½ ä»ä¸€ä¸ªå‡½æ•°ä¸­å¾—åˆ°ä¸€ä¸ª<code class="fe mn mo mp mq b">Result&lt;A, E&gt;</code>ï¼Œä½†æ˜¯ä½ éœ€è¦ä¸€ä¸ª<code class="fe mn mo mp mq b">Result&lt;B, E&gt;</code>ã€‚ä½ å¯ä»¥ç”¨ä¸€ä¸ªå¼€å…³æ¥åšï¼Œä½†æ˜¯ä¸ä½ ç”¨<code class="fe mn mo mp mq b">Result</code> mapæ“ä½œæ‰€èƒ½åšçš„ç›¸æ¯”ï¼Œé‚£è¦å¤šå¾ˆå¤šä»£ç :</p><p id="b39f" class="pw-post-body-paragraph lr ls it lt b lu nn ju lw lx no jx lz ma np mc md me nq mg mh mi nr mk ml mm im bi translated"><code class="fe mn mo mp mq b">func map&lt;NewSuccess&gt;(_ transform: (Success) -&gt; NewSuccess) -&gt; Result&lt;NewSuccess, Failure&gt;</code></p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="2a9d" class="mv la it mq b gy mw mx l my mz">let resultSuccess = Result&lt;Int, Error&gt;.success(1)</span><span id="b948" class="mv la it mq b gy na mx l my mz">let stringResult: Result&lt;String, Error&gt; = resultSuccess.map { String($0) }</span></pre></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="f646" class="kz la it bd lb lc ni le lf lg nj li lj jz nk ka ll kc nl kd ln kf nm kg lp lq bi translated">æ˜ å°„æ•…éšœç±»å‹</h1><p id="5308" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">åŒæ ·ï¼Œæœ‰æ—¶ä½ å¾—åˆ°äº†ä¸€ä¸ª<code class="fe mn mo mp mq b">Result&lt;A, E1&gt;</code>ï¼Œä½†éœ€è¦ä¸€ä¸ª<code class="fe mn mo mp mq b">Result&lt;A, E2&gt;</code>ã€‚æ‰€ä»¥ï¼Œä½ çŒœæ€ä¹ˆç€ï¼Œè¿˜æœ‰å¦å¤–ä¸€ä¸ªåœ°å›¾æ“ä½œ:</p><p id="df31" class="pw-post-body-paragraph lr ls it lt b lu nn ju lw lx no jx lz ma np mc md me nq mg mh mi nr mk ml mm im bi translated"><code class="fe mn mo mp mq b">func mapError&lt;NewFailure&gt;(_ transform: (Failure) -&gt; NewFailure) -&gt; Result&lt;Success, NewFailure&gt; where NewFailure : Error</code></p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="8e4c" class="mv la it mq b gy mw mx l my mz">enum CustomError: Error { case customErrorA }</span><span id="78dd" class="mv la it mq b gy na mx l my mz">let customErrorResult = Result&lt;Int, CustomError&gt;.failure(.customErrorA)</span><span id="a7ae" class="mv la it mq b gy na mx l my mz">let errorResult: Result&lt;Int, Error&gt; = customErrorResult.mapError { $0 }</span></pre></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="d001" class="kz la it bd lb lc ni le lf lg nj li lj jz nk ka ll kc nl kd ln kf nm kg lp lq bi translated">å¹³é¢å›¾æˆåŠŸç±»å‹</h1><p id="c0fa" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated">å‡è®¾æ‚¨ä½¿ç”¨ä¸€ä¸ªå‡½æ•°å°†ä¸€ä¸ª<code class="fe mn mo mp mq b">Result</code>è¿”å›åˆ°ä¸€ä¸ª<code class="fe mn mo mp mq b">Result.map</code>ã€‚ä½ ä¼šå¾—åˆ°ä¸€ä¸ªæ¼‚äº®çš„<code class="fe mn mo mp mq b">Result&lt;Result&lt;Success, Failure&gt;, Failure&gt;</code>ã€‚ç„¶è€Œï¼Œå°½ç®¡å®ƒå¾ˆæ¼‚äº®ï¼Œä½ å¯èƒ½æƒ³è¦ä¸€ä¸ªç®€å•çš„<code class="fe mn mo mp mq b">Result&lt;Success, Failure&gt;</code>æ¥ä»£æ›¿ã€‚è¿™æ—¶ä½ å¯ä»¥ä½¿ç”¨<code class="fe mn mo mp mq b">flatMap</code>:</p><p id="5335" class="pw-post-body-paragraph lr ls it lt b lu nn ju lw lx no jx lz ma np mc md me nq mg mh mi nr mk ml mm im bi translated"><code class="fe mn mo mp mq b">func flatMap&lt;NewSuccess&gt;(_ transform: (Success) -&gt; Result&lt;NewSuccess, Failure&gt;) -&gt; Result&lt;NewSuccess, Failure&gt;</code></p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="75ae" class="mv la it mq b gy mw mx l my mz">enum FooError: Error {<br/>  case noNumber, outOfRange<br/>}</span><span id="c70b" class="mv la it mq b gy na mx l my mz">func random() -&gt; Result&lt;UInt, FooError&gt; {<br/>  if Bool.random() {<br/>    return .success(UInt.random(in: 1...25))<br/>  } else {<br/>    return .failure(FooError.noNumber)<br/>  }<br/>}</span><span id="2043" class="mv la it mq b gy na mx l my mz">func factorial(input: UInt) -&gt; Result&lt;UInt, FooError&gt; {<br/>  if input == 0 || input &gt; 20 {<br/>    return .failure(.outOfRange)<br/>  } else {<br/>    let f = (2â€¦input).reduce(1) { $0 * $1 }<br/>    return .success(f)<br/>  }<br/>}</span><span id="4c98" class="mv la it mq b gy na mx l my mz">// Result&lt;Result&lt;UInt, FooError&gt;, FooError&gt; ğŸ‘<br/>let mappedResult: Result&lt;Result&lt;UInt, FooError&gt;, FooError&gt; = random().map { factorial(input: $0) }</span><span id="6aa6" class="mv la it mq b gy na mx l my mz">// Result&lt;UInt, FooError&gt; ğŸ‘<br/>let flattenResult: Result&lt;UInt, FooError&gt; = random().flatMap { factorial(input: $0) }</span></pre></div><div class="ab cl nb nc hx nd" role="separator"><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng nh"/><span class="ne bw bk nf ng"/></div><div class="im in io ip iq"><h1 id="613b" class="kz la it bd lb lc ni le lf lg nj li lj jz nk ka ll kc nl kd ln kf nm kg lp lq bi translated">å¹³é¢å›¾æ•…éšœç±»å‹</h1><p id="8924" class="pw-post-body-paragraph lr ls it lt b lu lv ju lw lx ly jx lz ma mb mc md me mf mg mh mi mj mk ml mm im bi translated"><code class="fe mn mo mp mq b">Result</code>æä¾›å¦ä¸€ç§æ›´éš¾åº”ç”¨çš„æ“ä½œã€‚å‡è®¾æ‚¨æƒ³ä»ä¸€ä¸ª<code class="fe mn mo mp mq b">Result.failure</code>ä¸­æ¢å¤ï¼Œä¿æŒæˆåŠŸç±»å‹ä½†æ”¹å˜å¤±è´¥ç±»å‹ã€‚é‚£ä¹ˆä½ å¯èƒ½ä¼šå‘ç°<code class="fe mn mo mp mq b">Result.flatMap</code>å¾ˆæœ‰ç”¨ã€‚</p><p id="2813" class="pw-post-body-paragraph lr ls it lt b lu nn ju lw lx no jx lz ma np mc md me nq mg mh mi nr mk ml mm im bi translated"><code class="fe mn mo mp mq b">func flatMapError&lt;NewFailure&gt;(_ transform: (Failure) -&gt; Result&lt;Success, NewFailure&gt;) -&gt; Result&lt;Success, NewFailure&gt; where NewFailure : Error</code></p><pre class="kj kk kl km gt mr mq ms mt aw mu bi"><span id="1272" class="mv la it mq b gy mw mx l my mz">enum RecoverableError: Error {<br/>  case fooError<br/>}</span><span id="c2d2" class="mv la it mq b gy na mx l my mz">func recoverableOperation() -&gt; Result&lt;Int, RecoverableError&gt; {<br/>  return .failure(.fooError)<br/>}</span><span id="7941" class="mv la it mq b gy na mx l my mz">enum RecoveryError: Error {<br/>  case notRecovered<br/>}</span><span id="19f2" class="mv la it mq b gy na mx l my mz">func recoverFromRecoverableError(_ recoverableError: RecoverableError) -&gt; Result&lt;Int, RecoveryError&gt; {<br/>  return .failure(.notRecovered)<br/>}</span><span id="2d61" class="mv la it mq b gy na mx l my mz">// Result&lt;Int, RecoveryError&gt;<br/>let flattenErrorResult = recoverableOperation().flatMapError { recoverFromRecoverableError($0) }</span></pre></div></div>    
</body>
</html>