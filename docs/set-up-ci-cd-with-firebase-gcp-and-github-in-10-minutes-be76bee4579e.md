# 10 åˆ†é’Ÿåœ¨ Google äº‘å¹³å°å’Œ GitHub ä¸Šç”¨ Firebase è®¾ç½® CI/CD

> åŸæ–‡ï¼š<https://betterprogramming.pub/set-up-ci-cd-with-firebase-gcp-and-github-in-10-minutes-be76bee4579e>

## è‡ªåŠ¨åŒ–æ‚¨çš„éƒ¨ç½²å·¥ä½œæµç¨‹å¹¶è®¾ç½®æŒç»­é›†æˆ

![](img/f3b9086557564e61e034b3a85a2f9c3c.png)

ç…§ç‰‡ç”±[ä½ å¥½ï¼Œæˆ‘æ˜¯å°¼å…‹ğŸ](https://unsplash.com/@helloimnik?utm_source=medium&utm_medium=referral) on [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ã€‚

æƒ³äº†è§£å¦‚ä½•è‡ªåŠ¨åŒ–æ‚¨çš„éƒ¨ç½²å·¥ä½œæµå—ï¼Ÿé‚£å°±åˆ«å†æ‰¾äº†ã€‚åœ¨æœ¬æŒ‡å—ä¸­ï¼Œæˆ‘å°†ä»‹ç»åœ¨ Google äº‘å¹³å°(GCP)ä¸Šä½¿ç”¨ Firebase è®¾ç½® CI/CD æ‰€éœ€çš„æ­¥éª¤ã€‚

ä½†é¦–å…ˆï¼Œä¸ºä»€ä¹ˆï¼Ÿ

å½“ä½ åœ¨ä¸€ä¸ªå›¢é˜Ÿä¸­å·¥ä½œæ—¶ï¼Œæ–°çš„ç‰¹æ€§ä¼šä¸æ–­åœ°è¢«å®ç°ã€‚ä¸€æ—¦å®ç°äº†è¿™äº›ç‰¹æ€§ï¼Œå°±éœ€è¦å¯¹å®ƒä»¬è¿›è¡Œæµ‹è¯•ã€éƒ¨ç½²å’Œå‘å¸ƒã€‚å°†æ‚¨çš„åº”ç”¨ä»æœ¬åœ°ç¯å¢ƒè¿ç§»åˆ°ç”Ÿäº§ç¯å¢ƒéœ€è¦è®¸å¤šæ­¥éª¤ã€‚ä½†æ˜¯æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥è‡ªåŠ¨åŒ–è¿™äº›æ­¥éª¤ã€‚è¿™å°±æ˜¯æŒç»­é›†æˆ(CI)å’ŒæŒç»­éƒ¨ç½²(CD)çš„ç”¨æ­¦ä¹‹åœ°ã€‚é‡‡ç”¨ CI/CD å¯ä»¥å¸®åŠ©å›¢é˜Ÿåœ¨æ—©æœŸå‘ç° bugã€‚

ä»€ä¹ˆæ˜¯æŒç»­é›†æˆ(CI)å’ŒæŒç»­éƒ¨ç½²(CD)ï¼Ÿ

æŒç»­é›†æˆå¯ä»¥å…è®¸å¼€å‘äººå‘˜å°†å˜æ›´æ¨é€åˆ°å…±äº«å­˜å‚¨åº“ã€‚å¯ä»¥è¿›è¡Œæµ‹è¯•ï¼Œä»¥ç¡®ä¿ä»£ç ä¸ºä¸‹ä¸€é˜¶æ®µåšå¥½å‡†å¤‡ã€‚

è¿ç»­éƒ¨ç½²æ˜¯ä¸€ä¸ªè¿‡ç¨‹ï¼Œåœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæ–°çš„ä»£ç æ›´æ”¹åœ¨å°†ä»£ç è½¬ç§»åˆ°ç”Ÿäº§ç¯å¢ƒä¹‹å‰è¢«æ¨åˆ°ä¸€ä¸ªé˜¶æ®µç¯å¢ƒä¸­ã€‚

# **åˆ›å»ºä¸€ä¸ª React åº”ç”¨ç¨‹åº(å¯é€‰)**

å¦‚æœæ‚¨å·²ç»å‡†å¤‡å¥½äº†ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œè¯·ç»§ç»­æ‰§è¡Œæ­¥éª¤ 1ã€‚

è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªåä¸º`cicd-demo`çš„åº”ç”¨ç¨‹åº:

```
npx create-react-app cicd-demo
npm start
```

æ‚¨åº”è¯¥ä¼šçœ‹åˆ°è¿™æ ·ä¸€ä¸ªé¡µé¢:

![](img/0dc5ce371202e7d8f79890f1bef6131a.png)

# **1ã€‚åˆ›å»ºä¸€ä¸ª Firebase é¡¹ç›®**

å¦‚æœæ‚¨æœ‰ä¸€ä¸ªç°æœ‰çš„ Firebase é¡¹ç›®ï¼Œè¯·è½¬åˆ°æ­¥éª¤ 2ã€‚

å‰å¾€ [Firebase çš„ç½‘ç«™](https://firebase.google.com)ï¼Œè¿›å…¥æ§åˆ¶å°ï¼Œåˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ã€‚é€šè¿‡åœ¨ Firebase ä¸­åˆ›å»ºä¸€ä¸ªæ–°é¡¹ç›®ï¼Œç›¸åŒçš„é¡¹ç›®ä¹Ÿä¼šå‡ºç°åœ¨ GCP æ§åˆ¶å°ä¸­ã€‚å¯¹äºæœ¬æŒ‡å—ï¼Œæˆ‘åˆ›å»ºäº†ä¸€ä¸ªåä¸º CICD æ¼”ç¤ºçš„é¡¹ç›®æ¥å®Œæˆè¿™äº›æ­¥éª¤ã€‚

![](img/25558bbb088be29ab0e38ffbeffdb8b6.png)

ä¸€æ—¦æ‚¨åˆ›å»ºäº†ä¸€ä¸ªé¡¹ç›®ï¼Œæ‚¨åº”è¯¥ä¼šè¢«å®šå‘åˆ°é¡¹ç›®ä¸»é¡µ:

![](img/e2a07918ced8a9f26d39028c153a114c.png)

Firebase é¡¹ç›®ä¸»é¡µ

# **2ã€‚è®¾ç½®è¿ç»­éƒ¨ç½²**

åœ¨æ‚¨çš„é¡¹ç›®æ ¹ç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ª`cloudbuild.yaml`æ–‡ä»¶ã€‚è¯¥æ–‡ä»¶çš„ç›®çš„æ˜¯åˆ—å‡ºæ„å»ºåº”ç”¨ç¨‹åºçš„å¿…è¦æ­¥éª¤:

```
steps:
      # Install
      - name: 'gcr.io/cloud-builders/npm'
        args: ['install']
      # Build
      - name: 'gcr.io/cloud-builders/npm'
        args: ['run', 'build']
      # Deploy
      - name: gcr.io/project-id/firebase
        args: ['deploy', '--project=project-id', '--only=hosting']
```

# **3ã€‚å°†åº”ç”¨ç¨‹åºé“¾æ¥åˆ° Firebase**

å®‰è£… Firebase CLI å¹¶ç™»å½•:

```
npm install -g firebase-tools
firebase login
```

è®¤è¯åï¼Œæ‚¨éœ€è¦åˆå§‹åŒ–æ‚¨çš„é¡¹ç›®:

```
firebase init
```

ç¡®ä¿é€‰æ‹©â€œä½¿ç”¨ç°æœ‰é¡¹ç›®â€ï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»åœ¨ Firebase æ§åˆ¶å°ä¸­åˆ›å»ºäº†ä¸€ä¸ªé¡¹ç›®ã€‚

![](img/280631640c70c17c49971b3b37b28736.png)

Firebase æ‰˜ç®¡è®¾ç½®

ç”±äºè¿™æ˜¯ä¸€ä¸ª React åº”ç”¨ç¨‹åºï¼Œåœ¨`firebase.json`æ–‡ä»¶ä¸­å°†â€œå…¬å…±â€æ”¹ä¸ºâ€œæ„å»ºâ€:

```
"public": "build"
```

# **4ã€‚å»ºç«‹ GCP é¡¹ç›®**

è¿›å…¥[è°·æ­Œäº‘å¹³å°](https://console.cloud.google.com)ç½‘ç«™ï¼Œå¦‚æœä½ æœ‰å¤šä¸ªé¡¹ç›®ï¼Œåœ¨å·¦ä¸Šè§’é€‰æ‹©æ­£ç¡®çš„é¡¹ç›®ã€‚

![](img/f0595502d8e7a5f5a207ab67729369b9.png)

GCP é¡¹ç›®ä»ªè¡¨æ¿

æ‰“å¼€ä¾§è¾¹æ ï¼Œè¿›å…¥â€œäº‘æ„å»ºâ€å¯ç”¨äº‘æ„å»º API:

![](img/acc449b4120fa46d17134b110da6d847.png)

å¦‚æœä½ åˆšåˆ° GCPï¼Œä½ å¯èƒ½éœ€è¦æ·»åŠ ä¸€ä¸ªä»˜è´¹è´¦æˆ·ã€‚è½¬åˆ°ä¾§è¾¹æ ä¸Šçš„â€œå¸å•â€é€‰é¡¹å¡æ¥è®¾ç½®å¸æˆ·:

![](img/a2d187c51d5ac0840c42aad576f40297.png)

GCP é¡¹ç›®å¼€å•æ ‡ç­¾

# **5ã€‚åˆ›å»ºä¸€ä¸ªè§¦å‘å™¨**

å½“æ‚¨æ¨å…¥åˆ†æ”¯æ—¶ï¼Œåˆ›å»ºè§¦å‘å™¨å°†è‡ªåŠ¨å¼€å§‹æ„å»ºã€‚åœ¨â€œäº‘æ„å»ºâ€é€‰é¡¹å¡ä¸­ï¼Œé€‰æ‹©â€œè§¦å‘å™¨â€ä»¥å¯åŠ¨æµç¨‹:

![](img/17ac3514fbf1b7e9756200e126d49361.png)

é€‰æ‹© GitHub ä½œä¸ºæ‚¨çš„æ¥æº:

![](img/c93b7771d0efc920d822ebabcae3222b.png)

åº”è¯¥ä¼šå¼¹å‡ºä¸€ä¸ªæ–°çª—å£ï¼Œè®©æ‚¨éªŒè¯æ‚¨çš„ GitHub å¸æˆ·ã€‚å®Œæˆåï¼Œé€‰æ‹©æ­£ç¡®çš„å­˜å‚¨åº“å¹¶ç»§ç»­:

![](img/02338fbdea9b30f1432217bb3f842048.png)

ç„¶åé€‰æ‹©â€œåˆ›å»ºæ¨é€è§¦å‘å™¨â€æ‚¨åº”è¯¥ä¼šçœ‹åˆ°è¿™æ ·çš„è§¦å‘é¡µé¢ã€‚å½“æœ‰æ¨é€åˆ°ä»»ä½•åˆ†æ”¯æ—¶ï¼Œæ­¤è§¦å‘å™¨å°†å¼€å§‹æ„å»º:

![](img/1cba90b565b31003445398e1daaaf1de.png)

*å¯é€‰:å¦‚æœæ‚¨æƒ³å°†è§¦å‘é™åˆ¶ä¸ºä»…ä¸»åˆ†æ”¯ï¼Œå•å‡»* `*default-push-trigger-1*` *è¿›è¡Œç¼–è¾‘ã€‚*

![](img/ba5f03d9da678c1bbf11d3cbdd885139.png)

è§¦å‘å™¨ç¼–è¾‘é¡µé¢

# **6ã€‚å®‰è£… gcloud SDK**

å» [Cloud SDK ç½‘ç«™](https://cloud.google.com/sdk/)å®‰è£… gcloud SDKï¼Œç„¶ååˆå§‹åŒ–:

```
gcloud init
```

ä½¿ç”¨æ‚¨çš„å¸æˆ·ç™»å½•å¹¶é€‰æ‹©æ­£ç¡®çš„é¡¹ç›®ã€‚è¿™å°†ç¡®ä¿åœ¨ä¸‹ä¸€æ­¥ä¸­ä¸ºæ­£ç¡®çš„é¡¹ç›®åˆ›å»ºå›¾åƒã€‚

![](img/9c7165894f4ec636360deacce6483784.png)

# **7ã€‚å»ºç«‹äº‘æ„å»ºè€…ç¤¾åŒº**

ç”±äºæˆ‘ä»¬ä½¿ç”¨ Firebaseï¼Œäº‘æ„å»ºæ²¡æœ‰æ­£ç¡®çš„æ˜ åƒã€‚å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ¥è‡ªäº‘æ„å»ºå™¨ç¤¾åŒºçš„å›¾åƒã€‚

è½¬åˆ°å®ƒçš„ [GitHub é¡µé¢](https://github.com/GoogleCloudPlatform/cloud-builders-community)å¹¶å…‹éš†å›è´­ã€‚ç¡®ä¿å°† repo å…‹éš†åˆ°æ‚¨çš„æ ¹ç›®å½•ã€‚ç„¶åï¼Œå¯¼èˆªåˆ° Firebase æ–‡ä»¶å¤¹å¹¶æ‰“å¼€ docker æ–‡ä»¶ã€‚

ç”¨ä»¥ä¸‹æ­¥éª¤æ›¿æ¢ Dockerfile æ–‡ä»¶ä¸­çš„å†…å®¹:

```
FROM node
RUN apt-get update
RUN apt-get upgrade -y
RUN apt-get install dos2unix
RUN echo "Installing firebase tools ..."
RUN npm i -g firebase-tools
ADD firebase.bash /usr/bin
RUN chmod +x /usr/bin/firebase.bash
RUN dos2unix /usr/bin/firebase.bashENTRYPOINT [ "/usr/bin/firebase.bash" ]
```

ç”±äºæ–‡ä»¶æ ¼å¼çš„åŸå› ï¼ŒCloud Builder ç¤¾åŒº Dockerfile æ–‡ä»¶ä¸­çš„åŸå§‹å†…å®¹å°†å¯¼è‡´ä»¥ä¸‹é”™è¯¯ã€‚è¦ä¿®å¤å®ƒï¼Œè¯·å®‰è£… dos2unix:

![](img/4c807a4c00d7839e8e44836a2913d48f.png)

ç„¶åå»ºç«‹å›¾åƒã€‚è¾“å‡ºåº”ä»¥`SUCCESS`ç»“æŸã€‚

```
gcloud builds submit .
```

# **8ã€‚é…ç½®æƒé™**

æ—¢ç„¶å·²ç»è®¾ç½®äº† CI/CD ç®¡é“ï¼Œæˆ‘ä»¬éœ€è¦ä¸º Firebase éƒ¨ç½²æˆäºˆæœåŠ¡å¸æˆ·æƒé™ã€‚è¿›å…¥ GCP ä¾§è¾¹æ å’Œâ€œIAM & Adminâ€æ ‡ç­¾ã€‚æ‰¾å‡ºä»¥ cloudbuild.gserviceaccount.com ç»“å°¾çš„æˆå‘˜ã€‚ç„¶åè½¬åˆ° editï¼Œæ·»åŠ å¦ä¸€ä¸ªåä¸ºâ€œFirebase Adminâ€çš„è§’è‰²å¦‚æœä½ çš„åº”ç”¨ç¨‹åºä½¿ç”¨ APIï¼Œä½ å¿…é¡»æ·»åŠ â€œAPI Keys Adminâ€

![](img/7a5bb1a8061225040fec77bb6b8ed221.png)

# 9ã€‚æ¨é€è‡³ GitHub

åˆ›å»ºä¸€ä¸ª GitHub åº“ï¼Œå¦‚æœä½ è¿˜æ²¡æœ‰è¿™æ ·åšçš„è¯ï¼ŒæŠŠä½ çš„ä»£ç æ¨ä¸Šæ¥ã€‚

```
git add --all
git commit -m 'initial commit'
git push
```

# 10ã€‚æµ‹è¯• CI/CD ç®¡é“

ä¸ºäº†æµ‹è¯•æ‚¨çš„ CI/CD ç®¡é“ï¼Œå¯¹æ‚¨çš„é¡¹ç›®è¿›è¡Œä¸€äº›æ›´æ”¹ï¼Œå¹¶å‘ä¸Šæ¨é€ä»£ç ã€‚ä¸€æ—¦ä½ å®Œæˆäº†ä¿®æ”¹ï¼Œè½¬åˆ° GitHubï¼Œä½ åº”è¯¥ä¼šåœ¨æäº¤æ—è¾¹çœ‹åˆ°ä¸€ä¸ªé»„ç‚¹ã€‚è¿™è¡¨æ˜æ„å»ºæ­£åœ¨è¿›è¡Œä¸­ã€‚æ‚¨å¯ä»¥ç‚¹å‡»æ„å»ºæ—¥å¿—ï¼Œè½¬åˆ°â€œè¯¦ç»†ä¿¡æ¯â€ï¼Œè¿›å…¥äº‘æ„å»ºå†å²ã€‚

![](img/1a78fab9dfde34e5d5d6be3ae83b4b02.png)

æ­£åœ¨æ„å»º

![](img/52da5227c43c74af1e277803682fc6f9.png)

æˆåŠŸæ„å»º

# **å‚è€ƒæ–‡çŒ®**

1.  [CI/CD æ•™ç¨‹](https://www.youtube.com/watch?v=Zd014DjonqE) by Fireship
2.  [https://cloud . Google . com/cloud-build/docs/deploying-builds/deploy-firebase](https://cloud.google.com/cloud-build/docs/deploying-builds/deploy-firebase)
3.  [https://cloud.google.com/sdk/docs/quickstart-windows](https://cloud.google.com/sdk/docs/quickstart-windows)