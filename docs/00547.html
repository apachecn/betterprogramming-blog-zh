<html>
<head>
<title>Kubernetes Tips: Give Access To Your Cluster With A Client Certificate</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Kubernetesæç¤º:ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦è®¿é—®æ‚¨çš„é›†ç¾¤</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/k8s-tips-give-access-to-your-clusterwith-a-client-certificate-dfb3b71a76fe?source=collection_archive---------0-----------------------#2019-06-08">https://betterprogramming.pub/k8s-tips-give-access-to-your-clusterwith-a-client-certificate-dfb3b71a76fe?source=collection_archive---------0-----------------------#2019-06-08</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="0925" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">è®©ç”¨æˆ·è®¿é—®æ–°çš„Kubernetesé›†ç¾¤çš„ç®€å•æŒ‡å—ï¼ŒåŒ…æ‹¬èº«ä»½éªŒè¯è®¾ç½®å’Œè§’è‰²ç»‘å®š</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/5675a05ff0fc4cb7a64172932065c1e1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bC9X7IX5KxUcpqOGWvFcWg.png"/></div></div></figure><p id="8032" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æˆ‘ä»¬åˆšåˆšå»ºç«‹äº†ä¸€ä¸ªå…¨æ–°çš„Kubernetesé›†ç¾¤(æ­å–œï¼ğŸ‰).å®ƒå°†å¾ˆå¿«åœ¨æ•´ä¸ªå…¬å¸èŒƒå›´å†…ä½¿ç”¨ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†ä¸€ä½åŒäº‹ï¼Œæ¥è‡ª<em class="lq">å¼€å‘</em>å›¢é˜Ÿçš„Daveï¼Œä»–æƒ³å¼€å§‹ä½¿ç”¨beastï¼Œå¹¶åœ¨å…¶ä¸Šéƒ¨ç½²å’Œæµ‹è¯•ä»–çš„å…¨æ–°å¾®æœåŠ¡åº”ç”¨ã€‚æˆ‘ä»¬èƒ½åšäº›ä»€ä¹ˆç®€å•çš„æ­¥éª¤è®©ä»–è¿›å…¥ï¼Ÿè¿™å°±æ˜¯è¿™ç¯‡æ–‡ç« çš„å†…å®¹(æç¤º:æˆ‘ä»¬å°†ä½¿ç”¨x509å®¢æˆ·ç«¯è¯ä¹¦)ã€‚</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="443b" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">Kubernetesä¸­çš„ç”¨æˆ·ç®¡ç†</h1><p id="9199" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">ä¸ºäº†ç®¡ç†Kubernetesé›†ç¾¤å’Œå…¶ä¸Šè¿è¡Œçš„åº”ç”¨ç¨‹åºï¼Œé€šå¸¸ä½¿ç”¨<a class="ae mv" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank"> kubectl </a>äºŒè¿›åˆ¶æ–‡ä»¶æˆ–<a class="ae mv" href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/" rel="noopener ugc nofollow" target="_blank"> Web UI </a>ã€‚åœ¨å¹•åï¼Œè¿™äº›å·¥å…·è°ƒç”¨APIæœåŠ¡å™¨:HTTP Rest APIå…¬å¼€é›†ç¾¤æ§åˆ¶å¹³é¢çš„æ‰€æœ‰ç«¯ç‚¹ã€‚</p><p id="b796" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">(è¿™ä¸ªHTTP APIçš„æ–‡æ¡£å¾ˆæ£’ï¼Œéšä¾¿çœ‹çœ‹:<a class="ae mv" href="https://kubernetes.io/docs/reference/generated/kubernetes-api/v1.14" rel="noopener ugc nofollow" target="_blank">https://kubernetes . io/docs/reference/generated/kubernetes-API/v 1.14</a>)</p><p id="1e6a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å½“ä¸€ä¸ªè¯·æ±‚è¢«å‘é€åˆ°APIæœåŠ¡å™¨æ—¶ï¼Œåœ¨å®ƒè¢«æˆæƒ(ç¡®ä¿è¯·æ±‚è€…è¢«å…è®¸æ‰§è¡Œæ‰€è¯·æ±‚çš„åŠ¨ä½œ)ä¹‹å‰ï¼Œé¦–å…ˆéœ€è¦å¯¹å®ƒè¿›è¡Œè®¤è¯(ç¡®ä¿è¯·æ±‚è€…è¢«ç³»ç»Ÿè¯†åˆ«)ã€‚</p><p id="ed7d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">è®¤è¯æ­¥éª¤æ˜¯é€šè¿‡ä½¿ç”¨è®¤è¯æ’ä»¶æ¥å®Œæˆçš„ã€‚æœ‰å‡ ä¸ªæ’ä»¶å¯ä»¥ä½¿ç”¨ä¸åŒçš„è®¤è¯æœºåˆ¶:</p><ul class=""><li id="a1f0" class="mw mx it kw b kx ky la lb ld my lh mz ll na lp nb nc nd ne bi translated">å®¢æˆ·ç«¯è¯ä¹¦(æˆ‘ä»¬å°†åœ¨æœ¬æ–‡ä¸­è®¨è®º)</li><li id="b377" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">ä¸è®°åä»£å¸</li><li id="9f7a" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">è®¤è¯ä»£ç†</li><li id="8a98" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">HTTPåŸºæœ¬èº«ä»½éªŒè¯</li></ul><p id="f4cf" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æ ¹æ®æ‰€ä½¿ç”¨çš„è®¤è¯æœºåˆ¶ï¼Œç›¸åº”çš„æ’ä»¶æœŸæœ›åœ¨ç‰¹å®šä½ç½®æ‰¾åˆ°ç”¨æˆ·ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œå¯¹äºå®¢æˆ·ç«¯è¯ä¹¦è®¤è¯ï¼Œåº”è¯¥åœ¨è¯ä¹¦çš„<em class="lq">é€šç”¨åç§°</em> (CN)å­—æ®µä¸­æä¾›ç”¨æˆ·çš„æ ‡è¯†(ä»–ä»¬çš„idã€å§“åã€ç”µå­é‚®ä»¶ç­‰)ï¼Œå¹¶ä¸”åº”è¯¥åœ¨<em class="lq">ç»„ç»‡</em> (O)å­—æ®µä¸­æä¾›ç»„ä¿¡æ¯(å¦‚æœæœ‰)ã€‚æˆ‘ä»¬å¾ˆå¿«ä¼šåœ¨ä¸€ä¸ªä¾‹å­ä¸­çœ‹åˆ°è¿™ä¸€ç‚¹ã€‚</p><p id="4893" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Kubernetesé›†ç¾¤ä¸­æ—¢æ²¡æœ‰ç”¨æˆ·èµ„æºï¼Œä¹Ÿæ²¡æœ‰ç»„èµ„æºã€‚è¿™åº”è¯¥åœ¨é›†ç¾¤ä¹‹å¤–å¤„ç†ï¼Œå¹¶éšå‘é€åˆ°APIæœåŠ¡å™¨çš„æ¯ä¸ªè¯·æ±‚ä¸€èµ·æä¾›ã€‚</p><p id="4dc5" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å¦‚æœäº‹æƒ…è¿˜ä¸å¤ªæ¸…æ¥šï¼Œè¯·ä¸è¦æ‹…å¿ƒï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢ä¸¾ä¾‹è¯´æ˜ã€‚</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="9da9" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">ä¸€äº›è€ƒè™‘å’Œå‡è®¾</h1><ul class=""><li id="1fd8" class="mw mx it kw b kx mq la mr ld nk lh nl ll nm lp nb nc nd ne bi translated">é›†ç¾¤å°†ç”±å‡ ä¸ªå›¢é˜Ÿ/å®¢æˆ·ç«¯ä½¿ç”¨(å¤šç§Ÿæˆ·æ–¹æ³•)ï¼Œå› ä¸ºæ¯ä¸ªç§Ÿæˆ·çš„å·¥ä½œè´Ÿè½½éœ€è¦éš”ç¦»ã€‚æˆ‘ä»¬å°†é¦–å…ˆåˆ›å»ºä¸€ä¸ªåä¸º<em class="lq"> development </em>çš„åç§°ç©ºé—´ï¼Œä¸“é—¨ç”¨äºå¼€å‘å›¢é˜Ÿ(Daveæ‰€å±çš„å›¢é˜Ÿ)ã€‚</li><li id="ea98" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">Daveéœ€è¦éƒ¨ç½²æ ‡å‡†çš„Kubernetesèµ„æºã€‚ç„¶åï¼Œä»–å°†è¢«æˆäºˆä»…åˆ›å»ºã€åˆ—å‡ºã€æ›´æ–°ã€è·å–å’Œåˆ é™¤éƒ¨ç½²å’ŒæœåŠ¡èµ„æºçš„æƒé™ã€‚å¦‚æœéœ€è¦ï¼Œä»¥åå¯ä»¥æä¾›é¢å¤–çš„æƒåˆ©ã€‚æˆ‘ä»¬å°†ç¡®ä¿è¿™äº›æƒåˆ©ä»…é™äº<em class="lq">å¼€å‘</em>å‘½åç©ºé—´ã€‚</li><li id="a340" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">Daveå›¢é˜Ÿçš„å…¶ä»–æˆå‘˜ä»¥åå¯èƒ½éœ€è¦æ‹¥æœ‰ç›¸åŒçº§åˆ«çš„è®¿é—®æƒé™ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†è€ƒè™‘ä¸€ä¸ªåä¸º<em class="lq"> dev </em>çš„ç»„ï¼Œå¹¶æä¾›ç»„çº§åˆ«çš„æƒé™ã€‚</li><li id="1327" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">Daveéœ€è¦å®‰è£…<em class="lq"> kubectl </em>(è¿™å¯èƒ½å·²ç»å‘ç”Ÿäº†ï¼Œå› ä¸ºä»–å¯èƒ½å·²ç»åœ¨è¿™å°æœ¬åœ°æœºå™¨ä¸Šç©äº†<a class="ae mv" href="https://kubernetes.io/docs/setup/minikube/" rel="noopener ugc nofollow" target="_blank"> <em class="lq"> Minikube </em> </a>)ï¼Œä»–è¿˜éœ€è¦<a class="ae mv" href="https://www.openssl.org/" rel="noopener ugc nofollow" target="_blank"> <em class="lq"> openssl </em> </a>ï¼Œå› ä¸ºä»–å°†ç”Ÿæˆä¸€ä¸ªç§é’¥å’Œä¸€ä¸ªè¯ä¹¦ç™»å½•è¯·æ±‚ã€‚</li></ul></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="8458" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">åˆ›å»ºç§é’¥å’Œè¯ä¹¦ç­¾åè¯·æ±‚(CSR)</h1><p id="3d84" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">Daveé¦–å…ˆéœ€è¦ç”Ÿæˆä¸€ä¸ªç§æœ‰rsaå¯†é’¥å’Œä¸€ä¸ªCSRã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å¯ä»¥å¾ˆå®¹æ˜“åœ°åˆ›å»ºç§é’¥:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="0ab9" class="ns lz it no b gy nt nu l nv nw"><strong class="no iu">$ openssl genrsa -out dave.key 4096</strong></span></pre><p id="686a" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ä¼ä¸šç¤¾ä¼šè´£ä»»æœ‰ç‚¹å¤æ‚ã€‚æˆ´å¤«éœ€è¦ç¡®ä¿ä»–:</p><ul class=""><li id="9bfb" class="mw mx it kw b kx ky la lb ld my lh mz ll na lp nb nc nd ne bi translated">åœ¨Common Name (CN)å­—æ®µä¸­ä½¿ç”¨ä»–çš„åå­—:è¿™å°†ç”¨äºåœ¨APIæœåŠ¡å™¨ä¸­è¯†åˆ«ä»–ã€‚</li><li id="341a" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">ä½¿ç”¨organization(O)å­—æ®µä¸­çš„ç»„å:è¿™å°†ç”¨äºæ ¹æ®APIæœåŠ¡å™¨è¯†åˆ«ç»„ã€‚</li></ul><p id="73d7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ä¸‹é¢æ˜¯Daveå°†ç”¨æ¥ç”ŸæˆCSRçš„é…ç½®æ–‡ä»¶:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="9100" class="ns lz it no b gy nt nu l nv nw">[ req ]<br/>default_bits = 2048<br/>prompt = no<br/>default_md = sha256<br/>distinguished_name = dn</span><span id="0f46" class="ns lz it no b gy nx nu l nv nw">[ dn ]<br/>CN = dave<br/>O = dev</span><span id="6d1c" class="ns lz it no b gy nx nu l nv nw">[ v3_ext ]<br/>authorityKeyIdentifier=keyid,issuer:always<br/>basicConstraints=CA:FALSE<br/>keyUsage=keyEncipherment,dataEncipherment<br/>extendedKeyUsage=serverAuth,<strong class="no iu">clientAuth</strong></span></pre><p id="ff1e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">æ³¨æ„</strong>:extendedkey usageå­—æ®µä¸­çš„clientAuthæ¡ç›®å¾ˆé‡è¦ï¼Œå› ä¸ºè¯ä¹¦å°†ç”¨äºè¯†åˆ«å®¢æˆ·ç«¯ã€‚</p><p id="68ee" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ä½¿ç”¨ä¸Šé¢çš„é…ç½®æ–‡ä»¶(ä¿å­˜åœ¨csr.cnfä¸­)ï¼Œå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºcsr:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="3de6" class="ns lz it no b gy nt nu l nv nw">$ openssl req -config ./csr.cnf -new -key dave.key -nodes -out dave.csr</span></pre><p id="7a07" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ä¸€æ—¦ã€‚csræ–‡ä»¶å·²åˆ›å»ºï¼ŒDaveéœ€è¦å°†å…¶å‘é€ç»™æˆ‘ä»¬(ç®¡ç†å‘˜),è¿™æ ·æˆ‘ä»¬å°±å¯ä»¥ä½¿ç”¨ç¾¤é›†è¯ä¹¦é¢å‘æœºæ„å¯¹å…¶è¿›è¡Œç­¾åã€‚è¿™æ˜¯æˆ‘ä»¬ä¸‹ä¸€æ­¥è¦è®¨è®ºçš„ã€‚</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="e8b3" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">CSRçš„ç­¾å</h1><p id="fbc0" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">çš„ç­¾åã€‚csræ–‡ä»¶å°†å¯¼è‡´è¯ä¹¦çš„åˆ›å»ºã€‚è¿™ä¸ªå°†ç”¨äºéªŒè¯Daveå‘é€ç»™APIæœåŠ¡å™¨çš„æ¯ä¸ªè¯·æ±‚ã€‚</p><p id="c3c8" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æˆ‘ä»¬å°†é¦–å…ˆåˆ›å»ºä¸€ä¸ªKubernetes CertificateSigninRequestèµ„æºã€‚</p><p id="78a1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">æ³¨æ„</strong>:æˆ‘ä»¬å¯èƒ½å·²ç»å»ºç«‹äº†ä¸€ä¸ªæ‰˜ç®¡é›†ç¾¤(æœ‰å¾ˆå¤šè¿™æ ·çš„é›†ç¾¤:<a class="ae mv" href="https://digitalocean.com" rel="noopener ugc nofollow" target="_blank">æ•°å­—æµ·æ´‹</a>ã€<a class="ae mv" href="https://cloud.google.com/kubernetes-engine/" rel="noopener ugc nofollow" target="_blank">è°·æ­Œçš„GKE </a>ã€<a class="ae mv" href="https://azure.microsoft.com/fr-fr/services/kubernetes-service/" rel="noopener ugc nofollow" target="_blank">å¾®è½¯çš„Azure AKS </a>ã€â€¦)ï¼Œæˆ–è€…åˆ›å»ºäº†æˆ‘ä»¬è‡ªå·±çš„é›†ç¾¤(ä½¿ç”¨<a class="ae mv" href="https://kubernetes.io/fr/docs/setup/independent/install-kubeadm/" rel="noopener ugc nofollow" target="_blank"> kubeadm </a>ã€<a class="ae mv" href="https://github.com/kubernetes-sigs/kubespray" rel="noopener ugc nofollow" target="_blank"> kubespray </a>ã€â€¦)ã€‚è¿‡ç¨‹æ˜¯ä¸€æ ·çš„ã€‚</p><p id="5ef6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æˆ‘ä»¬å°†ä½¿ç”¨ä¸‹é¢çš„è§„èŒƒï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨<em class="lq"> csr.yaml </em>ä¸­ã€‚</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="f00b" class="ns lz it no b gy nt nu l nv nw">apiVersion: certificates.k8s.io/v1beta1<br/>kind: CertificateSigningRequest<br/>metadata:<br/>  name: mycsr<br/>spec:<br/>  groups:<br/>  - system:authenticated<br/>  request: ${BASE64_CSR}<br/>  usages:<br/>  - digital signature<br/>  - key encipherment<br/>  - server auth<br/>  - client auth</span></pre><p id="4581" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æ­£å¦‚æˆ‘ä»¬æ‰€è§ï¼Œ<em class="lq">è¯·æ±‚</em>é”®çš„å€¼æ˜¯<em class="lq"> BASE64_CSR </em>ç¯å¢ƒå˜é‡çš„å†…å®¹ã€‚ç¬¬ä¸€æ­¥æ˜¯è·å–ã€‚csræ–‡ä»¶ï¼Œç„¶ååœ¨åˆ›å»ºèµ„æºä¹‹å‰ä½¿ç”¨<a class="ae mv" href="https://www.gnu.org/software/gettext/manual/html_node/envsubst-Invocation.html" rel="noopener ugc nofollow" target="_blank"> <em class="lq"> envsubst </em> </a>äºŒè¿›åˆ¶æ¥æ›¿æ¢è¯¥å˜é‡çš„å€¼ã€‚</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="5e1c" class="ns lz it no b gy nt nu l nv nw"># Encoding the .csr file in base64<br/><strong class="no iu">$ export BASE64_CSR=$(cat ./dave.csr | base64 | tr -d '\n')</strong></span><span id="f528" class="ns lz it no b gy nx nu l nv nw"># Substitution of the BASE64_CSR env variable and creation of the CertificateSigninRequest resource<strong class="no iu"><br/>$ cat csr.yaml | envsubst | kubectl apply -f -</strong></span></pre><p id="f9f4" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æ£€æŸ¥æ–°åˆ›å»ºçš„CSRçš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒå¤„äº<em class="lq"> Pending </em>çŠ¶æ€ã€‚</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="9438" class="ns lz it no b gy nt nu l nv nw"># Checking the status of the newly created CSR<br/><strong class="no iu">$ kubectl get csr<br/></strong>NAME        AGE   REQUESTOR            CONDITION<br/>mycsr       9s    28b93...d73801ee46   Pending</span></pre><p id="f62d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰¹å‡†è¯¥CSR:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="f5ba" class="ns lz it no b gy nt nu l nv nw">$ kubectl certificate approve mycsr</span></pre><p id="92ae" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å†æ¬¡æ£€æŸ¥CSRçš„çŠ¶æ€ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®ƒç°åœ¨å·²è¢«æ‰¹å‡†ã€‚</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="8bb6" class="ns lz it no b gy nt nu l nv nw"><strong class="no iu">$ kubectl get csr<br/></strong>NAME        AGE   REQUESTOR            CONDITION<br/>mycsr       9s    28b93...d73801ee46   Approved,Issued</span></pre><p id="d30d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">è¯ä¹¦å·²åˆ›å»ºã€‚è®©æˆ‘ä»¬å°†å®ƒä»CSRèµ„æºä¸­æå–å‡ºæ¥ï¼Œå¹¶ä¿å­˜åœ¨ä¸€ä¸ªåä¸º<em class="lq"> dave.crt </em>çš„æ–‡ä»¶ä¸­ï¼Œä»¥æ£€æŸ¥é‡Œé¢æœ‰ä»€ä¹ˆã€‚</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="b49f" class="ns lz it no b gy nt nu l nv nw">$ kubectl get csr mycsr -o jsonpath='{.status.certificate}' \<br/>  | base64 --decode &gt; dave.crt</span></pre><p id="60c7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ä¸‹é¢çš„<a class="ae mv" href="https://www.openssl.org/" rel="noopener ugc nofollow" target="_blank"> openssl </a>å‘½ä»¤æ˜¾ç¤ºè¯ä¹¦å·²ç»ç”±DigitalOceançš„é›†ç¾¤CA(å‘è¡Œè€…éƒ¨åˆ†)ç­¾åï¼Œä¸»é¢˜åŒ…å«CN (CommonName)å­—æ®µä¸­çš„<em class="lq"> dave </em>å’ŒO(organization)å­—æ®µä¸­çš„<em class="lq"> dev </em>ï¼Œå¦‚daveåœ¨åˆ›å»ºã€‚csræ–‡ä»¶ã€‚</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="2660" class="ns lz it no b gy nt nu l nv nw"><strong class="no iu">$ openssl x509 -in ./dave.crt -noout -text<br/></strong>Certificate:<br/>    Data:<br/>        Version: 3 (0x2)<br/>        Serial Number:<br/>            48:29:cf:ae:d6:...:09:33:ef:14:58<br/>    Signature Algorithm: sha256WithRSAEncryption<br/>        Issuer: O=DigitalOcean, CN=k8saas Cluster CA<br/>        Validity<br/>            Not Before: Jun  3 07:56:00 2019 GMT<br/>            Not After : Jun  2 07:56:00 2020 GMT<br/>        <strong class="no iu">Subject: O=dev, CN=dave</strong><br/>        Subject Public Key Info:<br/>            Public Key Algorithm: rsaEncryption<br/>                Public-Key: (4096 bit)<br/>                Modulus:<br/>...</span></pre><p id="7059" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">æ³¨</strong>:æœ¬ä¾‹ä¸­ä½¿ç”¨çš„é›†ç¾¤æ˜¯åœ¨<a class="ae mv" href="https://digitalocean.com" rel="noopener ugc nofollow" target="_blank"> DigitalOcean </a>ä¸Šåˆ›å»ºçš„æ‰˜ç®¡Kubernetesé›†ç¾¤ã€‚æˆ‘ä»¬å¯ä»¥ä»ç¾¤é›†è¯ä¹¦é¢å‘æœºæ„çœ‹åˆ°å®ƒã€‚</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="5c53" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">å‘½åç©ºé—´çš„åˆ›å»º</h1><p id="6581" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">æˆ‘ä»¬é¦–å…ˆåˆ›å»ºä¸€ä¸ªåä¸º<em class="lq"> development </em>çš„åç§°ç©ºé—´ï¼Œè¿™æ ·Daveå’Œä»–çš„å›¢é˜Ÿå°†éƒ¨ç½²çš„æ‰€æœ‰èµ„æºéƒ½ä¸é›†ç¾¤çš„å…¶ä»–å·¥ä½œè´Ÿè½½éš”ç¦»å¼€æ¥ã€‚å®ƒå¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„å‘½ä»¤åˆ›å»º:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="8cb8" class="ns lz it no b gy nt nu l nv nw">$ kubectl create ns development</span></pre><p id="d5ff" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æˆ–è€…ç”¨è¿™ä¸ª<em class="lq"> dev-ns.yaml </em>æ–‡ä»¶:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="90a2" class="ns lz it no b gy nt nu l nv nw">apiVersion: v1<br/>kind: Namespace<br/>metadata:<br/>  name: <!-- -->development</span></pre><p id="6430" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æ¥ç€æ˜¯é€šå¸¸çš„:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="9071" class="ns lz it no b gy nt nu l nv nw">$ kubectl apply -f dev-ns.yaml</span></pre><p id="abe2" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">æ³¨æ„</strong>:æœ€ä½³å®è·µæ˜¯åˆ›å»ºä¸€ä¸ªResourceQuotaèµ„æºå¹¶å°†å…¶é“¾æ¥åˆ°åç§°ç©ºé—´ï¼Œä»¥ä¾¿é™åˆ¶åç§°ç©ºé—´ä¸­å¯ä»¥ä½¿ç”¨çš„cpuå’ŒRAMçš„æ•°é‡ï¼Œä½†è¿™æ˜¯å¦ä¸€ç¯‡æ–‡ç« çš„å†…å®¹ã€‚</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="8ef8" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">è®¾ç½®RBACè§„åˆ™</h1><p id="4501" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">é€šè¿‡åˆ›å»ºä¸€ä¸ªè¯ä¹¦ï¼Œæˆ‘ä»¬å…è®¸Daveé’ˆå¯¹APIæœåŠ¡å™¨è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä½†æ˜¯æˆ‘ä»¬æ²¡æœ‰æŒ‡å®šä»»ä½•æƒé™ï¼Œå› æ­¤ä»–å°†ä¸èƒ½åšå¾ˆå¤šäº‹æƒ…â€¦â€¦æˆ‘ä»¬å°†æ”¹å˜è¿™ä¸€ç‚¹ï¼Œå¹¶æˆäºˆä»–åœ¨<em class="lq"> dev </em>åç§°ç©ºé—´ä¸­åˆ›å»ºã€è·å–ã€æ›´æ–°ã€åˆ—å‡ºå’Œåˆ é™¤éƒ¨ç½²å’ŒæœåŠ¡èµ„æºçš„æƒé™ã€‚</p><p id="7216" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ä¸‹å›¾æ˜¾ç¤ºäº†Kubernetesè§’è‰²åº“è®¿é—®æ§åˆ¶(RBAC)ä¸­æ¶‰åŠçš„èµ„æºã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ny"><img src="../Images/016d5260e2b288c34917ffbe1d08bc9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*s2OHCGlh-XH87ZT9xW2e0A.png"/></div></div><p class="nz oa gj gh gi ob oc bd b be z dk translated">æ‰€æ¶‰åŠèµ„æºçš„æ¦‚è¿°</p></figure><p id="512d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ç®€è€Œè¨€ä¹‹:è§’è‰²(åŒæ ·é€‚ç”¨äºé›†ç¾¤è§’è‰²)åŒ…å«ä¸€ç³»åˆ—è§„åˆ™ã€‚æ¯ä¸ªè§„åˆ™éƒ½å®šä¹‰äº†ä¸€äº›å¯ä»¥é’ˆå¯¹apiGroups(ä¾‹å¦‚:coreï¼Œapps/v1ï¼Œâ€¦)å†…çš„èµ„æºåˆ—è¡¨(ä¾‹å¦‚:Podï¼ŒServiceï¼ŒSecret)æ‰§è¡Œçš„æ“ä½œ(ä¾‹å¦‚:listï¼Œgetï¼Œwatchï¼Œâ€¦)ã€‚è§’è‰²å®šä¹‰ç‰¹å®šå‘½åç©ºé—´çš„æƒé™ï¼Œè€Œé›†ç¾¤è§’è‰²çš„èŒƒå›´æ˜¯æ•´ä¸ªé›†ç¾¤</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="4904" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated"><strong class="ak">è§’è‰²çš„åˆ›å»º</strong></h1><p id="f454" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">è®©æˆ‘ä»¬é¦–å…ˆä½¿ç”¨ä»¥ä¸‹è§„èŒƒåˆ›å»ºä¸€ä¸ªè§’è‰²èµ„æº:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="018c" class="ns lz it no b gy nt nu l nv nw">kind: Role<br/>apiVersion: rbac.authorization.k8s.io/v1<br/>metadata:<br/> namespace: development<br/> name: dev<br/>rules:<br/>- apiGroups: [""]<br/>  resources: ["pods", "services"]<br/>  verbs: ["create", "get", "update", "list", "delete"]<br/>- apiGroups: ["apps"]<br/>  resources: ["deployments"]<br/>  verbs: ["create", "get", "update", "list", "delete"]</span></pre><p id="7d15" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Podså’ŒæœåŠ¡èµ„æºå±äº<em class="lq">æ ¸å¿ƒ</em> APIç»„(apiGroupsé”®çš„å€¼æ˜¯ç©ºå­—ç¬¦ä¸²)ï¼Œè€Œéƒ¨ç½²èµ„æºå±äº<em class="lq">åº”ç”¨</em> APIç»„ã€‚å¯¹äºè¿™ä¸¤ä¸ªapiGroupsï¼Œæˆ‘ä»¬å®šä¹‰äº†èµ„æºåˆ—è¡¨å’Œåº”è¯¥åœ¨è¿™äº›èµ„æºä¸Šæˆæƒçš„æ“ä½œã€‚</p><p id="9a20" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å‡è®¾ä¸Šé¢çš„å†…å®¹åœ¨<em class="lq"> role.yaml </em>ä¸­ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºè§’è‰²:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="aff4" class="ns lz it no b gy nt nu l nv nw">$ kubectl apply -f role.yaml</span></pre></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="fe35" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated"><strong class="ak">åˆ›å»ºè§’è‰²ç»‘å®š</strong></h1><p id="78fe" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">è§’è‰²ç»‘å®šçš„ç›®çš„æ˜¯é“¾æ¥è§’è‰²(æˆæƒæ“ä½œåˆ—è¡¨)å’Œç”¨æˆ·æˆ–ç»„ã€‚ä¸ºäº†è®©Daveæ‹¥æœ‰ä¸Šè¿°è§’è‰²ä¸­æŒ‡å®šçš„æƒé™ï¼Œæˆ‘ä»¬éœ€è¦å°†ä»–ç»‘å®šåˆ°è¿™ä¸ªè§’è‰²ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹è§’è‰²ç»‘å®šèµ„æº:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="23d1" class="ns lz it no b gy nt nu l nv nw">kind: RoleBinding<br/>apiVersion: rbac.authorization.k8s.io/v1<br/>metadata:<br/> name: dev<br/> namespace: development<br/>subjects:<br/>- kind: User<br/>  name: dave<br/>  apiGroup: rbac.authorization.k8s.io<br/>roleRef:<br/> kind: Role<br/> name: dev<br/> apiGroup: rbac.authorization.k8s.io</span></pre><p id="1909" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æ­¤è§’è‰²ç»‘å®šé“¾æ¥:</p><ul class=""><li id="7574" class="mw mx it kw b kx ky la lb ld my lh mz ll na lp nb nc nd ne bi translated">ä¸€ä¸ªä¸»é¢˜:æˆ‘ä»¬çš„ç”¨æˆ·æˆ´å¤«ã€‚</li><li id="a8ca" class="mw mx it kw b kx nf la ng ld nh lh ni ll nj lp nb nc nd ne bi translated">è§’è‰²:åä¸º<em class="lq"> dev </em>çš„è§’è‰²ï¼Œå®ƒå…è®¸åˆ›å»º/è·å–/æ›´æ–°/åˆ—å‡º/åˆ é™¤æˆ‘ä»¬ä¸Šé¢å®šä¹‰çš„éƒ¨ç½²å’ŒæœåŠ¡èµ„æºã€‚</li></ul><p id="69ce" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">æ³¨æ„</strong>:ç”±äºDaveå±äº<em class="lq"> dev </em>ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„RoleBindingå°†ä¹‹å‰çš„è§’è‰²ä¸ç»„ç»‘å®šï¼Œè€Œä¸æ˜¯ä¸å•ä¸ªç”¨æˆ·ç»‘å®šã€‚è¯·è®°ä½:ç»„ä¿¡æ¯åœ¨éšæ¯ä¸ªè¯·æ±‚ä¸€èµ·å‘é€çš„è¯ä¹¦çš„ç»„ç»‡(O)å­—æ®µä¸­æä¾›ã€‚</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="1064" class="ns lz it no b gy nt nu l nv nw">kind: RoleBinding<br/>apiVersion: rbac.authorization.k8s.io/v1<br/>metadata:<br/> name: dev<br/> namespace: development<br/>subjects:<br/>- kind: Group<br/>  name: dev<br/>  apiGroup: rbac.authorization.k8s.io<br/>roleRef:<br/> kind: Role<br/> name: dev<br/> apiGroup: rbac.authorization.k8s.io</span></pre><p id="3098" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å‡è®¾æˆ‘ä»¬å·²ç»åœ¨<em class="lq"> role-binding.yaml </em>æ–‡ä»¶ä¸­ä¿å­˜äº†RoleBindingèµ„æºçš„è§„èŒƒï¼Œæˆ‘ä»¬å¯ä»¥ç”¨ä¸‹é¢çš„å‘½ä»¤åˆ›å»ºå®ƒ:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="7b85" class="ns lz it no b gy nt nu l nv nw">$ kubectl apply -f role-binding.yaml</span></pre></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="77aa" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">ä¸ºDaveæ„å»ºKubeé…ç½®</h1><p id="92b9" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">ä¸€åˆ‡éƒ½å‡†å¤‡å¥½äº†ã€‚æˆ‘ä»¬ç°åœ¨å¿…é¡»å‘Daveå‘é€ä»–éœ€è¦çš„ä¿¡æ¯ï¼Œä»¥é…ç½®ä»–çš„æœ¬åœ°kubectlå®¢æˆ·æœºä¸æˆ‘ä»¬çš„é›†ç¾¤é€šä¿¡ã€‚</p><p id="c235" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æˆ‘ä»¬å°†é¦–å…ˆåˆ›å»ºä¸€ä¸ª<em class="lq"> kubeconfig.tpl </em>æ–‡ä»¶ï¼Œå®ƒåŒ…å«ä»¥ä¸‹å†…å®¹ï¼Œæˆ‘ä»¬å°†æŠŠå®ƒç”¨ä½œæ¨¡æ¿ã€‚</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="cc7d" class="ns lz it no b gy nt nu l nv nw">apiVersion: v1<br/>kind: Config<br/>clusters:<br/>- cluster:<br/>    certificate-authority-data: ${CLUSTER_CA}<br/>    server: ${CLUSTER_ENDPOINT}<br/>  name: ${CLUSTER_NAME}<br/>users:<br/>- name: ${USER}<br/>  user:<br/>    client-certificate-data: ${CLIENT_CERTIFICATE_DATA}<br/>contexts:<br/>- context:<br/>    cluster: ${CLUSTER_NAME}<br/>    user: dave<br/>  name: ${USER}-${CLUSTER_NAME}<br/>current-context: ${USER}-${CLUSTER_NAME}</span></pre><p id="e4f7" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ä¸ºäº†ä»è¿™ä¸ªæ¨¡æ¿æ„å»ºä¸€ä¸ªåŸºæœ¬çš„kubeé…ç½®ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦è®¾ç½®æ‰€æœ‰éœ€è¦çš„ç¯å¢ƒå˜é‡:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="aacf" class="ns lz it no b gy nt nu l nv nw"># User identifier<br/><strong class="no iu">$ export USER="dave"</strong></span><span id="d8a9" class="ns lz it no b gy nx nu l nv nw"># Cluster Name (get it from the current context)<br/><strong class="no iu">$ export CLUSTER_NAME=$(kubectl config view --minify -o jsonpath={.current-context})</strong></span><span id="24ee" class="ns lz it no b gy nx nu l nv nw"># Client certificate<br/><strong class="no iu">$ export CLIENT_CERTIFICATE_DATA=$(kubectl get csr mycsr -o jsonpath='{.status.certificate}')</strong></span><span id="7fff" class="ns lz it no b gy nx nu l nv nw"># Cluster Certificate Authority<br/><strong class="no iu">$ export CLUSTER_CA=$(kubectl config view --raw -o json | jq -r '.clusters[] | select(.name == "'$(kubectl config current-context)'") | .cluster."certificate-authority-data"')</strong></span><span id="62f5" class="ns lz it no b gy nx nu l nv nw"># API Server endpoint<br/><strong class="no iu">$ export CLUSTER_ENDPOINT=$(kubectl config view --raw -o json | jq -r '.clusters[] | select(.name == "'$(kubectl config current-context)'") | .cluster."server"')</strong></span></pre><p id="8cd6" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å¹¶å†æ¬¡ä½¿ç”¨æ–¹ä¾¿çš„<a class="ae mv" href="https://www.gnu.org/software/gettext/manual/html_node/envsubst-Invocation.html" rel="noopener ugc nofollow" target="_blank"> envsubst </a>å®ç”¨ç¨‹åºæ›¿æ¢å®ƒä»¬:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="76e5" class="ns lz it no b gy nt nu l nv nw">$ cat kubeconfig.tpl | <!-- -->envsubst &gt; kubeconfig</span></pre><p id="3e38" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æˆ‘ä»¬ç°åœ¨å¯ä»¥å°†è¿™ä¸ª<em class="lq"> kubeconfig </em>æ–‡ä»¶å‘é€ç»™æˆ´å¤«ï¼Œä»–åªéœ€åœ¨å…¶ä¸­æ·»åŠ è‡ªå·±çš„ç§é’¥ï¼Œå°±å¯ä»¥ä¸é›†ç¾¤é€šä¿¡äº†ã€‚</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="7541" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">ä¸Šä¸‹æ–‡çš„ä½¿ç”¨</h1><p id="1be1" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">ä¸ºäº†ä½¿ç”¨<em class="lq"> kubeconfigï¼Œ</em> Daveå¯ä»¥ç”¨æŒ‡å‘æ–‡ä»¶çš„è·¯å¾„è®¾ç½®kubeconfigç¯å¢ƒå˜é‡ã€‚</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="d7f5" class="ns lz it no b gy nt nu l nv nw">$ export KUBECONFIG=$PWD/kubeconfig</span></pre><p id="74fa" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated"><strong class="kw iu">æ³¨æ„</strong>:ä½¿ç”¨Kubernetesé…ç½®æœ‰ä¸åŒçš„æ–¹æ³•:è®¾ç½®<em class="lq"> KUBECONFIG </em>ç¯å¢ƒå˜é‡ï¼Œåœ¨é»˜è®¤çš„<em class="lq"> $HOME/ä¸­æ·»åŠ ä¸€ä¸ªæ–°æ¡ç›®ã€‚kube/config </em>æ–‡ä»¶ï¼Œæˆ–è€…åœ¨æ¯ä¸ª<em class="lq"> kubectl </em>å‘½ä»¤ä¸Šä½¿ç”¨- <em class="lq"> kubeconfig </em>æ ‡å¿—ã€‚</p><p id="976e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">è¦æ·»åŠ ä»–çš„ç§æœ‰å¯†é’¥ï¼Œdave.key åœ¨æµç¨‹å¼€å§‹æ—¶ç”Ÿæˆï¼Œdaveå¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="ccbd" class="ns lz it no b gy nt nu l nv nw">$ kubectl config set-credentials dave \<br/>  --client-key=$PWD/dave.key \<br/>  <!-- -->--embed-certs=true</span></pre><p id="761d" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å®ƒå°†åœ¨<em class="lq"> kubeconfig </em>æ–‡ä»¶çš„ç”¨æˆ·æ¡ç›®ä¸­åˆ›å»ºå¯†é’¥<em class="lq"> client-key-data </em>ï¼Œå¹¶å°†<em class="lq"> dave.key </em>çš„base64ç¼–ç è®¾ç½®ä¸ºå€¼ã€‚</p><p id="5738" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼ŒDaveåº”è¯¥èƒ½å¤Ÿä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ£€æŸ¥æœåŠ¡å™¨(å’Œå®¢æˆ·æœº)çš„ç‰ˆæœ¬:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="816e" class="ns lz it no b gy nt nu l nv nw">$ kubectl version<br/>Client Version: version.Info{Major:"1", Minor:"14", GitVersion:"v1.14.2", GitCommit:"66049e3b21efe110454d67df4fa62b08ea79a19b", GitTreeState:"clean", BuildDate:"2019-05-16T16:23:09Z", GoVersion:"go1.12.5", Compiler:"gc", Platform:"darwin/amd64"}<br/><strong class="no iu">Server Version: version.Info{Major:"1", Minor:"14", GitVersion:"v1.14.2", GitCommit:"66049e3b21efe110454d67df4fa62b08ea79a19b", GitTreeState:"clean", BuildDate:"2019-05-16T16:14:56Z", GoVersion:"go1.12.5", Compiler:"gc", Platform:"linux/amd64"}</strong></span></pre><p id="3227" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">è®©æˆ‘ä»¬æ›´è¿›ä¸€æ­¥ï¼Œæ£€æŸ¥ä¸Daveå…³è”çš„å½“å‰è§’è‰²æ˜¯å¦å…è®¸ä»–åˆ—å‡ºé›†ç¾¤çš„èŠ‚ç‚¹ã€‚</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="e73f" class="ns lz it no b gy nt nu l nv nw"><strong class="no iu">$ kubectl get nodes<br/></strong>Error from server (Forbidden): nodes is forbidden: User "dave" cannot list resource "nodes" in API group "" at the cluster scope</span></pre><p id="4c70" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">å½“ç„¶ä¸æ˜¯ï¼ä½†æ˜¯Daveç°åœ¨åº”è¯¥èƒ½å¤Ÿåœ¨é›†ç¾¤ä¸Šéƒ¨ç½²ä¸œè¥¿äº†â€”â€”è‡³å°‘åœ¨åä¸º<em class="lq"> development </em>çš„åç§°ç©ºé—´ä¸­ã€‚è®©æˆ‘ä»¬ç”¨è¿™ä¸ªç¤ºä¾‹ymlæ–‡ä»¶æ¥æ£€æŸ¥ä¸€ä¸‹ï¼Œå®ƒå®šä¹‰äº†ä¸€ä¸ªåŸºäºnginxæ˜ åƒçš„éƒ¨ç½²å’Œä¸€ä¸ªå…¬å¼€å®ƒçš„æœåŠ¡ã€‚</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="a43e" class="ns lz it no b gy nt nu l nv nw"># www.yaml</span><span id="9c59" class="ns lz it no b gy nx nu l nv nw">apiVersion: apps/v1<br/>kind: Deployment<br/>metadata:<br/>  name: www<br/>  namespace: development<br/>spec:<br/>  replicas: 3<br/>  selector:<br/>    matchLabels:<br/>      app: www<br/>  template:<br/>    metadata:<br/>      labels:<br/>        app: www<br/>    spec:<br/>      containers:<br/>      - name: nginx<br/>        image: nginx:1.14-alpine<br/>        ports:<br/>        - containerPort: 80<br/>---<br/>apiVersion: v1<br/>kind: Service<br/>metadata:<br/>  name: www<br/>  namespace: development<br/>spec:<br/>  selector:<br/>    app: vote<br/>  type: ClusterIP<br/>  ports:<br/>  - port: 80<br/>    targetPort: 80</span></pre><p id="5153" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æˆ‘ä»¬å¯ä»¥ä»ä¸‹é¢çš„å‘½ä»¤ä¸­çœ‹åˆ°ï¼ŒDaveå¯ä»¥åœ¨é›†ç¾¤ä¸­åˆ›å»ºè¿™äº›èµ„æº:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="8daa" class="ns lz it no b gy nt nu l nv nw"><strong class="no iu">$ kubectl apply -f </strong><a class="ae mv" href="http://www.yaml" rel="noopener ugc nofollow" target="_blank"><strong class="no iu">www.yaml</strong></a><br/>deployment.apps/www created<br/>service/www created</span></pre><p id="fff1" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">Daveå—é™äº<em class="lq">å¼€å‘</em>åç§°ç©ºé—´ã€‚æˆ‘ä»¬å¯ä»¥ä»ä»–åœ¨è¯•å›¾åˆ—å‡ºé»˜è®¤åç§°ç©ºé—´ä¸­çš„æ‰€æœ‰çª—æ ¼æ—¶å¾—åˆ°çš„é”™è¯¯æ¶ˆæ¯ä¸­ç¡®è®¤è¿™ä¸€ç‚¹:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="b187" class="ns lz it no b gy nt nu l nv nw"><strong class="no iu">$ kubectl get pods</strong><br/>Error from server (Forbidden): pods is forbidden: User â€œdaveâ€ cannot list resource â€œpodsâ€ in API group â€œâ€ in the namespace â€œdefaultâ€</span></pre><p id="32dd" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">æ­¤å¤–ï¼Œé™¤äº†æˆ‘ä»¬æˆäºˆä»–è®¿é—®æƒé™çš„èµ„æºä¹‹å¤–ï¼Œä»–å°†æ— æ³•åˆ›å»ºå…¶ä»–èµ„æºã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä»¥ä¸‹Secretç±»å‹èµ„æºçš„è§„èŒƒ:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="017c" class="ns lz it no b gy nt nu l nv nw"># credentials.yaml<br/>apiVersion: v1<br/>kind: Secret<br/>metadata:<br/>  name: mysecret<br/>  namespace: development<br/>data:<br/>  username: YWRtaW4=<br/>  password: MWYyZDFlMmU2N2Rm</span></pre><p id="7d57" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">è®©æˆ‘ä»¬çœ‹çœ‹æˆ´å¤«æ˜¯å¦‚ä½•åˆ›é€ å®ƒçš„:</p><pre class="kj kk kl km gt nn no np nq aw nr bi"><span id="1d9c" class="ns lz it no b gy nt nu l nv nw"><strong class="no iu">$ kubectl apply -f credentials.yaml</strong><br/>Error from server (Forbidden): error when retrieving current configuration of:<br/>Resource: â€œ/v1, Resource=secretsâ€, GroupVersionKind: â€œ/v1, Kind=Secretâ€<br/>Name: â€œmysecretâ€, Namespace: â€œdevelopmentâ€<br/>Object: &amp;{map[â€œapiVersionâ€:â€v1" â€œdataâ€:map[â€œpasswordâ€:â€MWYyZDFlMmU2N2Rmâ€ â€œusernameâ€:â€YWRtaW4=â€] â€œkindâ€:â€Secretâ€ â€œmetadataâ€:map[â€œannotationsâ€:map[â€œkubectl.kubernetes.io/last-applied-configurationâ€:â€â€] â€œnameâ€:â€mysecretâ€ â€œnamespaceâ€:â€developmentâ€]]}<br/>from server for: â€œcredentials.yamlâ€: secrets â€œmysecretâ€ is forbidden: User â€œdaveâ€ cannot get resource â€œsecretsâ€ in API group â€œâ€ in the namespace â€œdevelopmentâ€</span></pre></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><h1 id="1cf3" class="ly lz it bd ma mb mc md me mf mg mh mi jz mj ka mk kc ml kd mm kf mn kg mo mp bi translated">æ‘˜è¦</h1><p id="bd72" class="pw-post-body-paragraph ku kv it kw b kx mq ju kz la mr jx lc ld ms lf lg lh mt lj lk ll mu ln lo lp im bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨å®¢æˆ·ç«¯è¯ä¹¦æˆæƒç”¨æˆ·è¿›å…¥æˆ‘ä»¬çš„Kubernetesé›†ç¾¤ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…¶ä»–æ–¹æ³•æ¥è®¾ç½®è¿™ç§èº«ä»½éªŒè¯ï¼Œä½†è¿™ç§æ–¹æ³•éå¸¸ç®€å•(åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨å¤–éƒ¨èº«ä»½æä¾›è€…)ã€‚</p><p id="6658" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ä¸€æ—¦å»ºç«‹äº†èº«ä»½éªŒè¯ï¼Œæˆ‘ä»¬å°±ä½¿ç”¨è§’è‰²æ¥å®šä¹‰ä¸€äº›ä»…é™äºåç§°ç©ºé—´çš„æƒé™ï¼Œå¹¶ç”¨RoleBindingå°†å®ƒç»‘å®šåˆ°ç”¨æˆ·ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦æä¾›é›†ç¾¤èŒƒå›´çš„æƒé™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ClusterRoleå’ŒClusterRoleBindingèµ„æºã€‚</p></div><div class="ab cl lr ls hx lt" role="separator"><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw lx"/><span class="lu bw bk lv lw"/></div><div class="im in io ip iq"><p id="d15e" class="pw-post-body-paragraph ku kv it kw b kx ky ju kz la lb jx lc ld le lf lg lh li lj lk ll lm ln lo lp im bi translated">ç¥ä½ å¥½è¿ï¼å¦‚æœä½ å°è¯•è¿‡ï¼Œæˆ‘å¾ˆä¹æ„åœ¨ä¸‹é¢çš„è¯„è®ºä¸­å¬åˆ°ä½ çš„æƒ³æ³•ã€‚</p></div></div>    
</body>
</html>