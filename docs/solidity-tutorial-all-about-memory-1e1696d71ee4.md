# åšå®åº¦æ•™ç¨‹:å…³äºå†…å­˜çš„ä¸€åˆ‡

> åŸæ–‡ï¼š<https://betterprogramming.pub/solidity-tutorial-all-about-memory-1e1696d71ee4>

## ç†è§£ EVM çš„çŸ­æœŸè®°å¿†

![](img/8df96a52bf85ed9c299e153cc52eae75.png)

ç…§ç‰‡ç”±[æœºæ¢°å¿ƒçµ](https://unsplash.com/@mechmind)åœ¨ [Unsplash](https://unsplash.com/) ä¸Šæ‹æ‘„

> è¿™æ˜¯[](/solidity-tutorial-all-about-data-locations-dabd33212471)**å­ç³»åˆ—çš„ç¬¬äºŒéƒ¨åˆ†ã€‚**

*æˆ‘ä»¬å°†å­¦ä¹  EVM å†…å­˜çš„å¸ƒå±€ã€å®ƒçš„ä¿ç•™ç©ºé—´ã€ç©ºé—²å†…å­˜æŒ‡é’ˆã€å¦‚ä½•ä½¿ç”¨`memory`å¼•ç”¨æ¥è¯»å†™å†…å­˜ä»¥åŠä½¿ç”¨å†…å­˜æ—¶çš„ä¼ ç»Ÿæœ€ä½³å®è·µã€‚*

*æˆ‘ä»¬å°†ä½¿ç”¨æ¥è‡ª[ä»¥å¤ªåŠåç§°æœåŠ¡(ENS)](https://docs.ens.domains/) çš„åˆåŒä»£ç ç‰‡æ®µï¼Œç”¨æœ‰æ„ä¹‰çš„ä¾‹å­æ¥æ”¯æŒè¿™ç¯‡æ–‡ç« ã€‚è¿™å°†å¸®åŠ©æˆ‘ä»¬æ›´å¥½åœ°ç†è§£è¿™ä¸ªå—æ¬¢è¿çš„é¡¹ç›®èƒŒåçš„æ™ºèƒ½åˆåŒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚*

# *ç›®å½•*

*   *ä»‹ç»*
*   *EVM è®°å¿†â€”â€”æ¦‚è¿°*
*   *å†…å­˜å¸ƒå±€*
*   *è®°å¿†åŸºç¡€*
*   *ä»å†…å­˜ä¸­è¯»å–(`MLOAD`)*
*   *å†™å…¥å†…å­˜(`MSTORE` + `MSTORE8`)*
*   *çŸ¥é“å†…å­˜å¤§å°(`MSIZE`)*
*   *ç©ºé—²å†…å­˜æŒ‡é’ˆ*
*   *`memory`ä½œä¸ºå‡½æ•°å‚æ•°çš„å‚è€ƒ*
*   *`memory`å‡½æ•°ä½“å†…éƒ¨çš„å¼•ç”¨*
*   *å†…å­˜æ‰©å±•æˆæœ¬*
*   *åˆçº¦è°ƒç”¨ä¹‹é—´çš„å†…å­˜*
*   *ç»“è®º*

# *ä»‹ç»*

*åœ¨ä»‹ç»æ€§æ–‡ç« *â€œå…³äºæ•°æ®ä½ç½®çš„ä¸€åˆ‡â€ï¼Œ*ä¸­ï¼Œæˆ‘å°† EVM æè¿°ä¸ºä¸€ä¸ªå·¥ä¸šå·¥å‚ã€‚åœ¨å·¥å‚çš„æŸäº›åœ°æ–¹ï¼Œä½ ä¼šå‘ç°ç”±æ“ä½œå‘˜æ§åˆ¶çš„æœºå™¨å’Œæœºå™¨äººã€‚*

*è¿™äº›æœºå™¨å°†æ— æ³•åŠ å·¥çš„å¤§å—é’¢/é“(ä¾‹å¦‚ï¼Œç©¿è¿‡ç‚‰é—¨)åˆ†è§£æˆå°å—ã€‚*

*æˆ‘ä»¬å¯ä»¥ç”¨åŒæ ·çš„ä¾‹å­æ¥è¯´æ˜ä»¥å¤ªåŠã€‚EVM ä½œä¸º 32 å­—èŠ‚å­—çš„å †æ ˆæœºå™¨è¿è¡Œã€‚å½“ EVM é‡åˆ°å¤§äº 32 å­—èŠ‚çš„æ•°æ®(å¤æ‚ç±»å‹ï¼Œå¦‚`string`ã€`bytes`ã€`struct`æˆ–æ•°ç»„)æ—¶ï¼Œå®ƒä¸èƒ½åœ¨å †æ ˆä¸Šå¤„ç†å®ƒä»¬ï¼Œå› ä¸ºè¿™äº›é¡¹å¤ªå¤§äº†ã€‚*

*å› æ­¤ï¼ŒEVM éœ€è¦è·å–è¿™äº›æ•°æ®ï¼Œå¹¶åœ¨å…¶ä»–åœ°æ–¹è¿›è¡Œå¤„ç†ã€‚å®ƒæœ‰ä¸€ä¸ªä¸“é—¨çš„åœ°æ–¹:è®°å¿†ã€‚é€šè¿‡å°†è¿™æ ·çš„å˜é‡æ”¾å…¥å†…å­˜ï¼ŒEVM å¯ä»¥å°†å®ƒä»¬ä»¥æ›´å°çš„å—ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°ä¼ é€’ç»™å †æ ˆã€‚*

*EVM å­˜å‚¨å™¨è¿˜ç”¨äºå¤æ‚çš„å†…ç½®è¿ç®—ï¼Œå¦‚ abi ç¼–ç ã€abi è§£ç æˆ–é€šè¿‡ keccak256 çš„æ•£åˆ—å‡½æ•°ã€‚å¯¹äºè¿™äº›ç‰¹å®šæƒ…å†µï¼Œæƒ³è±¡ä¸€ä¸‹å†…å­˜å……å½“ EVM çš„ä¾¿ç¬ºç°¿æˆ–ç™½æ¿ã€‚*

*è€å¸ˆæˆ–ç§‘å­¦å®¶å¯èƒ½ä¼šç”¨ç™½æ¿åœ¨ä¸Šé¢å†™ä¸œè¥¿æ¥è§£å†³é—®é¢˜ã€‚è¿™åŒæ ·é€‚ç”¨äº EVMã€‚EVM å°†å†…å­˜ç”¨ä½œæš‚å­˜åŒºæ¥æ‰§è¡Œè¿™äº›æ“ä½œæˆ–è®¡ç®—ï¼Œå¹¶è¿”å›æœ€ç»ˆå€¼ã€‚*

*![](img/aef2ec465f502d7be0119296805026dd.png)*

*æ¥æº:[https://giphy.com/explore/physics-lecture](https://giphy.com/explore/physics-lecture)*

*å¯¹äº`abi.decode(...)`æˆ–`keccak256`ï¼Œå­˜å‚¨å™¨æ˜¯è¾“å…¥æºã€‚å¯¹äº`abi.encode(...)`æ¥è¯´ï¼Œå­˜å‚¨å™¨æ˜¯è¾“å‡ºå°†è¢«å­˜å‚¨çš„åœ°æ–¹ã€‚*

# *EVM è®°å¿†â€”â€”æ¦‚è¿°*

*EVM è®°å¿†æœ‰ 4 ä¸ªä¸»è¦ç‰¹å¾:*

*   *å°±æ±½æ²¹è€Œè¨€æ›´ä¾¿å®œ*
*   *å¯å˜= **å¯ä»¥è¢«è¦†ç›–å’Œæ›´æ”¹***
*   *ç›¸å¯¹äºæ¥è‡ªå‡½æ•°è°ƒç”¨çš„äº‹åŠ¡= **ï¼Œæˆ–æ„é€ å‡½æ•°** ( **=** åˆåŒåˆ›å»º)*
*   *çŸ­æœŸ **=ä¸æŒä¹…**å’Œ**åœ¨å¤–éƒ¨å‡½æ•°è°ƒç”¨ä¹‹é—´è¢«æ“¦é™¤ã€‚***

*EVM å­˜å‚¨å™¨æ˜¯ä¸€ä¸ªå­—èŠ‚å¯å¯»å€ç©ºé—´**ã€‚**é‡Œé¢æ‰€æœ‰çš„å­—èŠ‚æœ€åˆéƒ½æ˜¯ç©ºçš„(å®šä¹‰ä¸ºé›¶)ã€‚å®ƒæ˜¯ä¸€ä¸ªå¯å˜çš„æ•°æ®åŒºï¼Œæ„å‘³ç€ä½ å¯ä»¥è¯»å†™å®ƒã€‚å’Œ calldata ä¸€æ ·ï¼Œå†…å­˜ä¹Ÿæ˜¯é€šè¿‡å­—èŠ‚ç´¢å¼•æ¥å¯»å€çš„ï¼Œä½†æ˜¯æˆ‘ä»¬ä¼šåœ¨*â€œä¸å†…å­˜äº¤äº’â€*ä¸€èŠ‚ä¸­çœ‹åˆ°ï¼Œåœ¨å†…å­˜ä¸­ä¸€æ¬¡åªèƒ½è¯»å– 32 å­—èŠ‚çš„å­—ã€‚*

*EVM è®°å¿†ä¹Ÿæ˜¯ä¸ç¨³å®šçš„ã€‚å­˜å‚¨åœ¨å†…å­˜ä¸­çš„å€¼ä¸ä¼šåœ¨å¤–éƒ¨è°ƒç”¨ä¹‹é—´ä¿æŒä¸å˜ã€‚*

> *ä¸€ä¸ª ***åˆšè¢«* *æ¸…é™¤ï¼Œå½“ä¸€ä¸ªå¥‘çº¦è°ƒç”¨å¦ä¸€ä¸ªå¥‘çº¦æ—¶ï¼Œè·å¾—æ–°çš„å†…å­˜å®ä¾‹*** *ã€‚**

*å­˜å‚¨å™¨ä¸ä¼šè¢«æ“¦é™¤å’Œæ¸…é™¤ã€‚EVM å†…å­˜çš„æ¯ä¸ªæ–°å®ä¾‹éƒ½ç‰¹å®šäºä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡ï¼Œå³å½“å‰å¥‘çº¦æ‰§è¡Œã€‚*

*å› æ­¤ï¼Œæ‚¨åº”è¯¥è®°ä½ï¼ŒEVM å†…å­˜æ˜¯ç‰¹å®šäº 1)æ¶ˆæ¯è°ƒç”¨å’Œ 2)è¢«è°ƒç”¨çš„å¥‘çº¦çš„æ‰§è¡Œç¯å¢ƒçš„ã€‚ç¨åï¼Œæˆ‘ä»¬å°†åœ¨å•ç‹¬çš„ç« èŠ‚ä¸­æ›´è¯¦ç»†åœ°è§£é‡Šè¿™ä¸ªæ¦‚å¿µã€‚*

# *å†…å­˜å¸ƒå±€*

> *å­˜å‚¨å™¨æ˜¯çº¿æ€§çš„ï¼Œå¯ä»¥åœ¨å­—èŠ‚çº§å¯»å€ã€‚*

*æŠŠå†…å­˜æƒ³è±¡æˆä¸€ä¸ªéå¸¸å¤§(ç”šè‡³**å·¨å¤§ï¼**)å­—èŠ‚æ•°ç»„ï¼Œåƒ`byte[]`*

*![](img/415c4d1cc8758f9df6865602e68360b1.png)*

*å½“ä½ ä¸ EVM å†…å­˜äº¤äº’æ—¶ï¼Œä½ è¯»å–æˆ–å†™å…¥(æˆ‘ç§°ä¹‹ä¸º)*32 å­—èŠ‚é•¿çš„â€œå†…å­˜å—â€ã€‚**

**![](img/84acd8745b521bbcea1b3e2fc10859f6.png)**

## **ä¿ç•™ç©ºé—´**

**å­˜å‚¨å™¨ä¸­çš„å‰ 4 x 32 å­—èŠ‚å­—æ˜¯å‡ºäºä¸åŒç›®çš„è€Œä¿ç•™çš„ç©ºé—´:**

*   **å‰ 2 ä¸ªå­—(**åç§»é‡** `0x00`å’Œ`0x20`):æ•£åˆ—å‡½æ•°çš„æš‚å­˜ç©ºé—´**
*   ****åç§»é‡** `0x40`å’Œ`0x50`:ç¬¬ 3 ä¸ªå­—:**ç©ºé—²å†…å­˜æŒ‡é’ˆ****
*   ****åç§»é‡** `0x60`:æ°¸ä¹…ä¸ºé›¶ï¼Œç”¨ä½œç©ºåŠ¨æ€å†…å­˜æ•°ç»„çš„åˆå§‹å€¼**

**![](img/cb59ec8b81843fc729703aedada1e4ab.png)**

**ç©ºé—²å†…å­˜æŒ‡é’ˆ(ä½äºåç§»é‡ 0x40)æ˜¯*EVM å†…å­˜ä¸­æœ€é‡è¦çš„éƒ¨åˆ†ã€‚å¿…é¡»å°å¿ƒå¤„ç†ï¼Œå°¤å…¶æ˜¯åœ¨ç»„è£…/Yul æ—¶ã€‚æˆ‘ä»¬å°†åœ¨å•ç‹¬çš„ç« èŠ‚ä¸­ä»‹ç»å®ƒã€‚***

> **æ›´å¤šä¿¡æ¯å‚è§ Solidity æ–‡æ¡£ä¸­çš„[](https://docs.soliditylang.org/en/v0.8.13/internals/layout_in_memory.html)***ç« èŠ‚ã€‚*****

## *****æœ€å¤§å†…å­˜é™åˆ¶*****

*****æˆ‘ä»¬çœ‹åˆ°ï¼ŒEVM å­˜å‚¨å™¨æ˜¯ä¸€ä¸ªçº¿æ€§é˜µåˆ—ï¼Œå¯é€šè¿‡å­—èŠ‚ç´¢å¼•(ç§°ä¸ºåç§»é‡)å¯»å€ã€‚å®ƒæœ€å¤šå¯ä»¥åŒ…å«å¤šå°‘å­—èŠ‚ï¼Ÿ*****

> *****è¿™ä¸ªæ•°ç»„æœ‰å¤šå¤§ï¼ŸEVM è®°å¿†æœ‰å¤šå¤§ï¼Ÿ*****

*****è¿™ä¸ªé—®é¢˜çš„ç­”æ¡ˆå°±åœ¨ geth æºä»£ç é‡Œ(ä¸‹é¢æˆªå›¾)ã€‚çœ‹ä¸€ä¸‹ä½¿ç”¨çš„è½¬æ¢ç±»å‹ã€‚*****

*****![](img/fee52671e08bb5db087adcc56d5984c4.png)*****

*****[source:instructions . go(geth å®¢æˆ·ç«¯æºä»£ç )ã€‚](https://github.com/ethereum/go-ethereum/blob/master/core/vm/instructions.go#L506)*****

*****ä» geth å®¢æˆ·ç«¯çš„æˆªå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œ`mStart.Uint64()`å°†å†…å­˜åç§»é‡è½¬æ¢ä¸ºä¸€ä¸ª`uint64`å€¼ã€‚è¿™æ„å‘³ç€æ‚¨å¯ä»¥æ”¾å…¥å†…å­˜çš„æœ€å¤§æ•°æ®é‡æ˜¯ä¸€ä¸ª`uint64`æ•°çš„æœ€å¤§å€¼ã€‚*****

*****å¦‚æœæŒ‡å®šçš„åç§»é‡å¤§äºè¯¥å€¼ï¼Œå®ƒå°†æ¢å¤åŸçŠ¶ã€‚*****

# *****è®°å¿†åŸºç¡€*****

*****æ‚¨åªèƒ½åœ¨å†…éƒ¨å‡½æ•°ä¸­æŒ‡å®š`memory`,è€Œä¸èƒ½åœ¨å¥‘çº¦çº§åˆ«æŒ‡å®šå¤–éƒ¨å‡½æ•°ã€‚*****

*****é»˜è®¤æƒ…å†µä¸‹ï¼Œä»¥ä¸‹æ•°æ®å’Œå€¼å§‹ç»ˆä½äºå†…å­˜ä¸­:*****

*   *****å¤æ‚ç±»å‹çš„å‡½æ•°å‚æ•°ã€‚*****
*   *****å¤æ‚ç±»å‹çš„å±€éƒ¨å˜é‡(åœ¨å‡½æ•°ä½“å†…)ã€‚*****
*   *****ä»å‡½æ•°è¿”å›çš„å€¼ï¼Œä¸ç®¡å®ƒä»¬æ˜¯ä»€ä¹ˆç±»å‹(è¿™æ˜¯é€šè¿‡ **return** æ“ä½œç å®Œæˆçš„)ã€‚*****
*   *****å‡½æ•°è¿”å›çš„ä»»ä½•å¤æ‚å€¼ç±»å‹éƒ½å¿…é¡»æŒ‡å®šå…³é”®å­—`memory`*****

*****å¯¹äºå¤æ‚ç±»å‹çš„å˜é‡/å€¼ï¼Œæˆ‘ä»¬æŒ‡çš„æ˜¯`struct`ã€æ•°ç»„ã€`bytes`å’Œ`strings`ç­‰å˜é‡ã€‚*****

*****ä¸€æ—¦å‡½æ•°è°ƒç”¨ç»“æŸï¼Œè¿™äº›ç”¨å…³é”®å­—`memory`å®šä¹‰çš„å˜é‡å°±ä¼šæ¶ˆå¤±ã€‚è¿™å°±æ˜¯æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„â€œä¸åšæŒâ€ã€‚*****

*****åŸå› æ˜¯`memory`å‘Šè¯‰ Solidity åœ¨è¿è¡Œæ—¶ä¸ºå˜é‡åˆ›å»ºä¸€å—ç©ºé—´ï¼Œä¿è¯å®ƒçš„å¤§å°å’Œç»“æ„ï¼Œä»¥ä¾¿åœ¨å‡½æ•°æ‰§è¡ŒæœŸé—´åœ¨è¯¥å‡½æ•°ä¸­ä½¿ç”¨ã€‚*****

## *****ä¸å†…å­˜äº¤äº’â€”æ¦‚è¿°*****

*****åœ¨ EVM çš„è®°å¿†ä¸­,â€œå¯é æ€§æ–‡ä»¶â€æŒ‡å‡º:*****

> *****â€¦è¯»å–é™äº 256 ä½å®½ï¼Œè€Œå†™å…¥å¯ä»¥æ˜¯ 8 ä½å®½æˆ– 256 ä½å®½ã€‚*****

*****å¦‚æœæˆ‘ä»¬çœ‹çœ‹é»„çš®ä¹¦ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸€ä¸ªæ“ä½œç è¢«å®šä¹‰ä¸ºä»å†…å­˜ä¸­è¯»å–(`MLOAD`)ï¼Œä¸¤ä¸ªæ“ä½œç è¢«å®šä¹‰ä¸ºå†™å…¥å†…å­˜:`MSTORE`å’Œ`MSTORE8`ã€‚*****

*****![](img/95f512bef55ae0bbc5e906280caf2d70.png)*****

*****èµ„æ–™æ¥æº: [Ethreum é»„çš®ä¹¦ï¼Œç¬¬ 34 é¡µ](https://ethereum.github.io/yellowpaper/paper.pdf)*****

# *****å‡­è®°å¿†é˜…è¯»*****

*****æ‚¨å¯ä»¥ä½¿ç”¨`MLOAD`æ“ä½œç ä»å†…å­˜ä¸­è¯»å–ã€‚*****

## *******é»„çº¸é…æ–¹*******

*****ä»¥ä¸‹æ˜¯é»„çš®ä¹¦å¯¹`MLOAD`æ“ä½œç è§„èŒƒçš„æè¿°ã€‚*****

*****![](img/60b24acaf4065e4c3a19728dd0513d57.png)*****

*****è®©æˆ‘ä»¬æ­å¼€è¿™ä¸ªéå¸¸æ­£å¼çš„å…¬å¼çš„ç¥ç§˜é¢çº±ï¼*****

*****é»„çš®ä¹¦ä¸­çš„å…¬å¼å¯ä»¥è§£é‡Šå¦‚ä¸‹:*****

*   *****`Us[0]` =æ ˆé¡¶é¡¹ç›®ã€‚*****
*   *****`Us'[0]` =æ”¾åœ¨å †æ ˆé¡¶éƒ¨çš„ç»“æœé¡¹ç›®ã€‚*****
*   *****`Um` =å­˜å‚¨å™¨ä¸­ä»ç‰¹å®šåç§»é‡å¼€å§‹çš„å†…å®¹ã€‚*****

*****å…¬å¼`Um[Us[0]...Us[0] + 31]]`å¯ä»¥ç”¨ç®€å•çš„è‹±è¯­ç¿»è¯‘å¦‚ä¸‹:*****

1.  ******å–æ ˆé¡¶æœ€åä¸€ä¸ªé¡¹ç›®* `*Us[0]*` *ã€‚******
2.  ******ä½¿ç”¨è¯¥å€¼ä½œä¸ºèµ·å§‹æŒ‡é’ˆè¯»å…¥å†…å­˜* `*Um*` *(= offset)******
3.  ******ä»è¯¥å†…å­˜æŒ‡é’ˆ* `*Us[0]*` *ä¸­è¯»å–æ¥ä¸‹æ¥çš„ 31 ä¸ªå­—èŠ‚(* `*Us[0] + 31*` *)ã€‚******

*****ä»å†…å­˜ä¸­è¯»å–ä¸€æ¬¡åªèƒ½è¯»å– 32 å­—èŠ‚çš„å­—ã€‚è¿™æ„å‘³ç€ç”¨`mload`æ“ä½œç ä¸€æ¬¡åªèƒ½ä»å†…å­˜ä¸­å–å‡º 32 ä¸ªå­—èŠ‚ã€‚*****

*****è¿™äº›æ“ä½œç å¯ç”¨äº Solidity å†…åµŒæ±‡ç¼–æˆ–ç‹¬ç«‹çš„ Yul ä»£ç ã€‚*****

## *****ä¾‹å¦‚:ENS åˆåŒä¸­çš„ SHA1 å›¾ä¹¦é¦†*****

*****![](img/51775e30c8cb14b9ae2eddfd69f1d8d5.png)*****

*****å›¾ç‰‡æ¥æº:[ens-domains.com](https://ens.domains/static/twitter-49d4bb2b55c07c5f5900e95860401fd0.png)*****

*****è®©æˆ‘ä»¬æ¥çœ‹çœ‹ ENS åˆåŒä¸­çš„ä¸€ä¸ªä¾‹å­:SHA1.sol ã€‚*****

*****åœ¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œ`mload`æ“ä½œç è¢«ä½¿ç”¨äº†ä¸¤æ¬¡ã€‚*****

*   *****é¦–å…ˆæ£€ç´¢**ç©ºé—²å†…å­˜æŒ‡é’ˆã€‚**æš‚å­˜å˜é‡éšåè¢«ç”¨ä½œå†…å­˜ä¸­çš„æŒ‡é’ˆï¼Œæ•°æ®çš„ sha1 æ•£åˆ—å°†è¢«è®¡ç®—å’Œå†™å…¥ã€‚*****
*   *****ç¬¬äºŒæ¬¡æ£€ç´¢æ•°æ®å˜é‡çš„é•¿åº¦(=å­—èŠ‚æ•°)ã€‚*****

*****![](img/b5d1b7427b8a6adb60eb2ad63b888ec2.png)*****

*****[æ¥æº:Github ä¸Šçš„ ENS æºä»£ç ï¼ŒSHA1.sol åº“](https://github.com/ensdomains/ens-contracts/blob/8a2423829a28852297ee208357d148987e8dce0f/contracts/dnssec-oracle/SHA1.sol)*****

# *****å†™å…¥å†…å­˜*****

*****æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹ä¸¤ç§æ“ä½œç ä¹‹ä¸€å†™å…¥å­˜å‚¨å™¨:*****

*   *****`MSTORE` â†’åœ¨å†…å­˜ä¸­å†™ä¸€ä¸ªå­—(= 32 å­—èŠ‚)ã€‚*****
*   *****`MSTORE8` â†’åœ¨å­˜å‚¨å™¨ä¸­å†™å…¥ä¸€ä¸ªå­—èŠ‚*****

*****è¿™æ¡æ¨æ–‡å±•ç¤ºäº† geth å®¢æˆ·ç«¯ä¸­çš„ EVM å®ä¾‹å¦‚ä½•å°†å‚æ•°ä»å †æ ˆä¸­å–å‡ºä½œä¸º`MSTORE`çš„è¾“å…¥ã€‚*****

*****![](img/3d3093b5074b07f8dd39bb28e5f1dcec.png)*****

*****[æ¥æº:æ³•å¸Œå°”åœ¨æ¨ç‰¹ä¸Š](https://twitter.com/721Orbit/status/1511961771879370753?s=20&t=KDGCQ4OwQ47e2NACgQ8WWg)*****

*******åšå›ºæ€§*******

*****åœ¨ Solidity ä¸­ï¼Œæ¯å½“ä½ ç”¨`memory`å…³é”®å­—å®ä¾‹åŒ–ä¸€ä¸ªå˜é‡å¹¶èµ‹å€¼(ä¸€ä¸ªæ–‡å­—å­—èŠ‚/å­—ç¬¦ä¸²ï¼Œæˆ–è€…ä¸€ä¸ªå‡½æ•°çš„è¿”å›å€¼)æ—¶ï¼ŒEVM å°±ä¼šæ‰§è¡Œä¸€ä¸ª`mstore`æŒ‡ä»¤ã€‚*****

*****è¿™é‡Œæœ‰ä¸€ä¸ªæ¥è‡ª ENS çš„`DNSRegistar.sol`åˆåŒçš„ä¾‹å­ã€‚*****

*****![](img/ad1b9e6a8a434dec298e91f46e4e861a.png)*****

*****[æ¥æº:Github ä¸Šçš„ ENS æºä»£ç ï¼ŒDNSRegistar.sol](https://github.com/ensdomains/ens-contracts/blob/3445b94a187cac1016ec6e3fb69b885227565d8e/contracts/dnsregistrar/DNSRegistrar.sol#L175-L178)*****

*******ç»„è£…ä¸­*******

*****`mstore`æ“ä½œç å¯ä»¥åœ¨å†…åµŒæ±‡ç¼–ä¸­ä½¿ç”¨ã€‚å®ƒæ¥å—ä¸¤ä¸ªå‚æ•°:*****

*   *****è¦å†™å…¥çš„å†…å­˜åç§»é‡ã€‚*****
*   *****è¦å†™å…¥å†…å­˜çš„æ•°æ®*****

*****æŸ¥çœ‹`mstore`å¦‚ä½•åœ¨åŒä¸€ä¸ª ENS åˆåŒ`SHA1.sol.`ä¸­ç”¨äºè£…é…*****

*****![](img/754a429aff31dccbc612198f031d0ab4.png)*****

*****[æ¥æº:Github ä¸Šçš„ ENS æºä»£ç ï¼ŒSHA1.sol åº“ã€‚](https://github.com/ensdomains/ens-contracts/blob/8a2423829a28852297ee208357d148987e8dce0f/contracts/dnssec-oracle/SHA1.sol#L41-L56)*****

# *****çŸ¥é“å†…å­˜å¤§å°*****

> *****æœ‰å…³`MSIZE`æ“ä½œç çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·å‚è§ [evm.codes](https://www.evm.codes/) ä¸­çš„æ“ä½œç è¯´æ˜*****

*****ä¹ä¸€çœ‹ï¼ŒEVM æ“ä½œç `MSIZE`é¡¾åæ€ä¹‰ï¼Œå®ƒå°†è¿”å›å†…å­˜ä¸­å­˜å‚¨äº†å¤šå°‘æ•°æ®ã€‚æˆ–è€…æ¢å¥è¯è¯´ï¼Œå½“å‰æœ‰å¤šå°‘å­—èŠ‚è¢«å†™å…¥å­˜å‚¨å™¨ã€‚*****

*****`MSIZE`æ“ä½œç æœ‰ç‚¹å¤æ‚ã€‚Solidity ç¼–è¯‘å™¨çš„ C++æºä»£ç æä¾›äº†æ›´å¤šçš„ä¿¡æ¯æ¥ç†è§£å®ƒã€‚è§ä¸‹æ–‡ã€‚*****

*****![](img/11de316591daca90c2045969a909d067.png)*****

*****æ¥æº:Solidity Github ä»“åº“ä¸Šçš„ SemanticInformation.cpp*****

*****`MSIZE`æ“ä½œç è¿”å›å½“å‰æ‰§è¡Œç¯å¢ƒä¸­åœ¨å†…å­˜ä¸­è®¿é—®çš„æœ€é«˜å­—èŠ‚åç§»é‡ã€‚å¤§å°å°†å§‹ç»ˆæ˜¯å­—çš„å€æ•°(32 å­—èŠ‚)ã€‚*****

*****ä½†æ˜¯åœ¨åšå›ºæ€§ä¸Šï¼Œ*â€œå†…å­˜ä¸­å­˜å‚¨å¤šå°‘å­—èŠ‚â€*å’Œ*â€œå†…å­˜ä¸­è®¿é—®çš„æœ€å¤§ç´¢å¼•/åç§»é‡â€æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ******

*****æˆ‘ä»¬å°†ç”¨ä¸€ä¸ªä½¿ç”¨ Solidity æœ¬èº«çš„å®é™…ä¾‹å­æ¥è¯´æ˜ï¼è¯·çœ‹ä¸‹é¢çš„ä»£ç ç‰‡æ®µã€‚*****

*****è¿™é‡Œå‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼Ÿ*****

*******ç¬¬ä¸€æ­¥:** `freeMemBefore`é¦–å…ˆè¿”å›ç©ºé—²å†…å­˜æŒ‡é’ˆ:`0x80 (= 128)`*****

*******ç¬¬äºŒæ­¥:**ç„¶åæˆ‘ä»¬å°†`data`å†™å…¥å†…å­˜(64 å­—èŠ‚)ã€‚ç©ºé—²å†…å­˜æŒ‡é’ˆå¾—åˆ°æ›´æ–°ã€‚(`freeMemAfter`)å˜æˆ`0xc0 (= 192)`ã€‚*****

> *******æ³¨æ„:**åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç©ºé—²å†…å­˜æŒ‡é’ˆè‡ªåŠ¨æ›´æ–°åªæ˜¯å› ä¸ºæˆ‘ä»¬åœ¨æ±‡ç¼–å—ä¹‹å¤–ã€‚å¦‚æœæ‚¨é€šè¿‡`mstore`æˆ–ç±»ä¼¼çš„æ“ä½œç (å¦‚`calldatacopy`)å†™å…¥æ±‡ç¼–ä¸­çš„å†…å­˜ï¼Œç©ºé—²å†…å­˜æŒ‡é’ˆä¸ä¼šè‡ªåŠ¨æ›´æ–°ã€‚ä½ æœ‰è´£ä»»è‡ªå·±æ‰‹åŠ¨å®Œæˆã€‚*****
> 
> *****è¯·è®°ä½ Solidity æ–‡æ¡£ä¸­æåˆ°çš„è§„åˆ™:â€œå†…è”æ±‡ç¼–å¯èƒ½æœ‰ä¸€ä¸ªéå¸¸é«˜çº§çš„å¤–è§‚ï¼Œä½†å®ƒæ˜¯éå¸¸ä½çº§çš„â€ã€‚*****

*****æ­¤æ—¶ï¼Œä»æŠ€æœ¯ä¸Šè®²ï¼Œå†…å­˜ä¸­æ€»å…±åˆ†é…äº† 192 ä¸ªå­—èŠ‚ã€‚*****

```
 *****32 bytes 
x 4             (the first 4 reserved spaces in memory)
---------------------
= 128 
+ 64 bytes      (the variable `data`)  
---------------------  
= 192           (total)*****
```

*****ç°åœ¨æ³¨æ„ç¬¬ 28 è¡Œã€‚æˆ‘ä»¬è¯•ç€ä»åç§»é‡`0x0c (192)`è¯»å…¥å†…å­˜*****

*******ç¬¬ä¸‰æ­¥:**å½“æˆ‘ä»¬åš`msize`(ç¬¬ 31 è¡Œ)æ—¶ï¼Œæˆ‘ä»¬è·å¾—äº†æ•°å­—`224 (= 0xe0)`ã€‚åˆšåˆšå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿæ€»å…±åªæœ‰ 192 å­—èŠ‚å­˜å‚¨/åˆ†é…åœ¨å†…å­˜ä¸­ã€‚è¿™ 224 ä»ä½•è€Œæ¥ï¼Ÿ*****

*****`224 = 192 + 32`ã€‚æ‰€ä»¥`msize`è¿”å›çš„å€¼å°±æ˜¯å†…å­˜ä¸­å­˜å‚¨çš„æ€»å­—èŠ‚æ•°(`192` ) + 32ã€‚æˆ‘ä»¬åˆšåˆšè§¦å‘å¹¶è§è¯äº†ä¸€åœºè®°å¿†è†¨èƒ€ã€‚å†…å­˜æ€»æ˜¯ä¸€æ¬¡æ‰©å±• 32 å­—èŠ‚å­—ã€‚*****

*****å¯¹äº`msize`æ“ä½œç ï¼Œæ²¡æœ‰æ¯”æ¥è‡ª [evm.codes](https://www.evm.codes/) çš„è§£é‡Šæ›´å¥½çš„äº†ã€‚*****

> *****msize tracks æ˜¯å½“å‰æ‰§è¡Œä¸­è®¿é—®è¿‡çš„æœ€é«˜åç§»é‡ã€‚å¯¹æ›´å¤§åç§»é‡çš„é¦–æ¬¡å†™å…¥æˆ–è¯»å–å°†è§¦å‘[å­˜å‚¨å™¨æ‰©å±•](https://www.evm.codes/about)*****

# *****ç©ºé—²å†…å­˜æŒ‡é’ˆ*****

*****åœ¨ä»–ä»¬çš„çƒ­é—¨æ–‡ç« ç³»åˆ—â€œè§£æ„æ™ºèƒ½åˆçº¦â€ä¸­ï¼ŒOpenZeppelin æ­ç¤ºäº†æ¯ä¸ªæ™ºèƒ½åˆçº¦çš„å‰ 5 ä¸ªå­—èŠ‚èƒŒåçš„æ“ä½œç çš„å«ä¹‰ã€‚*****

```
*****0x6080604052...*****
```

*****![](img/be8d3bf2cab2afdc789cd612072de45a.png)*****

*****[èµ„æ–™æ¥æº:OpenZeppelinï¼Œè§£æ„æ™ºèƒ½åˆåŒ(ç¬¬ä¸€éƒ¨åˆ†)](https://blog.openzeppelin.com/deconstructing-a-solidity-contract-part-ii-creation-vs-runtime-6b9d60ecb44c/)*****

*****åœ¨ä¸€ä¸ª nutschell ä¸­ï¼Œè¿™ä¸ªæ“ä½œç åºåˆ—å°†æ•°å­—`0x80`(åè¿›åˆ¶ 128)å­˜å‚¨åˆ°å†…å­˜çš„ä½ç½®`0x40`(åè¿›åˆ¶ 64)ã€‚ä¸ºä»€ä¹ˆ*****

*****å¦‚å‰ä¸€èŠ‚*â€œå­˜å‚¨å™¨å¸ƒå±€â€*æ‰€è¿°ï¼Œå­˜å‚¨å™¨ä¸­çš„å‰ 4 ä¸ªå­—æ˜¯ä¸ºç‰¹å®šç›®çš„è€Œä¿ç•™çš„ã€‚ç¬¬ä¸‰ä¸ªå­—â€”â€”ä½äºå†…å­˜ä¸­çš„ä½ç½®`0x40`â€”â€”è¢«ç§°ä¸º**è‡ªç”±å†…å­˜æŒ‡é’ˆã€‚*******

*****Open Zeppelin å°†è‡ªç”±å†…å­˜æŒ‡é’ˆæè¿°ä¸º*â€œå¯¹å†…å­˜ä¸­ç¬¬ä¸€ä¸ªæœªä½¿ç”¨çš„å­—çš„å¼•ç”¨â€*ã€‚å®ƒèƒ½å¤ŸçŸ¥é“å†…å­˜ä¸­çš„å“ªä¸ªä½ç½®(åœ¨å“ªä¸ªåç§»é‡)æœ‰ç©ºé—²ç©ºé—´å¯ä»¥å†™å…¥æ•°æ®ã€‚è¿™æ˜¯ä¸ºäº†é¿å…è¦†ç›–å†…å­˜ä¸­å·²ç»å­˜åœ¨çš„æ•°æ®ã€‚*****

*****ç©ºé—²å†…å­˜æŒ‡é’ˆæ˜¯ EVM æœ€é‡è¦å’Œæœ€å…³é”®çš„ä¸œè¥¿ä¹‹ä¸€ã€‚*****

## *****Solidity ä¸­çš„ç©ºé—²å†…å­˜æŒ‡é’ˆ*****

*****åœ¨ Solidity ä¸­ï¼Œåš`bytes memory myVariable`è¿™æ ·çš„ä»£ç ç‰‡æ®µæ—¶ä¼šè‡ªåŠ¨å–+æ›´æ–°ç©ºé—²å†…å­˜æŒ‡é’ˆã€‚*****

*****è®©æˆ‘ä»¬çœ‹ä¸€ä¸ªä¾‹å­ã€‚å¯¹äºåšå›ºæ€§ä»£ç :*****

*****![](img/680de5c858a9a1cdd80c82de7f347496.png)*****

*****è¿™äº›æ˜¯ç”± Solidity ç¼–è¯‘å™¨ç”Ÿæˆçš„æ“ä½œç ã€‚æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ˜¯å¦‚ä½•è·å–å’Œæ›´æ–°ç©ºé—²å†…å­˜æŒ‡é’ˆï¼Œä»æŒ‡ä»¤`056`åˆ°æŒ‡ä»¤`065`ã€‚*****

*****![](img/57a3d8813c9544195bfecb31abf69d92.png)*****

*****å†™å­—ç¬¦ä¸²å­˜å‚¨å™¨çš„åŸºæœ¬æ“ä½œç åºåˆ—ã€‚*****

*****å½“ä¸€ä¸ªå­—ç¬¦ä¸²æˆ–ä¸€äº›æ•°æ®è¢«å†™å…¥ Solidity çš„å†…å­˜ä¸­æ—¶ï¼ŒEVM æ€»æ˜¯æ‰§è¡Œä»¥ä¸‹æœ€åˆçš„ä¸¤ä¸ªæ­¥éª¤:*****

*******ç¬¬ä¸€æ­¥:è·å–ç©ºé—²å†…å­˜æŒ‡é’ˆã€‚*******

*****EVM é¦–å…ˆä»å†…å­˜ä½ç½®`0x40`åŠ è½½ç©ºé—²å†…å­˜æŒ‡é’ˆã€‚`mload`è¿”å›çš„å€¼æ˜¯`0x80`ã€‚æˆ‘ä»¬çš„ç©ºé—²å†…å­˜æŒ‡é’ˆå‘Šè¯‰æˆ‘ä»¬ï¼Œå†…å­˜ä¸­ç¬¬ä¸€ä¸ªæœ‰ç©ºé—²ç©ºé—´å¯å†™çš„åœ°æ–¹æ˜¯åœ¨åç§»é‡`0x80`ã€‚è¿™æ˜¯æˆ‘ä»¬æ ˆé¡¶æœ€åçš„ä¸œè¥¿ã€‚*****

*****![](img/2163ac6edcfc7cea3b930e30a455777e.png)*****

*******ç¬¬äºŒæ­¥:åˆ†é…å†…å­˜+ç”¨æ–°çš„ç©ºé—²å†…å­˜æŒ‡é’ˆæ›´æ–°ã€‚*******

*****EVM ç°åœ¨å°†åœ¨å†…å­˜ä¸­ä¸º`string test`ä¿ç•™è¯¥ä½ç½®ã€‚å®ƒå°†ç©ºé—²å†…å­˜æŒ‡é’ˆè¿”å›çš„å€¼ä¿å­˜åœ¨æœ¬åœ°å †æ ˆä¸Šã€‚*****

*****ä½†æ˜¯ Solidity ç¼–è¯‘å™¨æ—¢èªæ˜åˆå®‰å…¨ï¼åœ¨åˆ†é…ä¹‹åï¼Œåœ¨å‘å†…å­˜ä¸­å†™å…¥ä»»ä½•å€¼ä¹‹å‰ï¼Œå®ƒæ€»æ˜¯æ›´æ–°ç©ºé—²å†…å­˜æŒ‡é’ˆã€‚è¿™æ˜¯æŒ‡å†…å­˜ä¸­ä¸‹ä¸€ä¸ªç©ºé—²ç©ºé—´ã€‚*****

*****æ ¹æ® ABI è§„èŒƒï¼Œ`string`ç”±ä¸¤éƒ¨åˆ†ç»„æˆ:é•¿åº¦+å­—ç¬¦ä¸²æœ¬èº«ã€‚ä¸‹ä¸€æ­¥æ˜¯æ›´æ–°ç©ºé—²å†…å­˜æŒ‡é’ˆã€‚EVM åœ¨è¿™é‡Œè¯´çš„æ˜¯*â€œæˆ‘è¦åœ¨å†…å­˜ä¸­å†™ 2Ã—32 å­—èŠ‚çš„å­—ã€‚å› æ­¤ï¼Œæ–°çš„ç©ºé—²å†…å­˜æŒ‡é’ˆå°†æ¯”å½“å‰æŒ‡é’ˆâ€œ*å¤š 64 ä¸ªå­—èŠ‚ã€‚*****

*****ä¸‹é¢çš„æ“ä½œç åšçš„äº‹æƒ…å¾ˆç®€å•ã€‚å®ƒ:*****

1.  *****å¤åˆ¶ç©ºé—²å†…å­˜æŒ‡é’ˆçš„å½“å‰å€¼= `0x80`*****
2.  *****ç»™å®ƒåŠ ä¸Š`0x40`*****
3.  *****å°†`0x40`(å†æ¬¡=ç©ºé—²å†…å­˜æŒ‡é’ˆçš„ä½ç½®)å‹å…¥å †æ ˆ*****
4.  *****é€šè¿‡`MSTORE`ç”¨æ–°å€¼æ›´æ–°ç©ºé—²å†…å­˜æŒ‡é’ˆ*****

*****![](img/154735b9f1fbab9386494b3bdb0bdee7.png)*****

## *****ç¨‹åºé›†ä¸­çš„ç©ºé—²å†…å­˜æŒ‡é’ˆ*****

*****åœ¨å†…è”æ±‡ç¼–ä¸­ï¼Œå¿…é¡»å°å¿ƒå¤„ç†ç©ºé—²å†…å­˜æŒ‡é’ˆï¼*****

*****ä¸ä»…è¦æ‰‹åŠ¨è·å–ï¼Œè¿˜è¦æ‰‹åŠ¨æ›´æ–°ï¼*****

*****å› æ­¤ï¼Œåœ¨æ±‡ç¼–ä¸­å¤„ç†å†…å­˜æ—¶å¿…é¡»å°å¿ƒã€‚å¦‚æœæ‚¨ä¸æƒ³æœ€ç»ˆè¦†ç›–å†…å­˜ä¸­å·²ç»æœ‰ä¸€äº›å†…å®¹çš„å†…å®¹ï¼Œé‚£ä¹ˆæ‚¨å¿…é¡»ç¡®ä¿æ€»æ˜¯é¦–å…ˆè·å–æ±‡ç¼–ä¸­çš„ç©ºé—²å†…å­˜ï¼Œå¹¶å†™å…¥ç©ºé—²å†…å­˜æŒ‡é’ˆæ‰€æŒ‡å‘çš„å†…å­˜ä½ç½®ã€‚*****

*****ä¸€æ—¦å†™å…¥å†…å­˜ï¼Œå¿…é¡»ç¡®ä¿ç”¨æ–°çš„ç©ºé—²å†…å­˜åç§»é‡æ›´æ–°ç©ºé—²å†…å­˜æŒ‡é’ˆã€‚*****

*****æ€»ä¹‹ï¼Œå½“è°ˆåˆ°ç©ºé—²å†…å­˜æŒ‡é’ˆæ—¶ï¼Œæ°¸è¿œè®°ä½ OpenZeppelin çš„å»ºè®®:*****

> ******â€œåœ¨æ±‡ç¼–çº§æ“ä½œå†…å­˜æ—¶ï¼Œå¿…é¡»éå¸¸å°å¿ƒã€‚å¦åˆ™ï¼Œæ‚¨å¯èƒ½ä¼šè¦†ç›–ä¿ç•™çš„ç©ºé—´ã€‚******

> *******æ³¨æ„:åœ¨æ£€æŸ¥ç©ºé—²å†…å­˜æŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ä½ç½®å®é™…å­˜å‚¨äº†ä»€ä¹ˆä¹‹å‰ï¼Œå…ˆå†™å…¥ç©ºé—²å†…å­˜æŒ‡é’ˆå¯èƒ½ä¸æ˜¯ä¸€ä¸ªå¥½çš„åšæ³•ã€‚*******

*******ç¤ºä¾‹:æ¥è‡ª**[æ¥æº:Github ä¸Šçš„ GBSPS/solidity-bytes-utilsï¼ŒBytesLib.sol](https://medium.com/u/3e5dfef854b6#L245-L247)*****

# *****ä½œä¸ºå‡½æ•°å‚æ•°çš„å†…å­˜å¼•ç”¨*****

*****æ¯æ¬¡åœ¨ Solidity ä¸­ï¼Œå½“æˆ‘ä»¬å¿…é¡»å°†ä¸€ä¸ªåŠ¨æ€æˆ–å¤æ‚ç±»å‹çš„å‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œæˆ‘ä»¬éƒ½ä¼šä½¿ç”¨è¿™ä¸ªè¯­å¥ã€‚*****

*****ä¾‹å¦‚ï¼Œåœ¨ ENS å¥‘çº¦ä¸­ï¼Œ`DNSRegistar.sol`çš„`claim(...)`å‡½æ•°æ¥å—ä¸¤ä¸ªå‚æ•°:a `name`å’Œ`proof`ï¼Œä¸¤è€…éƒ½æ˜¯`memory`å¼•ç”¨ã€‚*****

*****![](img/569b3cfd2e5eb6016465591a5faa95dd.png)*****

*****ä½†æ˜¯å¯¹äº EVM æ¥è¯´ï¼Œ`memory`å¼•ç”¨ä½œä¸ºå‡½æ•°å‚æ•°æ„å‘³ç€ä»€ä¹ˆå‘¢ï¼Ÿè®©æˆ‘ä»¬ç”¨ä¸€ä¸ªåŸºæœ¬çš„åšå®åº¦çš„ä¾‹å­ã€‚*****

```
*****function test(string memory input) public {
    // ...
}*****
```

*****å½“ä¸€ä¸ª`memory`å¼•ç”¨ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸€ä¸ªå‡½æ•°æ—¶ï¼Œè¯¥å‡½æ•°çš„ EVM å­—èŠ‚ç ä¾æ¬¡æ‰§è¡Œ 4 ä¸ªä¸»è¦æ­¥éª¤:*****

1.  *******ä»** `**calldata**` **åŠ è½½å­—ç¬¦ä¸²åç§»é‡åˆ°å †æ ˆ:**çŸ¥é“å­—ç¬¦ä¸²åœ¨`calldata`é‡Œé¢çš„èµ·å§‹ä½ç½®ã€‚*****
2.  *******å°†å­—ç¬¦ä¸²é•¿åº¦åŠ è½½åˆ°å †æ ˆä¸­:**å°†ç”¨äºçŸ¥é“ä»`calldata`ä¸­å¤åˆ¶å¤šå°‘æ•°æ®ã€‚*****
3.  *******åˆ†é…ä¸€äº›å†…å­˜ç©ºé—´**å°†å­—ç¬¦ä¸²ä»`calldata`ç§»è‡³`memory`:è¿™ä¸â€œç©ºé—²å†…å­˜æŒ‡é’ˆâ€ä¸­æè¿°çš„ç›¸åŒã€‚*****
4.  *******ä½¿ç”¨æ“ä½œç `calldatacopy`å°†å­—ç¬¦ä¸²ä»** `**calldata**` **è½¬ç§»åˆ°** `**memory**` ã€‚*****

*****æˆ‘æŠŠè¯¦ç»†çš„æ“ä½œç æ”¾åœ¨ä¸‹é¢äº†ã€‚ä½ ä¹Ÿå¯ä»¥æŸ¥çœ‹æˆ‘çš„ Github åº“æ¥äº†è§£æ›´å¤šç»†èŠ‚ã€‚*****

*****![](img/a2d2a004c33549779cf4f2fc5ba14e12.png)**********![](img/db57ae6c650a260a170749a95fbdc06d.png)*****

*****[æ¥æº:å…³äºåšå›ºæ€§çš„ä¸€åˆ‡â€”â€”è®°å¿†(Github åº“)](https://github.com/CJ42/All-About-Solidity/blob/master/articles/data-locations/Memory.md#a-string-passed-as-a-function-argument)*****

# *****å‡½æ•°ä½“å†…çš„å†…å­˜å¼•ç”¨*****

*****è®©æˆ‘ä»¬çœ‹çœ‹ä¸‹é¢çš„å‡†ç³»ç»Ÿä¾‹å­ã€‚*****

```
*****function test() public { uint256[] memory data;}*****
```

*****è¦é—®çš„é—®é¢˜æ˜¯*å˜é‡* `*data*` *åŒ…å«ä»€ä¹ˆï¼Ÿ******

*****å›ç­”*`*uint256*`*å·çš„ç©ºæ•°ç»„*å¯èƒ½ä¼šå¾ˆæœ‰è¯±æƒ‘åŠ›ã€‚ä½†æ˜¯ä¸è¦è¢«è¯­æ³•æ‰€è¿·æƒ‘æˆ–è¯¯å¯¼ã€‚è¿™æ˜¯ Solidityï¼Œä¸æ˜¯ Javascript æˆ–è€… Typescriptï¼******

******åœ¨ Typescript ä¸­ï¼Œå£°æ˜ä¸€ä¸ªå…·æœ‰`uint256[]`ç±»å‹çš„å˜é‡è€Œä¸åˆå§‹åŒ–å®ƒä¼šå¯¼è‡´è¯¥å˜é‡é¦–å…ˆä¿å­˜ä¸€ä¸ªç©ºæ•°ç»„ã€‚******

******ç„¶è€Œï¼Œå…³é”®å­—`memory`åœ¨è¿™é‡Œæ”¹å˜äº†è¿™ä¸€åˆ‡ï¼******

******è®©æˆ‘ä»¬æ¥åˆ·æ–°ä¸€ä¸‹æˆ‘ä»¬çš„å¤§è„‘ï¼Œåœ¨ä»‹ç»æ–‡ç« ã€Šå…³äºæ•°æ®ä½ç½®çš„ä¸€åˆ‡ã€‹ä¸­ï¼Œæˆ‘ä»¬æè¿°äº†å¸¦æœ‰å…³é”®å­—`storage`ã€`memory`æˆ–`calldata`çš„å˜é‡ç§°ä¸º**å¼•ç”¨ç±»å‹å˜é‡ã€‚********

******æ‰€ä»¥å½“ä½ åœ¨ä¸€ä¸ªå¸¦æœ‰å…³é”®å­—`memory`çš„å®æ€§å‡½æ•°ä¸­çœ‹åˆ°ä¸€ä¸ªå˜é‡æ—¶ï¼Œä½ æ˜¯åœ¨å¤„ç†ä¸€ä¸ªå¯¹å†…å­˜ä¸­æŸä¸ªä½ç½®çš„å¼•ç”¨ã€‚******

******å› æ­¤ï¼Œä¸Šé¢çš„å˜é‡`data`ä¸ä¿å­˜æ•°ç»„ï¼Œè€Œæ˜¯ä¿å­˜**ä¸€ä¸ªæŒ‡å‘å†…å­˜ä¸­æŸä¸ªä½ç½®çš„æŒ‡é’ˆã€‚**Solidity æ–‡æ¡£å¯¹æ­¤åšäº†å¾ˆå¥½çš„æè¿°:******

> ******å¼•ç”¨å†…å­˜çš„å±€éƒ¨å˜é‡è®¡ç®—å†…å­˜ä¸­å˜é‡çš„åœ°å€ï¼Œè€Œä¸æ˜¯å€¼æœ¬èº«ã€‚******

******è€Œåšå›ºæ€§åœ¨è§£é‡Šä¸Šæ›´è¿›ä¸€æ­¥ï¼******

> ******è¿™æ ·çš„å˜é‡ä¹Ÿå¯ä»¥èµ‹å€¼ç»™ï¼Œä½†æ˜¯æ³¨æ„èµ‹å€¼åªä¼šæ”¹å˜æŒ‡é’ˆè€Œä¸ä¼šæ”¹å˜æ•°æ®******

******è®©æˆ‘ä»¬çœ‹å¦ä¸€ä¸ªä¾‹å­æ¥æ›´å¥½åœ°ç†è§£ã€‚******

```
******function test() public pure returns (bytes memory) { bytes memory data;
    bytes memory greetings = hex"cafecafe"; data = greetings;
    data[0] = 0x00;
    data[1] = 0x00; return greetings;}******
```

******æœ‰äººå¯èƒ½ä¼šè®¤ä¸ºå˜é‡`greetings`åœ¨è¿™é‡Œæ˜¯å®‰å…¨çš„ï¼Œè¿™ä¸ªå‡½æ•°å°†è¿”å›`0xcafecafe`ã€‚ä½†æ˜¯è¿™é‡Œçš„å‡è®¾æ˜¯é”™è¯¯çš„ï¼Œå¦‚æœä½ è¿è¡Œè¿™ä¸ªå‡½æ•°ï¼Œå®ƒä¼šè¿”å›å¦‚ä¸‹ç»“æœã€‚******

******![](img/1649fda8736c2780678877023f85e225.png)******

******å†…å­˜å¼•ç”¨ç»™äººçš„æƒŠå¥‡å’Œé”™è¯¯çš„å‡è®¾ã€‚******

******å®é™…ä¸Šï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸¤ä¸ªæŒ‡å‘å†…å­˜çš„æŒ‡é’ˆï¼Œåˆ†åˆ«ç”¨å˜é‡`data`å’Œ`greetings`å‘½åã€‚******

******å½“æˆ‘ä»¬åš`data = greetings`æ—¶ï¼Œæˆ‘ä»¬è®¤ä¸ºæˆ‘ä»¬åœ¨ç»™å˜é‡`data`èµ‹å€¼`cafecafe`ã€‚ä½†æ˜¯**æˆ‘ä»¬åœ¨è¿™é‡Œæ ¹æœ¬æ²¡æœ‰åˆ†é…ä»»ä½•ä¸œè¥¿**ï¼æˆ‘ä»¬å‘ EVM å‘å‡ºä»¥ä¸‹æŒ‡ä»¤:******

> ******"å˜é‡`data`ï¼Œæˆ‘å‘½ä»¤ä½ æŒ‡å‘å†…å­˜ä¸­å˜é‡`greetings`æŒ‡å‘çš„ç›¸åŒä½ç½®ï¼"*ğŸ«¡*ğŸª–******

## ******åœ¨å†…å­˜ä¸­åˆ†é…æ–°å…ƒç´ ******

******åœ¨ä¸Šä¸€èŠ‚ä¸­æˆ‘ä»¬çœ‹åˆ°ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å†…å­˜ä¸­ä¸ºå˜é‡åˆ†é…ä¸€äº›ç©ºé—´ï¼Œå¹¶é€šè¿‡ç»™å˜é‡èµ‹å€¼æ¥ç›´æ¥å†™å…¥ã€‚******

******æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨å†…å­˜ä¸­åˆ†é…ä¸€äº›ç©ºé—´ï¼Œä½†ä¸ç«‹å³å†™å…¥å†…å­˜ï¼Œæ–¹æ³•æ˜¯ä½¿ç”¨`new`å…³é”®å­—ã€‚******

******è¿™ä¸»è¦æ˜¯åœ¨å®ä¾‹åŒ–å¤æ‚ç±»å‹(å¦‚å‡½æ•°ä¸­çš„æ•°ç»„)æ—¶ã€‚******

******å½“ç”¨`new`å…³é”®å­—åˆ›å»ºæ•°ç»„æ—¶ï¼Œæ•°ç»„é•¿åº¦å¿…é¡»åœ¨æ‹¬å·ä¸­æŒ‡å®šã€‚åœ¨å‡½æ•°ä½“å†…çš„å†…å­˜ä¸­åªå…è®¸å›ºå®šå¤§å°çš„æ•°ç»„ã€‚******

```
******uint[] memory data = new uint[](3);******
```

******å¯¹äºç»“æ„ï¼Œnew å…³é”®å­—ä¸æ˜¯å¿…éœ€çš„ã€‚******

## ******ä»å­˜å‚¨å‚è€ƒå˜é‡å¤åˆ¶******

******è®©æˆ‘ä»¬ç»§ç»­ä¸‹é¢çš„åšå®åº¦çš„ä¾‹å­ã€‚******

```
******// SPDX-License-Identifier: UNLICENSED
pragma solidity ^0.8.0;contract Playground { bytes storageData = hex"C0C0A0C0DE"; function test() public { bytes memory data = storageData; }}******
```

******åœ¨è¿™ä¸ªåœºæ™¯ä¸­ï¼Œæˆ‘ä»¬å°†ä¸€ä¸ª`storage`å¼•ç”¨(=åœ¨`=`ç¬¦å·çš„å³è¾¹)å¤åˆ¶åˆ°ä¸€ä¸ª`memory`å¼•ç”¨(=åœ¨`=`ç¬¦å·çš„å·¦è¾¹)ã€‚è¿™é‡Œå‘ç”Ÿäº†ä¸¤ä»¶äº‹:******

1.  ******æ–°çš„å†…å­˜è¢«åˆ†é…ï¼Œå˜é‡`data`å°†æŒ‡å‘å†…å­˜ä¸­çš„ä¸€ä¸ªæ–°ä½ç½®ã€‚******
2.  ******åå…­è¿›åˆ¶åè¿›åˆ¶å€¼`0xC0C0A0C0DE`ä»å­˜å‚¨å™¨ä¸­åŠ è½½å¹¶å¤åˆ¶åˆ°å†…å­˜ä¸­`data`æ‰€æŒ‡çš„å­˜å‚¨ä½ç½®ã€‚******

# ******å†…å­˜æ‰©å±•æˆæœ¬******

> ******æœ‰å…³å†…å­˜æ‰©å±•æˆæœ¬çš„æ›´å¤šè¯¦ç»†ä¿¡æ¯ï¼Œè¯·é˜…è¯» [evm.codes](https://www.evm.codes/about#memoryexpansion)******

******åšå›ºæ€§æ–‡ä»¶é™ˆè¿°å¦‚ä¸‹:******

> ******å½“è®¿é—®(è¯»å–æˆ–å†™å…¥)å…ˆå‰æœªæ¥è§¦çš„å­˜å‚¨å™¨å­—(å³ï¼Œå­—å†…çš„ä»»ä½•åç§»)æ—¶ï¼Œå­˜å‚¨å™¨è¢«ä¸€ä¸ªå­—(256 ä½)æ‰©å±•ã€‚******
> 
> ******åœ¨æ‰©å»ºæ—¶ï¼Œå¿…é¡»æ”¯ä»˜ç‡ƒæ°”è´¹ç”¨ã€‚å†…å­˜è¶Šå¤§ï¼Œæˆæœ¬å°±è¶Šé«˜(å®ƒä»¥å¹³æ–¹çš„æ–¹å¼æ‰©å±•)ã€‚******

******äº‹å®ä¸Šï¼Œæ¯å½“æˆ‘ä»¬åœ¨å†…å­˜ä¸­å†™å…¥ä¸€ä¸ªä»¥å‰æ²¡æœ‰ä½¿ç”¨è¿‡(å…¶ä¸­æœ‰ä¸€äº›æ•°æ®)æˆ–è®¿é—®è¿‡(é€šè¿‡`mload`)çš„æ–°å•è¯æ—¶ï¼Œå†…å­˜å°±ä¼šâ€œæ‰©å±•â€ã€‚******

******ä¸ºä»€ä¹ˆå†…å­˜æ‰©å±•å¾ˆé‡è¦ï¼Ÿå› ä¸ºå†…å­˜è¶Šå¤§ï¼Œæ¯æ¬¡ä¸å®ƒäº¤äº’æ—¶æ¶ˆè€—çš„æ°”ä½“å°±è¶Šå¤šã€‚******

******å½“ä½ é€šè¿‡`mstore`(æˆ–`mstore8`)å†™å…¥å†…å­˜æ—¶ï¼Œè¿™ä¸¤ä¸ªæ“ä½œç ä¼šç”¨åˆ°ä¸€äº› gasã€‚ä½†æ˜¯ï¼Œå†™å…¥å†…å­˜çš„å¼€é”€ä¸ä»…ä»…å–å†³äºæ‚¨å‘å†…å­˜å†™å…¥äº†å¤šå°‘æ•°æ®ã€‚å®ƒè¿˜å–å†³äºå®é™…çš„å†…å­˜å¤§å°ï¼Œä¹Ÿå°±æ˜¯ EVM å½±å­å¼€å‘è€…ç¤¾åŒºæ‰€è¯´çš„*â€œå†…å­˜æ‰©å±•æˆæœ¬â€ã€‚*******

******é™¤äº†å†™å…¥å†…å­˜çš„æˆæœ¬ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€ä¸ªä¸å†…å­˜æ‰©å±•é‡ç›¸å…³çš„é¢å¤–æˆæœ¬ã€‚******

******å†…å­˜æ‰©å±•æˆæœ¬ä»¥ä¸‹åˆ—æ–¹å¼å¢åŠ :******

*   ******å‰ 724 ä¸ªå­—èŠ‚æ˜¯çº¿æ€§çš„ã€‚******
*   ******ä¹‹åæ˜¯äºŒæ¬¡*(è§£é‡Šâ€œäºŒæ¬¡â€*çš„æ„æ€)******

******å½“é€šè¿‡`mload`æ“ä½œç åœ¨å†…å­˜ä¸­è®¿é—®æ›´é«˜çš„åç§»é‡æ—¶ï¼Œç®€å•çš„å†…å­˜è¯»å–æ“ä½œä¹Ÿä¼šå¢åŠ å†…å­˜æ‰©å±•æˆæœ¬ã€‚******

# ******åˆçº¦è°ƒç”¨ä¹‹é—´çš„å†…å­˜******

******å…³äº EVM è®°å¿†å’Œæ™ºèƒ½åˆçº¦ï¼Œæœ‰ä¸€ä¸ªé‡è¦çš„æ¦‚å¿µéœ€è¦æ³¨æ„ã€‚å¯é æ€§æ–‡ä»¶å¾ˆå¥½åœ°è¯´æ˜äº†è¿™ä¸€ç‚¹:******

> ******â€¦å¥‘çº¦ä¸ºæ¯ä¸ªæ¶ˆæ¯è°ƒç”¨è·å¾—ä¸€ä¸ªæ–°æ¸…é™¤çš„(å†…å­˜)å®ä¾‹ã€‚******

******è¿™æœ‰åŠ©äºæˆ‘ä»¬ç†è§£ EVM è®°å¿†çš„ä¸€ä¸ªä¸»è¦ç‰¹å¾:**ä¸€ä¸ªæ¸…æ™°çš„è®°å¿†å®ä¾‹æ˜¯åœ¨å¤–éƒ¨è°ƒç”¨ä¹‹é—´è·å¾—çš„ã€‚********

******äº‹å®ä¸Šï¼ŒEVM å†…å­˜çš„ä¸€ä¸ªå®ä¾‹æ˜¯ç‰¹å®šäºæ¯ä¸ªå¥‘çº¦å’Œå½“å‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„ã€‚è¿™æ„å‘³ç€åœ¨æ¯æ¬¡æ–°çº¦å®šäº¤äº’æ—¶ï¼Œè·å¾—æ–°æ¸…é™¤çš„ç©ºå†…å­˜ã€‚******

******è®©æˆ‘ä»¬åœ¨å®è·µä¸­æ£€æŸ¥å¦‚ä½•åœ¨æ¯ä¸ªæ–°çš„å¤–éƒ¨è°ƒç”¨ä¸­è·å¾—ä¸€ä¸ªæ¸…æ™°çš„å†…å­˜å®ä¾‹ã€‚æˆ‘ä»¬å°†ä»¥è¿™ä¸¤ä»½åˆåŒä¸ºä¾‹:******

******ä½¿ç”¨è¿™ä¸¤ä¸ªåŸºæœ¬å¥‘çº¦ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`Source`å¥‘çº¦ä¸`Target`å¥‘çº¦è¿›è¡Œäº¤äº’ã€‚è®©æˆ‘ä»¬åœ¨ Remix ä¸­éƒ¨ç½²å’Œè°ƒè¯•å®ƒä»¬ã€‚******

1.  ******æ‰“å¼€ [Remix IDE](https://remix-project.org/) ï¼Œåˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶å¤åˆ¶ä¸Šé¢çš„ Solidity ä»£ç ã€‚******
2.  ******åœ¨ä¸å¯ç”¨ä¼˜åŒ–å™¨æˆ–ä¸è¿è¡Œä»»ä½•æ¬¡æ•°çš„æƒ…å†µä¸‹ç¼–è¯‘æ–‡ä»¶ã€‚******
3.  ******é¦–å…ˆéƒ¨ç½²`Target`åˆåŒã€‚******
4.  ******å…¶æ¬¡éƒ¨ç½²`Source`å¥‘çº¦ï¼Œç»™å‡ºä¹‹å‰éƒ¨ç½²çš„`Target`å¥‘çº¦çš„åœ°å€ä½œä¸ºæ„é€ å‡½æ•°å‚æ•°ã€‚******
5.  ******åœ¨`Source`åˆåŒä¸Šï¼Œè¿è¡ŒåŠŸèƒ½`callTarget()`******
6.  ******åœ¨æ§åˆ¶å°ä¸Šï¼Œç‚¹å‡»**â€œDebugâ€**ï¼Œè°ƒè¯•äº‹åŠ¡çš„å„ä¸ªæ“ä½œç ã€‚******

******å½“æ‚¨è°ƒè¯•å¹¶æ£€æŸ¥æ¯ä¸ªæ“ä½œç æ—¶ï¼Œæ‚¨åº”è¯¥çœ‹åˆ° EVM å†…å­˜ä¸­å……æ»¡äº†å„ç§åç§»é‡çš„æ•°æ®ã€‚å…¶ä¸­ä¸€ä¸ªåœ¨åç§»é‡`0x80`å¤„æ˜¾ç¤ºäº†å€¼`0x826926790000000000000000...`ã€‚è¿™æ˜¯ç›®æ ‡å¥‘çº¦ä¸ŠåŠŸèƒ½`doSomething()`çš„åŠŸèƒ½é€‰æ‹©å™¨ã€‚******

******![](img/9d6d1c9f6c3e296019ba281884bb2664.png)******

******æˆ‘ä»¬åœ¨è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¤–éƒ¨å¥‘çº¦è°ƒç”¨ä¹‹å‰ï¼Œå†…å­˜ä¸­å……æ»¡äº†æ•°æ®******

******æˆ‘ä»¬å¯ä»¥åœ¨ä¸Šé¢çš„æˆªå›¾ä¸­çœ‹åˆ°æ‰§è¡Œä¸Šä¸‹æ–‡ã€‚è°ƒè¯•å™¨çªå‡ºæ˜¾ç¤ºäº†ä»£ç è¡Œ nb 12ï¼Œå¤–éƒ¨è°ƒç”¨`target.doSomething()`ã€‚******

******ç°åœ¨æ³¨æ„ä¸‹ä¸€æ­¥ï¼å¦‚æœä½ ç‚¹å‡»è“è‰²ç®­å¤´æŒ‰é’®è·³è½¬åˆ°ä¸‹ä¸€ä¸ªæ“ä½œç è¿›è¡Œè°ƒè¯•ï¼Œå°±åƒå˜é­”æœ¯ä¸€æ ·ï¼Œå†…å­˜è¢«æ¸…ç©ºï¼Œå˜æˆç©ºçš„ï¼******

******![](img/101ec95890c0f4fc74ce31b2c0d33ab4.png)******

******æŸ¥çœ‹å†…å­˜åˆ‡æ¢çŠ¶æ€â€œæ— æ•°æ®å¯ç”¨â€******

******ä»ä¸Šé¢çš„æˆªå›¾å¯ä»¥çœ‹å‡ºï¼Œå·¦è¾¹æ çš„â€œå†…å­˜â€æ ç°åœ¨æ˜¾ç¤ºâ€œæ— æ•°æ®å¯ç”¨â€ã€‚åˆšåˆšå‘ç”Ÿäº†ä»€ä¹ˆï¼Ÿ******

******`CALL`æ“ä½œç ä½¿ EVM æ”¹å˜äº†æ‰§è¡Œç¯å¢ƒã€‚æˆ‘ä»¬ç°åœ¨åœ¨ä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è¿è¡Œ EVM:`Target`å¥‘çº¦çš„ä¸Šä¸‹æ–‡ã€‚ä»ä¸Šé¢å¯ä»¥çœ‹åˆ°ï¼Œå‡½æ•°`doSomething()`ç°åœ¨è¢«çªå‡ºæ˜¾ç¤ºï¼Œä¸ºè¿™ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡åˆ‡æ¢æä¾›äº†é¢å¤–çš„çº¿ç´¢ã€‚******

******ä¸‹é¢æ˜¯ Solidity ä¸­è¿™ä¸ªå¤–éƒ¨è°ƒç”¨çš„æ“ä½œç æ‘˜è¦ã€‚ä¸ºäº†ç®€æ´èµ·è§ï¼Œæˆ‘çœç•¥äº†ä¸€äº›æ“ä½œç ï¼Œå¹¶ä»¥æ³¨é‡Šçš„å½¢å¼è§£é‡Šäº†å‘ç”Ÿçš„æƒ…å†µã€‚******

******ç®€å•è§£é‡Šä¸€ä¸‹ï¼ŒEVM ä¼šç”Ÿæˆ calldata å­—èŠ‚ï¼Œå°†`doSomething()`(ä¸º`0x82692679`)çš„å‡½æ•°é€‰æ‹©å™¨æ¨åˆ°å †æ ˆä¸Šï¼Œå¹¶å°†å…¶å·¦ç§»ä»¥å‡†å¤‡ calldataï¼Œè¿™æ ·å°±æœ‰è¿™ 4 ä¸ªå­—èŠ‚ä½œä¸º calldata ä¸­çš„å‡½æ•°é€‰æ‹©å™¨ã€‚******

******ç„¶åï¼Œè¦å‘é€çš„ calldata æœ‰æ•ˆè´Ÿè½½å­˜å‚¨åœ¨å†…å­˜ä¸­ç”±ç©ºé—²å†…å­˜æŒ‡é’ˆæ£€ç´¢çš„ä½ç½®ã€‚******

******æœ€åï¼Œ`CALL`æ“ä½œç å°†è°ƒç”¨å¤–éƒ¨å¥‘çº¦åœ°å€ï¼Œè¯¥åœ°å€æœ€åˆä»å¥‘çº¦å­˜å‚¨å™¨(åœ¨æŒ‡ä»¤ç¼–å·`057`å¤„)è·å–ï¼Œå¹¶ä¸”å°†é€šè¿‡ä»å­˜å‚¨å™¨(å…¶å…ˆå‰è¢«å†™å…¥çš„ä½ç½®)è·å–æ¥å‘é€ calldataã€‚******

> ******ä½ å¯ä»¥åœ¨ github çš„[â€œAll About Solidityâ€åº“ä¸­æŸ¥çœ‹è¿™ä¸ªå¤–éƒ¨è°ƒç”¨çš„ EVM æ“ä½œç çš„å®Œæ•´ç‰‡æ®µã€‚](https://github.com/CJ42/All-About-Solidity/blob/master/articles/data-locations/Memory.md#memory-between-function-calls)******

# ******ç»“è®º******

******åœ¨ EVMï¼Œè®°å¿†æ˜¯ä¸€ä¸ªé‡è¦çš„å­¦ä¹ é¢†åŸŸã€‚å®ƒä½¿ EVM èƒ½å¤Ÿæ‰§è¡Œæ¶ˆæ¯å‘¼å«ï¼Œä¾‹å¦‚æ ‡å‡†çš„`call`ã€`staticcall`å’Œ`delegatecall`ã€‚ä¸æ¶ˆæ¯è°ƒç”¨ä¸€èµ·å‘é€çš„ calldata å’Œ payload æ˜¯ä»å†…å­˜ä¸­å­˜å‚¨å’Œæ£€ç´¢çš„ã€‚******

******å› æ­¤ï¼ŒEVM å†…å­˜å…è®¸æ›´å¥½çš„å¯ç»„åˆæ€§ï¼Œä»è€Œèƒ½å¤Ÿåœ¨æ™ºèƒ½åˆçº¦ä¸­åˆ›å»ºçµæ´»çš„å†…éƒ¨å‡½æ•°å’Œå­ä¾‹ç¨‹ã€‚æ­¤å¤–ï¼Œå®šä¹‰ä¸º`memory`çš„å‚æ•°ä½¿å¥‘çº¦èƒ½å¤Ÿæ¥æ”¶æ¥è‡ªå„ç§æ¥æºçš„è°ƒç”¨å’Œå‚æ•°ï¼ŒåŒ…æ‹¬ EOAs å’Œå¤–éƒ¨å¥‘çº¦è°ƒç”¨(ä»`calldata`åˆ°`memory`åŠ è½½æœ‰æ•ˆè´Ÿè½½)ï¼Œè¿˜èƒ½å¤Ÿç›´æ¥ä»å†…éƒ¨å‡½æ•°ä¸­ç»„åˆè¾“å…¥ã€‚******

******æœ€åï¼Œåœ¨ä½çº§æ±‡ç¼–ä¸­ä½¿ç”¨å†…å­˜æ—¶è¦å°å¿ƒå¤„ç†ã€‚è¿™æ˜¯ä¸ºäº†ç¡®ä¿æ‚¨ä¸ä¼šè¦†ç›–ä¸€äº›å·²ç»åŒ…å«ä¸€äº›æ•°æ®çš„ä¿ç•™å†…å­˜ç©ºé—´ã€‚å› æ­¤ï¼Œå°Šé‡[å¯é æ€§å†…å­˜ç®¡ç†](https://docs.soliditylang.org/en/v0.8.16/assembly.html#memory-management)æ˜¯ä½ çš„è´£ä»»ã€‚******

******Solidity è¯­è¨€è¿˜æä¾›äº†å…³é”®å­— [*ã€å†…å­˜å®‰å…¨ã€‘*](https://docs.soliditylang.org/en/v0.8.16/assembly.html#memory-safety) æ¥æ›´å®‰å…¨åœ°ä½¿ç”¨å†…è”æ±‡ç¼–ï¼Œå¹¶å°Šé‡ Solidity å†…å­˜æ¨¡å‹ã€‚******

> ******æ›´å¤šè¯¦æƒ…è¯·å‚è§å®ä½“æ–‡æ¡£ä¸­çš„[æƒ¯ä¾‹](https://docs.soliditylang.org/en/v0.8.14/assembly.html?highlight=storage#conventions-in-solidity)éƒ¨åˆ†ã€‚******

# ******å‚è€ƒ******

******[](https://blog.openzeppelin.com/ethereum-in-depth-part-2-6339cf6bddb9/) [## ä»¥å¤ªåŠæ·±åº¦ï¼Œç¬¬ 2 éƒ¨åˆ†- OpenZeppelin åšå®¢

### æ„Ÿè°¢ä½ å¯¹è¿™ç¯‡æ–‡ç« æ„Ÿå…´è¶£ï¼æˆ‘ä»¬æ­£åœ¨è¿›è¡Œå“ç‰Œé‡å¡‘ï¼Œæ‰€ä»¥å¦‚æœæœ‰äº›åå­—â€¦

blog.openzeppelin.com](https://blog.openzeppelin.com/ethereum-in-depth-part-2-6339cf6bddb9/) [](https://www.evm.codes/) [## EVM ç”µç 

### ä»¥å¤ªåŠè™šæ‹Ÿæœºæ“ä½œç çš„äº¤äº’å¼å‚è€ƒ

www.evm.codes](https://www.evm.codes/) [](https://github.com/ethereum/solidity) [## GitHub -ä»¥å¤ªåŠ/solidity: Solidityï¼Œæ™ºèƒ½å¥‘çº¦ç¼–ç¨‹è¯­è¨€

### æ‚¨å¯ä»¥åœ¨ Gitter å’Œ Matrix ä¸Šä¸æˆ‘ä»¬äº¤æµï¼Œåœ¨ Twitter ä¸Šå‘æˆ‘ä»¬å‘æ¨æ–‡ï¼Œæˆ–è€…åœ¨ Solidity è®ºå›ä¸Šåˆ›å»ºä¸€ä¸ªæ–°ä¸»é¢˜ã€‚é—®é¢˜â€¦

github.com](https://github.com/ethereum/solidity) [](https://www.evm.codes/about#memoryexpansion) [## EVM ç”µç 

### ä»¥å¤ªåŠè™šæ‹Ÿæœº(æˆ– EVM)æ˜¯ä¸€ç§åŸºäºå †æ ˆçš„è®¡ç®—æœºã€‚è¿™æ„å‘³ç€æ‰€æœ‰æŒ‡ä»¤éƒ½å¸¦å‚æ•°â€¦

www.evm.codes](https://www.evm.codes/about#memoryexpansion) [](https://ethereum.stackexchange.com/questions/9537/how-to-return-dynamic-sized-arrays-original-address-on-the-memory-of-solidity/28457#28457) [## å¦‚ä½•è¿”å›åŠ¨æ€å¤§å°æ•°ç»„åœ¨ Solidity å†…å­˜ä¸­çš„åŸå§‹åœ°å€ï¼Ÿ

### ä¿®æ”¹ä¸ºä»¥å‰çš„ç­”æ¡ˆä¸å®Œå…¨æ­£ç¡®ï¼Œå› ä¸ºå®ƒåœ¨å†…å­˜ä¸­æ˜¯å¯èƒ½çš„ï¼Œä½†å®ƒåªèƒ½åœ¨æ±‡ç¼–å’Œâ€¦

ethereum.stackexchange.com](https://ethereum.stackexchange.com/questions/9537/how-to-return-dynamic-sized-arrays-original-address-on-the-memory-of-solidity/28457#28457)  [## å›ºä½“ä¸­çš„æ•°æ®è¡¨ç¤º

### é€‚ç”¨äºä»£ç è°ƒè¯•å™¨å’Œå…¶ä»–è°ƒè¯•ç›¸å…³å®ç”¨ç¨‹åºçš„ç¼–å†™äººå‘˜ã€‚ä½œè€…å“ˆé‡ŒÂ·å¥¥ç‰¹æ›¼[@haltman-at]å‘è¡¨â€¦

ethdebug.github.io](https://ethdebug.github.io/solidity-data-representation/)  [## åœ¨çº¿è£…é…-åšå›ºæ€§ 0.8.14 æ–‡ä»¶

### ä½ å¯ä»¥åœ¨ä¸€ç§æ¥è¿‘ä»¥å¤ªåŠè™šæ‹Ÿè¯­è¨€çš„è¯­è¨€ä¸­ç”¨å†…è”æ±‡ç¼–æ¥äº¤é”™ Solidity è¯­å¥

docs.soliditylang.org](https://docs.soliditylang.org/en/v0.8.14/assembly.html?highlight=storage#memory-management) [](https://stackoverflow.com/a/33839164/8245387) [## ä»¥å¤ªåŠåšå›ºä¸­ï¼Œâ€œè®°å¿†â€å…³é”®å­—çš„ç”¨é€”æ˜¯ä»€ä¹ˆï¼Ÿ

### å½“äººä»¬è°ˆè®º Solidity ä¸­çš„å­˜å‚¨å’Œå†…å­˜æ—¶ï¼Œä»–ä»¬å®é™…ä¸Šå¯èƒ½æŒ‡çš„æ˜¯è¿™äº›ä¸œè¥¿çš„ä¸¤ç§ä¸åŒç”¨é€”â€¦

stackoverflow.com](https://stackoverflow.com/a/33839164/8245387) [](https://ethereum.stackexchange.com/questions/9603/understanding-mload-assembly-function/9610) [## äº†è§£ mload æ±‡ç¼–å‡½æ•°

### mload(0xAB)åŠ è½½ä½äºå­˜å‚¨å™¨åœ°å€ 0xAB çš„å­—(32 å­—èŠ‚)ã€‚ä¾‹å¦‚ï¼Œmload(0x60)åŠ è½½ä½äº 0x60 çš„å­—â€¦

ethereum.stackexchange.com](https://ethereum.stackexchange.com/questions/9603/understanding-mload-assembly-function/9610)  [## å†…å­˜å¸ƒå±€- Solidity 0.8.15 æ–‡æ¡£

### Solidity ä¸­æœ‰ä¸€äº›æ“ä½œéœ€è¦å¤§äº 64 å­—èŠ‚çš„ä¸´æ—¶å­˜å‚¨åŒºï¼Œå› æ­¤ä¸é€‚åˆâ€¦

docs.soliditylang.org](https://docs.soliditylang.org/en/v0.8.15/internals/layout_in_memory.html)  [## åœ¨çº¿è£…é…-åšå›ºæ€§ 0.8.16 æ–‡ä»¶

### ä½ å¯ä»¥åœ¨ä¸€ç§æ¥è¿‘ä»¥å¤ªåŠè™šæ‹Ÿè¯­è¨€çš„è¯­è¨€ä¸­ç”¨å†…è”æ±‡ç¼–æ¥äº¤é”™ Solidity è¯­å¥

docs.soliditylang.org](https://docs.soliditylang.org/en/v0.8.16/assembly.html#memory-management) [](https://github.com/CJ42/All-About-Solidity/blob/master/articles/data-locations/Memory.md) [## ä¸» CJ42 ä¸Šçš„å…¨å¯é æ€§/memory . MD/å…¨å¯é æ€§

### MSIZE æ“ä½œç å¯èƒ½ä¼šè®©æ‚¨è®¤ä¸ºå®ƒè¿”å›å­˜å‚¨åœ¨å†…å­˜ä¸­çš„æ•°æ®çš„å®é™…å¤§å°(ä»¥å­—èŠ‚ä¸ºå•ä½)ã€‚å®ƒä¸â€¦

github.com](https://github.com/CJ42/All-About-Solidity/blob/master/articles/data-locations/Memory.md)******