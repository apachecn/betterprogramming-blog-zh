<html>
<head>
<title>Dealing With Race Conditions In Chained API Calls Using Swift</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Swiftå¤„ç†é“¾å¼APIè°ƒç”¨ä¸­çš„ç«äº‰æ¡ä»¶</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/dealing-with-race-conditions-in-chained-api-calls-96809839ec87?source=collection_archive---------11-----------------------#2022-08-04">https://betterprogramming.pub/dealing-with-race-conditions-in-chained-api-calls-96809839ec87?source=collection_archive---------11-----------------------#2022-08-04</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1f9b" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">ä½¿ç”¨å®Œæˆå¤„ç†ç¨‹åºã€é€’å½’å’Œä¿¡å·é‡ç¤ºä¾‹è¿›è¡Œè§£é‡Š</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/51ad5965726ae0cae4689a162fd589a5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*spDxJtUUtx7UJKof78Ow3w.jpeg"/></div></div></figure><p id="3659" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†åˆ†äº«ä¸€äº›æˆ‘åœ¨Nano Challenge 2åº”ç”¨ç¨‹åº<strong class="kt ir"> Colorioä¸­å¤„ç†é“¾å¼APIè°ƒç”¨çš„ç»éªŒã€‚</strong>è¿™é‡Œæˆ‘å°†è°ˆè°ˆæˆ‘å¤„ç†å®ƒä»¬çš„æ–¹æ³•ï¼Œä»¥åŠå¯ä»¥ä½¿ç”¨çš„æ›¿ä»£æ–¹æ³•ã€‚</p><h1 id="b77d" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">å…³é”®è¯</h1><ul class=""><li id="1bc1" class="mf mg iq kt b ku mh kx mi la mj le mk li ml lm mm mn mo mp bi translated">å®Œæˆå¤„ç†ç¨‹åº</li><li id="ac9a" class="mf mg iq kt b ku mq kx mr la ms le mt li mu lm mm mn mo mp bi translated">é€’å½’</li><li id="762b" class="mf mg iq kt b ku mq kx mr la ms le mt li mu lm mm mn mo mp bi translated">ä¿¡å·ç¯</li></ul><h1 id="e5a7" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">è®©æˆ‘ä»¬ä»ä¸€ä¸ªåŸºæœ¬çš„APIè°ƒç”¨å¼€å§‹</h1><p id="8864" class="pw-post-body-paragraph kr ks iq kt b ku mh jr kw kx mi ju kz la mv lc ld le mw lg lh li mx lk ll lm ij bi translated">ä½ æœ‰æ²¡æœ‰æƒ³è¿‡ä½¿ç”¨ä¸€ä¸ªAPIå¹¶æŠŠå®ƒä»¬çš„æ•°æ®åŠ è½½åˆ°ä¸€ä¸ªè¡¨æ ¼è§†å›¾ä¸­ï¼Ÿé€šå¸¸ä½ ä¼šåœ¨ä½ çš„è§†å›¾æ§åˆ¶å™¨ä¸­è¿™æ ·åš:</p><p id="8e9e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ä»APIè·å–çš„JSONæ•°æ®ç¤ºä¾‹:</p><pre class="kg kh ki kj gt my mz na bn nb nc bi"><span id="b8db" class="nd lo iq mz b be ne nf l ng nh">[<br/>  {<br/>    "id": 1,<br/>    "author": "Gregorius Albert",<br/>    "content": "This is my first tweet"<br/>  },<br/>  {<br/>    "id": 2,<br/>    "author": "Taylor Swift",<br/>    "content": "It's August baby"<br/>  },<br/>  {<br/>    "id": 3,<br/>    "author": "Justin Bieber",<br/>    "content": "What's about the Baby song thing?"<br/>  }<br/>]</span></pre><p id="e28c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ä»APIè·å–æ•°æ®å¹¶åŠ è½½åˆ°è¡¨è§†å›¾çš„ä»£ç æ˜¯:</p><pre class="kg kh ki kj gt my mz na bn nb nc bi"><span id="275e" class="nd lo iq mz b be ne nf l ng nh">let url = URL(string: Helper.BASE_URL)!<br/>var request = URLRequest(url: url)<br/>request.httpMethod = "GET"<br/><br/>URLSession.shared.dataTask(with: request){ (data, response, error) in<br/><br/>    let json = try! JSONSerialization.jsonObject(with: data!) as! [[String:Any]]<br/>	<br/>    for result in json {<br/>        let author = result["author"] as! String<br/>        let content = result["content"] as! String<br/>        let tweet = Tweet(author: author, content: content)<br/>        self.tweets.append(tweet)<br/>    }<br/>	<br/>    DispatchQueue.main.async {<br/>        self.tableView.reloadData()<br/>    }<br/>	<br/>}.resume()</span></pre><p id="f946" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚æœAPIå¯ä»¥æ‰¹é‡æˆ–é›†åˆåœ°è¿”å›æ•°æ®ï¼Œé‚£ä¹ˆè¿™ä¸ªè§£å†³æ–¹æ¡ˆæ˜¯å¯è¡Œçš„ã€‚è¿™å°±åƒåœ¨SQLæ•°æ®åº“ä¸­åšä¸€ä¸ª<code class="fe ni nj nk mz b">SELECT *</code>ã€‚</p><h1 id="bcf8" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">ä½¿ç”¨ä¸æä¾›æ‰¹é‡æ•°æ®çš„å…¬å…±API</h1><p id="0441" class="pw-post-body-paragraph kr ks iq kt b ku mh jr kw kx mi ju kz la mv lc ld le mw lg lh li mx lk ll lm ij bi translated">ä½†æ˜¯å¦‚æœæ‚¨ä½¿ç”¨çš„æ˜¯ä¸æä¾›æ‰¹é‡æ•°æ®çš„å…¬å…±APIå‘¢ï¼Ÿæœ‰äº›APIåªå…è®¸ä½ æ ¹æ®ä¸€ä¸ªå‚æ•°è·å–ä¸€ä¸ªæ•°æ®ã€‚è¯·çœ‹ä¸‹é¢çš„ä¾‹å­ã€‚</p><p id="b84f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">API URL: <code class="fe ni nj nk mz b"><a class="ae nl" href="https://www.thecolorapi.com/id?hex=E62028" rel="noopener ugc nofollow" target="_blank">https://www.thecolorapi.com/id?hex=E62028</a></code></p><p id="e912" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿”å›çš„ç»“æœ:</p><pre class="kg kh ki kj gt my mz nm nn aw no bi"><span id="8509" class="np lo iq mz b gy nq nr l ns nh">{<br/>  "hex": {<br/>    "value": "#E62028",<br/>    "clean": "E62028"<br/>  },<br/>  "rgb": {<br/>    "fraction": {<br/>      "r": 0.9019607843137255,<br/>      "g": 0.12549019607843137,<br/>      "b": 0.1568627450980392<br/>    },<br/>    "r": 230,<br/>    "g": 32,<br/>    "b": 40,<br/>    "value": "rgb(230, 32, 40)"<br/>  },<br/>  "name": {<br/>    "value": "Alizarin Crimson",<br/>    "closest_named_hex": "#E32636",<br/>    "exact_match_name": false,<br/>    "distance": 349<br/>  }<br/>}<br/><br/>// Some value from the API have been deleted to shorten this article</span></pre><p id="de14" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨è¿™é‡Œï¼Œæˆ‘ä»URLä¸­ç»™å‡ºçš„å‚æ•°<code class="fe ni nj nk mz b"><a class="ae nl" href="https://www.thecolorapi.com/id?hex=E62028" rel="noopener ugc nofollow" target="_blank">E62028</a></code>ä¸­è·å–å€¼ã€‚ä½†æ˜¯æˆ‘éœ€è¦ä¸€æ¬¡å¾—åˆ°å¤šç§é¢œè‰²çš„æ•°æ®ã€‚æˆ‘è¯¥æ€ä¹ˆåšå‘¢ï¼Ÿ</p><h1 id="d67f" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">æˆ‘æ‰€å°è¯•çš„</h1><p id="8b4a" class="pw-post-body-paragraph kr ks iq kt b ku mh jr kw kx mi ju kz la mv lc ld le mw lg lh li mx lk ll lm ij bi translated">å—¯ï¼Œå¾ˆå¤šäººå¯èƒ½è®¤ä¸ºâ€œ<em class="nt">åªéœ€å¾ªç¯APIè°ƒç”¨â€œ</em>ã€‚ä»æŠ€æœ¯ä¸Šè®²ï¼Œä½ å¯ä»¥åƒè¿™æ ·è¿è¡ŒAPIè°ƒç”¨ã€‚è®©æˆ‘ä»¬å°è¯•å¾ªç¯5ä¸ªåå…­è¿›åˆ¶ä»£ç ï¼Œå¹¶ä»æ•°ç»„ä¸­çš„æ¯ä¸ªåå…­è¿›åˆ¶ä»£ç è·å–é¢œè‰²åç§°ã€‚</p><pre class="kg kh ki kj gt my mz na bn nb nc bi"><span id="1a6b" class="nd lo iq mz b be ne nf l ng nh">let hexArr = ["FFFFFF", "000000", "FF0000", "00FF00", "0000FF"]<br/>// White, Black, Red, Green, Blue<br/><br/>for hex in hexArr {<br/>	fetchAPI(hexParam: hex)<br/>}<br/><br/>func fetchAPI(hexParam: String) -&gt; Void {<br/><br/>    let url = URL(string: "https://www.thecolorapi.com/id?hex=\(hexParam)")!<br/>    var request = URLRequest(url: url)<br/>    request.httpMethod = "GET"<br/>    <br/>    URLSession.shared.dataTask(with: request) { data, response, error in<br/>        <br/>        let json = try! JSONSerialization.jsonObject(with: data!) as! [String:Any]<br/>        <br/>        let name = json["name"] as! [String:Any]<br/>        let nameValue = name["value"] as! String<br/>        <br/>        DispatchQueue.main.async {<br/>            print(nameValue)<br/>        }<br/>                    <br/>    }.resume()<br/><br/>}</span></pre><p id="e224" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬å¸Œæœ›å¾—åˆ°çš„ç»“æœæ˜¯:</p><pre class="kg kh ki kj gt my mz nm nn aw no bi"><span id="5b9f" class="np lo iq mz b gy nq nr l ns nh">White <br/>Black <br/>Red <br/>Green <br/>Blue</span></pre><p id="a13e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ä½†æ˜¯ï¼Œå®ƒè¿”å›äº†:</p><pre class="kg kh ki kj gt my mz nm nn aw no bi"><span id="ef73" class="np lo iq mz b gy nq nr l ns nh">Black <br/>White <br/>Green <br/>Red <br/>Blue</span></pre><p id="f815" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬æŠŠæ‰€æœ‰çš„é¢œè‰²éƒ½å¼„å¯¹äº†ã€‚ä½†ä¸æ˜¯æŒ‰é¡ºåºâ€¦å¦‚æœæ‚¨å°è¯•å†æ¬¡è¿è¡Œè¯¥ä»£ç ï¼Œå®ƒå°†ä»¥ä¸åŒçš„é¡ºåºè¿”å›ã€‚</p><p id="c3a1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ğŸ’¡è¿™ç§æƒ…å†µç§°ä¸ºç«äº‰æƒ…å†µã€‚</p><p id="e721" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ç«äº‰æ¡ä»¶æ˜¯æŒ‡åŒæ—¶æ‰§è¡Œå¤šä¸ªä»»åŠ¡çš„æƒ…å†µã€‚å°½ç®¡æˆ‘ä»¬å·²ç»åœ¨æ•°ç»„çš„åºåˆ—ä¸­è°ƒç”¨äº†<code class="fe ni nj nk mz b">fetchAPI()</code>ï¼Œä½†æ˜¯æ¯ä¸ªAPIè°ƒç”¨çš„å®Œæˆæ—¶é—´éƒ½ä¸ç›¸åŒã€‚</p><p id="b365" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬çŸ¥é“ï¼Œæ¯ä¸€ä¸ªå«åš<code class="fe ni nj nk mz b">URLSession</code>çš„éƒ½æ˜¯å¼‚æ­¥è¿è¡Œçš„ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨éœ€è¦å¾ªç¯è°ƒç”¨æœ‰åºï¼Œæ‚¨å¿…é¡»æ“çºµAPIè°ƒç”¨ã€‚</p><h1 id="fa15" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">æ“çºµAPIè°ƒç”¨</h1><p id="4551" class="pw-post-body-paragraph kr ks iq kt b ku mh jr kw kx mi ju kz la mv lc ld le mw lg lh li mx lk ll lm ij bi translated">è¿™é‡Œï¼Œ<code class="fe ni nj nk mz b">URLSession</code>å°†åœ¨<code class="fe ni nj nk mz b">URLSession</code>å…³é—­æ‹¬å·æ—è¾¹çš„<code class="fe ni nj nk mz b">.resume()</code>è¢«è°ƒç”¨åå¼‚æ­¥è¿è¡Œå¦ä¸€ä¸ªä»»åŠ¡ã€‚æ‰€ä»¥ç†è®ºä¸Šï¼Œä½ éœ€è¦åœ¨URLSessionçš„å³æ‹¬å·å‰è°ƒç”¨<code class="fe ni nj nk mz b">fetchAPI()</code>ã€‚</p><pre class="kg kh ki kj gt my mz nm nn aw no bi"><span id="eff0" class="np lo iq mz b gy nq nr l ns nh">URLSession.shared.dataTask(with: request) { data, response, error in<br/>	<br/>    let json = try! JSONSerialization.jsonObject(with: data!) as! [String:Any]<br/>    <br/>    let name = json["name"] as! [String:Any]<br/>    let nameValue = name["value"] as! String<br/>    <br/>    DispatchQueue.main.async {<br/>        print(nameValue)<br/>    }<br/>    <br/>    // MARK: The next API call should be here<br/>				<br/>}.resume()</span></pre><p id="9a7d" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ç†è®ºä¸Šï¼Œå®ç°è¿™ä¸€ç‚¹æœ€ç®€å•çš„æ–¹æ³•æ˜¯ä½¿ç”¨é€’å½’ã€‚å› ä¸ºæˆ‘ä»¬å¯ä»¥åœ¨æŒ‡å®šçš„è¡Œä¸­å†æ¬¡è°ƒç”¨å‡½æ•°ã€‚</p><h1 id="f5e4" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">é€’å½’æ–¹æ³•</h1><p id="a5e4" class="pw-post-body-paragraph kr ks iq kt b ku mh jr kw kx mi ju kz la mv lc ld le mw lg lh li mx lk ll lm ij bi translated">æˆ‘ä¸ªäººåœ¨æˆ‘çš„Nano Challenge 2åº”ç”¨ç¨‹åºColorioä¸­ä½¿ç”¨äº†è¿™ç§æ–¹æ³•ã€‚å°½ç®¡è¿™ç§æ–¹æ³•æœ‰ç‚¹ç‹­éš˜ï¼Œå› ä¸ºå®ƒæ˜¯çº¯é€»è¾‘çš„ï¼Œå¹¶ä¸”æ²¡æœ‰åˆ©ç”¨åƒé˜Ÿåˆ—å’Œä¿¡å·é‡è¿™æ ·çš„Swiftç‰¹æ€§ã€‚æ€§èƒ½ä¹Ÿå¯èƒ½æ˜¯ä¸€ä¸ªé—®é¢˜ï¼Œå› ä¸ºé€’å½’ä¸­çš„å†…å­˜ç®¡ç†å¹¶ä¸æ˜¯æœ€å¥½çš„ã€‚</p><p id="ff7e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘æ˜¯è¿™æ ·å®ç°é€’å½’çš„:</p><ul class=""><li id="aec2" class="mf mg iq kt b ku kv kx ky la nu le nv li nw lm mm mn mo mp bi translated">è®¾ç½®ä½•æ—¶åœæ­¢é€’å½’çš„åŸºæœ¬æ¡ä»¶</li><li id="f19e" class="mf mg iq kt b ku mq kx mr la ms le mt li mu lm mm mn mo mp bi translated">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ç®€å•çš„<code class="fe ni nj nk mz b">if-else</code>æˆ–<code class="fe ni nj nk mz b">guard</code></li><li id="c29f" class="mf mg iq kt b ku mq kx mr la ms le mt li mu lm mm mn mo mp bi translated">æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ª<code class="fe ni nj nk mz b">index</code>å‚æ•°æ¥æ ‡è®°ä½•æ—¶åœæ­¢</li><li id="1814" class="mf mg iq kt b ku mq kx mr la ms le mt li mu lm mm mn mo mp bi translated">åœ¨å³æ‹¬å·å‰é€’å½’è¯¥å‡½æ•°</li></ul><p id="0452" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ğŸ’¡è¿™é‡Œï¼Œå‡½æ•°å°†åœ¨5æ¬¡å‡½æ•°è°ƒç”¨ååœæ­¢è¿è¡Œï¼Œè¿™æ˜¯æ•°ç»„å†…å®¹çš„è®¡æ•°</p><pre class="kg kh ki kj gt my mz na bn nb nc bi"><span id="4728" class="nd lo iq mz b be ne nf l ng nh">let hexArr = ["FFFFFF", "000000", "FF0000", "00FF00", "0000FF"]<br/>// White, Black, Red, Green, Blue<br/><br/>// Defining when the recursion needs to stop based on the array count<br/>let arrayCount = hexArr.count<br/><br/>// Calling the function<br/>fetchAPI(index: 0) <br/><br/>func fetchAPI(index: Int) -&gt; Void {<br/>    <br/>    // Guarding the function to stop after it reaches the array count<br/>    guard index &lt; arrayCount else { return }<br/><br/>    let url = URL(string: "https://www.thecolorapi.com/id?hex=\(hexArr[index])")!<br/>    var request = URLRequest(url: url)<br/>    request.httpMethod = "GET"<br/>    <br/>    URLSession.shared.dataTask(with: request) { data, response, error in<br/>        <br/>        let json = try! JSONSerialization.jsonObject(with: data!) as! [String:Any]<br/>        <br/>        let name = json["name"] as! [String:Any]<br/>        let nameValue = name["value"] as! String<br/>        <br/>        DispatchQueue.main.async {<br/>            print(nameValue)<br/>        }<br/>        <br/>        // Calling the recursion<br/>        fetchAPI(index: index+1)<br/>        <br/>    }.resume()<br/><br/>}</span></pre><p id="609f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚ä½ æ‰€è§ï¼Œç»“æœæ€»æ˜¯ä¸€è‡´çš„ã€‚ä½†æ˜¯å®ƒä»¬ä¼šä¸€ä¸ªæ¥ä¸€ä¸ªåœ°ç¼“æ…¢åŠ è½½ã€‚</p><pre class="kg kh ki kj gt my mz nm nn aw no bi"><span id="e128" class="np lo iq mz b gy nq nr l ns nh">White <br/>Black<br/>Red<br/>Green<br/>Blue</span></pre><p id="0b91" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬å°è¯•ç”¨å¦ä¸€ç§æ–¹å¼æ¥å®ç°é¡ºåºè°ƒç”¨ï¼Œä¿¡å·é‡ã€‚</p><h1 id="7a5d" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">ä¿¡å·é‡æ–¹æ³•</h1><p id="72b2" class="pw-post-body-paragraph kr ks iq kt b ku mh jr kw kx mi ju kz la mv lc ld le mw lg lh li mx lk ll lm ij bi translated">åœ¨æˆ‘ä»¬ç»§ç»­ä»£ç å®ç°ä¹‹å‰ï¼Œè¿™é‡Œæœ‰ä¸€äº›å…³äºä¿¡å·é‡çš„ç†è®ºï¼Œæ¥è‡ª<a class="ae nl" href="https://medium.com/@roykronenfeld/semaphores-in-swift-e296ea80f860" rel="noopener"> Roy Kronenfeldçš„æ–‡ç« </a>ä»¥å¸®åŠ©æ‚¨å¿«é€Ÿäº†è§£:</p><blockquote class="nx ny nz"><p id="1075" class="kr ks nt kt b ku kv jr kw kx ky ju kz oa lb lc ld ob lf lg lh oc lj lk ll lm ij bi translated">ä¿¡å·é‡ç”±ä¸€ä¸ªçº¿ç¨‹é˜Ÿåˆ—å’Œä¸€ä¸ªè®¡æ•°å™¨å€¼(Intç±»å‹)ç»„æˆã€‚</p><p id="8f05" class="kr ks nt kt b ku kv jr kw kx ky ju kz oa lb lc ld ob lf lg lh oc lj lk ll lm ij bi translated">ä¿¡å·é‡ä½¿ç”¨çº¿ç¨‹é˜Ÿåˆ—æ¥è·Ÿè¸ªFIFOé¡ºåºä¸­ç­‰å¾…çš„çº¿ç¨‹(<em class="iq">ä¸€æ—¦å…±äº«èµ„æºå¯ç”¨ï¼Œç¬¬ä¸€ä¸ªè¿›å…¥é˜Ÿåˆ—çš„çº¿ç¨‹å°†æ˜¯ç¬¬ä¸€ä¸ªè®¿é—®å…±äº«èµ„æºçš„çº¿ç¨‹</em>)ã€‚</p><p id="3cd4" class="kr ks nt kt b ku kv jr kw kx ky ju kz oa lb lc ld ob lf lg lh oc lj lk ll lm ij bi translated">ä¿¡å·é‡ä½¿ç”¨è®¡æ•°å™¨å€¼æ¥å†³å®šçº¿ç¨‹æ˜¯å¦åº”è¯¥è®¿é—®å…±äº«èµ„æºã€‚å½“æˆ‘ä»¬è°ƒç”¨signal()æˆ–wait()å‡½æ•°æ—¶ï¼Œè®¡æ•°å™¨å€¼ä¼šå‘ç”Ÿå˜åŒ–ã€‚</p><p id="2781" class="kr ks nt kt b ku kv jr kw kx ky ju kz oa lb lc ld ob lf lg lh oc lj lk ll lm ij bi translated"><strong class="kt ir">é‚£ä¹ˆï¼Œä»€ä¹ˆæ—¶å€™åº”è¯¥è°ƒç”¨wait()å’Œsignal()å‡½æ•°å‘¢ï¼Ÿ</strong></p><p id="64d0" class="kr ks nt kt b ku kv jr kw kx ky ju kz oa lb lc ld ob lf lg lh oc lj lk ll lm ij bi translated">â€”â€”æ¥æº:<a class="ae nl" href="https://medium.com/@roykronenfeld/semaphores-in-swift-e296ea80f860" rel="noopener">ç½—ä¼ŠÂ·å…‹ç½—å—è²å°”å¾·</a></p></blockquote><h1 id="52d3" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">ä»£ç å®ç°</h1><p id="ab54" class="pw-post-body-paragraph kr ks iq kt b ku mh jr kw kx mi ju kz la mv lc ld le mw lg lh li mx lk ll lm ij bi translated">ä¸‹é¢æ˜¯æˆ‘ä»¬åˆå§‹åŒ–ä¿¡å·é‡æ‰€éœ€çš„æ­¥éª¤:</p><ul class=""><li id="2906" class="mf mg iq kt b ku kv kx ky la nu le nv li nw lm mm mn mo mp bi translated"><code class="fe ni nj nk mz b">let semaphore = DispatchSemaphore(value: 1)</code></li><li id="7f65" class="mf mg iq kt b ku mq kx mr la ms le mt li mu lm mm mn mo mp bi translated">æ ¹æ®é˜Ÿåˆ—æ•°é‡ä¸ºvalueå‚æ•°èµ‹å€¼ã€‚åœ¨è¿™é‡Œï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›æŒ‰é¡ºåºæ‰§è¡Œï¼Œæ‰€ä»¥éœ€è¦é€ä¸ªå¯¹æ•°ç»„è¿›è¡Œæ’é˜Ÿã€‚å› æ­¤å°†å‚æ•°èµ‹å€¼ä¸º1ã€‚<code class="fe ni nj nk mz b">DispatchSemaphore(value: 1)</code></li><li id="00ef" class="mf mg iq kt b ku mq kx mr la ms le mt li mu lm mm mn mo mp bi translated">å°†APIè°ƒç”¨å°è£…åˆ°ä¸€ä¸ªå‡½æ•°ä¸­ã€‚è¿™é‡Œå‘½åä¸º<code class="fe ni nj nk mz b">fetchAPI(hexParam: String)</code></li><li id="c0b5" class="mf mg iq kt b ku mq kx mr la ms le mt li mu lm mm mn mo mp bi translated">åˆ›å»ºä¸€ä¸ªè°ƒç”¨å‡½æ•°çš„å¾ªç¯</li><li id="e4d6" class="mf mg iq kt b ku mq kx mr la ms le mt li mu lm mm mn mo mp bi translated">åœ¨è°ƒç”¨<code class="fe ni nj nk mz b">fetchAPI(hexParam: String)</code>ä¹‹å‰ï¼Œåˆ†é…<code class="fe ni nj nk mz b">semaphore.wait()</code>åˆå§‹åŒ–é˜Ÿåˆ—</li><li id="5bc9" class="mf mg iq kt b ku mq kx mr la ms le mt li mu lm mm mn mo mp bi translated">åˆ†é…<code class="fe ni nj nk mz b">semaphore.signal()</code>ç»§ç»­<code class="fe ni nj nk mz b">.resume()</code>ä¹‹å‰çš„é˜Ÿåˆ—</li></ul><pre class="kg kh ki kj gt my mz na bn nb nc bi"><span id="39c9" class="nd lo iq mz b be ne nf l ng nh">let hexArr = ["FFFFFF", "000000", "FF0000", "00FF00", "0000FF"]<br/>// White, Black, Red, Green, Blue<br/><br/>// Assign the semaphore variable<br/>let semaphore = DispatchSemaphore(value: 1)<br/><br/>for hex in hexArr {<br/>    semaphore.wait() // Initiate the queue<br/>    fetchAPI(hexParam: hex)<br/>}<br/><br/>func fetchAPI(hexParam: String) -&gt; Void {<br/><br/>    let url = URL(string: "https://www.thecolorapi.com/id?hex=\(hexParam)")!<br/>    var request = URLRequest(url: url)<br/>    request.httpMethod = "GET"<br/>    <br/>    URLSession.shared.dataTask(with: request) { data, response, error in<br/>        <br/>        let json = try! JSONSerialization.jsonObject(with: data!) as! [String:Any]<br/>        <br/>        let name = json["name"] as! [String:Any]<br/>        let nameValue = name["value"] as! String<br/>        <br/>        DispatchQueue.main.async {<br/>            print(nameValue)<br/>        }<br/><br/>        semaphore.signal() // Continue the queue<br/>        <br/>    }.resume()<br/><br/>}</span></pre><h1 id="6f4a" class="ln lo iq bd lp lq lr ls lt lu lv lw lx jw ly jx lz jz ma ka mb kc mc kd md me bi translated">å®Œæˆå¤„ç†ç¨‹åº</h1><p id="2155" class="pw-post-body-paragraph kr ks iq kt b ku mh jr kw kx mi ju kz la mv lc ld le mw lg lh li mx lk ll lm ij bi translated">å¦‚æœæˆ‘ä»¬æƒ³åœ¨ä¸€ä¸ªAPIè°ƒç”¨ä¸­é‡ç”¨è¿™ä¸ªå‡½æ•°å‘¢ï¼Ÿæˆ‘ä»¬æ€æ ·æ‰èƒ½åœ¨å‡½æ•°ä¸­åˆ é™¤<code class="fe ni nj nk mz b">semaphore.signal()</code>ï¼ŒåŒæ—¶è¿˜èƒ½åƒä»¥å‰ä¸€æ ·åœ¨é“¾æ¥APIè°ƒç”¨æ—¶ä¼ é€’ä¿¡å·å‘¢ï¼Ÿ</p><p id="2d52" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¯¹äºè¿™ç§ç”¨æ³•ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å®Œæˆå¤„ç†ç¨‹åºã€‚</p><p id="57e7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ğŸ’¡å®Œæˆå¤„ç†ç¨‹åºå…è®¸æ‚¨å°†æŸäº›å‡½æ•°æˆ–ä»£ç è¡ŒåµŒå…¥åˆ°å‡½æ•°ä¸­çš„ä»»ä½•ä½ç½®ï¼Œè€Œä¸ä»…ä»…æ˜¯åœ¨å‡½æ•°è°ƒç”¨çš„æœ«å°¾ã€‚</p><p id="1950" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨å¤„ç†å¼‚æ­¥ä»»åŠ¡æ—¶ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å‚æ•°ä¸­ä½¿ç”¨<code class="fe ni nj nk mz b">@escaping</code>æ¥ç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆï¼Œç„¶åè¿è¡Œæˆ‘ä»¬çš„å®Œæˆå¤„ç†ç¨‹åºã€‚å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨<code class="fe ni nj nk mz b">@escaping</code>,å¤„ç†ç¨‹åºå°†ç«‹å³è¿è¡Œï¼Œè€Œä¸ä¼šåœ¨è¿è¡Œå¤„ç†ç¨‹åºä¹‹å‰ç­‰å¾…å¼‚æ­¥ä»»åŠ¡å®Œæˆã€‚</p><p id="6dce" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å› ä¸ºæˆ‘ä»¬å°†<code class="fe ni nj nk mz b">finished()</code>å¤„ç†ç¨‹åºæ”¾åœ¨ä¸€ä¸ªå¼‚æ­¥çš„URLSessioné—­åŒ…å†…ï¼Œæ²¡æœ‰<code class="fe ni nj nk mz b">@escaping</code>å…³é”®å­—ï¼ŒXcodeå°†è¿”å›ä¸€ä¸ªé”™è¯¯:</p><pre class="kg kh ki kj gt my mz nm nn aw no bi"><span id="3dff" class="np lo iq mz b gy nq nr l ns nh">expression failed to parse:<br/>error: MyPlayground.playground:21:47: error: escaping closure captures non-escaping parameter 'finished'<br/>    URLSession.shared.dataTask(with: request) { data, response, error in<br/>                                              ^<br/><br/>MyPlayground.playground:15:47: note: parameter 'finished' is implicitly non-escaping<br/>func fetchAPIUsingSemaphore(hexParam: String, finished: () -&gt; Void) -&gt; Void {<br/>                                              ^<br/><br/>MyPlayground.playground:32:9: note: captured here<br/>        finished()<br/>        ^</span></pre><p id="ad31" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å› æ­¤ï¼Œä¸‹é¢æ˜¯å®ç°ç¤ºä¾‹:</p><pre class="kg kh ki kj gt my mz na bn nb nc bi"><span id="a0b7" class="nd lo iq mz b be ne nf l ng nh">myFunction() {<br/>    // Code to inject to the function<br/>}<br/><br/>func myFunction(finished: @escaping() -&gt; Void) -&gt; Void {<br/><br/>    URLSession.shared.dataTask(with: request) { data, response, error in<br/>    <br/>        // Any process handling the data<br/>        <br/>        finished() // Put where you want any code injected to the function<br/>        <br/>    }.resume()<br/><br/>}</span></pre><p id="daa4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿™é‡Œï¼Œæˆ‘ä»¬æƒ³åœ¨<code class="fe ni nj nk mz b">fetchAPI</code>å‡½æ•°æ¢å¤ä¹‹å‰æ³¨å…¥<code class="fe ni nj nk mz b">semaphore.signal()</code>ã€‚</p><p id="781c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åˆ›å»ºä¸€ä¸ªé—­åŒ…ï¼Œå¹¶å°†ä¿¡å·æ”¾åœ¨é—­åŒ…å†…ï¼Œå½“ä»£ç åˆ°è¾¾<code class="fe ni nj nk mz b">finished().</code>æ—¶ï¼Œé—­åŒ…å°±ä¼šè¿è¡Œ</p><p id="2db7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¯¹äºå•ä¸ªAPIè°ƒç”¨ï¼Œåªéœ€è°ƒç”¨å‡½æ•°å¹¶ç»™å®ƒä¸€ä¸ªç©ºé—­åŒ…ã€‚</p><pre class="kg kh ki kj gt my mz na bn nb nc bi"><span id="4cbb" class="nd lo iq mz b be ne nf l ng nh">let hexArr = ["FFFFFF", "000000", "FF0000", "00FF00", "0000FF"]<br/>// White, Black, Red, Green, Blue<br/><br/>let semaphore = DispatchSemaphore(value: 1)<br/><br/>// Looping and chaining the API Call<br/>for hex in hexArr {<br/>		semaphore.wait()<br/>    fetchAPI(hexParam: hex) {<br/>				// Injecting semaphore.signal to the function<br/>        semaphore.signal()<br/>    }<br/>}<br/><br/>// Single API Call. Just give an empty closure<br/>fetchAPI(hexParam: "FAFAFA"){}<br/><br/>func fetchAPI(hexParam: String, finished: @escaping() -&gt; Void) -&gt; Void {<br/><br/>    let url = URL(string: "https://www.thecolorapi.com/id?hex=\(hexParam)")!<br/>    var request = URLRequest(url: url)<br/>    request.httpMethod = "GET"<br/>    <br/>    URLSession.shared.dataTask(with: request) { data, response, error in<br/>        <br/>        let json = try! JSONSerialization.jsonObject(with: data!) as! [String:Any]<br/>        <br/>        let name = json["name"] as! [String:Any]<br/>        let nameValue = name["value"] as! String<br/>        <br/>        DispatchQueue.main.async {<br/>            print(nameValue)<br/>        }<br/>        <br/>        finished()<br/>        <br/>    }.resume()<br/><br/>}</span></pre><p id="9c41" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ç§ï¼Œç«äº‰æ¡ä»¶å·²ç»å¤„ç†å¥½äº†ï¼Œæ‚¨çš„APIè¯·æ±‚å°†æŒ‰é¡ºåºè·å–ã€‚</p><p id="9b76" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æ„Ÿè°¢é˜…è¯»ã€‚</p></div><div class="ab cl od oe hu of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="ij ik il im in"><p id="0d54" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Colorioæ˜¯ä¸€ä¸ªè°ƒè‰²æ¿ç”Ÿæˆå™¨ï¼Œä¸ºä½ çš„å®Œç¾è‰²å½©æ—¥æä¾›æ—¥å¸¸å»ºè®®ã€‚æˆ‘ä»¬å»ºè®®ä»ä½ çš„åŸºç¡€ä¸Šé€‰æ‹©å®Œç¾çš„è‰²è°ƒå’Œå·§å¦™çš„ç»„åˆï¼Œå¢åŠ ä¸ªäººé£æ ¼çš„æ„Ÿè§‰ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥é€‰æ‹©æ‚¨éœ€è¦çš„äº§å“â€”â€”æ‚¨çš„åº•åº§ï¼Œæˆ–è€…æˆ‘ä»¬çš„ç²¾é€‰äº§å“ã€‚</p><p id="1957" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nt">è¿™ä¸ªåº”ç”¨ç¨‹åºä¸»è¦ç”±ä¸¤ä¸ªAPIæä¾›æ”¯æŒï¼Œä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°åº”ç”¨ç¨‹åºçš„æºä»£ç â€”</em><a class="ae nl" href="https://github.com/gal-bert/Colorio" rel="noopener ugc nofollow" target="_blank"><em class="nt">GitHubâ€”gal-Bert/Colorio</em></a><em class="nt">ã€‚</em></p></div><div class="ab cl od oe hu of" role="separator"><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi oj"/><span class="og bw bk oh oi"/></div><div class="ij ik il im in"><p id="2b73" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="nt">åŸè½½äº</em><a class="ae nl" href="https://gist.github.com/gal-bert/474cadda5664bcbc41622fd84c9c252d" rel="noopener ugc nofollow" target="_blank"><em class="nt">http://github.com</em></a><em class="nt">ã€‚</em></p></div></div>    
</body>
</html>