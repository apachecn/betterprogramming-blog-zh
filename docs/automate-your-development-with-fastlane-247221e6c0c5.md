# ä½¿ç”¨æµªå­è‡ªåŠ¨åŒ–æ‚¨çš„å¼€å‘

> åŸæ–‡ï¼š<https://betterprogramming.pub/automate-your-development-with-fastlane-247221e6c0c5>

## åœ¨ Android å¼€å‘è¿‡ç¨‹ä¸­å®ç°æ›´å¿«çš„åé¦ˆå¾ªç¯

![](img/cd985457f81b31e855cb8ccd4510d014.png)

æˆ‘å°†è®¨è®º fastlane å¦‚ä½•åœ¨æå‡ºåˆå¹¶è¯·æ±‚ä¹‹å‰å¸®åŠ©è‡ªåŠ¨åŒ–æ‚¨çš„å¼€å‘éªŒè¯ã€‚

# åœ¨æŒç»­é›†æˆä¸­å‘å±•

æ„å»ºè½¯ä»¶åº”ç”¨ç¨‹åºæ˜¯ä¸€é¡¹è‰°å·¨çš„ä»»åŠ¡ã€‚å®ƒéœ€è¦åŒè¡Œçš„è®¡åˆ’ã€æµ‹è¯•å’Œè¯„å®¡ã€‚éšç€åº”ç”¨ç¨‹åºçš„å¢é•¿ï¼Œç»´æŠ¤åº”ç”¨ç¨‹åºæ‰€éœ€çš„å·¥ä½œé‡ä¹Ÿä¼šå¢åŠ ã€‚å› æ­¤ï¼Œåœ¨å¼€å‘å‘¨æœŸçš„åæœŸï¼Œæ·»åŠ æ–°ç‰¹æ€§æˆ–ç¡®ä¿ä»£ç åº“æ²¡æœ‰é”™è¯¯å¼€å§‹å˜å¾—æ›´åŠ æ˜‚è´µã€‚ä¸ºäº†å°½æ—©å‘ç°é—®é¢˜ï¼Œè½¯ä»¶å¼€å‘äººå‘˜éµå¾ªæŒç»­é›†æˆçš„å®è·µæ¥å¤§è§„æ¨¡æ„å»ºè½¯ä»¶åº”ç”¨ç¨‹åºã€‚

# æŒç»­é›†æˆçš„æ„å»ºæ¨¡å—

æºä»£ç æ§åˆ¶â€”â€”èƒ½å¤Ÿè·Ÿè¸ªã€ç®¡ç†å¤šä¸ªå¼€å‘äººå‘˜çš„æºä»£ç ï¼Œå¹¶å°†å…¶åˆå¹¶åˆ°ä»£ç åº“çš„ä¸»ç‰ˆæœ¬ä¸­ã€‚

è‡ªåŠ¨åŒ–æµ‹è¯•â€”â€”æœ‰ä¿¡å¿ƒç¡®ä¿æ–°çš„å˜åŒ–ä¸ä¼šç ´åç°æœ‰çš„ç‰¹æ€§ï¼Œä¹Ÿä¸ä¼šåœ¨åº”ç”¨ç¨‹åºä¸­å¼•å…¥æ–°çš„ bugã€‚

ç®¡é“éªŒè¯â€”éªŒè¯åº”ç”¨ç¨‹åºæ˜¯å¦å¯ä»¥æ„å»ºã€ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€ç¬¦åˆè´¨é‡æ ‡å‡†å¹¶ä¸”ä¸åŒ…å«ä»»ä½• lint é—®é¢˜ã€‚

åœ¨ç†æƒ³çš„å¼€å‘ç¯å¢ƒä¸­ï¼Œå‘å­˜å‚¨åº“æäº¤å˜æ›´æ¶‰åŠåˆ°ä¸€ä¸ªæ‰“å¼€åˆå¹¶è¯·æ±‚çš„è¿‡ç¨‹ï¼Œç„¶åè§¦å‘ä¸€ä¸ª CI ç®¡é“æ¥éªŒè¯æ‰€æœ‰æŒ‡å®šçš„æ ‡å‡†ã€‚å¯ä»¥ä½¿ç”¨çš„é…ç½®é¡¹ç±»å‹æœ‰ GitLab CI/CDã€Travis CIã€CircleCIã€GitHub Actions ç­‰ç­‰ã€‚

# å¿«é€Ÿæ„å»ºï¼Œç»å¸¸æ„å»º

åœ¨å¼€å‘è½¯ä»¶æ—¶ï¼Œä½¿ç”¨ CI æœ‰å¾ˆå¤šå¥½å¤„ã€‚å®ƒä¸ä»…å¯ä»¥åœ¨è¿‡ç¨‹çš„æ—©æœŸå‘ç°é—®é¢˜ï¼Œè¿˜å¯ä»¥é€šè¿‡ä¸€ç³»åˆ—è‡ªåŠ¨åŒ–ä»»åŠ¡åŠ é€ŸéªŒè¯è¿‡ç¨‹ã€‚ç„¶è€Œï¼Œä»…ä»…ä¾é  CI æ¸ é“æ¥éªŒè¯ä»–ä»¬çš„å·¥ä½œçš„å›¢é˜Ÿä¼šå‘ç°ä»–ä»¬è‡ªå·±å¤„äºä¸€ç§æ²¡æœ‰ç”Ÿäº§åŠ›çš„çŠ¶æ€ã€‚

ä½¿ç”¨ CI æœåŠ¡å™¨é€šå¸¸æ˜¯ä¸€ä¸ªèµ„æºå¯†é›†å‹è¿‡ç¨‹ã€‚éœ€è¦å¯åŠ¨ç®¡é“è¿è¡Œç¨‹åºï¼Œå¹¶ä¸‹è½½æ‰€éœ€çš„ä¾èµ–é¡¹æ¥æ‰§è¡Œæ‰‹å¤´çš„ä»»åŠ¡ã€‚æ­¤å¤–ï¼Œå¦‚æœç®¡é“åœ¨åæœŸå‡ºç°æ•…éšœï¼Œå¼€å‘äººå‘˜å°†éœ€è¦è¿›è¡Œä¿®å¤å¹¶é‡æ–°è¿è¡Œæ•´ä¸ªç®¡é“ã€‚

ç›¸åï¼Œå¼€å‘äººå‘˜åº”è¯¥è¢«æˆæƒåœ¨ä»–ä»¬çš„æœºå™¨ä¸Šæœ¬åœ°æ‰§è¡Œä»–ä»¬çš„ CI ç®¡é“ï¼Œä»¥ç¡®ä¿ä»–ä»¬çš„å·¥ä½œåœ¨æäº¤åˆå¹¶è¯·æ±‚ä¹‹å‰å¾—åˆ°éªŒè¯ã€‚ä¸‹é¢æ˜¯æˆ‘æœ€å–œæ¬¢çš„ Gene Kimã€Jez Humbleã€Patrick Debois å’Œ John Willis çš„ã€ŠDevOps æ‰‹å†Œã€‹ä¸­çš„ä¸€æ®µè¯ã€‚

> åœ¨ DevOps ideal ä¸­ï¼Œå¼€å‘äººå‘˜ä¼šæ”¶åˆ°å¿«é€Ÿã€æŒç»­çš„å·¥ä½œåé¦ˆï¼Œè¿™ä½¿ä»–ä»¬èƒ½å¤Ÿå¿«é€Ÿã€ç‹¬ç«‹åœ°å®ç°ã€é›†æˆå’ŒéªŒè¯ä»–ä»¬çš„ä»£ç ï¼Œå¹¶å°†ä»£ç éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒä¸­ã€‚

# æµªå­

æ„å»ºæœ¬åœ° CI ç®¡é“å¯ä»¥é€šè¿‡ fastlane ç®€å•å®ç°ï¼Œfast lane æ˜¯ä¸€ä¸ªå¼€æºå·¥å…·ï¼Œå¯ä»¥è‡ªåŠ¨å®Œæˆç§»åŠ¨åº”ç”¨ç¨‹åºçš„ç¹çæ„å»ºå’Œå‘å¸ƒä»»åŠ¡ã€‚è™½ç„¶ fastlane åœ¨è‡ªåŠ¨åŒ–å±å¹•æˆªå›¾ã€æµ‹è¯•ç‰ˆéƒ¨ç½²ã€åº”ç”¨å•†åº—éƒ¨ç½²å’Œä»£ç ç­¾åæ–¹é¢å¾ˆå—æ¬¢è¿ï¼Œä½†å®ƒä¹Ÿå¯ä»¥å¸®åŠ©è‡ªåŠ¨åŒ–æœ¬åœ°ç®¡é“ä¸­æ‰€éœ€çš„ä»»åŠ¡ã€‚

ä¸€æ—¦åœ¨é¡¹ç›®ä¸­å®‰è£…å¹¶åˆå§‹åŒ–äº† fastlaneï¼Œå°±å¯ä»¥åƒä¸‹é¢è¿™æ ·è½»æ¾åœ°æ‰§è¡Œå‘½ä»¤ã€‚

```
fastlane tests
```

æ‰§è¡Œä¸åœ¨`fastlane/Fastfile`ä¸­å®šä¹‰çš„`test`é€šé“ç›¸å…³ã€‚

```
lane :tests do   
  gradle(task: "test") 
end
```

äº†è§£å¦‚ä½•[å¼€å§‹](https://docs.fastlane.tools/)ä½¿ç”¨å¿«è½¦é“ã€‚

# æ›´å¿«çš„åé¦ˆ

åœ¨æœ¬åœ°æ‰§è¡Œ CI ç®¡é“èµ‹äºˆäº†å¼€å‘äººå‘˜ä»–ä»¬æ‰€æ„å»ºçš„ä¸œè¥¿çš„æ‰€æœ‰æƒã€‚å®ƒä»¥æ›´å¿«çš„é€Ÿåº¦äº§ç”Ÿåé¦ˆï¼Œå¹¶ä¸ºåœ¨æ›´çŸ­çš„æ—¶é—´å†…è°ƒè¯•é—®é¢˜æä¾›äº†å¯èƒ½æ€§ã€‚æœ‰äº† fastlaneï¼Œå›¢é˜Ÿå¯ä»¥åƒåœ¨ CI æœåŠ¡å™¨ä¸Šä¸€æ ·ä½¿ç”¨ç›¸åŒçš„ Fastfileã€‚

## å°å··

åœ¨è¿™ä¸ªå¿«é€Ÿæ–‡ä»¶ä¸­ï¼Œå®šä¹‰äº†äº”ä¸ªä¸åŒçš„é€šé“ï¼Œå®ƒä»¬å¯¹åº”äºä¸€ä¸ªç‰¹å®šçš„ä½œä¸šã€‚ä¾‹å¦‚ï¼Œ`lint`é€šé“éªŒè¯æºä»£ç ä¸­æ²¡æœ‰ lint é—®é¢˜ã€‚lint é€šé“çš„æ‰§è¡Œå¯ä»¥åœ¨ä¸‹é¢æ‰¾åˆ°ã€‚

```
fastlane lint
```

é¢„æœŸç»“æœ:

```
[12:33:02]: -----------------------------------------[12:33:02]: --- Step: Switch to android lint lane ---[12:33:02]: -----------------------------------------[12:33:02]: Cruising over to lane 'android lint' ğŸš–[12:33:02]: --------------------[12:33:02]: --- Step: gradle ---[12:33:02]: --------------------[12:33:02]: $ gradlew lintDebug -p .[12:33:03]: â–¸ > Task :app:preBuild UP-TO-DATE[12:33:03]: â–¸ > Task :app:preDebugBuild UP-TO-DATE[12:33:03]: â–¸ > Task :app:compileDebugAidl NO-SOURCE[12:33:03]: â–¸ > Task :app:checkDebugManifest UP-TO-DATE[12:33:03]: â–¸ > Task :app:compileDebugRenderscript NO-SOURCE[12:33:03]: â–¸ > Task :app:generateDebugBuildConfig UP-TO-DATE[12:33:03]: â–¸ > Task :app:mainApkListPersistenceDebug UP-TO-DATE[12:33:03]: â–¸ > Task :app:generateDebugResValues UP-TO-DATE[12:33:03]: â–¸ > Task :app:generateDebugResources UP-TO-DATE[12:33:03]: â–¸ > Task :app:createDebugCompatibleScreenManifests UP-TO-DATE[12:33:03]: â–¸ > Task :app:mergeDebugResources UP-TO-DATE[12:33:03]: â–¸ > Task :app:processDebugManifest UP-TO-DATE[12:33:03]: â–¸ > Task :app:processDebugResources UP-TO-DATE[12:33:03]: â–¸ > Task :app:compileDebugKotlin UP-TO-DATE[12:33:03]: â–¸ > Task :app:javaPreCompileDebug UP-TO-DATE[12:33:03]: â–¸ > Task :app:compileDebugJavaWithJavac UP-TO-DATE[12:33:03]: â–¸ > Task :app:prepareLintJar UP-TO-DATE[12:33:06]: â–¸ > Task :app:lintDebug[12:33:06]: â–¸ Wrote HTML report to file:///.../app/build/reports/lint-results-debug.html[12:33:06]: â–¸ Wrote XML report to file:///.../app/build/reports/lint-results-debug.xml[12:33:06]: â–¸ BUILD SUCCESSFUL in 3s[12:33:06]: â–¸ 13 actionable tasks: 1 executed, 12 up-to-date
```

## ç®¡é“

é€šé“å¯ä½œä¸ºç‹¬ç«‹ä½œä¸šæˆ–å¦ä¸€ä¸ªé€šé“çš„ä¸€éƒ¨åˆ†æ‰§è¡Œã€‚åœ¨æœ¬ä¾‹ä¸­ï¼Œç®¡é“é€šé“ç”±äº”ä¸ªä¸åŒçš„é€šé“ç»„æˆã€‚è¿™äº›é€šé“æ‰§è¡Œä»£ç åº“çš„ç¼–è¯‘ï¼Œè¿è¡Œ lint åˆ†æï¼Œç»„è£… apkï¼Œæ‰§è¡Œå•å…ƒæµ‹è¯•ï¼Œå¹¶åœ¨ä»¿çœŸå™¨ä¸Šæ‰§è¡Œå·¥å…·æµ‹è¯•ã€‚ä¸ºæ–¹ä¾¿èµ·è§ï¼Œå¼€å‘äººå‘˜åªéœ€æ‰§è¡Œå¦‚ä¸‹æ‰€ç¤ºçš„ä¸€ä¸ªå‘½ä»¤ã€‚

```
fastlane lint
```

ä¸‹é¢æ˜¾ç¤ºäº†ç®¡é“çš„ Fastfile æ¨¡æ¿ã€‚

![](img/3bd4c57b1db63d1b17386764b8572965.png)

å¯ä»¥åœ¨ GitHub ä¸Šæ‰¾åˆ°æºä»£ç çš„å‰¯æœ¬ã€‚

[](https://github.com/asadmansr/android-fastlane) [## asadmansr/Android-å¿«è½¦é“

### æ­¤æ—¶æ‚¨ä¸èƒ½æ‰§è¡Œè¯¥æ“ä½œã€‚æ‚¨å·²ä½¿ç”¨å¦ä¸€ä¸ªæ ‡ç­¾é¡µæˆ–çª—å£ç™»å½•ã€‚æ‚¨å·²åœ¨å¦ä¸€ä¸ªé€‰é¡¹å¡ä¸­æ³¨é”€ï¼Œæˆ–è€…â€¦

github.com](https://github.com/asadmansr/android-fastlane) 

å› æ­¤ï¼Œç®¡é“çš„æ‰§è¡Œå°†äº§ç”Ÿå¦‚å›¾æ‰€ç¤ºçš„ç»“æœæ‘˜è¦ã€‚

![](img/cd985457f81b31e855cb8ccd4510d014.png)

è°¢è°¢å¤§å®¶ï¼