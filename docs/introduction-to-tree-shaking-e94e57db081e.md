# æ‘‡æ ‘å…¥é—¨

> åŸæ–‡ï¼š<https://betterprogramming.pub/introduction-to-tree-shaking-e94e57db081e>

## é€šè¿‡é™æ€åˆ†æåœ¨ç¼–è¯‘æ—¶åˆ é™¤æœªä½¿ç”¨æˆ–ä¸å¯è®¿é—®çš„ä»£ç ã€‚

![](img/205805ea33af09fd355ca04a9a553544.png)

[çº¦ç¿°Â·è¥¿é—¨å­](https://unsplash.com/@johannsiemens?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šçš„ç…§ç‰‡

# ä»‹ç»

ä»Šå¤©æˆ‘ä»¬æ¥çœ‹çœ‹æœ€å®¹æ˜“è¢«è¯¯è§£çš„å‡å°ä½“ç§¯çš„æ–¹æ³•ä¹‹ä¸€ï¼Œæ‘‡æ™ƒæ ‘æœ¨ã€‚æ ‘çš„æ™ƒåŠ¨å¼•èµ·äº†å¾ˆå¤šè®®è®ºï¼Œæ‰€ä»¥å€¼å¾—ç ”ç©¶ã€‚

> *æ³¨æ„:è¦è·å¾—æ›´å¤šå…³äºæŸå°ºå¯¸çš„å¸®åŠ©ï¼Œè¯·æŸ¥çœ‹* [*æµ‹é‡*](https://medium.com/better-programming/reducing-js-bundle-size-58dc39c10f9c) *å’Œ* [*æ­»ä»£ç æ¶ˆé™¤*](https://medium.com/better-programming/reducing-js-bundle-size-a6533c183296) *ï¼*

æˆ‘ä»¬å°†ç ”ç©¶æ ‘æŠ–åŠ¨æ„å‘³ç€ä»€ä¹ˆï¼Œå®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Œå®ƒå¦‚ä½•å¸®åŠ©æ¶ˆé™¤æ­»ä»£ç å’Œæ¨¡å—ä¾èµ–æ€§ï¼Œæœ€åï¼Œæˆ‘ä»¬åº”è¯¥ä»å®ƒé‚£é‡Œå¾—åˆ°ä»€ä¹ˆã€‚è®©æˆ‘ä»¬é¦–å…ˆå›é¡¾ä¸€ä¸‹æ­»ä»£ç æ¶ˆé™¤ã€‚

# æ­»ä»£ç æ¶ˆé™¤æ¦‚è¿°

åœ¨æœ¬ç³»åˆ—çš„ä¸Šä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬æ·±å…¥æ¢è®¨äº†ä»€ä¹ˆæ˜¯[æ­»ä»£ç æ¶ˆé™¤](https://medium.com/better-programming/reducing-js-bundle-size-a6533c183296) (DCE)ã€‚å°½ç®¡å¦‚æ­¤ï¼Œè®©æˆ‘ä»¬å¿«é€Ÿå›é¡¾ä¸€ä¸‹ DCE æ˜¯ä»€ä¹ˆï¼Œå› ä¸ºå®ƒå¯¹äºç†è§£æ ‘æ‘‡åŠ¨æ˜¯è‡³å…³é‡è¦çš„ï¼Œå› ä¸ºæ ‘æ‘‡åŠ¨ä½¿ç”¨ç›¸åŒçš„æŠ€æœ¯ã€‚

DCE æ˜¯åˆ é™¤æœªä½¿ç”¨æˆ–ä¸å¯è®¿é—®çš„ä»£ç çš„è¿‡ç¨‹ã€‚åƒ [Terser](https://github.com/terser-js/terser) è¿™æ ·çš„å·¥å…·é€šå¸¸ä¸ Webpack è¿™æ ·çš„æ„å»ºç³»ç»Ÿä¸€èµ·å¤„ç† DCEã€‚ä»¥ä¸‹æ˜¯ DCE çš„ä¸€ä¸ªä¾‹å­:

åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¸å¯èƒ½è¿”å›åˆ°`type: hat`ã€‚é‚£æ˜¯å› ä¸ºäº‹å…ˆæœ‰ elseï¼Œä½¿å¾—ä»£ç ä¸å¯è®¿é—®ã€‚Terser å°†å°è¯•ç¡®å®šè¿™ä¸€ç‚¹ï¼Œå¹¶åˆ é™¤è¿™äº›æœªä½¿ç”¨çš„ç¤ºä¾‹ã€‚

ç±»ä¼¼åœ°ï¼Œ`selectAccessory`å‡½æ•°åœ¨è¿™æ®µä»£ç ä¸­ä»æœªæ‰§è¡Œè¿‡ï¼Œå› æ­¤ä¹Ÿå¯ä»¥åˆ é™¤ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬å¯¹æ–‡ä»¶è¿è¡Œ Terserï¼Œæ‚¨ä¼šæ³¨æ„åˆ°å®ƒæ²¡æœ‰è¢«åˆ é™¤ã€‚

ä¸ºä»€ä¹ˆè¿™ä¸ªæ²¡æœ‰è¢«ç§»é™¤ï¼Ÿå› ä¸º Terser ä¸æ˜¯æ­£æ•°ï¼Œæ‰€ä»¥è¿™ä¸ªå‡½æ•°ä¸ä¼šåœ¨å…¶ä»–åœ°æ–¹ä½¿ç”¨ï¼Œä¹Ÿä¸ä¼šè¿›è¡Œé‚£ä¸ªè°ƒç”¨ã€‚å®ƒåªåˆ é™¤å®ƒèƒ½ä¿è¯ä¸ä¼šè¢«ä½¿ç”¨çš„ä»£ç ã€‚å¦‚æœæœ‰ä»»ä½•æ­§ä¹‰ï¼Œå®ƒå°†ä¸ä¼šé‡‡å–ä»»ä½•è¡ŒåŠ¨ã€‚

æˆ‘ä»¬éœ€è¦çš„æ˜¯å°†è¿™ä¸ªæ–‡ä»¶éš”ç¦»ä¸ºä¸€ä¸ªæ¨¡å—ã€‚å°è£…ä¸€ä¸ªæ–‡ä»¶å¯ä»¥ç”¨å‡ ç§ä¸åŒçš„æ¨¡å—é£æ ¼æ¥å®Œæˆï¼Œä½†æ˜¯ [CommonJS](https://nodejs.org/docs/latest/api/modules.html) (CJS)å’Œ [ECMAScript æ¨¡å—](https://exploringjs.com/es6/ch_modules.html) (ESM)æ— ç–‘æ˜¯æœ€å—æ¬¢è¿çš„ï¼ŒESM æ˜¯å‰ç«¯çš„æ ‡å‡†ï¼ŒCJS ä»ç„¶æ™®éç”¨äº [NodeJS](https://nodejs.org/en/) ã€‚

ä¸ç®¡æ€æ ·ï¼Œåœ¨è¿™ä¸€ç‚¹ä¸Šï¼Œä½ ç”šè‡³ä¸éœ€è¦çŸ¥é“è¿™æ˜¯ä»€ä¹ˆé£æ ¼ã€‚é€šè¿‡ä½¿ç”¨ [Webpack](https://webpack.js.org/) è¿è¡Œæ„å»ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä¸åŒä¹‹å¤„ã€‚

> *å¯¹äºæ‰€æœ‰çš„ Webpack ç¤ºä¾‹ï¼Œæˆ‘å°†ä¿æŒä»£ç ä¸å˜ã€‚é‚£æ˜¯å› ä¸ºæˆ‘æƒ³ç»™å‡ºè¿™æ®µä»£ç çš„æ ·å­ã€‚æˆ‘å·²ç»ç”¨* `*console.log(name)*` *ä¸ºæˆ‘ä»¬æä¾›äº†ç‹©çŒçš„åœ°ç‚¹ã€‚*

Webpack åšäº†å¾ˆå¤šä¼˜åŒ–ï¼Œæ‰€ä»¥ä»£ç è¯»èµ·æ¥å¯èƒ½æœ‰ç‚¹æ£˜æ‰‹ï¼Œä½†æ˜¯è¯·æ³¨æ„ï¼Œç°åœ¨å·²ç»æ²¡æœ‰`type:ring`çš„å®ä¾‹äº†ã€‚å®ƒæ„è¯†åˆ°è¿™ä¸ªå‡½æ•°ä»æ¥æ²¡æœ‰åœ¨æ¨¡å—å†…éƒ¨è°ƒç”¨è¿‡ï¼Œå¹¶æ¶ˆé™¤äº†å®ƒã€‚

> *æ³¨æ„:æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†æŒ‰ç…§ ESM é£æ ¼è°ƒç”¨è¿™äº›*æ¨¡å—ï¼Œ*ã€‚å‡è®¾è¿™äº›éƒ½æ˜¯å°è£…çš„éƒ¨åˆ†ï¼Œä¼šè®©ä»–ä»¬æƒ³èµ·æ¥æ›´èˆ’æœã€‚æˆ‘ä»¬å°†å¾ˆå¿«è®¨è®ºä¸ºä»€ä¹ˆè¦ä½¿ç”¨ ESMã€‚*

# é‚£ä¹ˆä»€ä¹ˆæ˜¯æ ‘æ‘‡åŠ¨å‘¢ï¼Ÿ

æˆ‘å‘ç°è€ƒè™‘è¿™ä¸ªé—®é¢˜çš„æœ€ç®€å•çš„æ–¹æ³•æ˜¯æŠŠå®ƒæƒ³è±¡æˆè·¨æ¨¡å—çš„æ­»ä»£ç æ¶ˆé™¤ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬çš„æ­»ä»£ç æ¶ˆé™¤åªå¯¹ç»™å®šçš„æ¨¡å—å†…éƒ¨æœ‰æ•ˆã€‚å®ƒå°†æ£€æŸ¥ä»£ç æ˜¯å¦ä¸å¯è®¿é—®æˆ–è¢«è°ƒç”¨ï¼Œå¹¶ä»è¯¥æ¨¡å—ä¸­åˆ é™¤å®ƒã€‚

ä½†æ˜¯å¦‚æœæˆ‘ä»¬æœ‰ä¸€ä¸ªæ°¸è¿œä¸ä¼šè¢«è°ƒç”¨çš„æ¨¡å—å‘¢ï¼Ÿè¿˜æ˜¯åªæœ‰ä¸€å°éƒ¨åˆ†æ˜¯ï¼Ÿé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥ä»æˆ‘ä»¬çš„ä»£ç åº“ä¸­ç§»é™¤å®ƒæˆ–è€…æœªä½¿ç”¨æ¨¡å—ä¸­æœªä½¿ç”¨çš„éƒ¨åˆ†å—ï¼Ÿ

ç­”æ¡ˆæ˜¯â€œæ˜¯çš„â€ï¼Œå…¶ä¸­ä¸€äº›å¯èƒ½å·²ç»åœ¨ youâ å‘ç”Ÿäº†â€”â€”åªæ˜¯ä½ ä¸çŸ¥é“è€Œå·²ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹è¿™æ˜¯å¦‚ä½•å®ç°çš„ï¼Œä»¥åŠè¿™å¯¹æ‚¨æœ‰ä½•ç”¨å¤„ã€‚æˆ‘ä»¬å°†éµå¾ªä»¥ä¸‹æ­¥éª¤æ¥å®ç°è¿™ä¸€ç›®æ ‡:

*   ç†è§£ä¸ºä»€ä¹ˆç§°ä¹‹ä¸ºæ‘‡æ ‘ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½ä»æ ¹æœ¬ä¸Šç†è§£æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä»€ä¹ˆ
*   å¦‚ä½•ä»¥ä¸€ç§å…è®¸æœ€ä½³æ ‘æŠ–åŠ¨çš„æ–¹å¼ç¼–ç 
*   æŸ¥çœ‹è¿™ç§é£æ ¼çš„ä»£ç ç¤ºä¾‹
*   è°ƒæŸ¥ä»€ä¹ˆæ ·çš„åœºæ™¯æœ€æœ‰åˆ©äºæ ‘æ‘‡åŠ¨çš„åº”ç”¨

# ä¸ºä»€ä¹ˆå«æ ‘æ‘‡ï¼Ÿ

è®©æˆ‘ä»¬åœä¸‹æ¥æ€è€ƒä¸€ä¸‹æ¨¡å—ä¾èµ–æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚æ‚¨å‘Šè¯‰ Webpack å®ƒåº”è¯¥æŸ¥æ‰¾çš„ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼Œé€šå¸¸ç±»ä¼¼äº`src/index.js`ã€‚ä»é‚£é‡Œï¼ŒWebpack å°†æ‰“å¼€è¯¥æ–‡ä»¶ï¼Œå¹¶å¯èƒ½æ³¨æ„åˆ°æ‚¨æ­£åœ¨å¯¼å…¥`a.js`ã€‚ç„¶åå®ƒä¼šæ³¨æ„åˆ°`index`ä¾èµ–äº`a.js`ã€‚åœ¨`index`ä¹‹åï¼ŒWebpack å°†æŸ¥çœ‹`a.js`å¹¶æ‰«æå®ƒçš„ä¾èµ–æ€§ã€‚

> *æ³¨æ„:æ ¹æ®æ¨¡å—ç³»ç»Ÿçš„ä¸åŒï¼Œä¼šæœ‰ä¸€äº›å¼‚æ­¥åŠ è½½ï¼Œä½†ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬è¿˜æ˜¯åŒæ­¥è®¨è®ºä¸€ä¸‹ã€‚*

ä¸ºäº†æ›´å¥½åœ°ç†è§£è¿™ä¸€ç‚¹ï¼Œè®©æˆ‘ä»¬æ·»åŠ ä¸€äº›æ–‡ä»¶åˆ°æˆ‘ä»¬çš„å°é¡¹ç›®ä¸­ï¼Œå¹¶å¯¼å…¥ä¸€äº›æ–‡ä»¶ã€‚æ—¢ç„¶æˆ‘ä»¬å·²ç»æœ‰äº†`index.js`ï¼Œè®©æˆ‘ä»¬å†åšå››ä¸ªæ–‡ä»¶ï¼Œåˆ†åˆ«å‘½åä¸º`a.js`ã€`b.js`ã€`c.js`å’Œ`d.js`ã€‚ç„¶åæŒ‰ç…§ä¸‹é¢æ¯ä¸ªæ–‡ä»¶çš„æ­¥éª¤æ“ä½œ:

**a.js**

**b.js**

**c.js**

**æˆ´æ°**

**index.js**

å¾ˆå¥½ï¼Œæ‰€ä»¥çœ‹ä¸Šé¢çš„ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥æ˜ å°„å‡ºä¾èµ–å…³ç³»ã€‚æ¯ä¸ªæ¨¡å—å¯ä»¥ä¾èµ–äº`0...n`æ¨¡å—ã€‚è®©æˆ‘ä»¬å°†è¿™äº›ä¾èµ–å…³ç³»æ”¾åœ¨ä¸€ä¸ªè¡¨ä¸­ã€‚

![](img/23bbb36d57820737330166c157d0a322.png)

å®Œæˆç®€å•çš„ä¾èµ–å…³ç³»è¡¨åï¼Œè®©æˆ‘ä»¬å°†å…¶ç»˜åˆ¶æˆå›¾è¡¨ã€‚ä¸€ä¸ªåœ†åœˆä»£è¡¨æ¯ä¸ªæ¨¡å—ï¼Œä¸€æ¡çº¿ä»£è¡¨ä¸€ä¸ªä¾èµ–å…³ç³»ã€‚ç®­å¤´è¡¨ç¤ºå®ƒæ˜¯ dependee æ¨¡å—ã€‚åœ¨æˆ‘ä»¬çš„ä¾‹å­ä¸­ï¼Œå›¾è¡¨åº”è¯¥æ˜¯è¿™æ ·çš„:

![](img/b7e3cae91f3a3491aa497f3adf4d22fc.png)

çœ‹èµ·æ¥æœ‰ç‚¹åƒæ ‘ï¼Œä¸æ˜¯å—ï¼Ÿæˆ‘ä»¬çš„æ¨¡å—é›†ä»ç„¶å¾ˆå°ï¼Œå¹¶ä¸”ä¾èµ–å…³ç³»æœ‰äº›è¿é”ã€‚åœ¨æˆ‘ä»¬å‰è¿›ä¹‹å‰ï¼Œçœ‹åˆ°ä¸€äº›æ›´é‡è¦çš„é¡¹ç›®ï¼Œè·å¾—æ›´å¥½çš„è§†è§‰è¡¨ç°ï¼Œå°†æ˜¯å¾ˆæ–¹ä¾¿çš„ã€‚æœ‰ä¸€ä¸ªå¾ˆæ£’çš„å·¥å…·å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹:Webpack Analyzerã€‚å®ƒå°†ä¸ºæˆ‘ä»¬æ„å»ºè¿™äº›ä¾èµ–å›¾ã€‚é¦–å…ˆï¼Œåœ¨æˆ‘ä»¬é¡¹ç›®è¿è¡Œçš„æ ¹ä¸­:

ä¸Šè¿°å‘½ä»¤å°†åˆ›å»ºä¸€ä¸ª`webpack-state.json`æ–‡ä»¶ã€‚ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨åˆ†æå™¨ç½‘ç«™[è¿™é‡Œ](https://webpack.github.io/analyse/#home)ä¸Šä¼ è¿™ä¸ªã€‚ä½†æ˜¯å¦‚æœæ‚¨å¯¼èˆªåˆ° modules é€‰é¡¹å¡ï¼Œæ‚¨ä¼šæ³¨æ„åˆ°å®ƒçœ‹èµ·æ¥æœ‰ç‚¹ä¹å‘³:

![](img/9ff40c633452fe960c1cb063f7826e13.png)

å—¯ï¼Œæˆ‘ä»¬çš„ Webpack å°†è¿™äº›æ†ç»‘åœ¨ä¸€èµ·ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„å—ã€‚å› æ­¤ï¼Œæˆ‘ä»¬åªæŠŠå®ƒçœ‹ä½œä¸€ä¸ªç‚¹ã€‚ä½†æ˜¯æˆ‘ä»¬ç°åœ¨çŸ¥é“äº†è¿™ä¸ªè¿‡ç¨‹ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ä¸€ä¸ªæ›´é‡è¦çš„é¡¹ç›®ä¸Šå°è¯•ä¸€ä¸‹æ€ä¹ˆæ ·ï¼Ÿæˆ‘å‡†å¤‡åœ¨ [Boostnote](https://github.com/BoostIO/Boostnote) ä¸Šè¯•è¯•ï¼Œä¸€ä¸ªç”¨ [React](https://reactjs.org/) å†™çš„è·¨å¹³å° markdown ç¼–è¾‘å™¨ã€‚

é¦–å…ˆï¼Œæˆ‘ä»¬å°†ç”¨ä»¥ä¸‹ä»£ç å…‹éš† Boostnote:

å¦‚æœæˆ‘ä»¬å°†`webpack-stats`ä¸Šä¼ åˆ° Webpack åˆ†æå™¨ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ç±»ä¼¼è¿™æ ·çš„ç»“æœ:

![](img/19a971d94433ff640953ba5b16e3b308.png)

è¿™æ˜¯ä¸€æ£µæ ‘ã€‚ä¸å¹¸çš„æ˜¯ï¼Œ`main.js`å®é™…ä¸Šä½äºæ‰€æœ‰è¿™äº›ä¸­é—´ï¼Œå°†å®ƒåˆ›å»ºä¸ºä¸€ä¸ªå‘å¤–çš„ç½‘ç»œæ˜¯å¯¹ç©ºé—´çš„æœ€ä½³åˆ©ç”¨ã€‚ä½†æ˜¯å¦‚æœæˆ‘ä»¬æŠŠå®ƒæƒ³è±¡æˆåŸºç¡€ï¼Œä¸€åˆ‡éƒ½ä¼šä»¥ä¸€ç§æ›´ç»å…¸çš„æ ‘çš„å½¢å¼å‘å¤–æ‰©å±•ï¼Œæœ‰ä¸€ç»„èŠ‚ç‚¹å’Œå¶å­èŠ‚ç‚¹ã€‚

é‚£ä¹ˆè¿™å’Œæ ‘æ‘‡æ™ƒæœ‰ä»€ä¹ˆå…³ç³»å‘¢ï¼Ÿå¥½äº†ï¼Œç°åœ¨æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬çš„æ¨¡å—ç»“æ„æœ¬è´¨ä¸Šæ˜¯ç”±èŠ‚ç‚¹æ ‘ç»„æˆçš„ï¼Œå¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨ä¸€äº›ä¾èµ–ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿå†æ¬¡ç»™å‡ºæˆ‘ä»¬ä¸Šé¢çš„é¡¹ç›®:

![](img/81c7262d578ae0bc49c477d6746f9918.png)

å¦‚æœæˆ‘ä»¬ä¸å†ä¾èµ–`a -> c`ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿæˆ‘ä»¬çš„ä¾èµ–å›¾ç°åœ¨çœ‹èµ·æ¥åƒè¿™æ ·:

![](img/cabf64ddabb3ef52dce7d45dae4c0ebb.png)

è™½ç„¶`a -> c`ä¹‹é—´çš„ä¾èµ–ç°åœ¨å·²ç»ä¸å­˜åœ¨äº†ï¼Œä½†æ˜¯æ‰€æœ‰çš„æ¨¡å—ä»ç„¶ä»¥æŸç§æ–¹å¼è¢«éœ€è¦ã€‚å½“ Webpack è¿è¡Œæ‰€æœ‰æ¨¡å—æ—¶ï¼Œå®ƒä¼šè¯†åˆ«å‡ºæ¯ä¸ªæ¨¡å—éƒ½æ˜¯åœ¨æŸä¸ªç‚¹å¯¼å…¥çš„ï¼Œå¹¶å°†å®ƒä»¬æ·»åŠ åˆ°æˆ‘ä»¬çš„æ†ç»‘å—ä¸­ã€‚

è®©æˆ‘ä»¬è¿”å›æˆ‘ä»¬çš„`a -> c`ä¾èµ–é¡¹ï¼Œä½†æ˜¯ç°åœ¨ç§»é™¤æˆ‘ä»¬çš„`b -> d`ä¾èµ–é¡¹ã€‚ç°åœ¨ä¼šæœ‰ä»€ä¹ˆä¸åŒï¼Ÿ

![](img/745a02e0a12dbd818baed617a5f6cc26.png)

è¿™å°±æ˜¯æ™ƒåŠ¨æ ‘æœ¨å¼€å§‹å‘æŒ¥ä½œç”¨çš„åœ°æ–¹ã€‚å½“æˆ‘ä»¬æ„å»ºè¿™äº›æ ‘å’Œå®ƒä»¬çš„åŒ…æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»è®¤è¯†åˆ°ä¸€ä¸ªé‡è¦çš„å…³ç³»ã€‚

æˆ‘ä»¬ä»`index`å¼€å§‹(æˆ–è€…æˆ‘ä»¬å‘Šè¯‰ Webpack çš„ä»»ä½•ä¸œè¥¿éƒ½æ˜¯æˆ‘ä»¬çš„èµ·å§‹æ¨¡å—)ã€‚å›¾ä¸­çš„æ¯ä¸€æ­¥éƒ½æ˜¯ä¸€ä¸ª`dependsOn`å…³ç³»ã€‚åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œè™½ç„¶`d`ç¡®å®ä¾èµ–äº`c`ï¼Œä½†æ˜¯æ²¡æœ‰ä¾èµ–äº`d`çš„æ¨¡å—ã€‚å› æ­¤ï¼Œæ ‘ä¼šæ™ƒåŠ¨ï¼Œæˆ‘ä»¬å®é™…çš„æ ‘ä¼šæ˜¯:

![](img/68eb544850bea8463d73609a56510d05.png)

å‘ç”Ÿäº†æ ‘æŠ–åŠ¨ï¼Œæˆ‘ä»¬ä»ä¾èµ–å…³ç³»ä¸­ç§»é™¤äº†ä¸€ä¸ªä¸éœ€è¦çš„æ¨¡å—ã€‚è¿™æ˜¯ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œé‚£ä¹ˆå¤šé‡ä¾èµ–å‘¢ï¼Ÿè®©æˆ‘ä»¬æ·»åŠ å›æˆ‘ä»¬çš„`b -> d`ä¾èµ–é¡¹ï¼Œå¹¶ç§»é™¤æˆ‘ä»¬çš„`a -> b`ä¾èµ–é¡¹ã€‚

![](img/56e93b959a44561120839745d9d6116d.png)

å°±åƒä¸Šæ¬¡ä¸€æ ·ï¼Œè®©æˆ‘ä»¬æµè§ˆä¸€ä¸‹æ¨¡å—ï¼Œçœ‹çœ‹å®ƒä»¬çš„ä¾èµ–é¡¹ç°åœ¨åœ¨å“ªé‡Œã€‚é™¤äº†`b`ä¹‹å¤–ï¼Œæ¯ä¸ªæ¨¡å—éƒ½æœ‰ä¸€ä¸ª`dependsOn`å…³ç³»ã€‚å› æ­¤ï¼Œæ ‘ä¼šå‘ç”Ÿæ™ƒåŠ¨ï¼Œæˆ‘ä»¬å¾—åˆ°ä¸‹é¢çš„æ ‘:

![](img/62245defa40d0cb6e27715ed6706b647.png)

æˆ‘ä»¬çš„`d`æ¨¡å—æ€ä¹ˆäº†ï¼Ÿå¥½å§ï¼Œæ—¢ç„¶æ²¡æœ‰æ¨¡å—ä¾èµ–`b`ï¼Œå°±æŠŠå®ƒå»æ‰äº†ã€‚ä¸€æ—¦`b`è¢«ç§»é™¤ï¼Œä»æˆ‘ä»¬çš„åŸºåœ°(`index`)åˆ°`d`æ¨¡å—å°±å†ä¹Ÿæ²¡æœ‰è·¯å¾„äº†ã€‚å› æ­¤ï¼Œæ­£å¦‚ä½ æ‰€çœ‹åˆ°çš„ï¼Œå½“æˆ‘ä»¬â€œæ‘‡åŠ¨â€è¿™æ£µæ ‘æ—¶ï¼Œæˆ‘ä»¬ä»ä»£ç åº“ä¸­ç§»é™¤äº†æœªä½¿ç”¨çš„æ¨¡å—ã€‚

ç°åœ¨è¿™é‡Œæœ‰ä¸€ä¸ªé‡è¦çš„å…è´£å£°æ˜:ä¸Šé¢çš„ä¾‹å­å¹¶ä¸å®Œå…¨æ˜¯â€œæ ‘æ‘‡åŠ¨â€ä»æŠ€æœ¯æ„ä¹‰ä¸Šæ¥è¯´ï¼Œè¿™æ˜¯æ ‘æ‘‡åŠ¨ï¼Œä½†ä¸æ˜¯æˆ‘ä»¬é€šå¸¸æ‰€è¯´çš„æ ‘æ‘‡åŠ¨ã€‚ç›¸åï¼Œæˆ‘ä¸€ç›´åœ¨å‘æ‚¨å±•ç¤º[æ¨¡å—ä¾èµ–](https://en.wikipedia.org/wiki/Dependency_graph)ä»¥åŠæ‚¨çš„æ¨¡å—æ†ç»‘å™¨å°†å¦‚ä½•ä»è¿™äº›æ¨¡å—æ„å»ºä¾èµ–å›¾(å’Œæœ€ç»ˆæ†ç»‘åŒ…)ã€‚ä½†æ˜¯æˆ‘ä»¬å¾ˆæ¥è¿‘äº†ï¼Œä¸Šé¢çš„è¿‡ç¨‹æ˜¯æ ‘æ‘‡åŠ¨çš„åŸºç¡€ã€‚æˆ‘ä»¬åˆšåˆšè·³è¿‡äº†æ‘‡æ ‘è¿‡ç¨‹ä¸­çš„ä¸€ä¸ªæ­¥éª¤ï¼Œä»¥ä¾¿åœ¨è¾ƒé«˜å±‚æ¬¡ä¸Šæ›´å®¹æ˜“ç†è§£ã€‚

åœ¨è®¨è®ºæœ€åä¸€æ­¥ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä»€ä¹ˆæ˜¯é™æ€åˆ†æï¼Œä»¥åŠ ESM å¦‚ä½•åœ¨å…¶ä¸­å‘æŒ¥ä½œç”¨ã€‚

# CJS å¯¹æ¬§æ´²ç¨³å®šæœºåˆ¶

JavaScript ç”Ÿæ€ç³»ç»Ÿä¸­çš„æ¨¡å—ç³»ç»Ÿæœ‰ç›¸å½“é•¿ä¸”è¯¦ç»†çš„å†å²: [UMD](https://github.com/umdjs/umd) ã€ [AMD](https://requirejs.org/docs/whyamd.html) ã€CJSã€ESM ç­‰ç­‰ã€‚å…¶ä¸­ä¸€äº›ç³»ç»Ÿï¼Œå¦‚ AMDï¼Œåœ¨å‰ç«¯éå¸¸çªå‡ºï¼Œåƒ [RequireJS](https://requirejs.org/docs/whyamd.html) è¿™æ ·çš„å®ç°éå¸¸æµè¡Œã€‚

åŒæ—¶ï¼Œéšç€ Node è¶Šæ¥è¶Šå—æ¬¢è¿ï¼Œå®ƒçš„æ¨¡å—ç³»ç»Ÿ CommonJS ä¹Ÿè¶Šæ¥è¶Šå—æ¬¢è¿ã€‚CommonJS æœ€åˆè¢«æŒ‡å®šä¸¥æ ¼ç”¨äº NodeJSã€‚ä½†æ˜¯æ­£å¦‚ [NPM](https://www.npmjs.com/) åœ¨åå™¬[é²å°”](https://bower.io/)ä¹‹å‰æœ€åˆæ˜¯ä¸€ä¸ª NodeJS åŒ…ç®¡ç†ç³»ç»Ÿï¼ŒCJS ä¹Ÿæ˜¯è¿™æ ·èµ°åˆ°äº†å‰ç«¯ã€‚

æ›¾å‡ ä½•æ—¶ï¼ŒCJS é€šå¸¸æ˜¯æ„å»ºå‰ç«¯åº”ç”¨ç¨‹åºå’Œåº“çš„å®é™…æ–¹å¼ã€‚åƒ Webpack è¿™æ ·çš„æ¨¡å—æ†ç»‘å•†ç»å¸¸å‡è®¾ CJS å°†ä¼šæ˜¯è¢«ä½¿ç”¨çš„è§„èŒƒã€‚ä½†æ˜¯ CJS ä¸æ˜¯é™æ€å¯åˆ†æçš„ï¼Œå› ä¸ºå®ƒæ²¡æœ‰é™æ€ç»“æ„ã€‚é‚£æ˜¯ä»€ä¹ˆæ„æ€ï¼Ÿ

è®©æˆ‘ä»¬æ¥çœ‹ä¸€äº› CJS ä»£ç çš„ä¾‹å­:

åœ¨è¿è¡Œä¹‹å‰ï¼Œæˆ‘ä»¬æ— æ³•ç¡®å®š`y`å°†ä¼šæ˜¯ä»€ä¹ˆï¼Œä»¥åŠå®ƒä¼šå¯¼å…¥ä»€ä¹ˆã€‚å®ƒæœ‰ä¸€ä¸ª[åŠ¨æ€ç»“æ„](https://exploringjs.com/es6/ch_modules.html#static-module-structure)ã€‚æˆ‘ä»¬å¯¼å‡ºä»£ç çš„æ—¶å€™å‘¢ï¼Ÿ

åŒæ ·ï¼Œä»£ç æ˜¯åŠ¨æ€æ„é€ çš„ï¼›å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨è¿è¡Œæ—¶æ›´æ”¹æˆ‘ä»¬çš„å¯¼å‡ºã€‚æˆ‘ä»¬æ— æ³•è‚¯å®šè¿›å£æˆ–å‡ºå£çš„æ˜¯ä»€ä¹ˆï¼Œä½¿ç”¨çš„æ˜¯ä»€ä¹ˆã€‚è¿™äº›å€¼éƒ½å¯ä»¥åœ¨è¿è¡Œæ—¶æ”¹å˜ã€‚

ç„¶åæˆ‘ä»¬æ¥çœ‹ ECMAScript æ¨¡å—ã€‚ESM æ˜¯å·²ç»å·¥ä½œäº†ä¸€æ®µæ—¶é—´çš„æœ€æ–°è§„èŒƒï¼Œæ˜¯ ECMAScript çš„å®˜æ–¹ææ¡ˆã€‚ESM æ˜¯é™æ€ç»“æ„åŒ–çš„ï¼Œè¿™æ„å‘³ç€æ‰€æœ‰çš„å¯¼å…¥å’Œå¯¼å‡ºéƒ½å¿…é¡»åœ¨ç¼–è¯‘æ—¶(è€Œä¸æ˜¯è¿è¡Œæ—¶)å®šä¹‰ã€‚

å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥ä¿è¯å¯¼å…¥å’Œå¯¼å‡ºå“ªäº›æ¨¡å—ã€‚é™æ€ç»“æ„æœ‰å‡ ä¸ªç§¯æçš„å¥½å¤„ï¼Œä½†å®ƒä¹Ÿæ„å‘³ç€æˆ‘ä»¬å¯ä»¥åˆ†æä»£ç ï¼Œå¹¶ç¡®å®šåœ¨ç¼–è¯‘æ—¶ä½¿ç”¨å“ªäº›å¯¼å‡ºã€‚

> *æ³¨æ„:ESM æœ‰å¾ˆå¤šè¿™é‡Œæ²¡æœ‰æåˆ°çš„å¥½å¤„ï¼Œæ¯”å¦‚å¼‚æ­¥åŠ è½½ã€æ›´å¿«çš„æŸ¥æ‰¾ç­‰ã€‚æˆ‘ä»¬å°†åœ¨ä»¥åçš„æ–‡ç« ä¸­æ·±å…¥æ¢è®¨è¿™äº›é—®é¢˜ã€‚*

# è¿™åœ¨ä»£ç ä¸­æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿ

è®©æˆ‘ä»¬è·³å›åˆ°æˆ‘ä»¬ä¹‹å‰çš„ä¾‹å­`a.js`ã€`b.js`ã€`c.js`å’Œ`d.js`ã€‚å°±åƒæˆ‘åˆšæ‰è¯´çš„ï¼Œæˆ‘ä»¬è¿˜æ²¡æœ‰å®Œå…¨åšåˆ°æ‘‡æ ‘ã€‚æˆ‘ä»¬éµå¾ªä¸€ä¸ªæ¨¡å—ä¾èµ–é“¾ã€‚ä½†æ˜¯ï¼Œè®©æˆ‘ä»¬æŠŠæˆ‘ä»¬çš„ä¾‹å­æ›´è¿›ä¸€æ­¥ã€‚å‡è®¾æˆ‘ä»¬å›åˆ°äº†æœ€åˆçš„ä¾èµ–å…³ç³»ï¼Œå°±åƒè¿™æ ·:

![](img/47e0b0031fe9ce7b47b609a134e93134.png)

æˆ‘ä»¬æ¥çœ‹çœ‹`b.js`ä»£ç ã€‚

ä¸€åˆ‡éƒ½æ˜¯æ­£å¸¸çš„ï¼Œæˆ‘ä»¬çš„ä¾èµ–å›¾å‡†ç¡®åœ°è¡¨ç¤ºäº†æ¨¡å—ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨`d`å¹¶ä¸”æ²¡æœ‰ç§»é™¤`import`ï¼Œä¼šå‘ç”Ÿä»€ä¹ˆå‘¢ï¼Ÿåƒè¿™æ ·:

å¦‚æœè¿™æ˜¯ CJSï¼Œæˆ‘ä»¬ä»ç„¶ä¼šæœ‰å’Œä¸Šé¢ä¸€æ ·çš„å›¾è¡¨ï¼›å› ä¸ºæˆ‘ä»¬ä¸èƒ½ä¿è¯åœ¨è¿è¡Œæ—¶ï¼Œå®ƒä¼šä»¥æŸç§æ–¹å¼è¢«è°ƒç”¨ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ç¡®å®šå®ƒä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ç”¨ ESM è°ƒç”¨çš„ï¼Œå› æ­¤å¯ä»¥å……åˆ†åœ°å¯¹å®ƒè¿›è¡Œæ ‘æŠ–åŠ¨ã€‚

![](img/34e57493903157b0f3440e31b70be0f0.png)

è¿™æ˜¯æˆ‘ä»¬åœ¨ Webpack ä¸­æ†ç»‘åçš„ä¾‹å­ã€‚æ³¨æ„æ²¡æœ‰`console.log("This is d!")`ã€‚

æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹æœ€åä¸€ä¸ªæ ‘æŠ–åŠ¨çš„ä¾‹å­:æ ‘æŠ–åŠ¨ä¸€ä¸ªæœ‰å¤šä¸ªå¯¼å‡ºçš„æ¨¡å—ã€‚ç”±äºæ ‘æŠ–åŠ¨ä¹Ÿæ˜¯æ­»ä»£ç æ¶ˆé™¤çš„ä¸€éƒ¨åˆ†ï¼Œå¹¶ä¸”æˆ‘ä»¬å¯ä»¥é™æ€åœ°åˆ†ææˆ‘ä»¬çš„ä»£ç ï¼Œæ‰€ä»¥å®ƒä¸ä»…å¯ä»¥å¸®åŠ©å¤„ç†æ¨¡å—ä¾èµ–æ€§ï¼Œè¿˜å¯ä»¥å¸®åŠ©å‘ç°å“ªäº›ä»£ç å¯ä»¥è¢«æ¶ˆé™¤ã€‚æˆ‘ä»¬å°†å›åˆ°æœ€åˆçš„ç»“æ„ï¼Œä½†ä¼šç¨ä½œæ”¹åŠ¨:

**b.js**

è®©æˆ‘ä»¬æ›´æ–°æˆ‘ä»¬çš„`d.js` API æ¥åŒ¹é…:

**d.js**

ç°åœ¨ï¼Œæˆ‘ä»¬çš„æ­»ä»£ç æ¶ˆé™¤ä¸èƒ½åˆ é™¤å¯¼å‡ºçš„å‡½æ•°ï¼Œå› ä¸ºå®ƒä»¬å¯ä»¥åœ¨è¿™ä¸ªæ¨¡å—ä¹‹å¤–ä½¿ç”¨ã€‚å½“äººä»¬ä½¿ç”¨ CJS æ—¶ï¼Œæˆ‘ä»¬çš„ä»£ç ä¸æ˜¯é™æ€ç»“æ„åŒ–çš„ï¼›å› æ­¤ï¼Œæˆ‘ä»¬æ— æ³•ç¡®å®šä»£ç æ˜¯å¦è¢«ä½¿ç”¨è¿‡ï¼Œå°¤å…¶æ˜¯åœ¨ç¼–è¯‘ä¹‹å‰ã€‚

ä½†æ˜¯æœ‰äº† ESMï¼ŒWebpack(æˆ–å¤§å¤šæ•°æ¨¡å—æ†ç»‘å™¨)å¯ä»¥æ£€æŸ¥è¿™äº›ä»£ç ï¼Œå¹¶ç¡®å®šè¿™äº›å‡½æ•°æ˜¯å¦è¢«å¯¼å…¥æˆ–ä½¿ç”¨è¿‡ã€‚å¦‚æœå®ƒä»¬æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå°±åƒä¸Šé¢çš„`multiply`ä¸€æ ·ï¼Œæ ‘æŠ–åŠ¨å‘ç”Ÿï¼Œå¯¼å‡ºè¯­æ³•è¢«åˆ é™¤ã€‚æ­»ä»£ç æ¶ˆé™¤ç…§å¸¸æ¥ç®¡ï¼Œå¹¶æ³¨æ„åˆ°è¯¥å‡½æ•°æ²¡æœ‰è¢«ä½¿ç”¨ï¼Œå¹¶å°†å®ƒä»ä»£ç åº“ä¸­åˆ é™¤ã€‚è®©æˆ‘ä»¬é€šè¿‡è¿è¡Œä¸‹é¢çš„å‘½ä»¤æ¥çœ‹çœ‹å®ƒçš„è¿è¡Œæƒ…å†µ:

æ³¨æ„ä¸Šé¢çš„`console.log('multiply')`å¹¶ä¸å­˜åœ¨ã€‚æ‘‡æ ‘ä¸ºæˆ‘ä»¬ç§»é™¤äº†ä»£ç ã€‚ä¾èµ–å›¾æ˜¯ä»€ä¹ˆæ ·å­çš„ï¼Ÿå—¯ï¼Œå®ƒçœ‹èµ·æ¥åƒæˆ‘ä»¬çš„åŸå§‹å›¾ï¼Œåªæ˜¯ä»`d`æ¨¡å—ä¸­åˆ é™¤äº†æ­»ä»£ç :

![](img/6bfebbefab7b6d6be156924dabe86e2e.png)

# ä½œä¸ºä¸€ç§ä¼˜åŒ–ï¼Œè¦å°å¿ƒæ‘‡æ™ƒé‡‡æ²¹æ ‘

ç°åœ¨ä½ æ˜ç™½äº†ä»€ä¹ˆæ˜¯æ‘‡æ ‘ï¼Œä»¥åŠå®ƒå¯¹æˆ‘ä»¬æœ‰ä»€ä¹ˆå¸®åŠ©ï¼Œæˆ‘æƒ³å¼€å§‹è¯´å®ƒå¯¹ä½ çš„ç”¨æ³•ä¼šæœ‰å¾ˆå¤§çš„ä¸åŒã€‚æ ¹æ®ä½ æ­£åœ¨æ„å»ºçš„ä¸œè¥¿ï¼Œä½ å¦‚ä½•è®¾ç½®ä½ çš„åŒ…ä»¥åŠè®¾ç½®æ ‘æŠ–åŠ¨çš„æ•ˆæœä¼šæœ‰æ‰€ä¸åŒã€‚

è¿™æ˜¯å› ä¸ºæ ‘æŠ–åŠ¨å¯ä»¥æ–¹ä¾¿åœ°åˆ é™¤æœªä½¿ç”¨çš„æ¨¡å—å’Œä»£ç ã€‚

å–å†³äºä½ åœ¨æ„å»ºä»€ä¹ˆï¼Œè¿™å¯èƒ½éå¸¸æ–¹ä¾¿ï¼Œæˆ–è€…å¯¹ä½ å‡ ä¹æ²¡æœ‰ä»·å€¼ã€‚æ‘‡æ ‘å·²ç»æˆä¸º web å¼€å‘ç¤¾åŒºçš„ä¸€ä¸ªæ—¶é«¦è¯æ±‡ï¼Œä½œä¸ºä¸€ç§å‡ ä¹ç¥å¥‡çš„æ–¹å¼æ¥å‡å°‘åŒ…çš„å¤§å°ã€‚è€Œä¸”ï¼Œåœ¨æŸäº›é¢†åŸŸï¼Œè¿™å¯èƒ½æ˜¯ä¸å¯æ€è®®çš„ã€‚ä½†æ˜¯æˆ‘æƒ³æ—©ç‚¹è®¾å®šé¢„æœŸï¼Œä½ å¯èƒ½ä¸ä¼šè¿™æ ·ã€‚

## ä¸€ä¸ªå°å°çš„è­¦ç¤ºæ•…äº‹

æˆ‘å’Œæˆ‘çš„åŒäº‹å†³å®šå‡å°‘åº”ç”¨ç¨‹åºçš„åŒ…å¤§å°ã€‚

æˆ‘ä»¬æœ‰å‡ ä¸ªè®¡åˆ’ï¼Œä½†æ‘‡æ ‘æ— ç–‘æ˜¯æˆ‘ä»¬çš„é¦–è¦ä»»åŠ¡ä¹‹ä¸€ã€‚é—®é¢˜æ˜¯ï¼Œæˆ‘ä»¬çš„ä»£ç æ˜¯ CJS å’Œ ESM çš„æ··åˆã€‚å› æ­¤ï¼Œæˆ‘ä»¬æ„å»ºäº†å‡ ä¸ªä»£ç æ¨¡å—æ¥å°†æˆ‘ä»¬çš„ç³»ç»Ÿè¿ç§»åˆ° ESMã€‚

åœ¨è¿ç§»ä¹‹å‰ï¼Œæˆ‘ä»¬é€šè¿‡å¼ºåˆ¶ Babel æ„å»ºåˆ° ESM ä¸­ï¼Œæµ‹è¯•äº†å¯èƒ½çš„åŒ…å¤§å°ç¼©å‡ã€‚çœ‹æ¥æˆ‘ä»¬å¯ä»¥å‡å°‘è¿‘ 20%çš„æ†ç»‘é”€å”®ã€‚è¿™æ˜¯å·¨å¤§çš„ã€‚

æˆ‘ä»¬å®Œæˆäº†è¿ç§»å¹¶é‡æ–°è¿è¡Œäº†åˆ†æå™¨ã€‚æˆ‘ä»¬å°†æ ¸å¿ƒäº§å“åŒ…å‡å°‘äº† 3%åˆ° 5%ã€‚ä»ç„¶æœ‰ç”¨ï¼Œä½†è¿œæ²¡æœ‰è¾¾åˆ°æˆ‘ä»¬å¸Œæœ›çš„æ°´å¹³ã€‚

é‚£ä¹ˆï¼Œä¸ºä»€ä¹ˆæˆ‘ä»¬çš„æ•°å­—ç›¸å·®å¦‚æ­¤ä¹‹è¿œå‘¢ï¼Ÿå¥½å§ï¼Œåœ¨æˆ‘ä»¬æ—©æœŸçš„æµ‹è¯•ä¸­ï¼Œå½“æˆ‘ä»¬å¼ºè¿« CJS è¿›å…¥ ESM æ—¶ï¼Œåœ¨ä¸¤ä¸ªè§„æ ¼ä¹‹é—´å¯¼å…¥å·¥ä½œæ˜¯ä¸åŒçš„(å³é»˜è®¤)ã€‚å½“ Webpack åˆ†æä»£ç æ—¶ï¼Œå®ƒç¡®å®šå¯¼å…¥ä½ç½®æ²¡æœ‰ä»»ä½•ä¸œè¥¿ï¼Œå¹¶å°†åˆ é™¤è¯¥æ¨¡å—ï¼Œå°½ç®¡æˆ‘ä»¬éœ€è¦å®ƒï¼Œè¿™å¤§å¤§å¢åŠ äº†æ ‘æŠ–åŠ¨æ•ˆåº”ã€‚

> *æ„å»ºä» CJS è¿ç§»çš„ä»£ç æ¨¡å—- > ESM èŠ±è´¹äº†ç›¸å½“å¤šçš„æ—¶é—´å’Œç²¾åŠ›ã€‚ä¸¤ç§è§„æ ¼ä¹‹é—´å­˜åœ¨ä¸€äº›æ„æƒ³ä¸åˆ°çš„è¾¹ç¼˜æƒ…å†µã€‚æˆ‘æœŸå¾…å¼€æºæˆ‘ä»¬æ‰€åšçš„å·¥ä½œï¼Œå¹¶å¸Œæœ›å¾ˆå¿«å†™ä¸€ä¸ªåšå®¢è¯¦ç»†ä»‹ç»è¿™ä¸ªè¿‡ç¨‹ï¼*

# æ‘‡æ ‘ Web App vs .åº“ä»£ç 

è¦äº†è§£æ ‘æŠ–åŠ¨å¯¹ä½ æœ‰å¤šå¤§ç”¨å¤„ï¼Œé¦–å…ˆè¦ç¡®å®šä½ çš„ä»£ç åº“ä¸­ç›®å‰æœ‰å¤šå°‘æœªä½¿ç”¨çš„ä»£ç ï¼Ÿ

å¦‚æœæ‚¨æ­£åœ¨æ„å»ºä¸€ä¸ª web åº”ç”¨ç¨‹åºï¼Œæ ‘æŠ–åŠ¨ä»ç„¶ä¼šæ´¾ä¸Šç”¨åœºï¼Œä½†æ˜¯æ‚¨ä»ä¸­è·å¾—çš„å®é™…ä»£ç ä¼˜åŒ–å°†æ˜¯æœ€å°çš„ã€‚å¦‚æœæ‚¨çš„ä»£ç åº“ä¸­æœ‰å¤§é‡æœªä½¿ç”¨çš„ä»£ç ï¼Œè¿™ç§æƒ…å†µä¼šæœ‰æ‰€ä¸åŒï¼Œä½†å‡è®¾æ‚¨çš„å¤§éƒ¨åˆ†ä»£ç éƒ½ä»¥æŸç§æ–¹å¼æ‰§è¡Œï¼Œæ‚¨å¯èƒ½ä¸ä¼šçœ‹åˆ°è¿™ç§æƒ…å†µçš„æ˜¾è‘—å‡å°‘ã€‚

ä¸€ä¸ªæ›´æœ‰å¯èƒ½è®©ä½ å—ç›Šçš„é€”å¾„æ˜¯ä½ ä½¿ç”¨çš„åº“ã€‚æœ‰äº›åº“ï¼Œå°¤å…¶æ˜¯ UI åº“ï¼Œä¼šè¢«ä½ æ ‘æ‘‡ã€‚ä¸¾ä¸€ä¸ªé¡¹ç›®çš„ä¾‹å­ï¼Œå®ƒæ„å‘³ç€ä½ å¯ä»¥æ‘‡åŠ¨æ ‘ï¼Œ [react-dnd](https://github.com/react-dnd/react-dnd) æ²¡æœ‰ä»¥ä»»ä½•æ–¹å¼æ†ç»‘ï¼Œè€Œæ˜¯å®Œå…¨æ„å»ºåœ¨ ESM ä¸­ã€‚å°†é¡¹ç›®å¯¼å…¥ä½ çš„ web app åï¼Œå¦‚æœä½ çš„åº”ç”¨æ˜¯ç”¨æ ‘æ‘‡åˆ¶ä½œçš„ï¼Œè‡ªç„¶ä¼šæ ‘æ‘‡`react-dnd`ã€‚

è¿™ä¹Ÿæ„å‘³ç€ï¼Œå¦‚æœä½ æ­£åœ¨å¼€å‘ä¸€ä¸ªåº“ï¼Œä»¥è¿™æ ·ä¸€ç§æ–¹å¼è®¾ç½®å®ƒæ˜¯å¿…è¦çš„ï¼Œç”¨æˆ·å¯ä»¥æ ‘æ‘‡ä»–ä»¬ä¸ä½¿ç”¨çš„å…ƒç´ ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆä½ ä¼šç»å¸¸çœ‹åˆ°ä¸€äº›è¿™æ ·çš„åº“ä¸æ†ç»‘ä»–ä»¬çš„åº“ï¼Œè€Œåªæ˜¯é€šè¿‡ Babel ä¼ é€’å®ƒï¼Œå¹¶å…è®¸ç”¨æˆ·è‡ªå·±åŠ¨æ‘‡å®ƒã€‚

# ç»“æŸè¯­

å°½ç®¡æˆ‘åœ¨ä¸Šé¢æå‡ºäº†è­¦å‘Šï¼Œä½†æ˜¯æ ‘æŠ–åŠ¨ã€æ¨¡å—ä¾èµ–å’Œæ­»ä»£ç æ¶ˆé™¤æ˜¯æ‚¨çš„å¿…å¤‡å·¥å…·ã€‚å®ƒä»¬æ˜¯ç†è§£å°è¯•å‡å°‘ JavaScript åŒ…å¤§å°çš„æ–¹æ³•çš„åŸºç¡€ã€‚

æˆ‘ä»¬å°†é‡‡å–çš„ä¸‹ä¸€æ­¥å®é™…ä¸Šæ˜¯æˆ‘ç›¸ä¿¡ä½ å¯ä»¥å¸®åŠ©ä½ çš„å®¢æˆ·å‡å°‘[äº¤äº’](https://developers.google.com/web/tools/lighthouse/audits/time-to-interactive)æ—¶é—´çš„æ ¸å¿ƒæ–¹æ³•ï¼Œé‚£å°±æ˜¯ä»£ç åˆ†å‰²ã€‚æˆ‘ä»¬å°†å¾ˆå¿«å¯¹æ­¤è¿›è¡Œæ·±å…¥ç ”ç©¶ï¼Œå¹¶æ€»ç»“ä¸€ä¸‹ *Reducing JS Bundles* ç³»åˆ—ã€‚

# å‚è€ƒèµ„æ–™å’Œè¿›ä¸€æ­¥é˜…è¯»

[](https://webpack.js.org/guides/tree-shaking/) [## æ‘‡æ ‘|ç½‘ç»œåŒ…

### webpack æ˜¯ä¸€ä¸ªæ¨¡å—æ†ç»‘å™¨ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯æ†ç»‘ JavaScript æ–‡ä»¶ä»¥ä¾¿åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼Œä½†å®ƒä¹Ÿâ€¦

webpack.js.org](https://webpack.js.org/guides/tree-shaking/) [](https://medium.com/better-programming/reducing-js-bundle-size-58dc39c10f9c) [## å‡å° JS åŒ…çš„å¤§å°

### ç¬¬ä¸€éƒ¨åˆ†:ç­–ç•¥çš„åº¦é‡å’Œé«˜çº§è§†å›¾

medium.com](https://medium.com/better-programming/reducing-js-bundle-size-58dc39c10f9c) [](https://medium.com/better-programming/reducing-js-bundle-size-a6533c183296) [## å‡å° JS åŒ…çš„å¤§å°

### ç¬¬äºŒéƒ¨åˆ†:ç²¾ç®€å’Œæ­»ç æ¶ˆé™¤

medium.com](https://medium.com/better-programming/reducing-js-bundle-size-a6533c183296) [](https://github.com/terser-js/terser) [## ç‰¹å¡å°”-js/ç‰¹å¡å°”

### ğŸ—œ JavaScript è§£æå™¨ã€ä»£ç è½¬æ¢å™¨ã€ä¼˜åŒ–å™¨å’Œæ¼‚äº®çš„ ES6 å·¥å…·åŒ…

github.com](https://github.com/terser-js/terser)  [## Node.js v12.9.0 æ–‡æ¡£

### åœ¨ Node.js æ¨¡å—ç³»ç»Ÿä¸­ï¼Œæ¯ä¸ªæ–‡ä»¶éƒ½è¢«è§†ä¸ºä¸€ä¸ªå•ç‹¬çš„æ¨¡å—ã€‚ä¾‹å¦‚ï¼Œè€ƒè™‘ä¸€ä¸ªåä¸º foo.js çš„æ–‡ä»¶â€¦

nodejs.org](https://nodejs.org/docs/latest/api/modules.html)  [## 16.æ¨¡å—

### ç¼–è¾‘æè¿°

exploringjs.com](https://exploringjs.com/es6/ch_modules.html) [](https://nodejs.org/en/) [## èŠ‚ç‚¹. js

### Node.js æ˜¯åŸºäº Chrome çš„ V8 JavaScript å¼•æ“æ„å»ºçš„ JavaScript è¿è¡Œæ—¶ã€‚

nodejs.org](https://nodejs.org/en/) [](https://webpack.js.org/) [## ç½‘ç»œåŒ…

### webpack æ˜¯ä¸€ä¸ªæ¨¡å—æ†ç»‘å™¨ã€‚å®ƒçš„ä¸»è¦ç›®çš„æ˜¯æ†ç»‘ JavaScript æ–‡ä»¶ä»¥ä¾¿åœ¨æµè§ˆå™¨ä¸­ä½¿ç”¨ï¼Œä½†å®ƒä¹Ÿâ€¦

webpack.js.org](https://webpack.js.org/) [](https://medium.com/@joeclever/three-simple-ways-to-inspect-a-webpack-bundle-7f6a8fe7195d) [## æ£€æŸ¥ Webpack åŒ…çš„ä¸‰ç§ç®€å•æ–¹æ³•

### Webpack æ˜¯ä¸€ä¸ªæ¨¡å—æ†ç»‘å™¨ï¼Œè¿™æ„å‘³ç€å®ƒå°†æ‰€æœ‰çš„ JavaScript æ–‡ä»¶æ†ç»‘åˆ°ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶ä¸­â€¦

medium.com](https://medium.com/@joeclever/three-simple-ways-to-inspect-a-webpack-bundle-7f6a8fe7195d) [](https://github.com/BoostIO/Boostnote) [## BoostIO/Boostnote

### ğŸ“£Boostnote å›¢é˜Ÿå°† IssueHunt ç”¨äºå¯æŒç»­çš„å¼€æºç”Ÿæ€ç³»ç»Ÿã€‚é¢å‘ç¨‹åºå‘˜çš„ç¬”è®°åº”ç”¨ã€‚åº”ç”¨ç¨‹åºâ€¦

github.com](https://github.com/BoostIO/Boostnote) [](https://reactjs.org/) [## reactâ€”â€”ç”¨äºæ„å»ºç”¨æˆ·ç•Œé¢çš„ JavaScript åº“

### React ä½¿å¾—åˆ›å»ºäº¤äº’å¼ ui å˜å¾—ä¸é‚£ä¹ˆç—›è‹¦ã€‚ä¸ºåº”ç”¨ç¨‹åºä¸­çš„æ¯ä¸ªçŠ¶æ€è®¾è®¡ç®€å•çš„è§†å›¾ï¼Œå¹¶ååº”â€¦

reactjs.org](https://reactjs.org/)  [## ä¾èµ–å›¾

### åœ¨æ•°å­¦ã€è®¡ç®—æœºç§‘å­¦å’Œæ•°å­—ç”µå­å­¦ä¸­ï¼Œä¾èµ–å›¾æ˜¯ä¸€ç§æœ‰å‘å›¾ï¼Œè¡¨ç¤ºâ€¦

en.wikipedia.org](https://en.wikipedia.org/wiki/Dependency_graph)  [## umdjs/umd

### é€‚ç”¨äºä»»ä½•åœ°æ–¹çš„ JavaScript æ¨¡å—çš„ UMD(é€šç”¨æ¨¡å—å®šä¹‰)æ¨¡å¼ã€‚- umdjs/umd

github.com](https://github.com/umdjs/umd)  [## ä¸ºä»€ä¹ˆæ˜¯ AMDï¼Ÿ

### ä»€ä¹ˆæ˜¯ JavaScript æ¨¡å—ï¼Ÿä»–ä»¬çš„ç›®çš„æ˜¯ä»€ä¹ˆï¼Ÿå®šä¹‰:å¦‚ä½•å°†ä¸€æ®µä»£ç å°è£…æˆä¸€ä¸ªæœ‰ç”¨çš„å•å…ƒâ€¦

requirejs.org](https://requirejs.org/docs/whyamd.html) [](https://www.npmjs.com/) [## npm

### JavaScriptã€‚ä¼ä¸šçº§ã€‚å°†æ‚¨çš„å¼€å‘æ”¾åœ¨ä¸€ä¸ªå±‹æªä¸‹ï¼Œå¹¶å¤„ç†æ‚¨å…¬å¸çš„å¼€æºâ€¦

www.npmjs.com](https://www.npmjs.com/) [](https://bower.io/) [## å‡‰äº­

### ç½‘ç«™ç”±å¾ˆå¤šä¸œè¥¿ç»„æˆâ€”â€”æ¡†æ¶ã€åº“ã€èµ„äº§å’Œå®ç”¨ç¨‹åºã€‚é²å°”ä¸ºâ€¦ç®¡ç†æ‰€æœ‰è¿™äº›äº‹æƒ…

bower.io](https://bower.io/)  [## 16.æ¨¡å—

### ç¼–è¾‘æè¿°

exploringjs.com](https://exploringjs.com/es6/ch_modules.html#static-module-structure) [](https://medium.com/@lawliet29/tree-shaking-in-real-world-what-could-go-wrong-b398c2b2ebbb) [## çœŸå®ä¸–ç•Œä¸­çš„æ‘‡æ ‘:ä¼šå‡ºä»€ä¹ˆé—®é¢˜ï¼Ÿ

### TLï¼›é€Ÿåº¦ä¸‰è§’å½¢å®šä½æ³•(dead reckoning)

medium.com](https://medium.com/@lawliet29/tree-shaking-in-real-world-what-could-go-wrong-b398c2b2ebbb) [](https://developers.google.com/web/fundamentals/performance/optimizing-javascript/tree-shaking/) [## é€šè¿‡æ‘‡æ™ƒæ ‘æ¥å‡å°‘ JavaScript è´Ÿè½½|ç½‘ç»œåŸºç¡€|è°·æ­Œå¼€å‘è€…

### ä»Šå¤©çš„ web åº”ç”¨ç¨‹åºå¯ä»¥å˜å¾—éå¸¸å¤§ï¼Œå°¤å…¶æ˜¯å…¶ä¸­çš„ JavaScript éƒ¨åˆ†ã€‚æˆªè‡³ 2018 å¹´å¹´ä¸­ï¼ŒHTTP Archive å°†â€¦

developers.google.com](https://developers.google.com/web/fundamentals/performance/optimizing-javascript/tree-shaking/) [](https://babeljs.io/) [## ä¸‹ä¸€ä»£ JavaScript çš„ç¼–è¯‘å™¨

### é€šè¿‡æˆ‘ä»¬çš„å…¥é—¨æŒ‡å—äº†è§£æ›´å¤šå…³äºå·´åˆ«å¡”çš„ä¿¡æ¯ï¼Œæˆ–è€…æŸ¥çœ‹ä¸€äº›å…³äºå®ƒèƒŒåçš„äººå’Œæ¦‚å¿µçš„è§†é¢‘â€¦

babeljs.io](https://babeljs.io/) [](https://developers.google.com/web/tools/lighthouse/audits/time-to-interactive) [## äº’åŠ¨æ—¶é—´|ç½‘ç»œå¼€å‘è€…å·¥å…·|è°·æ­Œå¼€å‘è€…

### è´Ÿè½½ä¸æ˜¯æ—¶é—´ä¸Šçš„ä¸€ä¸ªç¬é—´â€”â€”å®ƒæ˜¯ä¸€ç§æ²¡æœ‰ä¸€ä¸ªæŒ‡æ ‡å¯ä»¥å®Œå…¨æ•æ‰åˆ°çš„ä½“éªŒã€‚æœ‰å¤šä¸ªâ€¦

developers.google.com](https://developers.google.com/web/tools/lighthouse/audits/time-to-interactive) 

[https://webpack.github.io/analyse/](https://webpack.github.io/analyse/)