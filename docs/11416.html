<html>
<head>
<title>How To Setup Prometheus (Operator) and Grafana Monitoring on Kubernetes</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•åœ¨Kubernetesä¸Šè®¾ç½®Prometheus(æ“ä½œå‘˜)å’ŒGrafanaç›‘æ§</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/how-to-setup-prometheus-and-grafana-monitoring-on-kubernetes-37d76c97dba0?source=collection_archive---------6-----------------------#2022-03-17">https://betterprogramming.pub/how-to-setup-prometheus-and-grafana-monitoring-on-kubernetes-37d76c97dba0?source=collection_archive---------6-----------------------#2022-03-17</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="5b5e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">æœ¬æ•™ç¨‹å‘æ‚¨å±•ç¤ºäº†å¦‚ä½•åœ¨Kubernetesä¸Šä½¿ç”¨Prometheus(æ“ä½œå‘˜)å’ŒGrafanaå¼€å§‹ä¸€ä¸ªç°ä»£ç›‘æ§å †æ ˆ</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/09c87f4731d5d1b8f27a8ec515bc12cd.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*EdoF8_GDwK9G89to.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae kv" href="https://unsplash.com/@mattvs?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Matthijs van Schuppen </a>åœ¨<a class="ae kv" href="https://unsplash.com/photos/bwonz6tZpVA?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>æ‹æ‘„</p></figure><p id="97c5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç›‘æ§æ˜¯DevOpsæœ€ä½³å®è·µçš„å…³é”®æ”¯æŸ±ã€‚è¿™æä¾›äº†å…³äºå¹³å°æ€§èƒ½å’Œå¥åº·çŠ¶å†µçš„é‡è¦ä¿¡æ¯ã€‚åœ¨Kuberneteså’Œå¾®æœåŠ¡è¿™æ ·çš„åˆ†å¸ƒå¼ç¯å¢ƒä¸­ï¼Œæ›´æ˜¯å¦‚æ­¤ã€‚</p><p id="70df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Kubernetesçš„ä¸€å¤§ä¼˜åŠ¿æ˜¯èƒ½å¤Ÿæ‰©å±•æ‚¨çš„æœåŠ¡å’Œåº”ç”¨ç¨‹åºã€‚å½“æ‚¨æ¥è§¦åˆ°æˆåƒä¸Šä¸‡ä¸ªåº”ç”¨ç¨‹åºæ—¶ï¼Œæ‰‹åŠ¨ç›‘æ§å®ƒä»¬æˆ–ä½¿ç”¨è„šæœ¬æ˜¯ä¸å¯è¡Œçš„ã€‚æ‚¨éœ€è¦é‡‡ç”¨ä¸€ä¸ªå¯æ‰©å±•çš„ç›‘æ§ç³»ç»Ÿï¼è¿™å°±æ˜¯æ™®ç½—ç±³ä¿®æ–¯å’Œæ ¼æ‹‰å¤«çº³å‡ºç°çš„åœ°æ–¹ã€‚</p><p id="11c1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Prometheuså°†æ”¶é›†ã€å­˜å‚¨å¹¶å…è®¸æ‚¨åˆ©ç”¨æ‚¨çš„å¹³å°æŒ‡æ ‡ã€‚å¦ä¸€æ–¹é¢ï¼ŒGrafanaå°†æ’å…¥Prometheusï¼Œå¹¶å…è®¸æ‚¨åˆ›å»ºæ¼‚äº®çš„ä»ªè¡¨æ¿å’Œå›¾è¡¨ã€‚</p><p id="219b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä»Šå¤©ï¼Œæˆ‘ä»¬å°†è®¨è®ºPrometheusæ˜¯ä»€ä¹ˆï¼Œä»¥åŠåœ¨Kubernetesä¸Šéƒ¨ç½²å®ƒçš„æœ€ä½³æ–¹å¼â€”â€”ä½¿ç”¨æ“ä½œç¬¦ã€‚æˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•ç”¨æ™®ç½—ç±³ä¿®æ–¯å’Œæ ¼æ‹‰å¤«çº³å»ºç«‹ä¸€ä¸ªç›‘æ§å¹³å°ã€‚</p><p id="3dc1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æœ¬æ•™ç¨‹å°†ä¸ºæ‚¨æä¾›ä¸€ä¸ªå…·æœ‰å¯è§‚å¯Ÿæ€§çš„è‰¯å¥½èµ·ç‚¹ï¼Œå¹¶èµ°å¾—æ›´è¿œï¼</p><h1 id="a3f0" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">æ™®ç½—ç±³ä¿®æ–¯</h1><h2 id="49b4" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">æ—¶é—´è¡¨</h2><p id="c3e3" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated"><a class="ae kv" href="https://prometheus.io/" rel="noopener ugc nofollow" target="_blank"> Prometheus </a>æ˜¯2012å¹´åœ¨<a class="ae kv" href="https://soundcloud.com/" rel="noopener ugc nofollow" target="_blank"> SoundCloud </a>å¼€å‘çš„ä¸€æ¬¾ç”¨äºäº‹ä»¶ç›‘æ§å’Œè­¦æŠ¥çš„å…è´¹å¼€æºåº”ç”¨ã€‚ä¸ä¹…ä¹‹åï¼Œè®¸å¤šå…¬å¸å’Œç»„ç»‡é‡‡ç”¨äº†å®ƒå¹¶åšå‡ºäº†è´¡çŒ®ã€‚2016å¹´ï¼Œ<a class="ae kv" href="https://www.cncf.io/" rel="noopener ugc nofollow" target="_blank">äº‘åŸç”Ÿè®¡ç®—åŸºé‡‘ä¼š</a> (CNCF)ç»§Kubernetesä¹‹åå­µåŒ–äº†æ™®ç½—ç±³ä¿®æ–¯é¡¹ç›®ã€‚</p><p id="da41" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä»¥ä¸‹æ—¶é—´è¡¨æ˜¾ç¤ºäº†æ™®ç½—ç±³ä¿®æ–¯é¡¹ç›®çš„è¿›å±•:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi nb"><img src="../Images/3adb1a05e79702e3b824bab175710b10.png" data-original-src="https://miro.medium.com/v2/resize:fit:1284/format:webp/0*80ochMcj3M9VVHs2.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">æ™®ç½—ç±³ä¿®æ–¯é¡¹ç›®æ—¶é—´è¡¨</p></figure><h2 id="8f12" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">æ¦‚å¿µ</h2><p id="a739" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">Prometheusè¢«è®¤ä¸ºæ˜¯Kubernetesçš„é»˜è®¤ç›‘æ§è§£å†³æ–¹æ¡ˆï¼Œå…¶çµæ„Ÿæ¥è‡ªè°·æ­Œçš„Borgmanã€‚å®ƒä½¿ç”¨HTTPæ‹‰è¯·æ±‚ä»åº”ç”¨ç¨‹åºå’ŒåŸºç¡€è®¾æ–½æ”¶é›†æŒ‡æ ‡ã€‚ç›®æ ‡æ˜¯é€šè¿‡æœåŠ¡å‘ç°æˆ–é™æ€é…ç½®å‘ç°çš„ã€‚é€šè¿‡ä¸­é—´ç½‘å…³ä¹Ÿæ”¯æŒæ¨é€æ—¶é—´åºåˆ—ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nc"><img src="../Images/84e7563d38728fec69407fb11342a84d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*OsqziZC3P9HdxaGU.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">é€šè¿‡HTTPå‘Prometheuså…¬å¼€çš„æŒ‡æ ‡ç¤ºä¾‹</p></figure><p id="5143" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="nd">æ™®ç½—ç±³ä¿®æ–¯ç›®æ ‡æš´éœ²çš„åº¦é‡å…·æœ‰ä»¥ä¸‹æ ¼å¼:</em> <code class="fe ne nf ng nh b">&lt;metric name&gt;{&lt;label name&gt;=&lt;label value&gt;, ...}</code></p><p id="5356" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">Prometheusåœ¨æ—¶åºæ•°æ®åº“(TSDB)ä¸­è®°å½•å®æ—¶æŒ‡æ ‡ï¼Œè¿™å¸¦æ¥äº†ç»´åº¦æ•°æ®æ¨¡å‹ã€æ“ä½œç®€å•æ€§å’Œå¯æ‰©å±•çš„æ•°æ®æ”¶é›†ã€‚å®ƒæä¾›äº†PromQLï¼Œä¸€ç§çµæ´»çš„æŸ¥è¯¢è¯­è¨€æ¥åˆ©ç”¨è¿™ç§ç»´åº¦ã€‚</p><h2 id="0195" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">ä½“ç³»ç»“æ„</h2><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ni"><img src="../Images/632cfb8c53fb01086c4eda81bddc1dc8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*u_rFr08xLJOWCZDO.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">æ¥è‡ª<a class="ae kv" href="https://prometheus.io/" rel="noopener ugc nofollow" target="_blank">https://prometheus.io/</a>çš„æ™®ç½—ç±³ä¿®æ–¯å»ºç­‘</p></figure><p id="c9eb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ¶æ„å›¾æ˜¾ç¤ºPrometheusæ˜¯ä¸€ä¸ªå¤šç»„ä»¶ç›‘æ§ç³»ç»Ÿã€‚æ™®ç½—ç±³ä¿®æ–¯éƒ¨ç½²ä¸­é›†æˆäº†ä»¥ä¸‹ç»„ä»¶:</p><ul class=""><li id="1aac" class="nj nk iq ky b kz la lc ld lf nl lj nm ln nn lr no np nq nr bi translated">PrometheusæœåŠ¡å™¨æŠ“å–å¹¶å­˜å‚¨æ—¶é—´åºåˆ—æ•°æ®ã€‚å®ƒè¿˜æä¾›äº†ä¸€ä¸ªç”¨æˆ·ç•Œé¢æ¥æŸ¥è¯¢æŒ‡æ ‡ã€‚</li><li id="5932" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><a class="ae kv" href="https://prometheus.io/docs/instrumenting/clientlibs/" rel="noopener ugc nofollow" target="_blank">å®¢æˆ·ç«¯åº“</a>ç”¨äºæ£€æµ‹åº”ç”¨ç¨‹åºä»£ç ã€‚</li><li id="1ed3" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><a class="ae kv" href="https://github.com/prometheus/pushgateway" rel="noopener ugc nofollow" target="_blank"> Pushgateway </a>æ”¯æŒä»çŸ­æœŸä»»åŠ¡ä¸­æ”¶é›†æŒ‡æ ‡</li><li id="ed7e" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><a class="ae kv" href="https://prometheus.io/docs/instrumenting/exporters/" rel="noopener ugc nofollow" target="_blank">å‡ºå£å•†</a>å¯¹äºä¸ç›´æ¥ä½¿ç”¨æ™®ç½—ç±³ä¿®æ–¯æŒ‡æ ‡çš„æœåŠ¡ã€‚</li><li id="dee8" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><a class="ae kv" href="https://github.com/prometheus/alertmanager" rel="noopener ugc nofollow" target="_blank">è­¦æŠ¥ç®¡ç†å™¨</a>å¤„ç†åŸºäºè§¦å‘å™¨çš„å®æ—¶è­¦æŠ¥</li></ul><h1 id="44e7" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">ä¸ºä»€ä¹ˆé€‰æ‹©æ™®ç½—ç±³ä¿®æ–¯ç®—å­ï¼Ÿ</h1><p id="a028" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">Kubernetesæä¾›äº†è®¸å¤šå¯¹è±¡æ¥éƒ¨ç½²æ‚¨çš„åº”ç”¨ç¨‹åº:Podã€Deploymentã€Serviceã€Ingressç­‰ã€‚è¿™äº›æ˜¯æœ¬æœºèµ„æºï¼Œç”±äºå®ƒä»¬æ˜¯é€šç”¨çš„ï¼Œæ‰€ä»¥å®ƒä»¬çš„è¡Œä¸ºä¸åƒæœ€ç»ˆçš„åº”ç”¨ç¨‹åºã€‚Kuberneteså…è®¸æ‚¨é€šè¿‡è‡ªå®šä¹‰èµ„æºå®šä¹‰(CRD)åˆ›å»ºè‡ªå®šä¹‰èµ„æºã€‚</p><p id="afc9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">CRDå¯¹è±¡å®ç°äº†æœ€ç»ˆåº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚è¿™å…è®¸æ›´å¥½çš„å¯ç»´æŠ¤æ€§å¹¶å‡å°‘éƒ¨ç½²å·¥ä½œã€‚ä½¿ç”¨<a class="ae kv" href="https://github.com/prometheus-operator/prometheus-operator" rel="noopener ugc nofollow" target="_blank">æ™®ç½—ç±³ä¿®æ–¯ç®—å­</a>æ—¶ï¼Œæ¶æ„çš„æ¯ä¸ªç»„ä»¶éƒ½æ¥è‡ªä¸€ä¸ªCRDã€‚è¿™ä½¿å¾—Prometheusçš„å®‰è£…æ¯”ä¼ ç»Ÿçš„å®‰è£…æ›´ç®€å•ã€‚</p><p id="0885" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨ä¼ ç»Ÿçš„Prometheuså®‰è£…ä¸­ï¼Œæ·»åŠ æ–°çš„åº¦é‡ç«¯ç‚¹éœ€è¦æ›´æ–°æœåŠ¡å™¨é…ç½®ã€‚è¿™å…è®¸æ³¨å†Œä¸€ä¸ªæ–°çš„ç«¯ç‚¹ä½œä¸ºæ”¶é›†æŒ‡æ ‡çš„ç›®æ ‡ã€‚Prometheusæ“ä½œå‘˜ä½¿ç”¨<code class="fe ne nf ng nh b">Monitor</code>å¯¹è±¡(<a class="ae kv" href="https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/api.md#podmonitor" rel="noopener ugc nofollow" target="_blank"> PodMonitor </a>ã€<a class="ae kv" href="https://github.com/prometheus-operator/prometheus-operator/blob/main/Documentation/api.md#servicemonitor" rel="noopener ugc nofollow" target="_blank"> ServiceMonitor </a>)æ¥åŠ¨æ€å‘ç°ç«¯ç‚¹å¹¶æŠ“å–æŒ‡æ ‡ã€‚</p><p id="875a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä½¿ç”¨Prometheusæ“ä½œå‘˜å¯ä»¥ä¸ºPrometheusçš„å®‰è£…å’Œç»´æŠ¤èµ¢å¾—æ—¶é—´ã€‚å®ƒä¸ºæ‚¨æä¾›ç›‘è§†å¯¹è±¡ï¼Œä»¥ä¾¿åœ¨ä¸æ›´æ–°Prometheusé…ç½®çš„æƒ…å†µä¸‹åŠ¨æ€æ”¶é›†æŒ‡æ ‡ã€‚</p><h1 id="2b4e" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">ä¸æ“ä½œå‘˜ä¸€èµ·éƒ¨ç½²æ™®ç½—ç±³ä¿®æ–¯</h1><p id="c14c" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated"><code class="fe ne nf ng nh b">kube-prometheus-stack</code>æ˜¯Kubernetesæ¸…å•ã€Grafanaä»ªè¡¨æ¿å’ŒPrometheusè§„åˆ™çš„é›†åˆã€‚å®ƒé€šè¿‡Prometheusä½¿ç”¨æ“ä½œå‘˜æä¾›æ˜“äºæ“ä½œçš„ç«¯åˆ°ç«¯Kubernetesé›†ç¾¤ç›‘æ§ã€‚</p><div class="nx ny gp gr nz oa"><a href="https://github.com/prometheus-community/helm-charts/tree/main/charts/kube-prometheus-stack" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">å¤´ç›”-æµ·å›¾/æµ·å›¾/åº“è´-æ™®ç½—ç±³ä¿®æ–¯-ä¸»æ™®ç½—ç±³ä¿®æ–¯-ç¤¾åŒºçš„å †æ ˆ/å¤´ç›”-æµ·å›¾</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">å®‰è£…kube-prometheuså †æ ˆï¼Œå®ƒæ˜¯Kubernetesæ¸…å•ã€Grafanaä»ªè¡¨æ¿å’Œprometheusè§„åˆ™çš„é›†åˆâ€¦</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">github.com</p></div></div><div class="oj l"><div class="ok l ol om on oj oo kp oa"/></div></div></a></div><p id="d686" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¿™ä¸€ç³»åˆ—å¯é€šè¿‡èˆµè½®å›¾è·å¾—å’Œéƒ¨ç½²ã€‚æ‚¨å¯ä»¥åœ¨ä¸€ä¸ªå‘½ä»¤è¡Œä¸­éƒ¨ç½²ç›‘æ§å †æ ˆã€‚åˆšæ¥è§¦å¤´ç›”ï¼Ÿçœ‹ä¸€ä¸‹<a class="ae kv" href="https://getbetterdevops.io/helm-quickstart-tutorial/" rel="noopener ugc nofollow" target="_blank">æœ¬æ•™ç¨‹</a>å…¥é—¨ï¼</p><h2 id="a152" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">å®‰è£…èˆµ</h2><pre class="kg kh ki kj gt op nh oq or aw os bi"><span id="380f" class="mk lt iq nh b gy ot ou l ov ow">$ brew install helm</span></pre><h2 id="8431" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">åˆ›å»ºä¸“ç”¨çš„ç›‘è§†å‘½åç©ºé—´</h2><p id="6551" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">åœ¨Kubernetesä¸­ï¼Œåç§°ç©ºé—´æä¾›äº†ä¸€ç§åœ¨å•ä¸ªé›†ç¾¤ä¸­éš”ç¦»èµ„æºç»„çš„æœºåˆ¶ã€‚æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º<code class="fe ne nf ng nh b">monitoring</code>çš„åç§°ç©ºé—´æ¥å‡†å¤‡æ–°çš„éƒ¨ç½²:</p><pre class="kg kh ki kj gt op nh oq or aw os bi"><span id="4065" class="mk lt iq nh b gy ot ou l ov ow">$ kubectl create namespace monitoring</span></pre><h2 id="abf1" class="mk lt iq bd lu ml mm dn ly mn mo dp mc lf mp mq me lj mr ms mg ln mt mu mi mv bi translated">å®‰è£…å¸¦èˆµçš„kube-prometheus-stack</h2><p id="1fd2" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ·»åŠ Prometheuså›¾è¡¨å­˜å‚¨åº“å¹¶æ›´æ–°æœ¬åœ°ç¼“å­˜:</p><pre class="kg kh ki kj gt op nh oq or aw os bi"><span id="b5b6" class="mk lt iq nh b gy ot ou l ov ow">$ helm repo add prometheus-community https://prometheus-community.github.io/helm-charts <br/>$ helm repo update</span></pre><p id="4b51" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä½¿ç”¨Helmåœ¨åç§°ç©ºé—´<code class="fe ne nf ng nh b">monitoring</code>ä¸­éƒ¨ç½²kube-stack-prometheuså›¾è¡¨:</p><pre class="kg kh ki kj gt op nh oq or aw os bi"><span id="3619" class="mk lt iq nh b gy ot ou l ov ow">$ helm upgrade --namespace monitoring --install kube-stack-prometheus prometheus-community/kube-prometheus-stack --set prometheus-node-exporter.hostRootFsMount.enabled=false</span></pre><p id="1748" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ne nf ng nh b">hostRootFsMount.enabled</code> <em class="nd">è®¾ç½®ä¸º</em> <code class="fe ne nf ng nh b">false</code> <em class="nd">åœ¨Macä¸ŠDockeræ¡Œé¢å·¥ä½œ</em></p><p id="4c1d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">CRDç°åœ¨å®‰è£…åœ¨åç§°ç©ºé—´ä¸­ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„<code class="fe ne nf ng nh b">kubectl</code>å‘½ä»¤æ¥éªŒè¯è¿™ä¸€ç‚¹:</p><pre class="kg kh ki kj gt op nh oq or aw os bi"><span id="f636" class="mk lt iq nh b gy ot ou l ov ow">$ kubectl get -n monitoring crds                                                           <br/>NAME                                        CREATED AT<br/>alertmanagerconfigs.monitoring.coreos.com   2022-03-15T10:54:41Z<br/>alertmanagers.monitoring.coreos.com         2022-03-15T10:54:42Z<br/>podmonitors.monitoring.coreos.com           2022-03-15T10:54:42Z<br/>probes.monitoring.coreos.com                2022-03-15T10:54:42Z<br/>prometheuses.monitoring.coreos.com          2022-03-15T10:54:42Z<br/>prometheusrules.monitoring.coreos.com       2022-03-15T10:54:42Z<br/>servicemonitors.monitoring.coreos.com       2022-03-15T10:54:42Z<br/>thanosrulers.monitoring.coreos.com          2022-03-15T10:54:42Z</span></pre><p id="bc71" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸‹é¢æ˜¯æˆ‘ä»¬ç°åœ¨åœ¨åç§°ç©ºé—´ä¸­è¿è¡Œçš„å†…å®¹:</p><pre class="kg kh ki kj gt op nh oq or aw os bi"><span id="2c4b" class="mk lt iq nh b gy ot ou l ov ow">$ kubectl get pods -n monitoring                                                                    <br/>NAME                                                       READY   STATUS    RESTARTS   AGE<br/>alertmanager-kube-stack-prometheus-kube-alertmanager-0     2/2     Running   0          2m36s<br/>kube-stack-prometheus-grafana-6994bd6c69-h6s9z             3/3     Running   0          13h<br/>kube-stack-prometheus-kube-operator-86667b5cdf-cqndt       1/1     Running   0          13h<br/>kube-stack-prometheus-kube-state-metrics-fc9878699-dpgh6   1/1     Running   0          13h<br/>kube-stack-prometheus-prometheus-node-exporter-vrjsl       1/1     Running   0          13h<br/>prometheus-kube-stack-prometheus-kube-prometheus-0         2/2     Running   0          13h</span></pre><p id="d792" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¯¥å›¾è¡¨å®‰è£…äº†Prometheus componentsã€Operatorã€Grafanaå’Œä»¥ä¸‹å‡ºå£å•†:</p><ul class=""><li id="625e" class="nj nk iq ky b kz la lc ld lf nl lj nm ln nn lr no np nq nr bi translated"><a class="ae kv" href="https://github.com/prometheus/node_exporter" rel="noopener ugc nofollow" target="_blank">æ™®ç½—ç±³ä¿®æ–¯èŠ‚ç‚¹å¯¼å‡ºå™¨</a>å…¬å¼€ç¡¬ä»¶å’Œæ“ä½œç³»ç»ŸæŒ‡æ ‡</li><li id="fbd0" class="nj nk iq ky b kz ns lc nt lf nu lj nv ln nw lr no np nq nr bi translated"><a class="ae kv" href="https://github.com/kubernetes/kube-state-metrics" rel="noopener ugc nofollow" target="_blank"> kube-state-metrics </a>ç›‘å¬Kubernetes APIæœåŠ¡å™¨å¹¶ç”Ÿæˆå…³äºå¯¹è±¡çŠ¶æ€çš„åº¦é‡</li></ul><p id="52df" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘ä»¬ä¸æ™®ç½—ç±³ä¿®æ–¯å’Œæ ¼æ‹‰å¤«çº³çš„ç›‘æ§ç³»ç»Ÿå·²ç»å‡†å¤‡å¥½äº†ï¼</p><h1 id="0199" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">è¿æ¥åˆ°æ™®ç½—ç±³ä¿®æ–¯çš„ç½‘ç»œç•Œé¢</h1><p id="6440" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">Prometheus web UIå¯é€šè¿‡ä»¥ä¸‹å‘½ä»¤é€šè¿‡<code class="fe ne nf ng nh b">port-forward</code>è®¿é—®:</p><pre class="kg kh ki kj gt op nh oq or aw os bi"><span id="d584" class="mk lt iq nh b gy ot ou l ov ow">$ kubectl port-forward --namespace monitoring svc/kube-stack-prometheus-kube-prometheus 9090:9090</span></pre><p id="4ad8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ‰“å¼€<code class="fe ne nf ng nh b"><a class="ae kv" href="http://localhost:9090" rel="noopener ugc nofollow" target="_blank">http://localhost:9090</a></code>ä¸Šçš„æµè§ˆå™¨æ ‡ç­¾ï¼Œæ˜¾ç¤ºæ™®ç½—ç±³ä¿®æ–¯ç½‘ç»œç”¨æˆ·ç•Œé¢ã€‚æˆ‘ä»¬å¯ä»¥æ£€ç´¢ä»å‡ºå£å•†é‚£é‡Œæ”¶é›†çš„æŒ‡æ ‡:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/bd4e87651b3e2dedd0787f43548f7695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*hv3JV93RRsXmqkRT.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Prometheus web UIä¸­çš„ä»ªè¡¨æ¿æ˜¾ç¤ºæ—¶é—´åºåˆ—æŒ‡æ ‡</p></figure><p id="33ab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è½¬åˆ°â€œStatus&gt;Targets â€,æ‚¨å¯ä»¥çœ‹åˆ°PrometheusæœåŠ¡å™¨å‘ç°çš„æ‰€æœ‰æŒ‡æ ‡ç«¯ç‚¹:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ox"><img src="../Images/fa928d0e33ba923d5652ac21152e8289.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*0oN5q_IE5N100Fq-.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">æ™®ç½—ç±³ä¿®æ–¯å‘ç°çš„åº¦é‡ç«¯ç‚¹åœ¨çŠ¶æ€&gt;ç›®æ ‡èœå•ä¸­å¯è§</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi oy"><img src="../Images/0895d48f71d952f8e225a7997fc063a1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WYMiQqgHEpQDmOjw.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">PrometheusæœåŠ¡å™¨å‘ç°çš„ç›®æ ‡ç«¯ç‚¹å¾ˆå°‘</p></figure><h1 id="ccc8" class="ls lt iq bd lu lv lw lx ly lz ma mb mc jw md jx me jz mf ka mg kc mh kd mi mj bi translated">è¿æ¥åˆ°Grafana</h1><p id="23f2" class="pw-post-body-paragraph kw kx iq ky b kz mw jr lb lc mx ju le lf my lh li lj mz ll lm ln na lp lq lr ij bi translated">è¿æ¥åˆ°Grafana webç•Œé¢çš„å‡­è¯å­˜å‚¨åœ¨Kubernetes Secretä¸­ï¼Œå¹¶ä»¥base64ç¼–ç ã€‚æˆ‘ä»¬ç”¨è¿™ä¸¤ä¸ªå‘½ä»¤æ£€ç´¢ç”¨æˆ·åå’Œå¯†ç :</p><pre class="kg kh ki kj gt op nh oq or aw os bi"><span id="c767" class="mk lt iq nh b gy ot ou l ov ow">$ kubectl get secret --namespace monitoring kube-stack-prometheus-grafana -o jsonpath='{.data.admin-user}' | base64 -d <br/>$ kubectl get secret --namespace monitoring kube-stack-prometheus-grafana -o jsonpath='{.data.admin-password}' | base64 -d</span></pre><p id="fa11" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘ä»¬ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»ºåˆ°Grafanaçš„<code class="fe ne nf ng nh b">port-forward</code>:</p><pre class="kg kh ki kj gt op nh oq or aw os bi"><span id="145d" class="mk lt iq nh b gy ot ou l ov ow">$ kubectl port-forward --namespace monitoring svc/kube-stack-prometheus-grafana 8080:80</span></pre><p id="e848" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ‰“å¼€æ‚¨çš„æµè§ˆå™¨ï¼Œè¿›å…¥<code class="fe ne nf ng nh b"> <a class="ae kv" href="http://localhost:8080" rel="noopener ugc nofollow" target="_blank">http://localhost:8080</a></code>å¹¶å¡«å†™ä¹‹å‰çš„å‡­è¯:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oz"><img src="../Images/7897cc1f8cd6ab351cc625b504ce5da8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1334/format:webp/0*hdmGziekrHjYqZFq.png"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Grafanaç™»å½•ç•Œé¢</p></figure><p id="6bc7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">kube-stack-prometheuséƒ¨ç½²æä¾›äº†Grafanaä»ªè¡¨ç›˜:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/0d486e5702f7f6c485c6db25a3824695.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*JC3cma4x11hDCI0_.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">æä¾›çš„Grafanaä»ªè¡¨æ¿åˆ—è¡¨</p></figure><p id="5f55" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å…¶ä¸­ä¸€ä¸ªå±•ç¤ºäº†Kubernetes podsçš„è®¡ç®—èµ„æº:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pb"><img src="../Images/6da1ddf30a8e4a279119978b64388e45.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Jy2OIoBHt-pplHir.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">æ˜¾ç¤ºKubernetes podè®¡ç®—èµ„æºçš„Grafanaä»ªè¡¨æ¿</p></figure><p id="40e5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¥½äº†ï¼Œè¿™å°±æ˜¯ä½ å¦‚ä½•åœ¨åº“æœ¬å†…ç‰¹æ–¯ä¸Šè®¾ç½®æ™®ç½—ç±³ä¿®æ–¯å’Œæ ¼æ‹‰æ³•çº³ç›‘æ§çš„ã€‚</p></div><div class="ab cl pc pd hu pe" role="separator"><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph pi"/><span class="pf bw bk pg ph"/></div><div class="ij ik il im in"><p id="7753" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ„Ÿè°¢é˜…è¯»ï¼ğŸ™æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« æ˜¯æœ‰å¸®åŠ©çš„ã€‚æƒ³äº†è§£æ›´å¤šå…³äºDevOpsçš„çŸ¥è¯†ï¼Ÿçœ‹çœ‹ä¸‹é¢æ›´å¤šç±»ä¼¼çš„æ–‡ç« å§ï¼â¬‡ï¸</p><div class="nx ny gp gr nz oa"><a href="https://getbetterdevops.io" rel="noopener  ugc nofollow" target="_blank"><div class="ob ab fo"><div class="oc ab od cl cj oe"><h2 class="bd ir gy z fp of fr fs og fu fw ip bi translated">Getbetterdevops</h2><div class="oh l"><h3 class="bd b gy z fp of fr fs og fu fw dk translated">Getbetterdevopsæ˜¯ä¸€ä¸ªdevopsåšå®¢ï¼Œå¸®åŠ©å­¦ä¹ ç°ä»£åŸºç¡€è®¾æ–½å’Œäº‘æŠ€æœ¯ï¼Œå¦‚Kubernetesâ€¦</h3></div><div class="oi l"><p class="bd b dl z fp of fr fs og fu fw dk translated">getbetterdevops.io</p></div></div><div class="oj l"><div class="pj l ol om on oj oo kp oa"/></div></div></a></div></div></div>    
</body>
</html>