<html>
<head>
<title>Automating UI Feedback and Visual Testing in Web Applications</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Webåº”ç”¨ç¨‹åºä¸­UIåé¦ˆå’Œå¯è§†åŒ–æµ‹è¯•çš„è‡ªåŠ¨åŒ–</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/automating-ui-feedback-and-visual-testing-in-web-applications-d91f687a2840?source=collection_archive---------12-----------------------#2022-12-14">https://betterprogramming.pub/automating-ui-feedback-and-visual-testing-in-web-applications-d91f687a2840?source=collection_archive---------12-----------------------#2022-12-14</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="a1bb" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">ä½¿ç”¨å½©è‰²ã€æ•…äº‹ä¹¦å’Œæ¨¡æ‹ŸæœåŠ¡äººå‘˜è¿›è¡Œè§†è§‰å›å½’æµ‹è¯•</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/6c528a1575e9d2cbed72501aecca734f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*u9BkaNrUt2uFmtX8V9mi3A.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">æœ¬æ°æ˜Â·æ²ƒç½—æ–¯åœ¨<a class="ae ky" href="https://unsplash.com/?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>æ‹æ‘„çš„ç…§ç‰‡ã€‚</p></figure><p id="d834" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æœ¬æ–‡å°†å¸¦ä½ äº†è§£å¦‚ä½•åœ¨ä½ çš„åº”ç”¨ä¸­è®¾ç½®è‰²åº¦å’Œå»ºç«‹è§†è§‰å›å½’æµ‹è¯•ã€‚è¿™é‡Œæ˜¯åŸºäº<a class="ae ky" href="https://github.com/manakuro/visual-regression-testing-with-chromatic-example" rel="noopener ugc nofollow" target="_blank"> GitHub </a>çš„æœ€ç»ˆä»£ç åº“ã€‚</p><ul class=""><li id="15f8" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated"><a class="ae ky" href="https://www.chromatic.com/docs/" rel="noopener ugc nofollow" target="_blank"> Chromatic </a>æ˜¯ä¸€ä¸ªåŸºäºäº‘çš„æ•…äº‹ä¹¦å·¥å…·é“¾ï¼Œå…è®¸æ•…äº‹ä¹¦å‡ºç‰ˆã€UIæµ‹è¯•å’ŒUIå®¡æŸ¥ã€‚æˆ‘ä»¬å°†ä½¿ç”¨Chromaticå’ŒGitHubåŠ¨ä½œæ¥è‡ªåŠ¨åŒ–è§†è§‰å›å½’æµ‹è¯•ã€‚</li><li id="8b48" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated"><a class="ae ky" href="https://mswjs.io/" rel="noopener ugc nofollow" target="_blank"> MSW </a>æ˜¯ä¸€ä¸ªåº“ï¼Œå®ƒé€šè¿‡åœ¨ç½‘ç»œçº§æ‹¦æˆªæ¥æ¨¡ä»¿APIè¯·æ±‚ã€‚MSWå…è®¸æ‚¨çš„åº”ç”¨ç¨‹åºåœ¨ä¸æ¨¡ä»¿ä»£ç åº“ä¸­ç‰¹å®šä»£ç çš„æƒ…å†µä¸‹å·¥ä½œã€‚æˆ‘ä»¬å°†ä½¿ç”¨MSWæœåŠ¡å™¨è¿›è¡Œæ•…äº‹ä¹¦å’Œå•å…ƒæµ‹è¯•ã€‚</li></ul><h1 id="0cf3" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">å±å›½</h1><p id="b019" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">ä»¥ä¸‹æ˜¯è¦è·å–çš„ä¾èµ–é¡¹:</p><ul class=""><li id="688b" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">ä¸‹ä¸€ä¸ª@13.0.6</li><li id="0417" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">ååº”@18.2.0</li><li id="f832" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">é˜¿æ³¢ç½—/å®¢æˆ·ç«¯@3.7.2</li><li id="f577" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">graphql-codegen/cli@2.16.1</li><li id="1758" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">msw@0.49.2</li><li id="fb48" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">æ•…äº‹ä¹¦@v6</li></ul><h1 id="0dc6" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">æ¦‚è§‚</h1><p id="7789" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç”±Next.jså’ŒGraphQL APIæœåŠ¡å™¨åˆ›å»ºçš„appã€‚ä¸ºäº†å¿«é€Ÿå¼€å§‹ï¼Œæˆ‘è®¾ç½®äº†å®‰è£…GraphQLã€<a class="ae ky" href="https://github.com/apollographql/apollo-client" rel="noopener ugc nofollow" target="_blank"> apollo-client </a>å’Œ<a class="ae ky" href="https://the-guild.dev/graphql/codegen" rel="noopener ugc nofollow" target="_blank"> graphql-codegen </a>çš„åº”ç”¨ç¨‹åºã€‚å…·ä½“å¯ä»¥åœ¨è¿™å¼ <a class="ae ky" href="https://github.com/manakuro/visual-regression-testing-with-chromatic-example/pull/1/files" rel="noopener ugc nofollow" target="_blank"> PR </a>é‡Œçœ‹åˆ°ã€‚</p><p id="abb1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºåœ¨countries.revorblades.comæœåŠ¡å™¨ä¸Šå‘å‡ºä¸€ä¸ªAPIè¯·æ±‚ï¼Œç„¶åå¾—åˆ°ä¸€ä¸ªå›½å®¶åˆ—è¡¨ï¼Œå¦‚ä¸‹æ‰€ç¤ºã€‚æˆ‘ä»¬å°†é’ˆå¯¹è¯¥é¡µé¢å®ç°ä¸€ä¸ªå¯è§†åŒ–å›å½’æµ‹è¯•ã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ng"><img src="../Images/897af99311650d5592919058d638da9d.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XghYOHI_dd8bh73SQIyWhA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">å›½å®¶é¡µé¢</p></figure><p id="b2b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸‹é¢æ˜¯å®ç°çš„æ¦‚è¿°ã€‚</p><ul class=""><li id="a35d" class="lv lw it lb b lc ld lf lg li lx lm ly lq lz lu ma mb mc md bi translated">è®¾ç½®MSW</li><li id="5f0e" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">å®‰è£…æ•…äº‹ä¹¦</li><li id="02bc" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">å®‰è£…æ•…äº‹ä¹¦æ’ä»¶ä¸‹ä¸€ä¸ªè·¯ç”±å™¨æ’ä»¶</li><li id="5a57" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">å®‰è£…MSW-æ•…äº‹ä¹¦-æ’ä»¶</li><li id="875b" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">åˆ›ä½œæ•…äº‹</li><li id="84e1" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">è®¾ç½®è‰²åº¦</li><li id="c530" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">ä½¿ç”¨GitHubåŠ¨ä½œè‡ªåŠ¨è¿›è¡ŒUIæ£€æŸ¥</li><li id="4dc6" class="lv lw it lb b lc me lf mf li mg lm mh lq mi lu ma mb mc md bi translated">å•å…ƒæµ‹è¯•</li></ul><h1 id="0888" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">è®¾ç½®MSW</h1><p id="2469" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">è®©æˆ‘ä»¬é¦–å…ˆå°†<code class="fe nh ni nj nk b">msw</code>åŒ…å®‰è£…åˆ°æˆ‘ä»¬çš„é¡¹ç›®ä¸­ã€‚</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="4897" class="np mk it nk b be nq nr l ns nt">yarn add -D msw</span></pre><p id="42fe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬è¿˜å°†å®‰è£…<code class="fe nh ni nj nk b">deepmerge</code>å’Œ<code class="fe nh ni nj nk b">utility-types</code>åŒ…æ¥çµæ´»æ‰©å±•æ¨¡æ‹Ÿæ•°æ®ã€‚</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="7e77" class="np mk it nk b be nq nr l ns nt">yarn add -D deepmerge utility-types</span></pre><p id="347f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸ºäº†å°†API mockingç›¸å…³çš„æ¨¡å—ä¿å­˜åœ¨ä¸€ä¸ªç›®å½•ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤åˆ›å»º<code class="fe nh ni nj nk b">src/mocks</code>ç›®å½•:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="19e2" class="np mk it nk b be nq nr l ns nt">mkdir src/mocks</span></pre><p id="7c3f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸ºäº†å®šä¹‰GraphQLæŸ¥è¯¢çš„æ¨¡æ‹Ÿï¼Œæˆ‘ä»¬å°†åˆ›å»º<code class="fe nh ni nj nk b">src/mocks/queries</code>ç›®å½•:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="9380" class="np mk it nk b be nq nr l ns nt">mkdir src/mocks/queries</span></pre><p id="58e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ï¼Œæˆ‘ä»¬æœ‰è¿™æ ·çš„<code class="fe nh ni nj nk b">Countries</code>æŸ¥è¯¢:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="c40d" class="np mk it nk b be nq nr l ns nt">query Countries($filer: CountryFilterInput) {<br/>  countries(filter: $filer) {<br/>    name<br/>    native<br/>    capital<br/>    emoji<br/>    currency<br/>    languages {<br/>      code<br/>      name<br/>    }<br/>  }<br/>}</span></pre><p id="78b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸ºäº†å¤„ç†GraphQLè¯·æ±‚ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªè§£æå™¨æ¥è¿”å›æ¨¡æ‹Ÿå“åº”å¹¶åˆ›å»ºæ¨¡æ‹Ÿæ•°æ®ã€‚ä¸ºäº†å°†æ¨¡å—åˆ†ç»„åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹ä¸­ï¼Œæˆ‘ä»¬å°†æŒ‰å¦‚ä¸‹æ–¹å¼ç»„ç»‡æ–‡ä»¶:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="5c40" class="np mk it nk b be nq nr l ns nt">src/mocks/<br/>â””â”€â”€ queries<br/>    â”œâ”€â”€ countries<br/>    â”‚   â”œâ”€â”€ countriesQuery.ts<br/>    â”‚   â”œâ”€â”€ data.ts<br/>    â”‚   â”œâ”€â”€ index.ts<br/>    â”‚   â””â”€â”€ type.ts<br/>    â””â”€â”€ handlers.ts</span></pre><p id="5720" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åˆ›å»º<code class="fe nh ni nj nk b">src/mocks/queries/countries/countriesQuery.ts</code>:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="0b12" class="np mk it nk b be nq nr l ns nt">import { graphql } from 'msw'<br/>import { data } from './data'<br/>import { Options, Query } from './type'<br/><br/>export const countriesQuery = (options?: Options) =&gt; {<br/>  return graphql.query&lt;Query&gt;('Countries', (_, res, ctx) =&gt; {<br/>    if (options?.networkError) {<br/>      return res(<br/>        ctx.errors([<br/>          {<br/>            message: 'Network request failed',<br/>            graphQLErrors: [],<br/>            networkError: new Error('error'),<br/>            errorMessage: 'error',<br/>            extraInfo: {},<br/>          },<br/>        ]),<br/>      )<br/>    }<br/><br/>    return res(ctx.data(data(options?.res, options?.deepMergeOptions)))<br/>  })<br/>}</span></pre><p id="5681" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¯¹äºé€šè¿‡<code class="fe nh ni nj nk b">res</code>å‡½æ•°è¿”å›æ¨¡æ‹Ÿæ•°æ®çš„<code class="fe nh ni nj nk b">Countries</code>æŸ¥è¯¢ï¼Œ<code class="fe nh ni nj nk b">countriesQuery</code>è¿”å›å“åº”è§£æå™¨ã€‚</p><p id="3f9b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åˆ›å»º<code class="fe nh ni nj nk b">src/mocks/queries/countries/type.ts</code>:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="f50b" class="np mk it nk b be nq nr l ns nt">import deepmerge from 'deepmerge'<br/>import { CountriesQuery as Query } from 'src/graphql/types/index.mock'<br/>import { DeepPartial } from 'utility-types'<br/><br/>export type Response = DeepPartial&lt;Query&gt;<br/>export type { CountriesQuery as Query } from 'src/graphql/types/index.mock'<br/><br/>export type Options = {<br/>  res?: Response<br/>  networkError?: boolean<br/>  deepMergeOptions?: deepmerge.Options<br/>}</span></pre><p id="ff39" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¹¶åˆ›å»º<code class="fe nh ni nj nk b">src/mocks/queries/countries/data.ts</code>:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="b1ff" class="np mk it nk b be nq nr l ns nt">import deepmerge from 'deepmerge'<br/>import { Response, Query } from './type'<br/><br/>export const data = (<br/>  options?: Response,<br/>  deepMergeOptions?: deepmerge.Options,<br/>): Query =&gt;<br/>  deepmerge&lt;Query&gt;(<br/>    {<br/>      __typename: 'Query',<br/>      countries: [<br/>        {<br/>          name: 'Andorra',<br/>          native: 'Andorra',<br/>          capital: 'Andorra la Vella',<br/>          emoji: 'ğŸ‡¦ğŸ‡©',<br/>          currency: 'EUR',<br/>          languages: [{ code: 'ca', name: 'Catalan', __typename: 'Language' }],<br/>          __typename: 'Country',<br/>        },<br/>        {<br/>          name: 'United Arab Emirates',<br/>          native: 'Ø¯ÙˆÙ„Ø© Ø§Ù„Ø¥Ù…Ø§Ø±Ø§Øª Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù…ØªØ­Ø¯Ø©',<br/>          capital: 'Abu Dhabi',<br/>          emoji: 'ğŸ‡¦ğŸ‡ª',<br/>          currency: 'AED',<br/>          languages: [{ code: 'ar', name: 'Arabic', __typename: 'Language' }],<br/>          __typename: 'Country',<br/>        },<br/>        {<br/>          name: 'Afghanistan',<br/>          native: 'Ø§ÙØºØ§Ù†Ø³ØªØ§Ù†',<br/>          capital: 'Kabul',<br/>          emoji: 'ğŸ‡¦ğŸ‡«',<br/>          currency: 'AFN',<br/>          languages: [<br/>            { code: 'ps', name: 'Pashto', __typename: 'Language' },<br/>            { code: 'uz', name: 'Uzbek', __typename: 'Language' },<br/>            { code: 'tk', name: 'Turkmen', __typename: 'Language' },<br/>          ],<br/>          __typename: 'Country',<br/>        },<br/>        {<br/>          name: 'Antigua and Barbuda',<br/>          native: 'Antigua and Barbuda',<br/>          capital: "Saint John's",<br/>          emoji: 'ğŸ‡¦ğŸ‡¬',<br/>          currency: 'XCD',<br/>          languages: [{ code: 'en', name: 'English', __typename: 'Language' }],<br/>          __typename: 'Country',<br/>        },<br/>        {<br/>          name: 'Anguilla',<br/>          native: 'Anguilla',<br/>          capital: 'The Valley',<br/>          emoji: 'ğŸ‡¦ğŸ‡®',<br/>          currency: 'XCD',<br/>          languages: [{ code: 'en', name: 'English', __typename: 'Language' }],<br/>          __typename: 'Country',<br/>        },<br/>        {<br/>          name: 'Albania',<br/>          native: 'ShqipÃ«ria',<br/>          capital: 'Tirana',<br/>          emoji: 'ğŸ‡¦ğŸ‡±',<br/>          currency: 'ALL',<br/>          languages: [{ code: 'sq', name: 'Albanian', __typename: 'Language' }],<br/>          __typename: 'Country',<br/>        },<br/>        {<br/>          name: 'Armenia',<br/>          native: 'Õ€Õ¡ÕµÕ¡Õ½Õ¿Õ¡Õ¶',<br/>          capital: 'Yerevan',<br/>          emoji: 'ğŸ‡¦ğŸ‡²',<br/>          currency: 'AMD',<br/>          languages: [<br/>            { code: 'hy', name: 'Armenian', __typename: 'Language' },<br/>            { code: 'ru', name: 'Russian', __typename: 'Language' },<br/>          ],<br/>          __typename: 'Country',<br/>        },<br/>        {<br/>          name: 'Angola',<br/>          native: 'Angola',<br/>          capital: 'Luanda',<br/>          emoji: 'ğŸ‡¦ğŸ‡´',<br/>          currency: 'AOA',<br/>          languages: [<br/>            { code: 'pt', name: 'Portuguese', __typename: 'Language' },<br/>          ],<br/>          __typename: 'Country',<br/>        },<br/>        {<br/>          name: 'Antarctica',<br/>          native: 'Antarctica',<br/>          capital: null,<br/>          emoji: 'ğŸ‡¦ğŸ‡¶',<br/>          currency: null,<br/>          languages: [],<br/>          __typename: 'Country',<br/>        },<br/>        {<br/>          name: 'Argentina',<br/>          native: 'Argentina',<br/>          capital: 'Buenos Aires',<br/>          emoji: 'ğŸ‡¦ğŸ‡·',<br/>          currency: 'ARS',<br/>          languages: [<br/>            { code: 'es', name: 'Spanish', __typename: 'Language' },<br/>            { code: 'gn', name: 'Guarani', __typename: 'Language' },<br/>          ],<br/>          __typename: 'Country',<br/>        },<br/>      ],<br/>    },<br/>    (options || {}) as Query,<br/>    {<br/>      arrayMerge(target: any[], source: any[]): any[] {<br/>        if (!source.length) return source<br/><br/>        return [...target, ...source]<br/>      },<br/>      ...deepMergeOptions,<br/>    },<br/>  )</span></pre><p id="813d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿™æ˜¯MSWæœåŠ¡å™¨å°†å“åº”<code class="fe nh ni nj nk b">Countries</code>æŸ¥è¯¢çš„æ¨¡æ‹Ÿæ•°æ®ã€‚æˆ‘ä»¬å¸Œæœ›å°†è¿™äº›æ¨¡æ‹Ÿæ•°æ®ç”¨äºæ•…äº‹ä¹¦å’Œå•å…ƒæµ‹è¯•ï¼Œæ‰€ä»¥æˆ‘ä»¬ä½¿ç”¨äº†<code class="fe nh ni nj nk b">deepmerge</code>ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è½»æ¾åœ°æ‰©å±•æ•°æ®ã€‚</p><p id="ff3a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æœ€åï¼Œæˆ‘ä»¬å°†åˆ›å»º<code class="fe nh ni nj nk b">src/mocks/queries/handlers.ts</code>:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="26c3" class="np mk it nk b be nq nr l ns nt">import { countriesQuery } from './countries'<br/><br/>export const handlers = [countriesQuery()]</span></pre><h1 id="6147" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">å®‰è£…æ•…äº‹ä¹¦</h1><p id="aa83" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">æ¥ä¸‹æ¥è®©æˆ‘ä»¬å®‰è£…æ•…äº‹ä¹¦ã€‚</p><p id="058c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸ºäº†å¿«é€Ÿè®¾ç½®ï¼Œæˆ‘ä»¬å°†è¿è¡Œæ•…äº‹ä¹¦CLI:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="293e" class="np mk it nk b be nq nr l ns nt">npx storybook init</span></pre><p id="20e4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸€æ—¦å®ƒå®Œæˆäº†<code class="fe nh ni nj nk b">.storybook</code>ç›®å½•ï¼Œå®ƒåº”è¯¥åƒè¿™æ ·è¢«åˆ›å»º:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="92b8" class="np mk it nk b be nq nr l ns nt">.storybook/<br/>â”œâ”€â”€ main.js<br/>â””â”€â”€ preview.js</span></pre><p id="00af" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç”±äºæˆ‘ä»¬åœ¨åº”ç”¨ç¨‹åºä¸­ä½¿ç”¨TypeScriptï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ ä¸æˆ‘ä»¬çš„<code class="fe nh ni nj nk b">tsconfig.ts</code>ä¸­çš„<code class="fe nh ni nj nk b">paths</code>ç›¸å¯¹åº”çš„<code class="fe nh ni nj nk b">alias</code>æ¡ç›®æ¥åŠ è½½æ¨¡å—ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†å®‰è£…<a class="ae ky" href="https://www.npmjs.com/package/tsconfig-paths-webpack-plugin" rel="noopener ugc nofollow" target="_blank">ts config-paths-web pack-plugin</a>æ’ä»¶:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="7b7c" class="np mk it nk b be nq nr l ns nt">yarn add -D tsconfig-paths-webpack-plugin</span></pre><p id="d749" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åæ‰“å¼€<code class="fe nh ni nj nk b">.storybook</code>å¹¶æ›´æ”¹Webpacké…ç½®:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="1939" class="np mk it nk b be nq nr l ns nt">const { TsconfigPathsPlugin } = require('tsconfig-paths-webpack-plugin');<br/><br/>module.exports = {<br/>  "stories": [<br/>    "../src/**/*.stories.mdx",<br/>    "../src/**/*.stories.@(js|jsx|ts|tsx)"<br/>  ],<br/>  addons: [<br/>    "@storybook/addon-links",<br/>    "@storybook/addon-essentials",<br/>    "@storybook/addon-interactions",<br/>    "storybook-addon-next-router",<br/>  ],<br/>  framework: "@storybook/react",<br/>  core: {<br/>    "builder": "@storybook/builder-webpack5"<br/>  },<br/>  features: {<br/>    emotionAlias: false,<br/>  },<br/>  webpackFinal: async (config, { configType }) =&gt; {<br/>    // Add plugins<br/>    config.resolve.plugins = [<br/>      ...(config.resolve.plugins || []),<br/>      new TsconfigPathsPlugin({<br/>        configFile: './tsconfig.json'<br/>      }),<br/>    ];<br/><br/>    // Return the altered config<br/>    return config;<br/>  },<br/>}</span></pre><p id="9415" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç°åœ¨æˆ‘ä»¬å¯ä»¥ä»æ•…äº‹ä¹¦æ–‡ä»¶ä¸­çš„<code class="fe nh ni nj nk b">src/**</code>åŠ è½½æ¨¡å—äº†ã€‚</p><h2 id="5a71" class="nu mk it bd ml nv nw dn mp nx ny dp mt li nz oa mv lm ob oc mx lq od oe mz of bi translated">å®‰è£…æä¾›å•†</h2><p id="ba73" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">å› ä¸ºæˆ‘ä»¬ä½¿ç”¨äº†Apolloå®¢æˆ·ç«¯ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨storiesä¸­é…ç½®æä¾›è€…ã€‚</p><p id="59cb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç”¨ä»¥ä¸‹ä»£ç åˆ›å»º<code class="fe nh ni nj nk b">src/storybook/provider.ts</code>å¹¶å®šä¹‰æä¾›è€…:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="c1b4" class="np mk it nk b be nq nr l ns nt">import 'src/styles/globals.css'<br/>import { ApolloProvider as ApolloProviderLibs } from '@apollo/client'<br/>import React, { useMemo } from 'react'<br/>import { createApolloClient } from 'src/shared/apollo/client'<br/><br/>export const Provider: React.FCWithChildren = (props) =&gt; {<br/>  return &lt;ApolloProvider&gt;{props.children}&lt;/ApolloProvider&gt;<br/>}<br/><br/>const ApolloProvider: React.FCWithChildren = (props) =&gt; {<br/>  const client = useMemo(<br/>    () =&gt; createApolloClient({ idToken: 'token' }),<br/>    // eslint-disable-next-line react-hooks/exhaustive-deps<br/>    [],<br/>  )<br/><br/>  return (<br/>    &lt;ApolloProviderLibs client={client}&gt;{props.children}&lt;/ApolloProviderLibs&gt;<br/>  )<br/>}</span></pre><p id="c5ba" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¯¥æä¾›ç¨‹åºåº”è¯¥ä¸åœ¨<code class="fe nh ni nj nk b">pages/_app.tsx</code>ä¸­ä½¿ç”¨çš„ç›¸åŒ:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="457c" class="np mk it nk b be nq nr l ns nt">import 'src/styles/globals.css'<br/>import type { AppProps } from 'next/app'<br/>import { ApolloProvider } from 'src/shared/apollo/ApolloProvider'<br/><br/>export default function App({ Component, pageProps }: AppProps) {<br/>  return (<br/>    &lt;ApolloProvider&gt;<br/>      &lt;Component {...pageProps} /&gt;<br/>    &lt;/ApolloProvider&gt;<br/>  )<br/>}</span></pre><p id="4aa0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åæ‰“å¼€ä¸€ä¸ª<code class="fe nh ni nj nk b">.storybook/preview.js</code>ï¼Œç”¨æä¾›è€…åŒ…è£…ä¸€ä¸ªæ•…äº‹ç»„ä»¶:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="8232" class="np mk it nk b be nq nr l ns nt">import {Provider} from "../src/storybook/Provider";<br/><br/>export const parameters = {<br/>  actions: { argTypesRegex: "^on[A-Z].*" },<br/>  controls: {<br/>    matchers: {<br/>      color: /(background|color)$/i,<br/>      date: /Date$/,<br/>    },<br/>  },<br/>}<br/><br/>export const decorators = [<br/>  // Add provider here.<br/>  (Story) =&gt; (<br/>    &lt;Provider&gt;<br/>      &lt;Story /&gt;<br/>    &lt;/Provider&gt;<br/>  ),<br/>];</span></pre><p id="6e49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ—¢ç„¶æˆ‘ä»¬å¯ä»¥é…ç½®apolloæä¾›ç¨‹åºï¼Œé‚£ä¹ˆstoryç»„ä»¶å°±å¯ä»¥ä½¿ç”¨æä¾›çš„æ•°æ®ã€‚</p><h1 id="46ff" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">å®‰è£…æ•…äº‹ä¹¦æ’ä»¶ä¸‹ä¸€ä¸ªè·¯ç”±å™¨æ’ä»¶</h1><p id="950e" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">å› ä¸ºæˆ‘ä»¬ä½¿ç”¨Next.jsï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦åœ¨æˆ‘ä»¬çš„æ•…äº‹ä¹¦æ•…äº‹ä¸­é…ç½®Next.jsè·¯ç”±å™¨ã€‚</p><p id="87de" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è®©æˆ‘ä»¬å®‰è£…<code class="fe nh ni nj nk b">storybook-addon-next-router</code>æ’ä»¶ã€‚</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="4768" class="np mk it nk b be nq nr l ns nt">yarn add -D storybook-addon-next-router</span></pre><p id="3257" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ‰“å¼€ä¸€ä¸ª<code class="fe nh ni nj nk b">.storybook/preview.js</code>å¹¶å°†<code class="fe nh ni nj nk b">RouterContext.Provider</code>æ·»åŠ åˆ°å‚æ•°ä¸­:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="2cf0" class="np mk it nk b be nq nr l ns nt">import { RouterContext } from "next/dist/shared/lib/router-context";<br/><br/>export const parameters = {<br/>  actions: { argTypesRegex: "^on[A-Z].*" },<br/>  controls: {<br/>    matchers: {<br/>      color: /(background|color)$/i,<br/>      date: /Date$/,<br/>    },<br/>  },<br/>  // Add here<br/>  nextRouter: {<br/>    Provider: RouterContext.Provider,<br/>  },<br/>}</span></pre><p id="8703" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿™ä½¿æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·é…ç½®è·¯ç”±å™¨è·¯å¾„:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="7a40" class="np mk it nk b be nq nr l ns nt">export const Example = () =&gt; &lt;MyComponentThatHasANextLink /&gt;;<br/><br/>Example.parameters = {<br/>  nextRouter: {<br/>    path: "/profile/[id]",<br/>    asPath: "/profile/lifeiscontent",<br/>    query: {<br/>      id: "lifeiscontent",<br/>    },<br/>  },<br/>};</span></pre><h1 id="9ee9" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">å®‰è£…msw-storybook-addonæ’ä»¶</h1><p id="8b4b" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">ä¸ºäº†åœ¨Storybookä¸­æ¨¡æ‹ŸGraphQLè¯·æ±‚ï¼Œæˆ‘ä»¬å®‰è£…äº†<a class="ae ky" href="https://storybook.js.org/addons/msw-storybook-addon" rel="noopener ugc nofollow" target="_blank"> msw-storybook-addon </a>æ’ä»¶ã€‚</p><p id="c026" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…msw-storybook-addon:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="9b89" class="np mk it nk b be nq nr l ns nt">yarn add -D msw-storybook-addon</span></pre><p id="e856" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¦å¯åŠ¨storiesä¸­çš„æ¨¡æ‹ŸæœåŠ¡å™¨ï¼Œæˆ‘ä»¬éœ€è¦åœ¨å…¬å…±ç›®å½•ä¸­ç”Ÿæˆä¸€ä¸ªæœåŠ¡å·¥ä½œè€…ã€‚ä¸‹é¢æ˜¯å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="1f93" class="np mk it nk b be nq nr l ns nt">npx msw init public/</span></pre><p id="f7c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å®ƒå°†åœ¨å…¬å…±ç›®å½•ä¸‹åˆ›å»º<code class="fe nh ni nj nk b">mockServiceWorker.js</code>ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="8fe0" class="np mk it nk b be nq nr l ns nt">public/<br/>â”œâ”€â”€ favicon.ico<br/>â”œâ”€â”€ mockServiceWorker.js // Added<br/>â””â”€â”€ vercel.svg</span></pre><p id="ea4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ‰“å¼€ä¸€ä¸ª<code class="fe nh ni nj nk b">.storybook/main.js</code>ï¼Œåœ¨Webpacké…ç½®ä¸­æ”¾å…¥ä¸€ä¸ª<code class="fe nh ni nj nk b">staticDirs</code>å’Œfallback:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="d330" class="np mk it nk b be nq nr l ns nt">const { TsconfigPathsPlugin } = require('tsconfig-paths-webpack-plugin');<br/><br/>module.exports = {<br/>  "stories": [<br/>    "../src/**/*.stories.mdx",<br/>    "../src/**/*.stories.@(js|jsx|ts|tsx)"<br/>  ],<br/>  staticDirs: ['../public'], // Add staticDirs here.<br/>  addons: [<br/>    "@storybook/addon-links",<br/>    "@storybook/addon-essentials",<br/>    "@storybook/addon-interactions",<br/>    "storybook-addon-next-router",<br/>  ],<br/>  framework: "@storybook/react",<br/>  core: {<br/>    "builder": "@storybook/builder-webpack5"<br/>  },<br/>  features: {<br/>    emotionAlias: false,<br/>  },<br/>  webpackFinal: async (config, { configType }) =&gt; {<br/>    config.resolve.plugins = [<br/>      ...(config.resolve.plugins || []),<br/>      new TsconfigPathsPlugin({<br/>        configFile: './tsconfig.json'<br/>      }),<br/>    ];<br/><br/>    // Add fallback here.<br/>    config.resolve = {<br/>      ...config.resolve,<br/>      fallback: {<br/>        timers: false,<br/>        tty: false,<br/>        os: false,<br/>        http: false,<br/>        https: false,<br/>        zlib: false,<br/>        util: false,<br/>        stream: false,<br/>        ...config.resolve.fallback,<br/>      }<br/>    }<br/><br/>    // Return the altered config<br/>    return config;<br/>  },<br/>}</span></pre><p id="4800" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åæ‰“å¼€<code class="fe nh ni nj nk b">.storybook/preview.js</code>å¯ç”¨MSW:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="6c85" class="np mk it nk b be nq nr l ns nt">import { RouterContext } from "next/dist/shared/lib/router-context";<br/>import * as msw from 'msw-storybook-addon';<br/>import {handlers as queryHandlers} from "../src/mocks/queries/handlers";<br/><br/>// Initialize the msw<br/>msw.initialize()<br/><br/>export const parameters = {<br/>  actions: { argTypesRegex: "^on[A-Z].*" },<br/>  controls: {<br/>    matchers: {<br/>      color: /(background|color)$/i,<br/>      date: /Date$/,<br/>    },<br/>  },<br/>  nextRouter: {<br/>    Provider: RouterContext.Provider,<br/>  },<br/>  // Add the MSW handlers.<br/>  // This will be applied globally.<br/>  msw: {<br/>    handlers: [...queryHandlers]<br/>  }<br/>}<br/><br/>// Provide the MSW addon decorator globally<br/>export const decorators = [<br/>  msw.mswDecorator,<br/>  (Story) =&gt; (<br/>    &lt;Provider&gt;<br/>      &lt;Story /&gt;<br/>    &lt;/Provider&gt;<br/>  ),<br/>];</span></pre><p id="f099" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬åˆå§‹åŒ–MSWå¹¶æä¾›æˆ‘ä»¬åœ¨<code class="fe nh ni nj nk b">src/mocks/queries/handlers.ts</code>ä¸­å®šä¹‰çš„å¤„ç†ç¨‹åºï¼Œè¿™æ ·æˆ‘ä»¬å°†èƒ½å¤Ÿæ¨¡æ‹Ÿæ•…äº‹ä¸­çš„æ•°æ®ã€‚</p><h1 id="5444" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">åˆ›ä½œæ•…äº‹</h1><p id="3454" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»è®¾ç½®äº†Storybookå’ŒMSWæœåŠ¡å™¨ï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ•…äº‹ï¼Œçœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><p id="4853" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åˆ›å»º<code class="fe nh ni nj nk b">src/pages/Countries/Countries.stories.tsx</code>:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="aca0" class="np mk it nk b be nq nr l ns nt">import { ComponentStory, ComponentMeta } from '@storybook/react'<br/>import React from 'react'<br/>import { Countries as Page } from './Countries'<br/><br/>export default {<br/>  title: 'Pages/Countries',<br/>  component: Page,<br/>  parameters: {<br/>    layout: 'fullscreen',<br/>    nextRouter: {<br/>      asPath: '/countries',<br/>      path: '/countries',<br/>    },<br/>  },<br/>} as ComponentMeta&lt;typeof Page&gt;<br/><br/>const Template: ComponentStory&lt;typeof Page&gt; = (args) =&gt; &lt;Page {...args} /&gt;<br/><br/>export const Default = Template.bind({})</span></pre><p id="c423" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç”¨ä¸‹é¢çš„ä»£ç å¼€å§‹æ•…äº‹ä¹¦:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="fe65" class="np mk it nk b be nq nr l ns nt">yarn storybook</span></pre><p id="ef15" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è½¬åˆ°<code class="fe nh ni nj nk b"><a class="ae ky" href="http://localhost:600" rel="noopener ugc nofollow" target="_blank">http://localhost:600</a>6</code>ç„¶åä½ å¯ä»¥çœ‹åˆ°å›½å®¶é¡µé¢æˆåŠŸè·å–æ¨¡æ‹Ÿæ•°æ®å¹¶å‘ˆç°åˆ—è¡¨ã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi og"><img src="../Images/5933aa33119e63721707267b0772d295.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*wQG1-TrweDPy5yi_5k2PRQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">æ•…äº‹ä¹¦</p></figure><h1 id="834a" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">è®¾ç½®è‰²åº¦</h1><p id="2db8" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">åœ¨å‘å¸ƒä¹‹å‰ï¼Œæ³¨å†Œ<a class="ae ky" href="https://www.chromatic.com/start?startWithSignup=true" rel="noopener ugc nofollow" target="_blank"> Chromatic </a>å¹¶åˆ›å»ºä¸€ä¸ªé¡¹ç›®ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥è·å¾—ä¸€ä¸ªå”¯ä¸€çš„é¡¹ç›®ä»¤ç‰Œã€‚</p><p id="3c4b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ³¨å†Œåï¼Œæ‚¨å°†çœ‹åˆ°ä¸€ä¸ªé¡¹ç›®è®¾ç½®é¡µé¢ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oh"><img src="../Images/96baf8eb48cd59d1087e74bc2db94d7c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*tyYdKKkupL91Fg1VicnbIw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">é¡¹ç›®è®¾ç½®é¡µé¢</p></figure><p id="56df" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬å°†æŒ‰ç…§æŒ‡ç¤ºè¡Œäº‹ã€‚ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤å®‰è£…chromaticè½¯ä»¶åŒ…:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="e697" class="np mk it nk b be nq nr l ns nt">yarn add -D chromatic</span></pre><p id="a597" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä½¿ç”¨ä»¥ä¸‹ä»£ç å‘å¸ƒæˆ‘ä»¬çš„æ•…äº‹ä¹¦:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="fc30" class="np mk it nk b be nq nr l ns nt">npx chromatic --project-token=&lt;your token&gt;</span></pre><p id="1311" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å®Œæˆåï¼Œæ‚¨å°†çœ‹åˆ°æˆåŠŸé¡µé¢ã€‚çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oi"><img src="../Images/1b86c25ce3b0deb80c5b9819f37c3c48.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*DRGDXS1kWvDf9gdb4T-dgw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">æˆåŠŸé¡µé¢</p></figure><h1 id="5373" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">ä½¿ç”¨GitHubåŠ¨ä½œè‡ªåŠ¨è¿›è¡ŒUIæ£€æŸ¥</h1><p id="7e41" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">ç°åœ¨æˆ‘ä»¬å·²ç»å°†Storybookå‘å¸ƒåˆ°äº†Chromaticï¼Œè®©æˆ‘ä»¬çœ‹çœ‹å¦‚ä½•è‡ªåŠ¨åŒ–UIæµ‹è¯•æ¥æ•æ‰CIçš„bugã€‚Chromaticæä¾›äº†ä¸€ä¸ªGitHubåŠ¨ä½œæ¥å¸®åŠ©æ‚¨è‡ªåŠ¨åŒ–å¯è§†åŒ–å›å½’æµ‹è¯•ã€‚</p><h2 id="8690" class="nu mk it bd ml nv nw dn mp nx ny dp mt li nz oa mv lm ob oc mx lq od oe mz of bi translated">é…ç½®æœºå¯†</h2><p id="2ced" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">ä¸ºäº†ä¿æŠ¤æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œæˆ‘ä»¬å°†åœ¨GitHub Secretsä¸­å­˜å‚¨é¡¹ç›®ä»¤ç‰Œã€‚</p><p id="0e34" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è½¬åˆ°<code class="fe nh ni nj nk b">Settings</code> &gt; <code class="fe nh ni nj nk b">Secrets</code> &gt; <code class="fe nh ni nj nk b">actions</code>ç„¶åç‚¹å‡»<code class="fe nh ni nj nk b">New repository secret</code>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oj"><img src="../Images/4cc7c20ff5c7c74c2df43962c5600242.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ydh582ic9vttWMGDNdQ8hw.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">è®¾ç½®</p></figure><p id="87a2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åæ·»åŠ <code class="fe nh ni nj nk b">CHROMATIC_PROJECT_TOKEN</code>å¹¶ç”¨ä¸Šé¢ç”Ÿæˆçš„é¡¹ç›®ä»¤ç‰Œæ›¿æ¢è¯¥å€¼:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ok"><img src="../Images/56b65cd0ac23fceadffe9131b6c51e35.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*qlY-_LMmiBP7uEP3SIzoDQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">æ–°ç§˜å¯†</p></figure><h2 id="46e2" class="nu mk it bd ml nv nw dn mp nx ny dp mt li nz oa mv lm ob oc mx lq od oe mz of bi translated">æ·»åŠ å¼€å‘å·¥ä½œæµ</h2><p id="9a63" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">æˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå·¥ä½œæµï¼Œå°†Storybookå‘å¸ƒåˆ°Chromaticï¼Œå¹¶åˆ›å»ºä¸€ä¸ªé“¾æ¥åˆ°Storybookå’ŒChromaticçš„æ³¨é‡Šã€‚è®©æˆ‘ä»¬çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><p id="34ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åˆ›å»º<code class="fe nh ni nj nk b">.github/workflows/chromatic_dev.yml</code>:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="3114" class="np mk it nk b be nq nr l ns nt">name: Chromatic development<br/>on:<br/>  pull_request:<br/>    branches: [main]<br/><br/>jobs:<br/>  chromatic:<br/>    name: chromatic development<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - uses: actions/checkout@v2<br/>        with:<br/>          fetch-depth: 0<br/>      - uses: actions/setup-node@v2<br/>        with:<br/>          node-version: 16.18.1<br/>      - name: Cache node_modules<br/>        uses: actions/cache@v2<br/>        id: node_modules_cache_id<br/>        with:<br/>          path: node_modules<br/>          key: v1-yarn-${{ hashFiles(format('{0}{1}', github.workspace, '/yarn.lock')) }}<br/>          restore-keys: |<br/>            v1-yarn-<br/>      - name: Run install<br/>        if: steps.node_modules_cache_id.outputs.cache-hit != 'true'<br/>        run: yarn install --frozen-lockfile --silent<br/>      - name: Run codegen<br/>        run: yarn codegen<br/>      - name: Publish to Chromatic<br/>        uses: chromaui/action@v1<br/>        id: chromatic<br/>        with:<br/>          projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}<br/>          exitZeroOnChanges: true<br/>      - name: Remove unnecessary path for Chromatic link<br/>        id: storybook-url<br/>        run: echo "::set-output name=value::${STORYBOOK_URL//\/iframe.html/}"<br/>        env:<br/>          STORYBOOK_URL: ${{ steps.chromatic.outputs.storybookUrl }}<br/>      - name: Find Comment<br/>        uses: peter-evans/find-comment@v2<br/>        id: fc<br/>        with:<br/>          issue-number: ${{ github.event.pull_request.number }}<br/>          comment-author: 'github-actions[bot]'<br/>          body-includes: ':books: Storybook :books:'<br/>      - name: Get datetime for now<br/>        id: datetime<br/>        run: echo "::set-output name=value::$(date)"<br/>        env:<br/>          TZ: Asia/Tokyo<br/>      - name: Create or update comment<br/>        uses: peter-evans/create-or-update-comment@v2<br/>        with:<br/>          comment-id: ${{ steps.fc.outputs.comment-id }}<br/>          issue-number: ${{ github.event.pull_request.number }}<br/>          body: |<br/>            Visit the :books: **Storybook** :books: for this PR (updated for commit ${{ github.event.pull_request.head.sha }}):<br/>            &lt;${{ steps.storybook-url.outputs.value }}&gt;<br/><br/>            &lt;sub&gt;Build URL: ${{ steps.chromatic.outputs.buildUrl }}&lt;/sub&gt;<br/>            &lt;sub&gt;(:fire: updated at ${{ steps.datetime.outputs.value }})&lt;/sub&gt;<br/>          edit-mode: replace</span></pre><p id="250f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æäº¤æ–‡ä»¶å¹¶æ¨é€ï¼Œç„¶åå·¥ä½œæµå°†å¼€å§‹ã€‚</p><p id="b2ae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸€æ—¦å·¥ä½œæµå®Œæˆï¼Œæ‚¨å°†å¾—åˆ°ä¸€ä¸ªæ³¨é‡Šï¼Œå³<a class="ae ky" href="https://github.com/manakuro/visual-regression-testing-with-chromatic-example/pull/2" rel="noopener ugc nofollow" target="_blank">çœ‹èµ·æ¥åƒè¿™æ ·</a>:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ol"><img src="../Images/ca358df6519aef87306cfb767cdd0d86.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*bDA8sbU4RfNaGlOk_vVOqA.png"/></div></div></figure><p id="4589" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ¯æ¬¡ä½ æ¨ä¸€ä¸ªæ–°çš„commitï¼Œå®ƒéƒ½ä¼šå‘å¸ƒStorybookï¼Œè¯„è®ºä¹Ÿä¼šéšç€æ–°çš„æ”¹å˜è€Œæ›´æ–°ã€‚</p><h2 id="eede" class="nu mk it bd ml nv nw dn mp nx ny dp mt li nz oa mv lm ob oc mx lq od oe mz of bi translated">UIæµ‹è¯•</h2><p id="cc61" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">è®©æˆ‘ä»¬æ·»åŠ ä¸€äº›æ›´æ”¹ï¼Œçœ‹çœ‹UIæµ‹è¯•æ˜¯å¦‚ä½•å·¥ä½œçš„ã€‚</p><p id="739f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ‰“å¼€<code class="fe nh ni nj nk b">src/pages/Countries/Countries.tsx</code>å¹¶åˆ é™¤ä¸€äº›ä»£ç :</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="df87" class="np mk it nk b be nq nr l ns nt">            &gt;<br/>              &lt;h2&gt;{c.name}&lt;/h2&gt;<br/>              &lt;p&gt;capital: {c.capital}&lt;/p&gt;<br/>-             &lt;p&gt;currency: {c.currency}&lt;/p&gt;<br/>            &lt;/a&gt;<br/>          ))}<br/>        &lt;/div&gt;</span></pre><p id="89f7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å‡ºç‰ˆåï¼ŒChromaticå‘ç°äº†è¿™æ ·çš„å˜åŒ–:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi om"><img src="../Images/19cd18ce822a17e898aa953ca548c804.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*fRs35lGuspJOEAiJZHH7WA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">UIæµ‹è¯•</p></figure><p id="aac9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿™é‡Œå¯ä»¥çœ‹åˆ°PR <a class="ae ky" href="https://github.com/manakuro/visual-regression-testing-with-chromatic-example/pull/7" rel="noopener ugc nofollow" target="_blank">è¿™é‡Œ</a>ã€‚</p><h2 id="c0ec" class="nu mk it bd ml nv nw dn mp nx ny dp mt li nz oa mv lm ob oc mx lq od oe mz of bi translated">æ·»åŠ ä¸»å·¥ä½œæµ</h2><p id="e415" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">Chromaticæä¾›äº†ä¸åˆ†æ”¯å’Œæäº¤ç›¸å¯¹åº”çš„æ°¸ä¹…é“¾æ¥ã€‚æ°¸ä¹…é“¾æ¥æ ¼å¼ä¸º:</p><p id="0546" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nh ni nj nk b">https://&lt;branch&gt; â€” &lt;appid&gt;.chromatic.com</code></p><p id="fa66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ‚¨å¯ä»¥åœ¨<code class="fe nh ni nj nk b">Manage</code> &gt; <code class="fe nh ni nj nk b">Permalinks</code>è·å¾—æ°¸ä¹…é“¾æ¥:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi on"><img src="../Images/ea48b847cfd2ac7bc20a11176dab0a3c.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*ZAthKeC6Nw5ZLmFwPkmMvQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">æ°¸ä¹…é“¾æ¥</p></figure><p id="1926" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸€æ—¦å°†PRåˆå¹¶åˆ°ä¸»åˆ†æ”¯ä¸­ï¼Œæˆ‘ä»¬å¸Œæœ›å°†å…¶å‘å¸ƒåˆ°Chromaticï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é“¾æ¥åˆ°ä¸»åˆ†æ”¯çš„æœ€æ–°æ•…äº‹ä¹¦ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å°†ä¸ºä¸»åˆ†æ”¯åˆ›å»ºä¸€ä¸ªå·¥ä½œæµã€‚</p><p id="73bd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åˆ›å»º<code class="fe nh ni nj nk b">.github/workflows/chromatic_main.yml</code>:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="b127" class="np mk it nk b be nq nr l ns nt">name: Chromatic main<br/>on:<br/>  push:<br/>    branches: [main]<br/><br/>jobs:<br/>  chromatic:<br/>    name: chromatic main<br/>    runs-on: ubuntu-latest<br/>    steps:<br/>      - uses: actions/checkout@v2<br/>        with:<br/>          fetch-depth: 0<br/>      - uses: actions/setup-node@v2<br/>        with:<br/>          node-version: 16.18.1<br/>      - name: Cache node_modules<br/>        uses: actions/cache@v2<br/>        id: node_modules_cache_id<br/>        with:<br/>          path: node_modules<br/>          key: v1-yarn-${{ hashFiles(format('{0}{1}', github.workspace, '/yarn.lock')) }}<br/>          restore-keys: |<br/>            v1-yarn-<br/>      - name: Run install<br/>        if: steps.node_modules_cache_id.outputs.cache-hit != 'true'<br/>        run: yarn install --frozen-lockfile --silent<br/>      - name: Run codegen<br/>        run: yarn codegen<br/>      - name: Publish to Chromatic<br/>        uses: chromaui/action@v1<br/>        id: chromatic<br/>        with:<br/>          projectToken: ${{ secrets.CHROMATIC_PROJECT_TOKEN }}<br/>          autoAcceptChanges: true</span></pre><p id="5be3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nh ni nj nk b">autoAcceptChanges</code>é€‰é¡¹åº”è¯¥ä¸ºçœŸï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»æ£€æŸ¥äº†PRä¸­çš„æ›´æ”¹ï¼Œæ‰€ä»¥å‘å¸ƒå®ƒã€‚</p><p id="0c77" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å®Œæˆåï¼Œæœ€æ–°çš„æ•…äº‹ä¹¦å°†åœ¨<code class="fe nh ni nj nk b">https://main â€” &lt;appid&gt;.chromatic.com</code>å‘å¸ƒã€‚</p><h1 id="df4f" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">å•å…ƒæµ‹è¯•</h1><p id="1808" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">æœ€åï¼Œæˆ‘ä»¬å°†ä½¿ç”¨MSWæœåŠ¡å™¨å®ç°å•å…ƒæµ‹è¯•ã€‚</p><p id="53d6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å®‰è£…<code class="fe nh ni nj nk b">@testing-library/react</code>åŒ…:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="ae1f" class="np mk it nk b be nq nr l ns nt">yarn add -D @testing-library/react @testing-library/jest-dom @testing-library/user-event</span></pre><p id="c8c0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å®‰è£…jestå’Œå…¶ä»–è½¯ä»¶åŒ…:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="00a7" class="np mk it nk b be nq nr l ns nt">yarn add -D jest jest-environment-jsdom @swc/core @swc/jest @types/jest node-fetch@2.6.6 empty</span></pre><p id="2243" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åˆ›å»º<code class="fe nh ni nj nk b">jest.config.js</code>:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="9655" class="np mk it nk b be nq nr l ns nt">module.exports = {<br/>  testEnvironment: 'jsdom',<br/>  globals: {<br/>    __DEV__: true,<br/>  },<br/>  testMatch: ['**/src/**/?(*.)+(spec|test).[jt]s?(x)'],<br/>  testPathIgnorePatterns: ['&lt;rootDir&gt;/.next/', '&lt;rootDir&gt;/node_modules/'],<br/>  setupFilesAfterEnv: ['&lt;rootDir&gt;/setupTests.js'],<br/>  transform: {<br/>    '^.+\\.(js|jsx|ts|tsx)$': ['@swc/jest'],<br/>  },<br/>  moduleFileExtensions: ['ts', 'tsx', 'js', 'jsx', 'json', 'd.ts'],<br/>  moduleNameMapper: {<br/>    '\\.(jpg|jpeg|png|gif|eot|otf|webp|svg|ttf|woff|woff2|mp4|webm|wav|mp3|m4a|aac|oga|css)$':<br/>      'empty/object',<br/>    '^src/(.*)$': '&lt;rootDir&gt;/src/$1',<br/>  },<br/>}</span></pre><p id="daca" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åˆ›å»º<code class="fe nh ni nj nk b">setupTests.js</code>:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="b0ed" class="np mk it nk b be nq nr l ns nt">import '@testing-library/jest-dom/extend-expect'<br/><br/>global.fetch = require('node-fetch')<br/><br/>jest.mock('src/config')<br/>jest.retryTimes(3, { logErrorsBeforeRetry: true })<br/><br/>// @see https://jestjs.io/docs/manual-mocks#mocking-methods-which-are-not-implemented-in-jsdom<br/>Object.defineProperty(window, 'matchMedia', {<br/>  writable: true,<br/>  value: jest.fn().mockImplementation((query) =&gt; ({<br/>    matches: false,<br/>    media: query,<br/>    onchange: null,<br/>    addListener: jest.fn(), // deprecated<br/>    removeListener: jest.fn(), // deprecated<br/>    addEventListener: jest.fn(),<br/>    removeEventListener: jest.fn(),<br/>    dispatchEvent: jest.fn(),<br/>  })),<br/>})</span></pre><p id="192e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åˆ›å»º<code class="fe nh ni nj nk b">.swcrc</code>:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="9a42" class="np mk it nk b be nq nr l ns nt">{<br/>  "jsc": {<br/>    "target": "es2015",<br/>    "parser": {<br/>      "syntax": "typescript",<br/>      "tsx": true<br/>    },<br/>    "transform": {<br/>      "react": {<br/>        "runtime": "automatic",<br/>        "pragma": "React.createElement",<br/>        "pragmaFrag": "React.Fragment",<br/>        "throwIfNamespace": true,<br/>        "useBuiltins": true<br/>      }<br/>    }<br/>  },<br/>  "sourceMaps": true<br/>}</span></pre><p id="c923" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åˆ›å»º<code class="fe nh ni nj nk b">src/mocks/server.ts</code>:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="5ea1" class="np mk it nk b be nq nr l ns nt">import { setupServer } from 'msw/node'<br/>import { handlers as queryHandlers } from './queries/handlers'<br/><br/>export const server = setupServer(...[...queryHandlers])<br/><br/>export const removeAllListeners = () =&gt; {<br/>  server.events.removeAllListeners()<br/>}</span></pre><p id="84dd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬å°†åˆ›å»º<code class="fe nh ni nj nk b">src/testUtils</code>ï¼Œç»“æ„å¦‚ä¸‹:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="4f19" class="np mk it nk b be nq nr l ns nt">src/testUtils/<br/>â”œâ”€â”€ Provider.tsx<br/>â”œâ”€â”€ index.ts<br/>â””â”€â”€ mock<br/>    â””â”€â”€ setup.ts</span></pre><p id="51a3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åˆ›å»º<code class="fe nh ni nj nk b">src/testUtils/Provider.tsx</code>:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="2b99" class="np mk it nk b be nq nr l ns nt">import React, { useMemo } from 'react'<br/>import { createApolloClient } from 'src/shared/apollo/client'<br/>import { ApolloProvider as ApolloProviderLibs } from '@apollo/client'<br/><br/>export const Provider: React.FCWithChildren = (props) =&gt; {<br/>  return &lt;ApolloProvider&gt;{props.children}&lt;/ApolloProvider&gt;<br/>}<br/><br/>const ApolloProvider: React.FCWithChildren = (props) =&gt; {<br/>  const client = useMemo(() =&gt; createApolloClient({ idToken: 'token' }), [])<br/><br/>  return (<br/>    &lt;ApolloProviderLibs client={client}&gt;{props.children}&lt;/ApolloProviderLibs&gt;<br/>  )<br/>}</span></pre><p id="9b07" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åˆ›å»º<code class="fe nh ni nj nk b">src/testUtils/mock/setup.ts</code>:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="0f73" class="np mk it nk b be nq nr l ns nt">import { server } from 'src/mocks/server'<br/><br/>type Callback = () =&gt; void<br/><br/>export const startServer = (callback?: Callback) =&gt; {<br/>  beforeAll(async () =&gt; {<br/>    if (callback) await callback()<br/>    server.listen()<br/>  })<br/>}<br/><br/>export const resetServer = (callback?: Callback) =&gt; {<br/>  afterAll(async () =&gt; {<br/>    if (callback) await callback()<br/>    server.resetHandlers()<br/>  })<br/>}<br/><br/>export const resetHandlers = (callback?: Callback) =&gt; {<br/>  afterEach(async () =&gt; {<br/>    if (callback) await callback()<br/>    server.resetHandlers()<br/>  })<br/>}<br/><br/>export const closeServer = (callback?: Callback) =&gt; {<br/>  afterAll(async () =&gt; {<br/>    if (callback) await callback()<br/>    server.close()<br/>  })<br/>}</span></pre><p id="976a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬å°†åœ¨æµ‹è¯•ä¸­ä½¿ç”¨è¿™äº›å‡½æ•°æ¥æ¨¡æ‹ŸGraphQLè¯·æ±‚ã€‚</p><p id="2380" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è®©æˆ‘ä»¬åˆ›å»º<code class="fe nh ni nj nk b">src/pages/Countries/Countries.test.tsx</code>:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="cb01" class="np mk it nk b be nq nr l ns nt">import { render, screen } from '@testing-library/react'<br/>import React from 'react'<br/>import { removeAllListeners } from 'src/mocks/server'<br/>import { Provider } from 'src/testUtils'<br/>import {<br/>  closeServer,<br/>  resetHandlers,<br/>  resetServer,<br/>  startServer,<br/>} from 'src/testUtils/mock/setup'<br/>import { Countries as Component } from '../Countries'<br/><br/>type Props = {}<br/>const propsData = (options?: Partial&lt;Props&gt;): Props =&gt; ({<br/>  ...options,<br/>})<br/><br/>describe('pages/Countries', () =&gt; {<br/>  startServer()<br/>  closeServer()<br/>  resetServer()<br/>  resetHandlers()<br/><br/>  beforeEach(async () =&gt; {<br/>    removeAllListeners()<br/>  })<br/><br/>  describe('Countries', () =&gt; {<br/>    test('renders countries list', async () =&gt; {<br/>      render(<br/>        &lt;Provider&gt;<br/>          &lt;Component {...propsData()} /&gt;<br/>        &lt;/Provider&gt;,<br/>      )<br/><br/>      expect(await screen.findByText('Argentina')).toBeInTheDocument()<br/>    })<br/>  })<br/>})</span></pre><p id="a05f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">é‚£ä¹ˆå®ƒåº”è¯¥èƒ½é€šè¿‡æµ‹è¯•ã€‚çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="9a33" class="np mk it nk b be nq nr l ns nt"> PASS  src/pages/Countries/__tests__/Countries.test.tsx<br/>  pages/Countries<br/>    Countries<br/>      âœ“ renders countries list (67 ms)<br/><br/>Test Suites: 1 passed, 1 total<br/>Tests:       1 passed, 1 total<br/>Snapshots:   0 total<br/>Time:        1.247 s, estimated 5 s<br/>Ran all test suites.<br/>âœ¨  Done in 2.48s.</span></pre><p id="8a4e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å½“æˆ‘ä»¬æƒ³è¦æ”¹å˜å“åº”æ—¶ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code class="fe nh ni nj nk b"><a class="ae ky" href="https://mswjs.io/docs/api/setup-server/use" rel="noopener ugc nofollow" target="_blank">server.use</a></code>åœ¨æµ‹è¯•ä¸­æ¨¡æ‹Ÿå®ƒ:</p><pre class="kj kk kl km gt nl nk nm bn nn no bi"><span id="8277" class="np mk it nk b be nq nr l ns nt">//...<br/>import { removeAllListeners, server } from 'src/mocks/server'<br/>import { countriesQuery } from 'src/mocks/queries/countries'<br/><br/>test('renders Japan', async () =&gt; {<br/>  // Change a reponse against Countries query.<br/>  // Countries list will be deeply merged with the new value.<br/>  server.use(<br/>    countriesQuery({<br/>      res: {<br/>        countries: [<br/>          {<br/>            name: 'Japan',<br/>            native: 'æ—¥æœ¬',<br/>            capital: 'Tokyo',<br/>            emoji: 'ğŸ‡¯ğŸ‡µ',<br/>            currency: 'JPY',<br/>            languages: [<br/>              {<br/>                code: 'ja',<br/>                name: 'Japanese',<br/>              },<br/>            ],<br/>          },<br/>        ],<br/>      },<br/>    }),<br/>  )<br/><br/>  render(<br/>    &lt;Provider&gt;<br/>      &lt;Component {...propsData()} /&gt;<br/>    &lt;/Provider&gt;,<br/>  )<br/><br/>  expect(await screen.findByText('Japan')).toBeInTheDocument()<br/>})</span></pre><h1 id="1a70" class="mj mk it bd ml mm mn mo mp mq mr ms mt jz mu ka mv kc mw kd mx kf my kg mz na bi translated">ç»“è®º</h1><p id="a4ee" class="pw-post-body-paragraph kz la it lb b lc nb ju le lf nc jx lh li nd lk ll lm ne lo lp lq nf ls lt lu im bi translated">æˆ‘ä»¬å·²ç»ä»‹ç»äº†å¦‚ä½•å°†å¯è§†åŒ–å›å½’æµ‹è¯•å¼•å…¥åˆ°æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä¸­ã€‚åœ¨å‰ç«¯æµ‹è¯•ä¸­ï¼Œæˆ‘ä»¬åº”è¯¥æµ‹è¯•åº”ç”¨ç¨‹åºå’Œç”¨æˆ·ç•Œé¢çš„å®é™…è¡Œä¸ºã€‚</p><p id="a5c8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Chromaticä¼šè‡ªåŠ¨æ£€æµ‹UIçš„å˜åŒ–ï¼Œå…è®¸æ‚¨é‡æ„ä»£ç åº“ï¼Œè€Œä¸ç”¨æ‹…å¿ƒUIé”™è¯¯ã€‚MSWä½¿æ‚¨èƒ½å¤Ÿåœ¨ä¸æ¨¡ä»¿åº”ç”¨ç¨‹åºä»£ç çš„æƒ…å†µä¸‹ï¼Œå‡†ç¡®åœ°æµ‹è¯•æ‚¨çš„åº”ç”¨ç¨‹åºä¸ç”¨æˆ·çš„äº¤äº’æ–¹å¼ã€‚</p></div></div>    
</body>
</html>