<html>
<head>
<title>The Whole Shebang: Compose Files</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">æ•´ä¸ªäº‹æƒ…:ç¼–å†™æ–‡ä»¶</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/the-whole-shebang-compose-files-5b6f50dd196c?source=collection_archive---------11-----------------------#2022-02-02">https://betterprogramming.pub/the-whole-shebang-compose-files-5b6f50dd196c?source=collection_archive---------11-----------------------#2022-02-02</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="317c" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">é€šè¿‡ç†è§£å’Œå®è·µDocker Composeçš„æ¯ä¸ªå¯ç”¨é€‰é¡¹ï¼ŒæŒæ¡å¤šå®¹å™¨åº”ç”¨ç¨‹åº</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/459ccdf8161241e45dba2e4a7941e469.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*mH0yw7Pu6NdGGTlX"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae ky" href="https://unsplash.com/@ventiviews?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">å¡æ¢…éš†é€šé£</a>åœ¨<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„</p></figure><p id="e5e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘æœ€è¿‘ä¸€ç›´åœ¨å†™å…³äºDockerå’Œå®¹å™¨çš„æ–‡ç« ã€‚æˆ‘éå¸¸æ„Ÿè°¢é‚£äº›ä½¿ç”¨æˆ‘çš„å†…å®¹å¹¶æä¾›åé¦ˆçš„äººã€‚æˆ‘æ˜ç™½ä½ çš„æ„æ€ï¼Œå¾ˆè‡ªç„¶ï¼Œä¸‹ä¸€ä¸ªè¦è§£å†³çš„è¯é¢˜æ˜¯Docker Composeâ€”â€”å› ä¸ºç°åœ¨ä½ å·²ç»çŸ¥é“å¦‚ä½•æ„å»ºè‡ªå·±çš„å®¹å™¨æ˜ åƒå¹¶è¿è¡Œå®ƒä»¬ï¼Œä¸‹ä¸€ä¸ªé€»è¾‘é‡Œç¨‹ç¢‘æ˜¯åˆ›å»ºå¤æ‚çš„å¤šå®¹å™¨åº”ç”¨ç¨‹åºï¼Œå¹¶å°†æ‰€æœ‰è¿™äº›ä½œä¸ºå•ä¸ªè½¯ä»¶è¿›è¡Œç®¡ç†ã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="6107" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">Docker Compose:å®ƒæ˜¯ä»€ä¹ˆï¼Œä¸ºä»€ä¹ˆæˆ‘éœ€è¦å®ƒï¼Ÿ</h1><blockquote class="mu mv mw"><p id="e699" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated"><strong class="lb iu"> Compose </strong>æ˜¯ä¸€ä¸ªå®šä¹‰å’Œè¿è¡Œå¤šå®¹å™¨<strong class="lb iu"> Docker </strong>åº”ç”¨çš„å·¥å…·ã€‚</p></blockquote><p id="7db6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ‚¨å¯ä»¥ä»<a class="ae ky" href="https://docs.docker.com/compose/" rel="noopener ugc nofollow" target="_blank">å®˜æ–¹æ–‡æ¡£</a>ä¸­äº†è§£æ›´å¤šä¿¡æ¯ï¼Œä½†æ˜¯ä¸ºäº†ç®€åŒ–ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹å†…å®¹:æ‚¨ä½¿ç”¨<strong class="lb iu"> Docker </strong>æ¥ç®¡ç†å®¹å™¨ã€å›¾åƒã€å·ç­‰ã€‚å½“ä½ åš<code class="fe nb nc nd ne b">docker run</code>æ—¶ï¼Œä½ åŸºæœ¬ä¸Šæ˜¯åœ¨æ‰§è¡Œä¸€ä¸ª<strong class="lb iu">å•ä¸ª</strong>å®¹å™¨ã€‚å¦‚æœæ‚¨æƒ³å¯åŠ¨ç¬¬äºŒä¸ªå®¹å™¨ï¼Œä»¥æŸç§æ–¹å¼ä¸ç¬¬ä¸€ä¸ªå®¹å™¨è¿›è¡Œäº¤äº’ï¼Œæ‚¨éœ€è¦å†æ¬¡è¿è¡Œ<code class="fe nb nc nd ne b">docker run</code>,å¹¶åˆ†åˆ«å¤„ç†å®ƒä»¬çš„å·å’Œç½‘ç»œï¼Œè¿™æ ·å®ƒä»¬å°±å¯ä»¥ç›¸äº’æŸ¥çœ‹å’Œé€šä¿¡ã€‚</p><p id="8e44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Docker Composeé€šè¿‡åœ¨Dockerä¹‹ä¸Šæä¾›ä¸€ä¸ª<strong class="lb iu">åŒ…è£…å™¨</strong>æŠ½è±¡äº†æ‰€æœ‰è¿™äº›(æ˜¯çš„ï¼Docker Composeåªæ˜¯Dockerçš„ä¸€ä¸ªé«˜çº§CLI)ã€‚äº‹å®ä¸Šï¼Œæ‚¨ä¼šçœ‹åˆ°å¤§å¤šæ•°é€‰é¡¹çš„å‘½åæ–¹å¼ä¸<code class="fe nb nc nd ne b">docker run</code>å­å‘½ä»¤ä¸­çš„é€‰é¡¹éå¸¸ç›¸ä¼¼ã€‚</p><p id="1ae2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä½¿ç”¨Docker Composeï¼Œæ‚¨å¯ä»¥é€šè¿‡åä¸º<strong class="lb iu"> Compose Files </strong>çš„YAMLæ–‡ä»¶ï¼Œä»¥å£°æ˜æ–¹å¼<strong class="lb iu">å®šä¹‰æ‚¨çš„æ‰€æœ‰å®¹å™¨(åœ¨Docker Composeä¸–ç•Œä¸­ç§°ä¸º<code class="fe nb nc nd ne b">services</code>â€¦,å› ä¸ºæ‚¨ä¹Ÿå¯ä»¥åœ¨Swarmæ¨¡å¼ä¸‹ä½¿ç”¨Composeæ–‡ä»¶â€¦â€¦ä½†åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­ä¼šæœ‰æ›´å¤šç›¸å…³å†…å®¹)ã€å·å’Œç½‘ç»œåŠå…¶é…ç½®ã€‚è¿™æ ·ï¼Œæ¯å½“ä½ éœ€è¦ç®¡ç†ä½ çš„å¤šå®¹å™¨åº”ç”¨ç¨‹åºæ—¶ï¼Œä½ åªéœ€è¦æ¥è§¦è¿™ä¸ªcomposeæ–‡ä»¶ï¼Œç„¶åè®©Docker Composeå¤„ç†å…¶ä»–çš„äº‹æƒ…ã€‚</strong></p><h1 id="82c3" class="mc md it bd me mf nf mh mi mj ng ml mm jz nh ka mo kc ni kd mq kf nj kg ms mt bi translated">æ’°å†™æ–‡ä»¶</h1><p id="5394" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">æˆ‘ä»¬å°†æŠŠDocker Compose CLIç•™ç»™å¦ä¸€ç¯‡æ–‡ç« ï¼Œå› ä¸ºé¦–å…ˆï¼Œæ‚¨éœ€è¦å­¦ä¹ å¦‚ä½•ç¼–å†™Composeæ–‡ä»¶ï¼Œä»¥ä¾¿èƒ½å¤Ÿæ­£ç¡®åœ°å°†å¤šå®¹å™¨åº”ç”¨ç¨‹åºæŠ•å…¥ä½¿ç”¨ã€‚</p><p id="208b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">compose filesä¸Šçš„<a class="ae ky" href="https://docs.docker.com/compose/compose-file/" rel="noopener ugc nofollow" target="_blank">Docker docs</a>éå¸¸å®Œæ•´ï¼Œä½†æ˜¯æˆ‘åšä¿¡å®ç”¨ä¸»ä¹‰å’Œä»ç»éªŒä¸­å­¦ä¹ ï¼Œæ‰€ä»¥æˆ‘å°†æ•´ç†æ‰€æœ‰çš„Compose Fileé€‰é¡¹ï¼Œå¹¶æä¾›ç®€å•çš„è§£é‡Šå’ŒçœŸå®çš„ä¾‹å­â€”â€”å¼€å§‹å§ï¼</p><p id="8f52" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">æ³¨1: </strong>æˆ‘å°†åªè®¨è®ºcompose filesè§„èŒƒv3çš„é€‰é¡¹å’Œæ¨¡å¼(è¿™æ˜¯æ’°å†™æœ¬æ–‡æ—¶çš„æœ€æ–°ç‰ˆæœ¬ï¼Œæ‰€ä»¥åº”è¯¥æ²¡é—®é¢˜)</p><p id="7292" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">æ³¨2: </strong>å¯¹äºæ¯ä¸ªé€‰é¡¹ï¼Œæˆ‘å°†åªè§£é‡Šå’Œä¸¾ä¾‹è¯´æ˜å®ƒä»¬çš„å¸¸è§ç”¨æ³•(å³æˆ‘å°†ä½¿ç”¨æˆ‘å¤šå¹´çš„Dockerç»éªŒä½œä¸ºå‚è€ƒï¼Œå› æ­¤å¦‚æœæœ‰æŸä¸ªé€‰é¡¹å‚æ•°æˆ‘ä»æœªä½¿ç”¨è¿‡ï¼Œæˆ‘ä¼šå°†å…¶è§†ä¸ºâ€œä¸å¸¸ç”¨â€)ã€‚å…³äºä»€ä¹ˆæ˜¯å¯èƒ½çš„ä»¥åŠå¦‚ä½•ä½¿ç”¨æŸä¸ªé€‰é¡¹çš„ä¸å¸¸ç”¨å‚æ•°çš„æ›´å¤šç»†èŠ‚ï¼Œè¯·æŸ¥çœ‹<a class="ae ky" href="https://docs.docker.com/compose/compose-file/compose-file-v3/" rel="noopener ugc nofollow" target="_blank">æ­£å¼æ–‡æ¡£</a></p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="d51b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨æ·±å…¥ç¤ºä¾‹ä¹‹å‰ï¼Œè¯·æ³¨æ„æ‰€æœ‰çš„åˆæˆæ–‡ä»¶éƒ½ä»¥å…³é”®å­—<code class="fe nb nc nd ne b">version</code>å¼€å¤´ï¼Œè¡¨ç¤ºæˆ‘ä»¬æ­£åœ¨ç¼–å†™çš„åˆæˆæ–‡ä»¶çš„æ¨¡å¼ã€‚å¦‚ä¸Šæ‰€è¿°ï¼Œæˆ‘ä»¬çš„å°†æ˜¯æœ€æ–°çš„(<code class="fe nb nc nd ne b">version: â€œ3â€</code>)ã€‚</p><h2 id="2de6" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">å»ºè®¾</h2><p id="630b" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">åŸºæœ¬ä¸Šï¼Œå½“æ‚¨å¼€å§‹ä½¿ç”¨Docker Composeæ—¶ï¼Œæ‚¨å¯ä»¥æä¾›Dockerå›¾åƒæˆ–Dockeræ–‡ä»¶ã€‚å¦‚æœæ‚¨å¸Œæœ›Dockeråœ¨å¯åŠ¨ç›¸åº”çš„å®¹å™¨ä¹‹å‰æ„å»ºæ‚¨çš„å®¹å™¨æ˜ åƒï¼Œè€Œä¸å¿…æ‰‹åŠ¨æ„å»ºæ˜ åƒï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚</p><p id="2f87" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¾‹å¦‚:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="e4cc" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;Dockerfile &lt;&lt;EOF<br/># This is the Dockerfile<br/>FROM ubuntu</span><span id="50d7" class="np md it ne b gy oj og l oh oi">CMD ["echo", "Hello Medium readers"]</span><span id="1ab3" class="np md it ne b gy oj og l oh oi"># End of the Dockerfile<br/>EOF<br/><strong class="ne iu">$<br/>$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="7198" class="np md it ne b gy oj og l oh oi">services:<br/>  my-test-container:<br/>    build: .<br/>EOF<br/><strong class="ne iu">$<br/>$ </strong>docker-compose up <br/>Creating network "mediumcom_default" with the default driver<br/>Building my-test-container<br/>Sending build context to Docker daemon  1.337MB<br/>Step 1/2 : FROM ubuntu<br/> ---&gt; ba6acccedd29<br/>Step 2/2 : CMD ["echo", "Hello Medium readers"]<br/> ---&gt; Using cache<br/> ---&gt; 6c8b22fa650c<br/>Successfully built 6c8b22fa650c<br/>Successfully tagged mediumcom_my-test-container:latest<br/>Creating mediumcom_my-test-container_1 ... done<br/>Attaching to mediumcom_my-test-container_1<br/>my-test-container_1  | Hello Medium readers<br/>mediumcom_my-test-container_1 exited with code 0<br/><strong class="ne iu">$</strong></span></pre><p id="b758" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¦‚æ‚¨æ‰€è§ï¼ŒDocker ComposeæŒ‡ç¤ºDockerä»æˆ‘ä»¬çš„Dockerfile(ä½äºä¸Composeæ–‡ä»¶ç›¸åŒçš„è·¯å¾„ä¸­)æ„å»ºä¸€ä¸ªå›¾åƒï¼Œç„¶åè‡ªåŠ¨å¯åŠ¨æˆ‘ä»¬çš„å®¹å™¨ã€‚</p><p id="a1fc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ³¨æ„:<strong class="lb iu"> </strong>æ­£å¦‚æ‚¨æ‰€æ–™ï¼Œæ‚¨é€šå¸¸åœ¨<code class="fe nb nc nd ne b">docker build</code>ä¸­ä½¿ç”¨çš„ä¸€äº›é€‰é¡¹ä¹Ÿå¯ä»¥åœ¨è¿™é‡Œä½¿ç”¨ï¼Œæ¯”å¦‚ä¼ é€’æ„å»ºå‚æ•°ã€æŒ‡å®šdockeræ–‡ä»¶çš„è·¯å¾„å’Œåç§°ç­‰ã€‚æŸ¥çœ‹<a class="ae ky" href="https://docs.docker.com/compose/compose-file/compose-file-v3/#build" rel="noopener ugc nofollow" target="_blank">æ–‡æ¡£</a>äº†è§£æ›´å¤šè¯¦æƒ…ã€‚</p><h2 id="39c7" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">å›¾åƒ</h2><p id="5f0e" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">å¾ˆæ˜æ˜¾ï¼Œä½ ä¸éœ€è¦åœ¨æ¯æ¬¡å¯åŠ¨åº”ç”¨ç¨‹åºæ—¶éƒ½æ„å»ºDockeræ˜ åƒâ€¦é‚£ä¼šå¾ˆéº»çƒ¦ã€‚æ‰€ä»¥ä½ è¦ä¹ˆé€‰æ‹©<code class="fe nb nc nd ne b">build</code>ï¼Œè¦ä¹ˆç®€å•åœ°æŒ‡å®šå®¹å™¨<code class="fe nb nc nd ne b">image</code>ã€‚</p><p id="e519" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¾‹å¦‚ï¼Œå‡è®¾å‰ä¸€ä¸ªç¤ºä¾‹ä¸­çš„dockeræ–‡ä»¶ï¼Œå¹¶é‡‡ç”¨ä»¥ä¸‹åˆæˆæ–‡ä»¶:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="508f" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong># just to clean the previous example<br/><strong class="ne iu">$ </strong># from here on, make sure this command is executed on every <strong class="ne iu"><br/>$ </strong>#<strong class="ne iu"> </strong>example, just for the sake of simplicity<br/><strong class="ne iu">$ </strong>docker-compose down -v --remove-orphans   <br/><strong class="ne iu">$<br/>$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="5db1" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    build: .</span><span id="c26d" class="np md it ne b gy oj og l oh oi">  second:<br/>    image: hello-world<br/>EOF</span><span id="7f1e" class="np md it ne b gy oj og l oh oi"><strong class="ne iu">$ </strong># Dockerfile hasn't changed, so the 1st image won't be rebuilt<strong class="ne iu"><br/>$ docker-compose up </strong>   <br/>Creating network "mediumcom_default" with the default driver<br/>Creating <strong class="ne iu">mediumcom_first_1</strong>  ... done<br/>Creating <strong class="ne iu">mediumcom_second_1</strong> ... done<br/>Attaching to mediumcom_second_1, mediumcom_first_1<br/><strong class="ne iu">first_1   | Hello Medium readers</strong><br/>second_1  | <br/><strong class="ne iu">second_1  | Hello from Docker!</strong><br/>second_1  | This message shows that your installation appears to be working correctly.<br/>second_1  | <br/>second_1  | To generate this message, Docker took the following steps:<br/>second_1  |  1. The Docker client contacted the Docker daemon.<br/>second_1  |  2. The Docker daemon pulled the "hello-world" image from the Docker Hub.<br/>second_1  |     (amd64)<br/>second_1  |  3. The Docker daemon created a new container from that image which runs the<br/>second_1  |     executable that produces the output you are currently reading.<br/>second_1  |  4. The Docker daemon streamed that output to the Docker client, which sent it<br/>second_1  |     to your terminal.<br/>second_1  | <br/>second_1  | To try something more ambitious, you can run an Ubuntu container with:<br/>second_1  |  $ docker run -it ubuntu bash<br/>second_1  | <br/>second_1  | Share images, automate workflows, and more with a free Docker ID:<br/>second_1  |  <a class="ae ky" href="https://hub.docker.com/" rel="noopener ugc nofollow" target="_blank">https://hub.docker.com/</a><br/>second_1  | <br/>second_1  | For more examples and ideas, visit:<br/>second_1  |  <a class="ae ky" href="https://docs.docker.com/get-started/" rel="noopener ugc nofollow" target="_blank">https://docs.docker.com/get-started/</a><br/>second_1  | <br/>mediumcom_second_1 exited with code 0<br/>mediumcom_first_1 exited with code 0</span></pre><p id="dab8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¦‚ä½ æ‰€è§ï¼Œç°åœ¨æˆ‘ä»¬å·²ç»åœ¨åŒä¸€ä¸ªå¤šå®¹å™¨åº”ç”¨ç¨‹åºä¸­ï¼Œä»å•ä¸ªåˆæˆæ–‡ä»¶å’Œå•ä¸ª<code class="fe nb nc nd ne b">docker-compose</code>å‘½ä»¤å¹¶è¡Œå¯åŠ¨äº†2ä¸ªå®¹å™¨ã€‚å…¶ä¸­ä¸€ä¸ªå®¹å™¨ä½¿ç”¨æˆ‘ä»¬å®šåˆ¶çš„Dockeræ˜ åƒæ¥è¡¨ç¤ºâ€œHello Medium readersâ€ï¼Œè€Œå¦ä¸€ä¸ªå®¹å™¨ä»Docker Hubä¸­æå–Dockeræ˜ åƒâ€œhello-world â€,å¹¶æ‰“å°å‡ºè‡ªå·±çš„Hello Worldæ¶ˆæ¯ã€‚</p><h2 id="2ea6" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">å‘½ä»¤</h2><p id="4b90" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">è¿™å…è®¸æ‚¨å®šä¹‰å®¹å™¨çš„å‘½ä»¤ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨çš„Dockeræ˜ åƒå®šä¹‰äº†ä¸€ä¸ªå…¥å£ç‚¹ï¼Œè¿™ä¸ªå‘½ä»¤å°†æ˜¯å®ƒçš„å‚æ•°ã€‚ç¤ºä¾‹:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="9811" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="8501" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: ubuntu<br/>    command: echo "I am at your command!"</span><span id="a40f" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Creating network "mediumcom_default" with the default driver<br/>Creating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/><strong class="ne iu">first_1  | I am at your command!<br/></strong>mediumcom_first_1 exited with code 0</span></pre><p id="3e63" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¶…çº§ç›´ç™½å§ï¼Ÿ</p><h2 id="6270" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">å…¥å£ç‚¹</h2><p id="cf6d" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">é¡¾åæ€ä¹‰ï¼Œå®ƒå…è®¸æ‚¨(é‡æ–°)å®šä¹‰å®¹å™¨çš„å…¥å£ç‚¹ã€‚å‡è®¾æ‚¨å¸Œæœ›æ‚¨çš„å®¹å™¨ä½œä¸ºä¸€ä¸ª<code class="fe nb nc nd ne b">echo</code>å¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œ:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="83ca" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="8c3d" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: ubuntu<br/>    entrypoint: ["echo"]<br/>    command: "I am just an arg"</span><span id="d669" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Creating network "mediumcom_default" with the default driver<br/>Creating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/><strong class="ne iu">first_1  | I am just an arg</strong><br/>mediumcom_first_1 exited with code 0</span></pre><p id="cfe4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç®€å•å§ï¼Ÿå¦‚æœä½ æƒ³çŸ¥é“<code class="fe nb nc nd ne b">command</code>å¯¹<code class="fe nb nc nd ne b">entrypoint</code>ç­‰ç­‰ã€‚ï¼Œä½ ä¸æ˜¯å”¯ä¸€ä¸€ä¸ªã€‚è¿™æ˜¯ä¸€ä¸ªéå¸¸å…¸å‹çš„å›°æƒ‘ç‚¹ã€‚æˆ‘å·²ç»åœ¨æˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« <a class="ae ky" rel="noopener ugc nofollow" target="_blank" href="/the-whole-shebang-dockerfiles-5d59ace94d28">â€œThe Whole she bang:docker filesâ€</a>ä¸­è°ˆè¿‡äº†ã€‚ç®€è€Œè¨€ä¹‹ï¼Œè¿™æ˜¯æˆ‘åœ¨éœ€è¦åè°ƒè¿™ä¸¤ä¸ªé€‰é¡¹æ—¶çš„å¤‡å¿˜å•:<a class="ae ky" href="https://docs.docker.com/engine/reference/builder/#understand-how-cmd-and-entrypoint-interact" rel="noopener ugc nofollow" target="_blank">https://docs . docker . com/engine/reference/builder/# understand-how-cmd-and-entry point-interact</a></p><h2 id="04c9" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">cap_add</h2><p id="8638" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">å¦‚æœæ‚¨çš„å®¹å™¨éœ€è¦é¢å¤–çš„åŠŸèƒ½ï¼Œæ‚¨å¯ä»¥è¿™æ ·æ·»åŠ å®ƒä»¬:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="b0ea" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="5602" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: ubuntu:14.04<br/>    command: <!-- -->ip link add dummy0 type dummy<br/>    cap_add:<br/>     - NET_ADMIN</span><span id="cc91" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>mediumcom_first_1 <strong class="ne iu">exited with code 0</strong></span></pre><p id="1c21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç°åœ¨ï¼Œå¦‚æœæ‚¨è¦è¿è¡Œä¸ä¸Šé¢ç›¸åŒçš„å®¹å™¨ï¼Œä½†æ˜¯æ²¡æœ‰è¯¥åŠŸèƒ½ï¼Œæ‚¨ä¼šå¾—åˆ°ä¸€ä¸ªé”™è¯¯:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="a9d3" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="4c25" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: ubuntu:14.04<br/>    command: <!-- -->ip link add dummy0 type dummy</span><span id="d1ed" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/><strong class="ne iu">first_1  | RTNETLINK answers: Operation not permitted</strong><br/>mediumcom_first_1 <strong class="ne iu">exited with code 2</strong></span></pre><h2 id="5618" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">cap_drop</h2><p id="fed9" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">ä¸<code class="fe nb nc nd ne b">cap_add</code>å®Œå…¨ç›¸åã€‚ä½¿ç”¨å®ƒä»å®¹å™¨ä¸­åˆ é™¤åŠŸèƒ½ã€‚å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¶…çº§ç‰¹æƒå®¹å™¨:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="4e11" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="64ea" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: ubuntu:14.04<br/>    command: <!-- -->ip link add dummy0 type dummy<br/>    cap_add:<br/>     - <strong class="ne iu">ALL</strong></span><span id="8e3c" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>mediumcom_first_1 exited with code <strong class="ne iu">0</strong></span></pre><p id="546f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä½†æ˜¯æˆ‘ä»¬ä¸å¸Œæœ›å®ƒç®¡ç†ä¸»æœºçš„ç½‘ç»œå †æ ˆ:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="1021" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="f49b" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: ubuntu:14.04<br/>    command: <!-- -->ip link add dummy0 type dummy<br/>    cap_add:<br/>     - ALL<br/>    cap_drop:<br/>     - NET_ADMIN</span><span id="355c" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  | <strong class="ne iu">RTNETLINK answers: Operation not permitted</strong><br/>mediumcom_first_1 exited with code 2</span></pre><h2 id="7684" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">cgroup_parent</h2><p id="b258" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">å¦‚æœä½ æ˜¯ç¬¬ä¸€æ¬¡æ¥è§¦<code class="fe nb nc nd ne b">cgroups</code>ï¼Œè¿™é‡Œæœ‰ä¸€ç¯‡å…³äºå®ƒä»¬çš„å¾ˆå¥½çš„çŸ­æ–‡<a class="ae ky" href="https://medium.com/@asishrs/docker-limit-resource-utilization-using-cgroup-parent-72a646651f9d" rel="noopener"/>ã€‚ç®€è€Œè¨€ä¹‹ï¼ŒLinuxå†…æ ¸ä¸ºç”¨æˆ·æä¾›äº†é€šè¿‡æ§åˆ¶ç»„(åˆå<code class="fe nb nc nd ne b">cgroups</code>)æŒ‰è¿›ç¨‹ä¸¥æ ¼æ§åˆ¶ç³»ç»Ÿèµ„æºä½¿ç”¨çš„èƒ½åŠ›ã€‚åœ¨Dockerä¸­ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥æ§åˆ¶å®¹å™¨å¯ä»¥ä½¿ç”¨å¤šå°‘ç‰¹å®šèµ„æºã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œå®¹å™¨ä¼šå°½å¯èƒ½å¤šåœ°è·å–èµ„æº:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="ad5c" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="e3a0" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: ubuntu<br/>    command: <!-- -->sleep 30</span><span id="0dff" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d <br/>Creating network "root_default" with the default driver<br/>Creating <strong class="ne iu">root_first_1</strong> ... done<br/><strong class="ne iu">$ </strong>docker inspect root_first_1 --format '{{.HostConfig.CgroupParent}}'</span><span id="32ee" class="np md it ne b gy oj og l oh oi"><strong class="ne iu">$</strong></span></pre><p id="dd98" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¦‚æ‚¨æ‰€è§ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œæ²¡æœ‰ä¸ºå®¹å™¨åˆ†é…æ§åˆ¶ç»„ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥æŒ‡å®šä¸€ä¸ªã€‚æˆ‘ä»¬ç”šè‡³å¯ä»¥åˆ†é…æˆ‘ä»¬è‡ªå·±çš„:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="7a1c" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cgcreate -g cpu:test-cgroup-medium<br/><strong class="ne iu">$ </strong>ls /sys/fs/cgroup/cpu<br/>cgroup-limit           cgroup.sane_behavior  cpu.shares    cpuacct.usage         cpuacct.usage_percpu_sys   cpuacct.usage_user  release_agent  <strong class="ne iu">test-cgroup-medium</strong><br/>cgroup.clone_children  cpu.cfs_period_us     cpu.stat      cpuacct.usage_all     cpuacct.usage_percpu_user  docker              system.slice   user.slice<br/>cgroup.procs           cpu.cfs_quota_us      cpuacct.stat  cpuacct.usage_percpu  cpuacct.usage_sys          notify_on_release   tasks</span></pre><p id="c1ad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">é€šè¿‡ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ï¼Œæˆ‘ä»¬å°†èƒ½å¤Ÿé€šè¿‡<code class="fe nb nc nd ne b">cgroup</code> "cpu:test-cgroup-medium ":</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="1a9a" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="1141" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: ubuntu<br/>    command: <!-- -->sleep 30<br/>    cgroup_parent: "<!-- -->cpu:test-cgroup-medium"</span><span id="29a8" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d <br/><strong class="ne iu">Recreating root_first_1</strong> ... done<br/><strong class="ne iu">$ </strong>docker inspect root_first_1 --format '{{.HostConfig.CgroupParent}}'<br/><strong class="ne iu">cpu:test-cgroup-medium<br/>$</strong></span></pre><h2 id="ea19" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">å®¹å™¨åç§°</h2><p id="61e9" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">è¿™ä¸ªé€‰é¡¹æ²¡æœ‰ç«ç®­ç§‘å­¦å¯è¨€ã€‚å®ƒåŸºæœ¬ä¸Šå…è®¸æ‚¨ä¿®æ”¹Dockeråˆæˆéƒ¨ç½²äº§ç”Ÿçš„å®¹å™¨çš„åç§°ã€‚</p><p id="f028" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ‚¨å¯èƒ½å·²ç»æ³¨æ„åˆ°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼ŒDocker Composeä¼šä¸ºæ‚¨çš„å®¹å™¨æ·»åŠ ä¸€ä¸ªåç¼€ï¼Œä¸Docker Composeé¡¹ç›®çš„åç§°ç›¸åŒ¹é…(å¦‚æœæ‚¨æ²¡æœ‰æ˜ç¡®æŒ‡å®šè¿™ä¸ªé¡¹ç›®çš„åç§°ï¼ŒDocker Composeä¼šå°†æ‚¨çš„å½“å‰è·¯å¾„ä½œä¸ºé»˜è®¤è·¯å¾„)ã€‚</p><p id="91f0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å› æ­¤ï¼Œå¦‚æœæ‚¨æƒ³è¦†ç›–è¿™ä¸ªDockerç»„åˆè¡Œä¸ºï¼Œå¹¶ä¸ºç”Ÿæˆçš„å®¹å™¨ä¿®æ”¹æ‚¨è‡ªå·±çš„è‡ªå®šä¹‰åç§°ï¼Œæ‚¨å¯ä»¥ä½¿ç”¨container_nameã€‚ç¤ºä¾‹:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="2ded" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="4242" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: ubuntu<br/>    container_name: my-own-container-name</span><span id="8ba9" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Creating network "mediumcom_default" with the default driver<br/>Creating <strong class="ne iu">my-own-container-name</strong> ... done<br/>Attaching to <strong class="ne iu">my-own-container-name</strong><br/><strong class="ne iu">my-own-container-name</strong> exited with code 0</span></pre><p id="0035" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu"> P.S.: </strong>æ˜¯çš„ï¼Œæ­£å¦‚æ‚¨å¯èƒ½æƒ³çŸ¥é“çš„é‚£æ ·ï¼Œè¿™ä¸ªDocker Composeéƒ¨ç½²ä¸­çš„å…¶ä»–å®¹å™¨å¯ä»¥é€šè¿‡å®¹å™¨åç›¸äº’è”ç³»ã€‚ç¤ºä¾‹:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="3b25" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="ca0e" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sleep 5<br/>    container_name: my-own-container-name</span><span id="d86d" class="np md it ne b gy oj og l oh oi">  second:<br/>    image: alpine<br/>    command: ping -c 1 my-own-container-name</span><span id="6831" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Recreating my-own-container-name ... done<br/>Creating mediumcom_second_1      ... done<br/>Attaching to mediumcom_second_1, my-own-container-name<br/>second_1  | PING my-own-container-name (172.18.0.3): 56 data bytes<br/>second_1  | 64 bytes from 172.18.0.3: seq=0 ttl=64 time=0.743 ms<br/>second_1  | <br/>second_1  | --- my-own-container-name ping statistics ---<br/>second_1  | 1 packets transmitted, 1 packets received, 0% packet loss<br/>second_1  | round-trip min/avg/max = 0.743/0.743/0.743 ms<br/>mediumcom_second_1 exited with code 0<br/>my-own-container-name exited with code 0</span></pre><h2 id="d75f" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">ä¾èµ–äº</h2><p id="4591" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">è®©æˆ‘å…ˆè¯´<strong class="lb iu">ä¸</strong>ï¼Œè¿™ä¸ªé€‰é¡¹<strong class="lb iu">ä¸èƒ½è®©ä½ æ§åˆ¶ä½ çš„å®¹å™¨<strong class="lb iu">åº”ç”¨</strong>çš„å¯åŠ¨é¡ºåºï¼è¿™æ˜¯ä¸€ä¸ªå¸¸è§çš„é”™è¯¯ã€‚ä½†æ˜¯è¯·æƒ³ä¸€æƒ³â€¦æ‚¨çš„å®¹å™¨å†…éƒ¨æ­£åœ¨è¿è¡Œä¸€ä¸ªæˆ–å¤šä¸ªè¿›ç¨‹ï¼Œå› æ­¤å‡è®¾Docker(ç®¡ç†æ‰€è¿°å®¹å™¨çš„äºº)å®Œå…¨äº†è§£åœ¨å®¹å™¨å†…éƒ¨è¿è¡Œçš„ä»»ä½•åº”ç”¨ç¨‹åº/è¿›ç¨‹çš„å•†ä¸šæ™ºèƒ½æ˜¯å¹¼ç¨šçš„ã€‚</strong></p><p id="4c89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿™æ˜¯ä¸€ä¸ªç»†å¾®çš„å·®åˆ«ï¼Œä½†æ˜¯è¿™ä¸ªé€‰é¡¹çš„ä½œç”¨æ˜¯æŒ‡ç¤ºDocker Composeä»¥ä»€ä¹ˆé¡ºåºå¼€å§‹/åœæ­¢å®¹å™¨ã€‚</p><p id="811d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç¤ºä¾‹:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="ee2d" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="ca0d" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    depends_on:<br/>     - second</span><span id="0ae0" class="np md it ne b gy oj og l oh oi">  second:<br/>    image: alpine<br/>    depends_on:<br/>     - first</span><span id="6112" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Creating network "mediumcom_default" with the default driver<br/>Creating <strong class="ne iu">mediumcom_second_1</strong> ... done<br/>Creating <strong class="ne iu">mediumcom_first_1</strong>  ... done<br/>Attaching to mediumcom_second_1, mediumcom_first_1<br/>mediumcom_second_1 exited with code 0<br/>mediumcom_first_1 exited with code 0</span></pre><p id="b80a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">çœ‹åˆ°äº†å—ï¼Ÿå› ä¸º<code class="fe nb nc nd ne b">first</code>ä¾èµ–äº<code class="fe nb nc nd ne b">second</code>ï¼Œæ‰€ä»¥<code class="fe nb nc nd ne b">second</code>å®¹å™¨ä¼šå…ˆå¯åŠ¨ï¼Œç„¶å<code class="fe nb nc nd ne b">first</code>æ‰ä¼šå¯åŠ¨ã€‚åŒæ ·çš„ï¼Œå½“ä½ é˜»æ­¢ä»–ä»¬çš„æ—¶å€™â€”â€”<code class="fe nb nc nd ne b">second</code>ä¼šæœ€åå€’ä¸‹ï¼Œå› ä¸º<code class="fe nb nc nd ne b">first</code>å°±é å®ƒäº†ï¼</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="c6fd" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$</strong> docker-compose down<br/>Removing <strong class="ne iu">mediumcom_first_1</strong>  ... done<br/>Removing <strong class="ne iu">mediumcom_second_1</strong> ... done<br/>Removing network mediumcom_default</span></pre><p id="fc89" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">é™„:</strong>å¦‚æœä½ é™·å…¥æ··ä¹±ï¼Œè€Œä½ ä½¿<code class="fe nb nc nd ne b">second</code>ä¹Ÿä¾èµ–<code class="fe nb nc nd ne b">first</code>æ€ä¹ˆåŠï¼ŸğŸ˜åˆ«æ‹…å¿ƒï¼ŒDockerå¾ˆèªæ˜ï¼Œä¼šå‘Šè¯‰ä½ è¿™æ ·çš„è¯:</p><blockquote class="mu mv mw"><p id="1cbf" class="kz la mx lb b lc ld ju le lf lg jx lh my lj lk ll mz ln lo lp na lr ls lt lu im bi translated">é”™è¯¯:ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªä¹‹é—´å­˜åœ¨å¾ªç¯ä¾èµ–</p></blockquote><h2 id="5051" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">å·</h2><p id="bfab" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">æˆ‘ä¸ä¼šæ·±å…¥è§£é‡ŠDockerå·ã€‚è¿™æ˜¯<a class="ae ky" href="https://docs.docker.com/storage/volumes/" rel="noopener ugc nofollow" target="_blank">ç›¸å½“å¤§çš„è¯é¢˜</a>ã€‚å‡è®¾æ‚¨æœ‰4ç§æ–¹æ³•æ¥ç®¡ç†å®¹å™¨åº”ç”¨ç¨‹åºä¸­çš„æ•°æ®:</p><ol class=""><li id="16de" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu op oq or os bi translated">å°†æ‰€æœ‰æ•°æ®ä¿ç•™åœ¨å®¹å™¨çš„å¯å†™å±‚ä¸­(æ— å·)</li><li id="76a8" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">åœ¨ä¸»æœºå’Œå®¹å™¨ä¹‹é—´åˆ›å»ºä¸€ä¸ªè£…è½½ç‚¹(ç»‘å®šè£…è½½)</li><li id="fe75" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">åˆ›å»ºä¸“ç”¨çš„Dockerèµ„æºæ¥æ‰˜ç®¡å’Œç®¡ç†æ•°æ®ï¼Œç‹¬ç«‹äºå®¹å™¨çš„ç”Ÿå‘½å‘¨æœŸ(å·)</li><li id="bb03" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu op oq or os bi translated">é€šè¿‡ä¸ä¿å­˜ä»»ä½•æ•°æ®ï¼Œè€Œæ˜¯å°†æ•°æ®ä¿å­˜åœ¨å†…å­˜ä¸­(tmpfs)æ¥ä¼˜åŒ–å®¹å™¨çš„æ€§èƒ½ã€‚</li></ol><p id="b800" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç°åœ¨ï¼Œå°½ç®¡å¦‚æ­¤ï¼Œæ‚¨æ˜¾ç„¶å¯ä»¥ä»åˆæˆæ–‡ä»¶ä¸­ç®¡ç†æ‰€æœ‰è¿™äº›ç±»å‹çš„å·ã€‚åˆ°ç›®å‰ä¸ºæ­¢ï¼Œä¸Šé¢æ‰€æœ‰çš„ä¾‹å­éƒ½åˆ©ç”¨äº†å®¹å™¨çš„å¯å†™å±‚ã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨å‰©ä½™çš„3ä¸ªæ•°æ®ç®¡ç†é€‰é¡¹ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="da4b" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="70f4" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: ls /<br/>    volumes:<br/>     - /:/my-hostfs<br/>     - my-volume:/my-volume<br/>     - type: tmpfs<br/>       target: /my-tmpfs</span><span id="1ac2" class="np md it ne b gy oj og l oh oi">volumes:<br/>  my-volume:</span><span id="ace1" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Creating network "test_default" with the default driver<br/>Creating volume "test_my-volume" with default driver<br/>Creating test_first_1 ... done<br/>Attaching to test_first_1<br/>first_1  | bin<br/>first_1  | dev<br/>first_1  | etc<br/>first_1  | home<br/>first_1  | lib<br/>first_1  | media<br/>first_1  | mnt<br/>first_1  | <strong class="ne iu">my-hostfs</strong><br/>first_1  | <strong class="ne iu">my-tmpfs</strong><br/>first_1  | <strong class="ne iu">my-volume</strong><br/>first_1  | opt<br/>first_1  | proc<br/>first_1  | root<br/>first_1  | run<br/>first_1  | sbin<br/>first_1  | srv<br/>first_1  | sys<br/>first_1  | tmp<br/>first_1  | usr<br/>first_1  | var<br/>test_first_1 exited with code 0</span></pre><p id="5bbb" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿™å°±å¯¹äº†ï¼Œä¸‰ç§ä¸åŒç±»å‹çš„åéª‘ä¸€æ°”å‘µæˆã€‚é¡ºä¾¿è¯´ä¸€ä¸‹ï¼Œä½ å¯èƒ½å·²ç»æ³¨æ„åˆ°æˆ‘ä½¿ç”¨äº†3ç§ä¸åŒçš„è¯­æ³•â€¦ä½ å¯ä»¥é€‰æ‹©ä½ å–œæ¬¢çš„ï¼Œæˆ–è€…æœ€é€‚åˆä½ çš„åéª‘çš„(åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äºå®ƒä»¬çš„ä¿¡æ¯<a class="ae ky" href="https://docs.docker.com/compose/compose-file/compose-file-v3/#short-syntax-3" rel="noopener ugc nofollow" target="_blank"/>)ã€‚</p><p id="10c6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ­¤å¤–ï¼Œ<code class="fe nb nc nd ne b">tmpfs</code>ä¹Ÿå¯ä»¥é€šè¿‡ä¸“ç”¨é€‰é¡¹è®¾ç½®â€¦é˜…è¯»ä¸‹ä¸€èŠ‚çš„ç¤ºä¾‹ã€‚</p><h2 id="8361" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">tmpfs</h2><p id="0993" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">è¿™åœ¨ä¸Šä¸€èŠ‚ä¸­å·²ç»æè¿°è¿‡äº†ï¼Œä½†æ˜¯æ­£å¦‚æ‚¨æ‰€çŸ¥é“çš„ï¼Œè¿™åªæ˜¯ä¸ºæ‚¨çš„å®¹å™¨è®¾ç½®éæŒä¹…æŒ‚è½½ç‚¹çš„å¦ä¸€ç§æ›´ç®€å•çš„æ–¹æ³•:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="65bc" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="d6b4" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: ls /<br/>    tmpfs: /my-tmpfs</span><span id="3892" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$</strong> docker-compose up<br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  | bin<br/>first_1  | dev<br/>first_1  | etc<br/>first_1  | home<br/>first_1  | lib<br/>first_1  | media<br/>first_1  | mnt<br/><strong class="ne iu">first_1  | my-tmpfs<br/></strong>first_1  | opt<br/>first_1  | proc<br/>first_1  | root<br/>first_1  | run<br/>first_1  | sbin<br/>first_1  | srv<br/>first_1  | sys<br/>first_1  | tmp<br/>first_1  | usr<br/>first_1  | var<br/>mediumcom_first_1 exited with code 0</span></pre><h2 id="8dea" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">è®¾å¤‡</h2><p id="1988" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">é¡¾åæ€ä¹‰ï¼Œå®ƒå…è®¸æ‚¨è®¿é—®ç”¨äºç®¡ç†ç³»ç»Ÿè®¾å¤‡çš„å®¹å™¨ã€‚ä½ æœ‰ç†ç”±æ€€ç–‘è¿™ä¸ç›´è£…è®¢æœ‰ä»€ä¹ˆä¸åŒã€‚ä½ å¯ä»¥ç®€å•åœ°æŠŠä¸€ä¸ªè®¾å¤‡ç»‘å®šåˆ°ä½ çš„å®¹å™¨ä¸Šï¼Œå¯¹å—ï¼Ÿå—¯ï¼Œæ˜¯ä¹Ÿä¸æ˜¯â€¦è¿™å–å†³äºä½ çš„å®¹å™¨æ˜¯å¦‚ä½•å¤„ç†é‚£ä¸ªè®¾å¤‡çš„ã€‚è®¾å¤‡æ–‡ä»¶ä¸å¸¸è§„æ–‡ä»¶å’Œç›®å½•ç•¥æœ‰ä¸åŒ(å³ä½¿å®ƒä»¬çœ‹èµ·æ¥åƒæ‚¨çš„<code class="fe nb nc nd ne b">/dev</code>æ–‡ä»¶å¤¹ä¸‹çš„æ™®é€šæ–‡ä»¶)ã€‚è®¾å¤‡æ–‡ä»¶æä¾›äº†åˆ°è®¾å¤‡é©±åŠ¨ç¨‹åºå’Œç‰©ç†è®¾å¤‡çš„æ¥å£ï¼Œå› æ­¤å…·æœ‰æ›´ç»†ç²’åº¦çš„è®¿é—®æ§åˆ¶ï¼Œè¿™é€šè¿‡<code class="fe nb nc nd ne b">cgroups</code>æ¥ç®¡ç†(ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äºå®ƒçš„<a class="ae ky" href="https://www.kernel.org/doc/Documentation/cgroup-v1/devices.txt" rel="noopener ugc nofollow" target="_blank">)ã€‚</a></p><p id="29b3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å› æ­¤ï¼Œç®€è€Œè¨€ä¹‹ï¼Œå¦‚æœæ‚¨çš„å®¹å™¨æ²¡æœ‰è¿è¡Œåœ¨ç‰¹æƒæ¨¡å¼ä¸‹ï¼Œæ‚¨ä»ç„¶å¯ä»¥é€šè¿‡è¿™ä¸ªé€‰é¡¹æˆäºˆæ‚¨çš„å®¹å™¨å¯¹ç‰¹å®šè®¾å¤‡æ–‡ä»¶çš„è®¿é—®æƒé™ã€‚</p><p id="6abe" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å‡è®¾æˆ‘ä»¬çš„ç”µè„‘ä¸Šå®‰è£…äº†ä¸€ä¸ªç½‘ç»œæ‘„åƒå¤´ï¼Œ</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="ebc5" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>lsusb -s 001:003<br/>Bus 001 Device 003: ID 046d:0826 <strong class="ne iu">Logitech, Inc. HD Webcam C525</strong></span></pre><p id="7544" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬æƒ³åœ¨é›†è£…ç®±é‡Œç”¨å®ƒæ¥æ‹ç…§ã€‚ç„¶åè€ƒè™‘ä»¥ä¸‹åœºæ™¯:</p><ul class=""><li id="2ef7" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu oy oq or os bi translated">é¦–å…ˆï¼Œè®©æˆ‘ä»¬å°è¯•ä»å®¹å™¨å†…éƒ¨è®¿é—®ç½‘ç»œæ‘„åƒå¤´ï¼Œä¸åº”ç”¨ä»»ä½•é€‰é¡¹</li></ul><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="f973" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="7d95" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: ccordeiro/fswebcam:armv7l<br/>    command: fswebcam -r 640x480 --jpeg 85 -D 1 picture.jpg</span><span id="e2b0" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Creating network "tmp_default" with the default driver<br/>Creating tmp_first_1 ... done<br/>Attaching to tmp_first_1<br/>first_1  | --- Opening /dev/video0...<br/><strong class="ne iu">first_1  | stat: No such file or directory<br/>first_1  | tmp_first_1 exited with code 0</strong></span></pre><p id="bc59" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">â€¦ä½†æ˜¾ç„¶ï¼Œå®¹å™¨å¯¹ä»»ä½•è®¾å¤‡éƒ½ä¸å¯è§â€¦</p><ul class=""><li id="1af5" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu oy oq or os bi translated">å…¶æ¬¡ï¼Œè®©æˆ‘ä»¬å°è¯•ç›´æ¥ç»‘å®šæŒ‚è½½è®¾å¤‡æ–‡ä»¶</li></ul><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="9627" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="3170" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: ccordeiro/fswebcam:armv7l<br/>    command: fswebcam -r 640x480 --jpeg 85 -D 1 picture.jpg<br/>    volumes:<br/>     - /dev/video0:/dev/video0</span><span id="245b" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Recreating tmp_first_1 ... done<br/>Attaching to tmp_first_1<br/>first_1  | --- Opening /dev/video0...<br/>first_1  | Trying source module v4l2...<br/><strong class="ne iu">first_1  | Error opening device: /dev/video0<br/>first_1  | open: Operation not permitted<br/></strong>first_1  | Trying source module v4l1...<br/><strong class="ne iu">first_1  | Error opening device: /dev/video0<br/>first_1  | open: Operation not permitted<br/></strong>first_1  | Unable to find a source module that can read /dev/video0.<br/>first_1  | tmp_first_1 exited with code 0</span></pre><p id="f6e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">â€¦å—¯ï¼Œå®¹å™¨å¯ä»¥çœ‹åˆ°å®ƒï¼Œä½†æ˜¯å®ƒæœ‰è®¿é—®å®ƒçš„æƒåˆ©ã€‚</p><ul class=""><li id="3e7b" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu oy oq or os bi translated">æœ€åï¼Œè®©æˆ‘ä»¬ä½¿ç”¨<code class="fe nb nc nd ne b">device</code></li></ul><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="4203" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="8792" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: ccordeiro/fswebcam:armv7l<br/>    command: fswebcam -r 640x480 --jpeg 85 -D 1 picture.jpg<br/>    devices:<br/>     - /dev/video0:/dev/video0</span><span id="bc68" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Recreating tmp_first_1 ... done<br/>Attaching to tmp_first_1<br/>first_1  | --- Opening /dev/video0...<br/>first_1  | Trying source module v4l2...<br/>first_1  | /dev/video0 opened.<br/>first_1  | No input was specified, using the first.<br/>first_1  | Delaying 1 seconds.<br/>first_1  | --- Capturing frame...<br/>first_1  | Captured frame in 0.00 seconds.<br/><strong class="ne iu">first_1  | --- Processing captured image...<br/>first_1  | Setting output format to JPEG, quality 85<br/>first_1  | Writing JPEG image to 'picture.jpg'.<br/></strong>first_1  | tmp_first_1 exited with code 0</span></pre><p id="8172" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬æˆåŠŸäº†ï¼</p><h2 id="cce6" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">ç½‘ç»œæ¨¡å¼</h2><p id="89bf" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">ä½ å¯èƒ½çŸ¥é“ï¼ŒDockerçš„è”ç½‘ç³»ç»Ÿæ˜¯åŸºäº<a class="ae ky" href="https://docs.docker.com/network/" rel="noopener ugc nofollow" target="_blank">è”ç½‘é©±åŠ¨</a>çš„ã€‚ä½¿ç”¨æ­¤é€‰é¡¹ï¼Œæ‚¨å¯ä»¥æŒ‡å®šå®¹å™¨åº”è¯¥ä»¥å“ªç§ç½‘ç»œæ¨¡å¼è¿è¡Œã€‚</p><p id="ca2a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å‡è®¾æˆ‘ä»¬è¦éƒ¨ç½²4ä¸ªå®¹å™¨:1ä¸ªåœ¨é»˜è®¤æ¡¥æ¥ç½‘ç»œä¸­ï¼Œ1ä¸ªåœ¨ä¸»æœºç½‘ç»œä¸­ï¼Œ1ä¸ªåœ¨ä¸ç¬¬ä¸€ä¸ªç›¸åŒçš„ç½‘ç»œä¸­ï¼Œ1ä¸ªæ²¡æœ‰ä»»ä½•ç½‘ç»œã€‚ä½ åº”è¯¥è¿™æ ·åš:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="0463" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="a7e9" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sh -c 'ifconfig eth0 &amp;&amp; sleep 5'<br/>    network_mode: bridge</span><span id="3fde" class="np md it ne b gy oj og l oh oi">  second:<br/>    image: alpine<br/>    command: ifconfig eth0<br/>    network_mode: host</span><span id="7c92" class="np md it ne b gy oj og l oh oi">  third:<br/>    image: alpine<br/>    command: ifconfig eth0<br/>    depends_on:<br/>     - first<br/>    network_mode: service:first</span><span id="72d9" class="np md it ne b gy oj og l oh oi">  fourth:<br/>    image: alpine<br/>    command: ifconfig eth0<br/>    network_mode: none</span><span id="bf09" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Creating mediumcom_first_1  ... done<br/>Creating mediumcom_fourth_1 ... done<br/>Creating mediumcom_second_1 ... done<br/>Creating mediumcom_third_1  ... done<br/>Attaching to mediumcom_second_1, mediumcom_fourth_1, mediumcom_first_1, mediumcom_third_1<br/><strong class="ne iu">first_1   | eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:00:02  <br/>first_1   |           inet addr:172.17.0.2</strong>  <strong class="ne iu">Bcast:172.17.255.255  Mask:255.255.0.0</strong><br/><strong class="ne iu">...</strong><br/><strong class="ne iu">fourth_1  | ifconfig: eth0: error fetching interface information: Device not found<br/>...<br/>second_1  | eth0      Link encap:Ethernet  HWaddr 02:50:00:00:00:01  <br/>second_1  |           inet addr:192.168.65.3  Bcast:192.168.65.255  Mask:255.255.255.0</strong><br/>...<br/><strong class="ne iu">third_1   | eth0      Link encap:Ethernet  HWaddr 02:42:AC:11:00:02  <br/>third_1   |           inet addr:172.17.0.2  Bcast:172.17.255.255  Mask:255.255.0.0</strong><br/>...<br/>mediumcom_fourth_1 exited with code 1<br/>mediumcom_second_1 exited with code 0<br/>mediumcom_third_1 exited with code 0<br/>mediumcom_first_1 exited with code 0</span></pre><p id="204d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å‘ç”Ÿäº†ä»€ä¹ˆäº‹ï¼Ÿè®©æˆ‘ä»¬æ¥åˆ†è§£ä¸€ä¸‹:</p><ul class=""><li id="80a0" class="ok ol it lb b lc ld lf lg li om lm on lq oo lu oy oq or os bi translated"><code class="fe nb nc nd ne b">first</code>å®¹å™¨è¿›å…¥ç½‘æ¡¥æ¨¡å¼ï¼Œå› æ­¤è¢«åˆ†é…äº†è‡ªå·±çš„<code class="fe nb nc nd ne b">eth0</code>ä¸“ç”¨ç½‘ç»œæ¥å£(IP 172.17.0.2ï¼Œæ˜¯Dockerç½‘æ¡¥å­ç½‘çš„ä¸€éƒ¨åˆ†)</li><li id="8921" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu oy oq or os bi translated"><code class="fe nb nc nd ne b">second</code>å®¹å™¨è¿›å…¥ä¸»æœºæ¨¡å¼ï¼Œè¿™æ„å‘³ç€å®ƒè¿è¡Œåœ¨ä¸ä¸»æœºç›¸åŒçš„ç½‘ç»œçº§åˆ«ï¼Œå› æ­¤å¯ä»¥çœ‹åˆ°ä¸»æœºçš„æ‰€æœ‰ç½‘ç»œæ¥å£ï¼ŒåŒ…æ‹¬ä¸»æœºçš„eth0 IP</li><li id="be0d" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu oy oq or os bi translated"><code class="fe nb nc nd ne b">third</code>é›†è£…ç®±å’Œ<code class="fe nb nc nd ne b">first</code>é›†è£…ç®±è¢«èµ‹äºˆç›¸åŒçš„ç½‘ç»œ</li><li id="e077" class="ok ol it lb b lc ot lf ou li ov lm ow lq ox lu oy oq or os bi translated"><code class="fe nb nc nd ne b">fourth</code>å®¹å™¨æ²¡æœ‰ç½‘ç»œï¼Œå› æ­¤å®ƒæ— æ³•æ‰¾åˆ°<code class="fe nb nc nd ne b">eth0</code>æ¥å£ã€‚</li></ul><h2 id="0e0b" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated"><strong class="ak">ç½‘ç»œ</strong></h2><p id="99cc" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">ç°åœ¨ï¼Œå›åˆ°ä¸Šé¢çš„é€‰é¡¹ï¼Œå¦‚æœæ‚¨æƒ³å°†æ‚¨çš„å®¹å™¨è¿æ¥åˆ°ä¸€ä¸ªç”¨æˆ·å®šä¹‰çš„ç½‘ç»œ(ç°æœ‰çš„æˆ–æ–°çš„)ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿå—¯ï¼Œç”¨<code class="fe nb nc nd ne b">networks</code>:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="831c" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>docker network create cjdc-test<br/>0f5e35bf6b8d396c45c19545540957fbc5fa15ba1ca0e5fbca4add3802c7db6d<br/><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="8668" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sleep 30<br/>    networks:<br/>     - new-net</span><span id="a535" class="np md it ne b gy oj og l oh oi">  second:<br/>    image: alpine<br/>    command: sleep 30<br/>    networks:<br/>     - cjdc-test</span><span id="58e1" class="np md it ne b gy oj og l oh oi">networks:<br/>  new-net:<br/>  cjdc-test:<br/>    external: true<br/>    name: cjdc-test</span><span id="1129" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d<br/><strong class="ne iu">Creating network "mediumcom_new-net</strong>" with the default driver<br/>Creating mediumcom_second_1 ... done<br/>Creating mediumcom_first_1  ... done<br/><strong class="ne iu">$ </strong>docker inspect --format '{{.NetworkSettings.Networks}}' mediumcom_first_1<br/>map[<strong class="ne iu">mediumcom_new-net</strong>:0xc0004d8f00]<br/><strong class="ne iu">$ </strong>docker inspect --format '{{.NetworkSettings.Networks}}' mediumcom_second_1<br/>map[<strong class="ne iu">cjdc-test</strong>:0xc0003e8f00]</span></pre><h2 id="121c" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">åè¿›ä½è®¡æ•°åˆ¶</h2><p id="2686" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">å®ƒåŸºæœ¬ä¸Šè®©ä½ ä¸ºä½ çš„å®¹å™¨å®šä¹‰ä¸€ä¸ªå®šåˆ¶çš„DNSæœåŠ¡å™¨ã€‚ç¤ºä¾‹:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="ae46" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="9a23" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: cat /etc/resolv.conf<br/>    dns: 1.2.3.4<br/>    network_mode: bridge</span><span id="665b" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  | nameserver <strong class="ne iu">1.2.3.4</strong><br/>mediumcom_first_1 exited with code 0</span></pre><p id="9aad" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">æ³¨æ„:</strong>æ³¨æ„éœ€è¦æœ‰ä¸€ä¸ªæ¡¥æ¥ç½‘ç»œï¼Œå› ä¸ºå¯¹äºç”¨æˆ·å®šä¹‰çš„ç½‘ç»œæ¥è¯´,<code class="fe nb nc nd ne b">dns</code>é€‰é¡¹ä¸ä¼šæœ‰è¿™æ ·çš„è¡Œä¸ºã€‚</p><h2 id="4f3c" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">dns_search</h2><p id="c58e" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">è¿™æ ·ï¼Œæ‚¨å¯ä»¥è®¾ç½®è‡ªå·±çš„è‡ªå®šä¹‰DNSæœç´¢åŸŸã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="4538" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="d303" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: cat /etc/resolv.conf<br/>    dns_search: my.custom.dns<br/>    network_mode: bridge</span><span id="1c0e" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  | search <strong class="ne iu">my.custom.dns</strong><br/>first_1  | nameserver 192.168.65.5<br/>mediumcom_first_1 exited with code 0</span></pre><h2 id="834f" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">ç¯å¢ƒæ–‡ä»¶</h2><p id="7999" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">æ‚¨å¯èƒ½ä¹ æƒ¯äºä¸€æ¬¡è®¾ç½®ä¸€ä¸ªå˜é‡çš„å®¹å™¨ç¯å¢ƒï¼Œä½†æ˜¯æ‚¨å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ–‡ä»¶æ¥ä¸€æ¬¡æ€§å®Œæˆè¿™é¡¹å·¥ä½œ:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="259b" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;my-env &lt;&lt;EOF<br/>VAR1=value<br/>MY_VAR_FROM_FILE=1<br/>FOO=BAR<br/>EOF</span><span id="664b" class="np md it ne b gy oj og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="2eea" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: env<br/>    env_file:<br/>     - my-env</span><span id="688c" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  | PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br/>first_1  | HOSTNAME=157e34e4fc64<br/>first_1  | <strong class="ne iu">VAR1=value</strong><br/>first_1  | <strong class="ne iu">MY_VAR_FROM_FILE=1</strong><br/>first_1  | <strong class="ne iu">FOO=BAR</strong><br/>first_1  | HOME=/root<br/>mediumcom_first_1 exited with code 0</span></pre><h2 id="3335" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">ç¯å¢ƒ</h2><p id="bade" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">è¿™æ ·ï¼Œæ‚¨å¯ä»¥ç›´æ¥åœ¨åˆæˆæ–‡ä»¶ä¸­ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°ä¸ºå®¹å™¨è®¾ç½®ç¯å¢ƒå˜é‡ã€‚</p><p id="2537" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ‚¨ä¹Ÿå¯ä»¥ç”¨å®ƒæ¥è¦†ç›–é€šè¿‡<code class="fe nb nc nd ne b">env_file</code>é€‰é¡¹åŠ è½½çš„å˜é‡ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="434b" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="67dd" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: env<br/></span><span id="4cf5" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  | PATH=/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin<br/>first_1  | HOSTNAME=68e909013198<br/>first_1  | <strong class="ne iu">NEW_VAR=yes</strong><br/>first_1  | HOME=/root<br/>mediumcom_first_1 exited with code 0</span></pre><h2 id="7486" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">æ­éœ²</h2><p id="717a" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">ä¸Dockerfileséå¸¸ç›¸ä¼¼ï¼Œè¿™ä¸ªé€‰é¡¹åªæ˜¯ç®€å•åœ°æ ‡è®°ä¸€ä¸ªå®¹å™¨çš„ç«¯å£ï¼Œå¹¶ä½¿å®ƒä»¬å¯¹å…¶ä»–é“¾æ¥çš„å®¹å™¨å¯ç”¨ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="d894" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="c6bb" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sleep 20<br/>    expose:<br/>     - 9876</span><span id="45d4" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d<br/>Recreating mediumcom_first_1 ... done<br/><strong class="ne iu">$ </strong>docker ps<br/>CONTAINER ID   IMAGE     COMMAND      CREATED          STATUS          PORTS      NAMES<br/>3be377f4bf6c   alpine    "sleep 20"   18 seconds ago   Up 16 seconds   <strong class="ne iu">9876/tcp</strong>   mediumcom_first_1</span></pre><h2 id="3bf1" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">å¤–éƒ¨é“¾æ¥</h2><p id="f82f" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated"><em class="mx">è®©æˆ‘ä»¬è·³è¿‡è¿™ä¸€ä¸ªåŸå› 1)å®ƒæ˜¯ä¸€ä¸ªé—ç•™é€‰é¡¹ï¼Œ2)æ‚¨å¯ä»¥ä½¿ç”¨ç½‘ç»œæ¥å®ç°ç›¸åŒçš„ç»“æœ(å³ï¼Œé€šè¿‡</em> <code class="fe nb nc nd ne b"><em class="mx">external</em></code> <em class="mx"> </em> <strong class="lb iu"> <em class="mx">ç½‘ç»œ</em> </strong> <em class="mx">ï¼Œå°†æ‚¨çš„å®¹å™¨è¿æ¥åˆ°æ‚¨çš„åˆæˆæ–‡ä»¶ä¹‹å¤–çš„å…¶ä»–å®¹å™¨)ã€‚</em></p><h2 id="49e3" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">é¢å¤–ä¸»æœº</h2><p id="51a3" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">è¿™åŸºæœ¬ä¸Šå…è®¸æ‚¨å‘å®¹å™¨çš„<code class="fe nb nc nd ne b">/etc/hosts</code>æ–‡ä»¶æ·»åŠ ä¸€ä¸ªæ–°æ¡ç›®ã€‚ä¾‹å¦‚ï¼Œå¦‚æœä½ æƒ³è®©ä½ çš„å®¹å™¨åœ¨å†…éƒ¨ç»™è‡ªå·±èµ·ä¸€ä¸ªåˆ«çš„åå­—ï¼Œè€Œä¸ä»…ä»…æ˜¯â€œlocalhost â€,ä½ å¯ä»¥è¿™æ ·åš:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="3257" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="d472" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sh -c 'cat /etc/hosts; ping me -c 1'<br/>    extra_hosts:<br/>     - "myself:127.0.0.1"<br/>     - "me:127.0.0.1"</span><span id="e057" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  | 127.0.0.1 localhost<br/>first_1  | ::1 localhost ip6-localhost ip6-loopback<br/>first_1  | fe00::0 ip6-localnet<br/>first_1  | ff00::0 ip6-mcastprefix<br/>first_1  | ff02::1 ip6-allnodes<br/>first_1  | ff02::2 ip6-allrouters<br/><strong class="ne iu">first_1  | 127.0.0.1 myself<br/>first_1  | 127.0.0.1 me</strong><br/>first_1  | 172.22.0.2 01d566c4380a<br/>first_1  | PING <strong class="ne iu">me</strong> (127.0.0.1): 56 data bytes<br/>first_1  | 64 bytes from 127.0.0.1: seq=0 ttl=64 time=1.192 ms<br/>first_1  | <br/>first_1  | --- me ping statistics ---<br/>first_1  | <strong class="ne iu">1 packets transmitted, 1 packets received, 0% packet loss</strong><br/>first_1  | round-trip min/avg/max = 1.192/1.192/1.192 ms<br/>mediumcom_first_1 exited with code 0</span></pre><h2 id="881c" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">å¥åº·æ£€æŸ¥</h2><p id="f7d7" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">æ­£å¦‚æ‰€æ–™ï¼Œè¿™ä¸åŒåçš„Dockerfileé€‰é¡¹éå¸¸ç›¸ä¼¼ã€‚å®ƒå…è®¸æ‚¨åˆ›å»ºä¸€ä¸ªè‡ªå®šä¹‰æ£€æŸ¥ï¼ŒDockerå¯ä»¥ç”¨å®ƒæ¥è¯„ä¼°æ‚¨çš„å®¹å™¨æ˜¯å¦â€œå¥åº·â€ã€‚</p><p id="0752" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å› æ­¤ï¼Œå‡è®¾åªæœ‰å½“åœ¨<code class="fe nb nc nd ne b">/tmp</code>æœ‰ä¸€ä¸ªåä¸º<code class="fe nb nc nd ne b">medium.txt</code>çš„æ–‡ä»¶æ—¶ï¼Œæˆ‘ä»¬çš„å®¹å™¨æ‰æ˜¯å¥åº·çš„ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="128b" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="6847" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sh -c 'touch /tmp/NOT_MY_FILE; sleep 10'<br/>    healthcheck:<br/>      test: "[ -f /tmp/medium.txt ]"<br/>      # run asap<br/>      interval: 1s<br/>      timeout: 5s<br/>      retries: 1<br/>      start_period: 0s</span><span id="5ebc" class="np md it ne b gy oj og l oh oi">  second:<br/>    image: alpine<br/>    command: sh -c 'touch /tmp/medium.txt; sleep 10'<br/>    healthcheck:<br/>      test: "[ -f /tmp/medium.txt ]"<br/>      # run asap<br/>      interval: 1s<br/>      timeout: 5s<br/>      retries: 1<br/>      start_period: 0s</span><span id="ac45" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d<br/>Recreating mediumcom_first_1 ... done<br/>Creating mediumcom_second_1  ... done<br/><strong class="ne iu">$ </strong>docker ps<br/>CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS                     PORTS     NAMES<br/>b8804cbb440d   alpine    "sh -c 'touch /tmp/Nâ€¦"   4 seconds ago   Up 2 seconds (<strong class="ne iu">unhealthy</strong>)             <strong class="ne iu">mediumcom_first_1</strong><br/>604a6880f3c6   alpine    "sh -c 'touch /tmp/mâ€¦"   4 seconds ago   Up 2 seconds (<strong class="ne iu">healthy</strong>)               <strong class="ne iu">mediumcom_second_1</strong></span></pre><p id="1bdc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ­£å¦‚æ‰€æ–™ï¼Œ<code class="fe nb nc nd ne b">first</code>ä¸æ­£å¸¸ï¼Œä½†<code class="fe nb nc nd ne b">second</code>æ­£å¸¸ï¼Œå› ä¸ºæ‰€éœ€çš„æ–‡ä»¶å­˜åœ¨äºæ­£ç¡®çš„ä½ç½®ã€‚</p><h2 id="1e19" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">åˆå§‹åŒ–</h2><p id="e510" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">æœ‰äº†è¿™ä¸ªï¼Œä½ å¯ä»¥å‘Šè¯‰Dockeræ˜¯å¦ä¸ºä½ çš„å®¹å™¨ä½¿ç”¨ä¸€ä¸ª<code class="fe nb nc nd ne b">init</code>ã€‚å¦‚æœæ˜¯<code class="fe nb nc nd ne b">true</code>ï¼ŒDockerå°†ä½¿ç”¨åŸºäº<a class="ae ky" href="https://github.com/krallin/tini" rel="noopener ugc nofollow" target="_blank"><em class="mx"/></a>çš„initè°ƒç”¨<code class="fe nb nc nd ne b">docker-init</code>ã€‚è®©æˆ‘ä»¬æ¥çœ‹çœ‹ä¸åŒä¹‹å¤„:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="43a2" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="0ea6" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: ps -a<br/>    init: false</span><span id="c2c1" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  | PID   USER     TIME  COMMAND<br/>first_1  |     1 root      0:00 <strong class="ne iu">ps -a</strong><br/>mediumcom_first_1 exited with code 0</span></pre><p id="8e60" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä½†æ˜¯å¦‚æœæ‚¨å¯ç”¨äº†ä¸€ä¸ª<code class="fe nb nc nd ne b">init</code>ï¼Œé‚£ä¹ˆæ‚¨å°†å¾—åˆ°è¿™ç§æµç¨‹åŒ…è£…å™¨ï¼Œå¹¶æ·»åŠ äº†PID 1(åœ¨æœ¬ä¾‹ä¸­æ˜¯<code class="fe nb nc nd ne b">docker-init</code>)åŠŸèƒ½:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="9c27" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="bb42" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: ps -a<br/>    init: true</span><span id="85eb" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up<br/>Starting mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  | PID   USER     TIME  COMMAND<br/>first_1  |     1 root      0:00 <strong class="ne iu">/sbin/docker-init</strong> -- ps -a<br/>first_1  |     8 root      0:00 ps -a<br/>mediumcom_first_1 exited with code 0</span></pre><h2 id="0f1c" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">éš”ç¦»</h2><p id="9b28" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">å¯¹äºLinuxï¼Œè¿™æ€»æ˜¯<code class="fe nb nc nd ne b">default</code>ã€‚å¯¹äºWindowsï¼Œä½ æœ‰æ›´å¤šçš„é€‰æ‹©ï¼Œä½†æˆ‘ææ€•æˆ‘æ²¡æœ‰ä¸€å°Windowsæœºå™¨æ¥ä¸ºä½ ä»¬è¿è¡Œä¸€ä¸ªä¾‹å­ğŸ˜›å¯¹ä¸èµ·Windowsç”¨æˆ·ï¼</p><h2 id="4331" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">æ ‡ç­¾</h2><p id="22b3" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">é¡¾åæ€ä¹‰ï¼Œä½¿ç”¨è¯¥é€‰é¡¹å¯ä»¥ä¸ºå®¹å™¨è®¾ç½®æ ‡ç­¾:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="53d3" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="1402" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sleep 10<br/>    labels:<br/>     - "foo=bar"</span><span id="0728" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d<br/>Recreating mediumcom_first_1 ... done<br/><strong class="ne iu">$ docker ps --filter 'label=foo=bar'<br/></strong>CONTAINER ID   IMAGE     COMMAND      CREATED          STATUS         PORTS     NAMES<br/>94e844176d76   alpine    "sleep 10"   30 seconds ago   Up 7 seconds             <strong class="ne iu">mediumcom_first_1</strong></span></pre><h2 id="81a5" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">é“¾æ¥</h2><p id="db92" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated"><em class="mx">è‡³äº</em> <code class="fe nb nc nd ne b"><em class="mx">external_links</em></code> <em class="mx">æˆ‘ä»¬å°±è·³è¿‡è¿™ä¸ª</em> <strong class="lb iu"> <em class="mx">é—ç•™</em> </strong> <em class="mx">é€‰é¡¹å§ã€‚å®¹å™¨ä¹‹é—´çš„é€šä¿¡å¯ä»¥é€šè¿‡ç”¨æˆ·å®šä¹‰çš„ç½‘ç»œè½»æ¾å®ç°ã€‚</em></p><h2 id="9da6" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">è®°å½•</h2><p id="cfe7" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">å®é™…ä¸Šï¼Œæˆ‘å‘ç°è¿™ä¸ªé€‰é¡¹éå¸¸å…³é”®ï¼Œå› ä¸ºå¤§å¤šæ•°ç”¨æˆ·é€šå¸¸æ²¡æœ‰è¶³å¤Ÿé‡è§†ä»–ä»¬çš„å®¹å™¨åº”ç”¨ç¨‹åºæ—¥å¿—ä¸æ–­å¢é•¿çš„å¤§å°ã€‚é™¤éæ‚¨å¸Œæœ›æ‚¨çš„ä¸»æœºéšç€æ—¶é—´çš„æ¨ç§»è€Œå¡«æ»¡ï¼Œå¦åˆ™å¯¹äºä»»ä½•å…¶ä»–åº”ç”¨ç¨‹åºï¼Œæ‚¨è¿˜å¿…é¡»æ§åˆ¶åº”ç”¨ç¨‹åºè®°å½•å…¶å†…å®¹çš„æ–¹å¼ã€‚Dockerå…è®¸æ‚¨é€šè¿‡ä½¿ç”¨è¿™ä¸ª<code class="fe nb nc nd ne b">logging</code>é€‰é¡¹æ¥æ§åˆ¶å®¹å™¨åº”ç”¨ç¨‹åºçš„æ ‡å‡†è¾“å‡ºæ—¥å¿—ã€‚ä¸ä»…æ˜¯æ—¥å¿—è®°å½•çš„ç±»å‹ï¼Œè¿˜æœ‰æ—¥å¿—è®°å½•å¤§å°é™åˆ¶å’Œå¾ªç¯å‚æ•°:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="db96" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="bb4f" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sh -c 'while true; do echo `date`; done'<br/>    logging:<br/>      options:<br/>        max-size: "50k"<br/>        max-file: "10"</span><span id="d53f" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d<br/>Recreating tmp_first_1 ... done<br/><strong class="ne iu">$ </strong>docker ps -f 'name=tmp_first_1'<br/>CONTAINER ID   IMAGE     COMMAND                  CREATED         STATUS         PORTS     NAMES<br/><strong class="ne iu">2ea63dd32607</strong>   alpine    "sh -c 'while true; â€¦"   2 minutes ago   Up 2 minutes             tmp_first_1<br/><strong class="ne iu">$ <br/>$ </strong>du -h /var/lib/docker/containers/2ea63dd32607*/*log*<br/><strong class="ne iu">20K</strong> /var/lib/docker/containers/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60-json.log<br/><strong class="ne iu">52K</strong> /var/lib/docker/containers/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60-json.log.1<br/><strong class="ne iu">52K</strong> /var/lib/docker/containers/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60-json.log.2<br/><strong class="ne iu">52K</strong> /var/lib/docker/containers/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60-json.log.3<br/><strong class="ne iu">52K</strong> /var/lib/docker/containers/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60-json.log.4<br/><strong class="ne iu">52K</strong> /var/lib/docker/containers/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60-json.log.5<br/><strong class="ne iu">52K</strong> /var/lib/docker/containers/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60-json.log.6<br/><strong class="ne iu">52K</strong> /var/lib/docker/containers/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60-json.log.7<br/><strong class="ne iu">52K</strong> /var/lib/docker/containers/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60-json.log.8<br/><strong class="ne iu">52K</strong> /var/lib/docker/containers/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60/2ea63dd32607ea5c5b3238ed4da2233a049c41422cfff96b6a2e45c818f96f60-json.log.9</span></pre><p id="0b4a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¦‚æ‚¨æ‰€è§ï¼Œåœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥ç¡®è®¤Dockeræœ€å¤šåªä¿å­˜10ä¸ªæ—¥å¿—æ–‡ä»¶ï¼Œå®ƒä»¬çš„å¤§å°ä»æœªè¶…è¿‡æˆ‘ä»¬æœŸæœ›çš„50kå­—èŠ‚(= 52K)ã€‚</p><h2 id="9080" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">pid</h2><p id="afe9" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">æ ¹æ®è¯·æ±‚ï¼Œæ‚¨å¯ä»¥è®©å®¹å™¨ä¸ä¸»æœºå…±äº«PIDåœ°å€ç©ºé—´ã€‚è¿™æ˜¯å®ç°è¿™ä¸€ç›®æ ‡çš„é€‰æ‹©:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="4dfa" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="fa42" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: ps -a<br/>    pid: "host"</span><span id="7bfa" class="np md it ne b gy oj og l oh oi">  second:<br/>    image: alpine<br/>    command: ps -a<br/>EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Creating network "mediumcom_default" with the default driver<br/>Creating mediumcom_second_1 ... done<br/>Creating mediumcom_first_1  ... done<br/>Attaching to mediumcom_second_1, mediumcom_first_1<br/>second_1  | PID   USER     TIME  COMMAND<br/><strong class="ne iu">second_1</strong>  |     1 root      0:00 ps -a<br/>first_1   | PID   USER     TIME  COMMAND<br/><strong class="ne iu">first_1</strong>   |     1 root      0:07 /sbin/init<br/>first_1   |     2 root      0:00 [kthreadd]<br/>first_1   |     3 root      0:00 [rcu_gp]<br/>first_1   |     4 root      0:00 [rcu_par_gp]<br/>first_1   |     6 root      0:00 [kworker/0:0H-ev]<br/>first_1   |     8 root      0:00 [mm_percpu_wq]<br/>first_1   |     9 root      0:00 [rcu_tasks_rude_]<br/>first_1   |    10 root      0:00 [rcu_tasks_trace]<br/>first_1   |    11 root      0:22 [ksoftirqd/0]<br/>first_1   |    12 root      0:10 [rcu_sched]<br/>first_1   |    13 root      0:07 [migration/0]<br/>first_1   |    15 root      0:00 [cpuhp/0]<br/>first_1   |    16 root      0:00 [cpuhp/1]<br/>...</span></pre><p id="6af3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¯·æ³¨æ„ï¼Œè¿™æ„å‘³ç€æ‚¨å¯ä»¥ä»å®¹å™¨å†…éƒ¨ç®¡ç†(åŒ…æ‹¬ç»ˆæ­¢)ä¸»æœºè¿›ç¨‹ï¼Œæ‰€ä»¥ä½¿ç”¨è¯¥é€‰é¡¹æ—¶è¦å°å¿ƒã€‚</p><h2 id="cba4" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">æ¸¯å£</h2><p id="b637" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">åœ¨æœ€æµè¡Œçš„é€‰é¡¹ä¸­ï¼Œè¿™å…è®¸æ‚¨ä»å®¹å™¨å†…éƒ¨å‘æ‚¨çš„ä¸»æœºå‘å¸ƒç«¯å£(é™¤éæ‚¨çš„å®¹å™¨å·²ç»åœ¨â€œä¸»æœºâ€æ¨¡å¼ä¸‹è¿è¡Œ)ã€‚</p><p id="598f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å‡è®¾æˆ‘è¦å‘å¸ƒ:<br/> -ç«¯å£3000åˆ°éšæœºç«¯å£<br/> -ç«¯å£èŒƒå›´3005åˆ°3010 <br/> -ç«¯å£80åˆ°ä»…æœ¬åœ°ä¸»æœºä¸Šçš„ç«¯å£80<br/>-ç«¯å£443åˆ°æ‰€æœ‰ä¸»æœºæ¥å£ä¸Šçš„ç«¯å£443<br/>-ç«¯å£3011åˆ°ä¸»æœºä¸Šçš„ç«¯å£9876ï¼Œä½†ä»…ç”¨äºUDP</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="e1b9" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="060b" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sleep 10<br/>    ports:<br/>     - 3000<br/>     - 3005-3010<br/>     - 127.0.0.1:80:80<br/>     - 443:443<br/>     - 9876:3011/udp</span><span id="319d" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d<br/>Removing orphan container "mediumcom_second_1"<br/>Starting mediumcom_first_1 ... done<br/><strong class="ne iu">$ </strong>docker ps --format '{{.Ports}}'<br/>127.0.0.1:80-&gt;80/tcp, 0.0.0.0:443-&gt;443/tcp, 0.0.0.0:61290-&gt;3000/tcp, 0.0.0.0:61292-&gt;3005/tcp, 0.0.0.0:61293-&gt;3006/tcp, 0.0.0.0:61294-&gt;3007/tcp, 0.0.0.0:61295-&gt;3008/tcp, 0.0.0.0:61296-&gt;3009/tcp, 0.0.0.0:61291-&gt;3010/tcp, 0.0.0.0:9876-&gt;3011/udp</span></pre><h2 id="76b2" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">è½®å»“</h2><p id="3b4d" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">â€œé…ç½®æ–‡ä»¶â€æ˜¯ä¸€ä¸ªå¾ˆé…·çš„æ§åˆ¶æœºåˆ¶ï¼Œé€šè¿‡å®ƒæ‚¨å¯ä»¥åœ¨æ‚¨çš„æ’°å†™æ–‡ä»¶ä¸­åˆ†ç¦»èŒè´£ã€‚å‡è®¾æˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„ç»„åˆæ–‡ä»¶ä¸­çš„ä¸€äº›å®¹å™¨åªåœ¨éå¸¸ç‰¹å®šçš„è®¾ç½®ä¸‹è¿è¡Œï¼Œæˆ–è€…æŒ‰éœ€è¿è¡Œ(ä¹Ÿç§°ä¸ºâ€œæ¦‚è¦â€)ã€‚ä½ å¯ä»¥è¿™æ ·åš:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="4bf1" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="bdda" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: nginx</span><span id="305c" class="np md it ne b gy oj og l oh oi">  second:<br/>    image: alpine<br/>    command: wget <a class="ae ky" href="http://first'" rel="noopener ugc nofollow" target="_blank">http://first</a><br/>    profiles: ["debug"]</span><span id="2a7c" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d<br/>Creating network "mediumcom_default" with the default driver<br/>Creating <strong class="ne iu">mediumcom_first_1</strong> ... done</span><span id="63f4" class="np md it ne b gy oj og l oh oi"><strong class="ne iu">$ </strong># see? only the nginx container was started. Let's enable "debug"<br/><strong class="ne iu">$ </strong>docker-compose <strong class="ne iu">--profile debug</strong> up <br/>mediumcom_first_1 is up-to-date<br/>Creating <strong class="ne iu">mediumcom_second_1</strong> ... done<br/>Attaching to mediumcom_first_1, mediumcom_second_1<br/><strong class="ne iu">second_1  | Connecting to first (172.26.0.2:80)<br/>second_1  | saving to 'index.html'<br/>second_1  | index.html           100% |********************************|   615  0:00:00 ETA<br/>second_1  | 'index.html' saved</strong><br/>first_1   | /docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration<br/>first_1   | /docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/<br/>first_1   | /docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh<br/>first_1   | 10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf<br/>first_1   | 10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf<br/>first_1   | /docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh<br/>first_1   | /docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh<br/>first_1   | /docker-entrypoint.sh: Configuration complete; ready for start up<br/>first_1   | 2022/02/01 15:07:21 [notice] 1#1: using the "epoll" event method<br/>first_1   | 2022/02/01 15:07:21 [notice] 1#1: nginx/1.21.5<br/>first_1   | 2022/02/01 15:07:21 [notice] 1#1: built by gcc 10.2.1 20210110 (Debian 10.2.1-6) <br/>first_1   | 2022/02/01 15:07:21 [notice] 1#1: OS: Linux 5.10.76-linuxkit<br/>first_1   | 2022/02/01 15:07:21 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576<br/>first_1   | 2022/02/01 15:07:21 [notice] 1#1: start worker processes<br/>first_1   | 2022/02/01 15:07:21 [notice] 1#1: start worker process 31<br/>first_1   | 2022/02/01 15:07:21 [notice] 1#1: start worker process 32<br/><strong class="ne iu">first_1   | 172.26.0.3 - - [01/Feb/2022:15:07:34 +0000] "GET / HTTP/1.1" 200 615 "-" "Wget" "-"</strong><br/><strong class="ne iu">mediumcom_second_1 exited with code 0</strong></span></pre><h2 id="987a" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">é‡æ–°å¼€å§‹</h2><p id="ffec" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">è¿™å°±æ˜¯ä½ å¦‚ä½•ä¸ºä½ çš„å®¹å™¨å®šä¹‰é‡å¯ç­–ç•¥(ä»<code class="fe nb nc nd ne b">no</code>ã€<code class="fe nb nc nd ne b">always</code>ã€<code class="fe nb nc nd ne b">unless-stopped</code>å’Œ<code class="fe nb nc nd ne b">on-failure</code>ä¸­)ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="158e" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="49ce" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    restart: on-failure<br/>    command: sleep 4</span><span id="4797" class="np md it ne b gy oj og l oh oi">  second:<br/>    image: alpine<br/>    command: echo Hi `date`<br/>    restart: always</span><span id="98f9" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Creating network "mediumcom_default" with the default driver<br/>Creating mediumcom_first_1  ... done<br/>Creating mediumcom_second_1 ... done<br/>Attaching to mediumcom_first_1, mediumcom_second_1<br/>second_1  | Hi Tue Feb 1 17:21:11 CET 2022<br/><strong class="ne iu">mediumcom_second_1 exited with code 0<br/></strong>second_1  | Hi Tue Feb 1 17:21:11 CET 2022<br/>second_1  | Hi Tue Feb 1 17:21:11 CET 2022<br/><strong class="ne iu">mediumcom_second_1 exited with code 0<br/></strong>second_1  | Hi Tue Feb 1 17:21:11 CET 2022<br/>second_1  | Hi Tue Feb 1 17:21:11 CET 2022<br/>second_1  | Hi Tue Feb 1 17:21:11 CET 2022<br/><strong class="ne iu">mediumcom_second_1 exited with code 0<br/></strong>second_1  | Hi Tue Feb 1 17:21:11 CET 2022<br/>second_1  | Hi Tue Feb 1 17:21:11 CET 2022<br/>second_1  | Hi Tue Feb 1 17:21:11 CET 2022<br/>second_1  | Hi Tue Feb 1 17:21:11 CET 2022<br/>mediumcom_first_1 exited with code 0</span></pre><h2 id="9767" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">å®‰å…¨æ€§_opt</h2><p id="bd29" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">è¯¥é€‰é¡¹å…è®¸æ‚¨æ§åˆ¶å®¹å™¨çš„SELinuxæ ‡ç­¾ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="3bda" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="2e53" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sleep 30<br/>    <!-- -->security_opt:<br/>     - label:user:USER</span><span id="3e4e" class="np md it ne b gy oj og l oh oi">  second:<br/>    image: alpine<br/>    command: sleep 30</span><span id="294f" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker inspect mediumcom_first_1 --format '{{ .Id }}: SecurityOpt={{ .HostConfig.SecurityOpt }}'<br/>2808e4b2ac6a6870b372ecf06da5ce0217efdd6d14df16cef4b332e1d4fb9b6a: SecurityOpt=<strong class="ne iu">[label:user:USER]</strong><br/><strong class="ne iu">$ </strong><br/><strong class="ne iu">$ </strong>docker inspect mediumcom_second_1 --format '{{ .Id }}: SecurityOpt={{ .HostConfig.SecurityOpt }}'<br/>ed4c417b27257cc9f793d5d3dad94672074859dba90effddd0cde49f12dd4115: SecurityOpt=<strong class="ne iu">&lt;no value&gt;</strong></span></pre><h2 id="4093" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">åœæ­¢å®½é™æœŸ</h2><p id="2d70" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">ä½ å¯èƒ½ä¼šå‘ç°ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¦‚æœåœ¨æ”¶åˆ°ä¸€ä¸ªSIGTERMå10ç§’å†…æ²¡æœ‰è‡ªç„¶åœæ­¢ï¼ŒDocker forceå°±ä¼šæ€æ­»ä¸€ä¸ªå®¹å™¨(ä¾‹å¦‚ï¼Œåœ¨ä½ è¯•å›¾ç”¨<code class="fe nb nc nd ne b">docker stop</code>åœæ­¢ä¸€ä¸ªå®¹å™¨å)ã€‚è¿™ä¸ªæ—¶é—´æ®µç§°ä¸ºåœæ­¢å®½é™æœŸï¼Œæ‚¨å¯ä»¥å¯¹å…¶è¿›è¡Œé…ç½®ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="6bf0" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="b0ac" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sh -c 'while true; do sleep 5 &amp; done'</span><span id="e206" class="np md it ne b gy oj og l oh oi">  second:<br/>    image: alpine<br/>    command: sh -c 'while true; do sleep 5 &amp; done'<br/>    stop_grace_period: 1s</span><span id="bd13" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d<br/>Recreating mediumcom_first_1  ... done<br/>Recreating mediumcom_second_1 ... done<br/><strong class="ne iu">$ </strong>time docker stop mediumcom_first_1<br/>mediumcom_first_1</span><span id="8c5e" class="np md it ne b gy oj og l oh oi"><strong class="ne iu">real 0m10.847s</strong><br/>user 0m0.205s<br/>sys 0m0.092s<br/><strong class="ne iu">$ </strong>time docker stop mediumcom_second_1<br/>mediumcom_second_1</span><span id="0cb2" class="np md it ne b gy oj og l oh oi"><strong class="ne iu">real 0m1.883s<br/></strong>user 0m0.192s<br/>sys 0m0.105s</span></pre><h2 id="2a05" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">åœæ­¢ä¿¡å·</h2><p id="3b99" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">ä»ä¸Šé¢çš„é€‰é¡¹ä¸­ï¼Œæ‚¨å·²ç»çŸ¥é“SIGTERMæ˜¯åœæ­¢Dockerå®¹å™¨çš„é»˜è®¤ä¿¡å·ã€‚ä½†æ˜¯æ‚¨å¯ä»¥æ”¹å˜è¿™ä¸€ç‚¹ï¼Œè¿™æ ·<code class="fe nb nc nd ne b">docker stop</code>å°±å¯ä»¥å‘æ‚¨çš„å®¹å™¨åº”ç”¨ç¨‹åºå‘é€æ‚¨è‡ªå·±å–œæ¬¢çš„ä¿¡å·:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="479e" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="5170" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sleep 60<br/>    stop_signal: SIGUSR1</span><span id="d3a1" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d<br/>Creating network "mediumcom_default" with the default driver<br/>Creating mediumcom_first_1 ... done<br/><strong class="ne iu">$ </strong>docker inspect mediumcom_first_1 --format '{{.Config.StopSignal}}'</span><span id="c967" class="np md it ne b gy oj og l oh oi"><strong class="ne iu">SIGUSR1</strong></span></pre><h2 id="f356" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">sysctls</h2><p id="2f49" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">è¯¥é€‰é¡¹å…è®¸æ‚¨åœ¨è¿è¡Œæ—¶ä¸ºå®¹å™¨é…ç½®å‘½åç©ºé—´å†…æ ¸å‚æ•°ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="6373" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="f6a3" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sleep 60<br/>    sysctls:<br/>      net.core.somaxconn: 1024<br/>      net.ipv4.tcp_syncookies: 0</span><span id="de26" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d<br/>Creating network "mediumcom_default" with the default driver<br/>Creating mediumcom_first_1 ... done<br/><strong class="ne iu">$ </strong>docker inspect mediumcom_first_1 --format '{{json .HostConfig.Sysctls}}'<br/><strong class="ne iu">{"net.core.somaxconn":"1024","net.ipv4.tcp_syncookies":"0"}</strong></span></pre><h2 id="0ee5" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">ulimits</h2><p id="59f3" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">å…è®¸æ‚¨è¦†ç›–å®¹å™¨çš„é»˜è®¤ulimitsã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="f0ab" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="82fa" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sleep 60<br/>    ulimits:<br/>      <!-- -->nproc: 65535<br/>      <!-- -->nofile:<br/>        soft: 20000<br/>        hard: 40000</span><span id="0fea" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d<br/>Recreating mediumcom_first_1 ... done<br/><strong class="ne iu">$ </strong>docker inspect mediumcom_first_1 --format '{{json .HostConfig.Ulimits}}'<br/><strong class="ne iu">[{"Name":"nproc","Hard":65535,"Soft":65535},{"Name":"nofile","Hard":40000,"Soft":20000}]</strong></span></pre><h2 id="4276" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">ç”¨æˆ·æ¨¡å¼</h2><p id="5cac" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">ä¸æ¶‰åŠå¤ªå¤šç»†èŠ‚ï¼Œä»¥é˜²ä¸‡ä¸€æ‚¨å·²ç»åœ¨Dockerå®ˆæŠ¤è¿›ç¨‹ä¸­å¯ç”¨äº†<code class="fe nb nc nd ne b">user</code>åç§°ç©ºé—´ï¼Œè¿™ä¸ªé€‰é¡¹è®©æ‚¨åªéœ€æ‰§è¡Œ<code class="fe nb nc nd ne b">userns_mode: "host"</code>å°±å¯ä»¥ç¦ç”¨å•ä¸ªå®¹å™¨çš„ç”¨æˆ·åç§°ç©ºé—´ã€‚</p><h2 id="6fe4" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">ç”¨æˆ·</h2><p id="3c51" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">æ‚¨å¸Œæœ›æ‚¨çš„å®¹å™¨åº”ç”¨ç¨‹åºåœ¨æ‚¨çš„å®¹å™¨ä¸­ä½œä¸ºç‰¹å®šç”¨æˆ·è¿è¡Œå—ï¼Ÿ</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="9038" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="168d" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: whoami<br/>    user: nobody</span><span id="de70" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  | <strong class="ne iu">nobody</strong><br/>mediumcom_first_1 exited with code 0</span></pre><h2 id="e722" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">å·¥ä½œç›®å½•</h2><p id="7279" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">ä½ ä»æ¡£æ¡ˆé‡ŒçŸ¥é“è¿™ä¸ªã€‚æœ‰äº†å®ƒï¼Œä½ å¯ä»¥ä¸ºä½ çš„å®¹å™¨é‡æ–°å®šä¹‰ç™»é™†è·¯å¾„(PWD ),å¹¶å¯èƒ½å½±å“ä½ çš„å…¥å£ç‚¹å’Œå‘½ä»¤çš„è¡Œä¸ºï¼Œä»¥é˜²å®ƒä»¬æ²¡æœ‰ä½¿ç”¨ç»å¯¹è·¯å¾„ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="2c3b" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="ee4b" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: pwd<br/>    working_dir: /my/custom/medium/dir</span><span id="15fc" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  |<strong class="ne iu"> /my/custom/medium/dir</strong><br/>mediumcom_first_1 exited with code 0</span></pre><h2 id="1821" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">åŸŸå</h2><p id="b208" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">å¦‚æ‚¨æ‰€çŸ¥ï¼Œæ‚¨çš„å®¹å™¨æœ‰ä¸€ä¸ªä¸»æœºåå’Œä¸€ä¸ªåŸŸåã€‚å½“<strong class="lb iu">ä¸æ˜¯</strong>åœ¨ä¸»æœºæ¨¡å¼ä¸‹è¿è¡Œæ—¶ï¼Œä¸»æœºåå°†ç­‰äºå®¹å™¨çš„IDï¼ŒåŸŸåï¼Œæ­£å¦‚æ‰€æ–™ï¼Œå°†æ˜¯noneã€‚å¦‚æœæ‚¨æƒ³è®¾ç½®å®ƒï¼Œè¯·æ‰§è¡Œä»¥ä¸‹æ“ä½œ:</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="290f" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="f0e3" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: hostname -f<br/>    domainname: cristovaocordeiro.medium.com</span><span id="c8d5" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  | 6e900c697939.<strong class="ne iu">cristovaocordeiro.medium.com</strong><br/>mediumcom_first_1 exited with code 0</span></pre><h2 id="3c53" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">ä¸»æœºå</h2><p id="3b24" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">æ˜¾ç„¶ï¼Œå¦‚æœæ‚¨å¯ä»¥è®¾ç½®ä¸€ä¸ªåŸŸåï¼Œé‚£ä¹ˆæ‚¨ä¹Ÿå¯ä»¥ä¸ºæ‚¨çš„å®¹å™¨è®¾ç½®ä¸€ä¸ªä¸»æœºåï¼Œè¿™æ ·å®ƒå°±å¯ä»¥é‡‡ç”¨é»˜è®¤çš„â€œéš¾çœ‹çš„â€IDå½¢å¼ğŸ˜œ</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="3d26" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="9b7a" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: hostname -f<br/>    hostname: test-container</span><span id="8d41" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  | <strong class="ne iu">test-container</strong><br/>mediumcom_first_1 exited with code 0</span></pre><h2 id="5c7b" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">å·¥ä¸šç¨‹åºæ§åˆ¶ï¼ˆ industrial process controlçš„ç¼©å†™ï¼‰</h2><p id="eefa" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">æ‚¨å¯ä»¥ç®¡ç†å®¹å™¨çš„è¿›ç¨‹é—´é€šä¿¡(ç”¨äºæ€§èƒ½è°ƒä¼˜)ã€‚é€šè¿‡è®©æ‚¨ä¸ºå®¹å™¨é…ç½®IPCåç§°ç©ºé—´ï¼Œè¯¥é€‰é¡¹è®©æ‚¨å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="857b" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="155e" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sleep 30<br/>    ipc: shareable</span><span id="2ace" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker inspect mediumcom_first_1 --format '{{json .HostConfig.IpcMode}}'<br/>"<strong class="ne iu">shareable</strong>"</span></pre><h2 id="e84c" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">macåœ°å€</h2><p id="6b49" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">ä½ ç”šè‡³å¯ä»¥ä¸ºä½ çš„å®¹å™¨å®šä¹‰ä½ è‡ªå·±çš„macåœ°å€ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="e3dd" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="62b7" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: ifconfig eth0<br/>    mac_address: <!-- -->00:ab:cd:12:34:56</span><span id="9138" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  | eth0      Link encap:Ethernet  HWaddr <strong class="ne iu">00:AB:CD:12:34:56</strong>  <br/>first_1  |           inet addr:172.29.0.2  Bcast:172.29.255.255  Mask:255.255.0.0<br/>first_1  |           UP BROADCAST RUNNING MULTICAST  MTU:1500  Metric:1<br/>first_1  |           RX packets:2 errors:0 dropped:0 overruns:0 frame:0<br/>first_1  |           TX packets:0 errors:0 dropped:0 overruns:0 carrier:0<br/>first_1  |           collisions:0 txqueuelen:0 <br/>first_1  |           RX bytes:200 (200.0 B)  TX bytes:0 (0.0 B)<br/>first_1  | <br/>mediumcom_first_1 exited with code 0</span></pre><h2 id="8572" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">ç‰¹è®¸çš„</h2><p id="def5" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">æˆ‘ä»¬å·²ç»åœ¨ä¸Šé¢å‡ æ¬¡è§£å†³äº†â€œç‰¹æƒâ€å®¹å™¨çš„çŠ¶æ€ã€‚æ€»ä¹‹å¦‚æœä½ ç¡®å®š(ï¼ï¼)å¹¶ä¸”æ‚¨æƒ³ç®€å•åœ°å‘æ‚¨çš„å®¹å™¨æˆäºˆæ¯ä¸€ç§å¯èƒ½çš„èƒ½åŠ›(ä»¥åŠå¯¹ä¸»æœºè®¾å¤‡å’Œæ›´å¤šè®¾å¤‡çš„æ½œåœ¨è®¿é—®æƒ)ï¼Œé‚£ä¹ˆæ‚¨å¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="723c" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="41ee" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: sh -c 'ls /dev/ | wc -l'</span><span id="10ef" class="np md it ne b gy oj og l oh oi">  second:<br/>    image: alpine<br/>    command: sh -c 'ls /dev/ | wc -l'<br/>    privileged: true</span><span id="2e1e" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Recreating mediumcom_first_1  ... done<br/>Recreating mediumcom_second_1 ... done<br/>Attaching to mediumcom_first_1, mediumcom_second_1<br/>first_1   | 15<br/><strong class="ne iu">second_1  | 150</strong><br/>mediumcom_first_1 exited with code 0<br/>mediumcom_second_1 exited with code 0</span></pre><h2 id="5f38" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">åªè¯»</h2><p id="8e1e" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">å¦‚æ‚¨æ‰€çŸ¥ï¼Œè¿è¡Œå®¹å™¨æ—¶ï¼Œä¼šåœ¨å®¹å™¨çš„åªè¯»å›¾åƒå±‚ä¹‹ä¸Šåˆ›å»ºä¸€ä¸ªå¯å†™å±‚ã€‚ä½†æ˜¯ï¼Œæ‚¨ä¹Ÿå¯ä»¥å°†è¿™ä¸ªå¯å†™å±‚å˜ä¸ºåªè¯»ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="1e2f" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="fa6f" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: touch /tmp/test</span><span id="56cc" class="np md it ne b gy oj og l oh oi">  second:<br/>    image: alpine<br/>    command: touch /tmp/test<br/>    read_only: true</span><span id="04fb" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Recreating mediumcom_first_1  ... done<br/>Recreating mediumcom_second_1 ... done<br/>Attaching to mediumcom_first_1, mediumcom_second_1<br/><strong class="ne iu">second_1  | touch: /tmp/test: Read-only file system</strong><br/>mediumcom_first_1 exited with code 0<br/>mediumcom_second_1 exited with <strong class="ne iu">code 1</strong></span></pre><h2 id="017a" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">shm_size</h2><p id="b8dc" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">æ‚¨å¯ä»¥æŒ‡å®šå®¹å™¨å¯ä»¥ä½¿ç”¨çš„å…±äº«å†…å­˜é‡ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="3236" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="4879" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    command: df -h /dev/shm<br/>    shm_size: 123M</span><span id="5da4" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up <br/>Recreating mediumcom_first_1 ... done<br/>Attaching to mediumcom_first_1<br/>first_1  | Filesystem                Size      Used Available Use% Mounted on<br/>first_1  | <strong class="ne iu">shm</strong>                     <strong class="ne iu">123.0M</strong>         0    123.0M   0% <strong class="ne iu">/dev/shm</strong><br/>mediumcom_first_1 exited with code 0</span></pre><h2 id="c29a" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">æ ‡å‡†è¾“å…¥_æ‰“å¼€</h2><p id="73ab" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">è¿™ç›¸å½“äº<code class="fe nb nc nd ne b">docker run</code>ä¸­çš„<code class="fe nb nc nd ne b">-i</code>ã€‚ä½¿ç”¨å®ƒï¼Œæ‚¨å¯ä»¥ä¸ºæ‚¨çš„å®¹å™¨æ‰“å¼€STDINï¼Œåœ¨æ‚¨çš„ä¸»æœºå’Œå®¹å™¨ä¹‹é—´åˆ›å»ºä¸€ä¸ªäº¤äº’å¼ä¼šè¯ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="d4ed" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="991a" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    stdin_open: true</span><span id="2978" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d<br/>Recreating mediumcom_first_1 ... done<br/><strong class="ne iu">$ </strong>docker attach mediumcom_first_1 <br/>echo Hello, I am sending commands to the container<br/>Hello, I am sending commands to the container<br/>exit</span></pre><p id="d78c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬æ­£åœ¨ä¸å®¹å™¨è¿›è¡Œäº¤äº’ï¼Œä½†ä¸»æœºå’Œå®¹å™¨ä¹‹é—´å¹¶æ²¡æœ‰çœŸæ­£çš„ç»ˆç«¯ä¼šè¯â€¦å¦‚æœæ‚¨æƒ³ç®€åŒ–å®ƒï¼Œå®ƒåŸºæœ¬ä¸Šåªæ˜¯ä¸€ä¸ªç®¡é“ã€‚</p><h2 id="3fdc" class="np md it bd me nq nr dn mi ns nt dp mm li nu nv mo lm nw nx mq lq ny nz ms oa bi translated">ç”µä¼ æ‰“å­—æœº</h2><p id="0455" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">è¿™ç›¸å½“äº<code class="fe nb nc nd ne b">docker run</code>ä¸­çš„<code class="fe nb nc nd ne b">-t</code>ã€‚å®ƒè®©ä½ ä¸ºä½ çš„å®¹å™¨åˆ†é…ä¸€ä¸ªä¼ªttyï¼Œå½“ä¸<code class="fe nb nc nd ne b">stdin_open</code>ç»“åˆæ—¶ï¼Œå®ƒä¼šå¾ˆæœ‰ç”¨ã€‚</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="80a1" class="np md it ne b gy of og l oh oi"><strong class="ne iu">$ </strong>cat &gt;<strong class="ne iu">docker-compose.yml</strong> &lt;&lt;EOF<br/>version: "3"</span><span id="46da" class="np md it ne b gy oj og l oh oi">services:<br/>  first:<br/>    image: alpine<br/>    stdin_open: true<br/>    tty: true</span><span id="d892" class="np md it ne b gy oj og l oh oi">EOF<br/><strong class="ne iu">$ </strong>docker-compose up -d<br/>Recreating mediumcom_first_1 ... done<br/><strong class="ne iu">$ </strong>docker attach mediumcom_first_1 <br/>/ # echo now this is a real terminal<br/>now this is a real terminal<br/>/ # sleep 5<br/>^C<br/>/ # echo $?<br/>130<br/>/ # exit</span></pre><p id="a44c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç°åœ¨æˆ‘ä»¬æœ‰äº†ä¸€ä¸ªçœŸæ­£çš„ç»ˆç«¯å’Œä¸€ä¸ªäº¤äº’å¼ä¼šè¯ï¼Œå¯ä»¥åœ¨å®¹å™¨å†…éƒ¨åšæˆ‘ä»¬æƒ³åšçš„ä»»ä½•äº‹æƒ…ã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="c3b6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">é‚£æ˜¯ä¸€ç¯‡å¤§æ–‡ç« ã€‚å¾ˆæŠ±æ­‰ã€‚ä»å¥½çš„æ–¹é¢æ¥è¯´ï¼Œä½ ä¸éœ€è¦åœ¨æ ‡ç­¾é¡µä¹‹é—´è·³æ¥è·³å»ï¼Œåœ¨å¤šç¯‡æ–‡ç« ä¸­æœç´¢ï¼Œåªæ˜¯ä¸ºäº†æ‰¾å‡ºä¸åŒçš„åˆæˆæ–‡ä»¶é€‰é¡¹çš„ä½œç”¨</p><p id="f98a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¯·æ³¨æ„ï¼Œæˆ‘å·²ç»å¿½ç•¥äº†ä¸€äº›é€‰é¡¹(é‚£äº›ç‰¹å®šäºSwarmæ¨¡å¼ä¸­çš„æœåŠ¡çš„é€‰é¡¹)å’Œç‰¹æ®Šçš„ç»“æ„æŠ€å·§ï¼Œå¦‚å˜é‡æ›¿æ¢å’Œæ‰©å±•å­—æ®µã€‚è¿™äº›æ˜¯å¯é€‰çš„ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å¦ä¸€ç¯‡æ–‡ç« ä¸­ä»‹ç»å®ƒä»¬ã€‚</p><p id="732d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘å¸Œæœ›è¿™èƒ½æé«˜ä½ çš„Dockerå†™ä½œæŠ€å·§</p><pre class="kj kk kl km gt ob ne oc od aw oe bi"><span id="9705" class="np md it ne b gy of og l oh oi"><strong class="ne iu">Want to Connect?</strong></span><span id="8f9e" class="np md it ne b gy oj og l oh oi">I hope this article was useful, and serves as a good complement to my <a class="ae ky" href="https://www.udemy.com/course/docker-crash-course-learn-from-experience-for-beginners/?couponCode=B6FB29C107CC97ACFEFF" rel="noopener ugc nofollow" target="_blank">Docker course for beginners</a> (get 75% discount from this link).</span></pre></div></div>    
</body>
</html>