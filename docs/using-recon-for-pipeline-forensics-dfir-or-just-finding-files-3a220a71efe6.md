# å¦‚ä½•è¿›è¡Œç®¡é“å–è¯ï¼ŒDFIRï¼Œæˆ–è€…åªæ˜¯ç”¨ Recon å¿«é€Ÿæ‰¾åˆ°æ–‡ä»¶

> åŸæ–‡ï¼š<https://betterprogramming.pub/using-recon-for-pipeline-forensics-dfir-or-just-finding-files-3a220a71efe6>

## å¼€æºå·¥å…·çš„å¿«é€Ÿä»‹ç»

![](img/3f5dbd4a65a7977fd38ef395c027d5d2.png)

ä½œè€…å›¾ç‰‡

Recon æ˜¯ä¸€ä¸ªå†…ç½®äº Rust çš„å¼€æºå·¥å…·ğŸ¦€ï¼Œå…·æœ‰æŸ¥æ‰¾æ–‡ä»¶çš„å‡ºè‰²æ€§èƒ½å’Œäººä½“å·¥ç¨‹å­¦è®¾è®¡ã€‚

æ‚¨å¯èƒ½æƒ³è¦:

*   åœ¨ç®¡é“ä¸­è¿è¡Œä¸€äº›éªŒè¯æˆ–æ£€æŸ¥â€”â€”ä¾‹å¦‚ï¼Œåœ¨æ„å»º Javascript æ—¶ä¸ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œ
*   æˆ–è€…ï¼Œæ‚¨å¯èƒ½å¸Œæœ›åœ¨ç‰¹å®šä¸»æœºä¸Šè¿è¡Œæ•°å­—å–è¯ä»»åŠ¡ï¼Œä»¥æŸ¥æ‰¾ç‰¹å®šçš„æ¶æ„è½¯ä»¶ã€‚
*   æˆ–è€…ï¼Œæ‚¨å¯èƒ½æƒ³è¦ä¸€æŠŠç‘å£«å†›åˆ€æ¥ä½¿ç”¨ SQL æŸ¥æ‰¾æ–‡ä»¶ã€‚

![](img/a8667da77c6c1aea9b6ae90bd18665e0.png)

ä½œè€…å›¾ç‰‡

æŸ¥çœ‹è¿™é‡Œçš„ Github å›è´­ã€‚

# å…³é”®ç‰¹å¾

*   **ä½¿ç”¨ SQL æŸ¥è¯¢æ–‡ä»¶** â€”ä½¿ç”¨ SQL æŸ¥è¯¢çš„å…¨éƒ¨åŠŸèƒ½æŸ¥æ‰¾æ–‡ä»¶
*   **ä½¿ç”¨æ‘˜è¦æŸ¥æ‰¾å†…å®¹** â€”ä½¿ç”¨ SHA256/512ã€md5ã€crc32 æŸ¥æ‰¾å‰¯æœ¬ï¼Œä½¿ç”¨å…¶ä»–åŒ¹é…å™¨æŸ¥æ‰¾é‡è¦åŒ¹é…ï¼Œä»¥å®šä½ä¸»æœºä¸Šçš„å·¥ä»¶
*   **ä½¿ç”¨ YARA æŸ¥æ‰¾æ¶æ„è½¯ä»¶æˆ–äºŒè¿›åˆ¶æ–‡ä»¶** â€”ä½¿ç”¨ YARA è§„åˆ™é«˜æ•ˆåŒ¹é…äºŒè¿›åˆ¶æ–‡ä»¶
*   **å¾®è°ƒæ‚¨çš„æœç´¢è¿è¡Œæ—¶é—´** â€”æ‚¨å¯ä»¥åªé€‰æ‹©æ‚¨éœ€è¦çš„å¤„ç†ï¼Œä»¥ä¾¿å¿«é€Ÿè¦†ç›–æ›´å¤šæ–‡ä»¶
*   **æ„å»ºä½ è‡ªå·±çš„è„šæœ¬**â€”â€”ç”¨`--xargs`å°†`recon`ç»“æœä¼ è¾“åˆ°ä½ è‡ªå·±çš„è„šæœ¬
*   **å¯¼å‡º** â€”ä½¿ç”¨`--csv`æˆ–`--json`ï¼Œæˆ–å°†`recon.db`ä¸Šä¼ åˆ°è‡ªå·±çš„æœåŠ¡å™¨è¿›è¡Œåˆ†æ

# æ­£åœ¨ä¾¦å¯Ÿ

Recon æ˜¯å…è´¹å’Œå¼€æºçš„ã€‚å¯¹äº macOS:

```
$ brew tap rusty-ferris-club/tap && brew install recon
```

å¦åˆ™ï¼Œä»[é‡Šæ”¾](https://github.com/rusty-ferris-club/recon/releases)ä¸­æŠ“å–ä¸€ä¸ªé‡Šæ”¾å¹¶è¿è¡Œ`recon --help`:

```
$ recon --help
SQL over files with security processing and tests

Usage: recon [OPTIONS]

Options:
  -c, --config <CONFIG_FILE>  Point to a configuration
  -r, --root <ROOT>           Target folder to scan
  -q, --query <SQL>           Query with SQL
  -f, --file <DB_FILE>        Use a specific DB file (file or :memory: for in memory) [default: recon.db]
  -d, --delete                Clear data: delete existing cache database before running
  -u, --update                Always walk files and update DB before query. Leave off to run query on existing recon.db.
  -a, --all                   Walk all files (dont consider .gitignore)
      --no-progress           Don't display progress bars
  -m, --inmem                 Don't cache index to disk, run in-memory only
      --xargs                 Output as xargs formatted list
      --json                  Output as JSON
      --csv                   Output as CSV
      --no-style              Output as a table with no styles
      --fail-some             Exit code failure if *some* files are found
      --fail-none             Exit code failure if *no* files are found
      --verbose               Show logs
  -h, --help                  Print help information
  -V, --version               Print version information
```

# æ›´å¥½çš„â€œå‘ç°â€

ä½ è¿˜è®°å¾—`find`çš„æ‰€æœ‰è®ºç‚¹å—ï¼Ÿæˆ‘ä¹Ÿæ²¡æœ‰ã€‚Recon é€šè¿‡è®©æ‚¨ä½¿ç”¨ SQL ç®€åŒ–äº†æ–‡ä»¶æŸ¥æ‰¾:

```
$ recon -q "select path,mode,uid from files where ext='rs'"
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”
â”‚ path                       â”‚ mode       â”‚ uid â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ ./xtask/src/main.rs        â”‚ -rw-rw-r-- â”‚ 501 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ ./recon/tests/cli_tests.rs â”‚ -rw-r--r-- â”‚ 501 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ ./recon/src/os.rs          â”‚ -rw-r--r-- â”‚ 501 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ ./recon/src/out.rs         â”‚ -rw-r--r-- â”‚ 501 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ ./recon/src/bin/recon.rs   â”‚ -rw-r--r-- â”‚ 501 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ ./recon/src/config.rs      â”‚ -rw-r--r-- â”‚ 501 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ ./recon/src/lib.rs         â”‚ -rw-r--r-- â”‚ 501 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ ./recon/src/data.rs        â”‚ -rw-r--r-- â”‚ 501 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ ./recon/src/processing.rs  â”‚ -rw-r--r-- â”‚ 501 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ ./recon/src/workflow.rs    â”‚ -rw-r--r-- â”‚ 501 â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”¤
â”‚ ./recon/src/matching.rs    â”‚ -rw-r--r-- â”‚ 501 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”˜
11 of 233 files in 5.565875ms
```

ç”¨é€šå¸¸çš„`xargs`ç»„åˆå¯¹ç»“æœåšäº›ä»€ä¹ˆæ€ä¹ˆæ ·ï¼Ÿ

```
$ recon -q "select path from files where ext='rs'" --xargs | xargs echo
./xtask/src/main.rs ./recon/tests/cli_tests.rs ./recon/src/os.rs ./recon/src/out.rs ./recon/src/bin/recon.rs ./recon/src/config.rs ./recon/src/lib.rs ./recon/src/data.rs ./recon/src/processing.rs ./recon/src/workflow.rs ./recon/src/matching.rs
```

# å¼ºå¤§çš„å–è¯å·¥å…·

å¯¹äºè¯•å›¾å®šä½æ˜“å—æ”»å‡»çš„äºŒè¿›åˆ¶æ–‡ä»¶æˆ–æ¶æ„è½¯ä»¶ä»¥åŠæ‰‹å¤´çš„ä»»ä½•å…¶ä»– DFIR ä»»åŠ¡çš„å®‰å…¨ä¸“å®¶æ¥è¯´ï¼ŒRecon ä¹Ÿå¾ˆæœ‰ç”¨ã€‚

æ‚¨å¯ä»¥**é…ç½®å¤„ç†å™¨å’ŒåŒ¹é…å™¨**ï¼Œä»¥é˜²æ‚¨éœ€è¦ä¸€äº›è®¡ç®—å¯†é›†å‹æ•°æ®ç”¨äºæŸ¥è¯¢æˆ–åŒ¹é…ï¼Œä¾‹å¦‚:

*   æ‘˜è¦æˆ–æ ¡éªŒå’Œ(md5ã€SHAxxxã€crc32)
*   è·¯å¾„ï¼Œå†…å®¹åŒ¹é…
*   YARA è§„åˆ™
*   æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§[https://github . com/rusty-ferris-club/recon/tree/master/examples](https://github.com/rusty-ferris-club/recon/tree/master/examples)

**è®©æˆ‘ä»¬æ·»åŠ äºŒè¿›åˆ¶æ£€æµ‹ã€‚**åˆ›å»ºä¸€ä¸ªåä¸º`config.yaml`çš„é…ç½®æ–‡ä»¶:

```
source:
  computed_fields:
    is_binary: true
```

> *ä½ çŸ¥é“å—ï¼Ÿæ£€æµ‹æ–‡ä»¶æ˜¯å¦ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶çš„å¸¸ç”¨æ–¹æ³•æ˜¯ä»ä¸­è¯»å–ä¸€å—æ•°æ®(é€šå¸¸ä¸º 1k å­—èŠ‚)å¹¶åœ¨å…¶ä¸­æœç´¢ä»»ä½•éæ–‡æœ¬å­—èŠ‚ã€‚å¾ˆå¤§ç¨‹åº¦ä¸Š:æ²¡æœ‰å†…ç½®çš„æ“ä½œç³»ç»Ÿå…ƒæ•°æ®â€œæ ‡å¿—â€æ¥æŒ‡ç¤ºæ–‡ä»¶æ˜¯å¦æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ã€‚*

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`-m`æ¥é¿å…å°†ä»»ä½•ç¼“å­˜ä¿å­˜åˆ°ç£ç›˜ã€‚

```
$ recon -m -c config.yaml -q 'select path,is_binary,mode from files limit 6'
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ path          â”‚ is_binary â”‚ mode       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ./os.rs       â”‚ 0         â”‚ -rw-r--r-- â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ./out.rs      â”‚ 0         â”‚ -rw-r--r-- â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ./bin/main.rs â”‚ 0         â”‚ -rw-r--r-- â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ./config.rs   â”‚ 0         â”‚ -rw-r--r-- â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ./lib.rs      â”‚ 0         â”‚ -rw-r--r-- â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ./recon.db    â”‚ 1         â”‚ -rw-r--r-- â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
6 files in 145.81675ms
```

# æ¢ç´¢æ›´å¤š

æˆ‘ä»¬æœ‰å……åˆ†é…ç½®çš„ä¾‹å­æ¥æ¢ç´¢ï¼Œå¹¶å¼€å§‹ä»([æ‰“å¼€ä¸€ä¸ªå…¬å…³](https://github.com/rusty-ferris-club/recon/pulls)æ·»åŠ æ‚¨è‡ªå·±çš„ï¼):

[all-processors.yaml](https://github.com/rusty-ferris-club/recon/blob/master/examples/all-processors.yaml) â€”é»˜è®¤æƒ…å†µä¸‹æ‰“å¼€æ‰€æœ‰å¤„ç†å™¨

[custom-walking.yaml](https://github.com/rusty-ferris-club/recon/blob/master/examples/custom-walking.yaml) â€”ä»…è®¡ç®—éƒ¨åˆ†å·²éå†ç›®å½•æ ‘çš„å­—æ®µ

[file-classes.yaml](https://github.com/rusty-ferris-club/recon/blob/master/examples/file-classes.yaml) â€”é…ç½®å¹¶åˆ†ç±»æ‚¨è‡ªå·±çš„æ–‡ä»¶ç±»

[find-log4shell.yaml](https://github.com/rusty-ferris-club/recon/blob/master/examples/find-log4shell.yaml) â€”ä½¿ç”¨å·²çŸ¥æ‘˜è¦æŸ¥æ‰¾ log4shell æ¼æ´çš„ç¤ºä¾‹

[ä½¿ç”¨-yara.yaml](https://github.com/rusty-ferris-club/recon/blob/master/examples/using-yara.yaml) â€”ä½¿ç”¨ç®€å•çš„ yara è§„åˆ™é›†è¿›è¡ŒåŒ¹é…

æœ‰ç”¨ä¾‹å—ï¼Ÿæƒ³åšç‚¹è´¡çŒ®å—ï¼Ÿ[éšæ„å¼€ä¸€ä¸ª PR](https://github.com/rusty-ferris-club/recon)