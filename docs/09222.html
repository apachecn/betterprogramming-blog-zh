<html>
<head>
<title>Maintainability in the Face of API Complexity</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">é¢å¯¹APIå¤æ‚æ€§çš„å¯ç»´æŠ¤æ€§</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/maintainability-in-the-face-of-api-complexity-e23531e2d322?source=collection_archive---------0-----------------------#2021-07-29">https://betterprogramming.pub/maintainability-in-the-face-of-api-complexity-e23531e2d322?source=collection_archive---------0-----------------------#2021-07-29</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="2f01" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">APIç½‘å…³çš„å†…å®¹ã€åŸå› å’Œæ–¹å¼</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/bf226d015712acb5b9d775653459545b.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*29Ro9i6PCvnid5o3ZZiKpA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Denys Nevozhai åœ¨<a class="ae kv" href="https://unsplash.com/s/photos/highway-los-angeles?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„çš„ç…§ç‰‡</p></figure><p id="1967" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">APIç½‘å…³æ˜¯ä¸€ä¸ªç»„ä»¶ï¼Œå®ƒå°†æµé‡è·¯ç”±åˆ°åç«¯ï¼Œå¹¶å°†å®¢æˆ·ç«¯ä»APIå¥‘çº¦ä¸­åˆ†ç¦»å‡ºæ¥ã€‚å®ƒé€šè¿‡ä¸€ä¸ªå†…èšçš„APIæ¥å£å°è£…äº†ä¸€ä¸ªå¤æ‚çš„åº”ç”¨æ¶æ„ã€‚é™¤äº†å°è£…å’Œåå‘ä»£ç†ä¹‹å¤–ï¼Œå®ƒä»¬è¿˜å¯ä»¥ä»å•ä¸ªæœåŠ¡ä¸­å¸è½½æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œæ¯”å¦‚èº«ä»½éªŒè¯ã€é€Ÿç‡é™åˆ¶å’Œè¯·æ±‚æ—¥å¿—ã€‚</p><h2 id="0c48" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">èº«ä»½å±æœº</h2><p id="e4df" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">è¿‘å¹´æ¥å‡ºç°äº†è®¸å¤šç”¨äºè¯·æ±‚ç®¡ç†å’Œå¤„ç†çš„å·¥å…·ã€‚ä¸æ•°æ®ç³»ç»Ÿä¸€æ ·ï¼Œæ•°æ®å­˜å‚¨è¢«ç”¨ä½œæ¶ˆæ¯é˜Ÿåˆ—ï¼Œæ¶ˆæ¯é˜Ÿåˆ—å…·æœ‰ç±»ä¼¼æ•°æ®åº“çš„æŒä¹…æ€§ä¿è¯ï¼Œä»£ç†ã€ç½‘æ ¼å’Œç½‘å…³ä¹‹é—´çš„ç•Œé™æ­£åœ¨å˜å¾—æ¨¡ç³Šã€‚</p><p id="dd65" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸ºäº†é¿å…æ··æ·†ï¼Œæœ¬æ–‡å‡è®¾æ¯ä¸ªè§£å†³æ–¹æ¡ˆéƒ½æœ‰ä»¥ä¸‹ä¸»è¦èŒè´£:</p><ul class=""><li id="59a9" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><strong class="ky ir">æœåŠ¡ç½‘çŠ¶ã€‚</strong>ä¸€ä¸ªä¸“ç”¨çš„ç½‘ç»œåŸºç¡€è®¾æ–½ï¼Œè¦†ç›–åœ¨æ‚¨çš„æœåŠ¡ä¹‹ä¸Šï¼Œå¸è½½<em class="mz">æœåŠ¡é—´çš„é€šä¿¡åŠŸèƒ½</em>ï¼Œä¾‹å¦‚åŠ å¯†ã€å¯è§‚å¯Ÿæ€§å’Œå¼¹æ€§æœºåˆ¶ã€‚</li><li id="a4b4" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><strong class="ky ir"> APIç½‘å…³ã€‚</strong>æä¾›è·¨åº”ç”¨æ¶æ„çš„å†…èšæŠ½è±¡çš„ç»„ä»¶ï¼ŒåŒæ—¶ä»£è¡¨å•ä¸ªæœåŠ¡å¸è½½<em class="mz">è¾¹ç¼˜åŠŸèƒ½</em>ã€‚</li></ul><p id="96b9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘ä»¬ç°åœ¨æ¥çœ‹çœ‹APIç½‘å…³çš„â€œä¸ºä»€ä¹ˆâ€,ç¨åå†çœ‹ä¸€ä¸ªä»£ç ç¤ºä¾‹ã€‚</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><h1 id="a5c1" class="no lt iq bd lu np nq nr lx ns nt nu ma jw nv jx md jz nw ka mg kc nx kd mj ny bi translated">å‘å±•å°±æ˜¯ç»´æŠ¤</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nz"><img src="../Images/38079a9d82a19a05ed90aefc95f633b4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*CVSThjAXg8Vx1mnpkiX_NA.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae kv" href="https://unsplash.com/@guiccunha?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">å¤ä¼Šåˆ—æ¢…Â·å´”æ—</a>åœ¨<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šæ‹æ‘„</p></figure><p id="9e92" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¼—æ‰€å‘¨çŸ¥ï¼Œè½¯ä»¶çš„å¤§éƒ¨åˆ†æˆæœ¬éƒ½èŠ±åœ¨æ—¥å¸¸ç»´æŠ¤ä¸Šã€‚äº¤ä»˜åçš„æ‰€æœ‰å¢å¼ºå’Œä¿®å¤éƒ½è¢«è§†ä¸ºâ€œç»´æŠ¤å·¥ä½œâ€â€”â€”ä¿æŒç³»ç»Ÿè¿è¡Œã€åˆ†ææ•…éšœã€é€‚åº”ä¸åŒçš„å¹³å°ã€ä¿®å¤bugï¼Œä»¥åŠå¿è¿˜<a class="ae kv" href="https://en.wikipedia.org/wiki/Technical_debt#:~:text=Technical%20debt%20(also%20known%20as,approach%20that%20would%20take%20longer." rel="noopener ugc nofollow" target="_blank">æŠ€æœ¯å€ºåŠ¡</a>ã€‚æˆ‘ä»¬åº”è¯¥è®¾è®¡èƒ½å¤Ÿè½»æ¾é€‚åº”ä¸æ–­å˜åŒ–çš„éœ€æ±‚çš„ç³»ç»Ÿï¼Œä½¿ç»´æŠ¤æ¨¡å¼ä¸é‚£ä¹ˆç—›è‹¦ã€‚</p><blockquote class="oa"><p id="4d97" class="ob oc iq bd od oe of og oh oi oj lr dk translated">æ€»æ˜¯è¿™æ ·ç¼–ç ï¼Œå°±å¥½åƒæœ€ç»ˆç»´æŠ¤ä½ çš„ä»£ç çš„äººä¼šæ˜¯ä¸€ä¸ªçŸ¥é“ä½ ä½åœ¨å“ªé‡Œçš„æš´åŠ›ç²¾ç¥ç—…æ‚£è€…â€•â€•çº¦ç¿°Â·ä¼å…¹</p></blockquote><h1 id="8d8c" class="no lt iq bd lu np ok nr lx ns ol nu ma jw om jx md jz on ka mg kc oo kd mj ny bi translated">å˜åŒ–æ˜¯ä¸å¯é¿å…çš„</h1><p id="67e7" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">ä¸šåŠ¡ä¼˜å…ˆçº§å˜åŒ–ã€åº•å±‚å¹³å°å˜åŒ–ã€æ³•å¾‹æ³•è§„è¦æ±‚å˜åŒ–ã€æ‚¨çš„ç”¨æˆ·å˜åŒ–ï¼ç»å¤§å¤šæ•°è®¾è®¡åŸåˆ™éƒ½ä¸“æ³¨äºè®©äº‹æƒ…â€œæ›´å®¹æ˜“æ”¹å˜â€ï¼Œè¿™å¹¶ä¸æ˜¯å·§åˆæ— è®ºæ˜¯éš”ç¦»æ¨¡å—é—´çš„å…³æ³¨ç‚¹(<a class="ae kv" href="https://en.wikipedia.org/wiki/Coupling_%28computer_programming%29" rel="noopener ugc nofollow" target="_blank">è§£è€¦</a>)ï¼Œå±è”½ç®€å•<a class="ae kv" href="https://en.wikipedia.org/wiki/Facade_pattern" rel="noopener ugc nofollow" target="_blank">è¡¨è±¡</a>èƒŒåçš„å¤æ‚äº¤äº’ï¼Œè¿˜æ˜¯å¹²è„†ä¸é‡å¤è‡ªå·±(<a class="ae kv" href="https://en.wikipedia.org/wiki/Don%27t_repeat_yourself" rel="noopener ugc nofollow" target="_blank">å¹²</a>)ï¼›æˆ‘ä»¬çš„ç›®æ ‡åº”è¯¥æ˜¯èƒ½å¤Ÿè¿›åŒ–çš„ç³»ç»Ÿï¼Œä»¥ä¾¿äºå°†æ¥çš„é€‚åº”ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi op"><img src="../Images/479421304783a712bb066fa0d118e265.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*eLeHG0cczNplv4UmEcHMyw.jpeg"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">æ³°å‹’Â·æ‹‰æ–¯æ‰˜ç»´å¥‡åœ¨<a class="ae kv" href="https://unsplash.com/?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šçš„ç…§ç‰‡</p></figure><blockquote class="oa"><p id="18f8" class="ob oc iq bd od oe oq or os ot ou lr dk translated">å¯¹äºæ¯ä¸€ä¸ªå…³é”®çš„å†³ç­–ï¼Œé¡¹ç›®å›¢é˜Ÿéƒ½è‡´åŠ›äºé€‰æ‹©æ›´å°‘çš„ç°å®ç‰ˆæœ¬ã€‚</p></blockquote><h1 id="5be5" class="no lt iq bd lu np ok nr lx ns ol nu ma jw om jx md jz on ka mg kc oo kd mj ny bi translated">APIç»´æŠ¤</h1><p id="908d" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">éšç€ç»„ç»‡ä»å•ä¸€æ¶æ„è¿‡æ¸¡åˆ°æ›´åŠ åˆ†å¸ƒå¼æˆ–"<a class="ae kv" href="https://en.wikipedia.org/wiki/Shared-nothing_architecture#:~:text=A%20shared%2Dnothing%20architecture%20%28SN,to%20eliminate%20contention%20among%20nodes.&amp;text=A%20SN%20system%20can%20scale,central%20resource%20bottlenecks%20the%20system." rel="noopener ugc nofollow" target="_blank">æ— å…±äº«</a>"æ¶æ„ï¼Œå…¶ä¸­æœåŠ¡æ˜¯è‡ªæˆ‘ç®¡ç†çš„ï¼Œ<a class="ae kv" href="https://en.wikipedia.org/wiki/Mobile_backend_as_a_service" rel="noopener ugc nofollow" target="_blank">äº‘ç®¡ç†çš„</a>æˆ–"<a class="ae kv" href="https://en.wikipedia.org/wiki/Serverless_computing" rel="noopener ugc nofollow" target="_blank">æ— æœåŠ¡å™¨åŠŸèƒ½</a>"ï¼Œæ“ä½œå¤æ‚æ€§å¢åŠ ï¼Œæä¾›å¯é çš„APIä½“éªŒå˜å¾—å…·æœ‰æŒ‘æˆ˜æ€§ã€‚è¿™ç§å¤æ‚æ€§é™ä½äº†é¡¹ç›®å›¢é˜Ÿçš„é€Ÿåº¦ï¼Œè¿›ä¸€æ­¥å¢åŠ äº†ç»´æŠ¤æˆæœ¬ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ov"><img src="../Images/59bb074ab2f413c6edeadcbfae7b44f8.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*XsHDeVWZHgNvV9Kz5912Mg.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">ç›´æ¥çš„å®¢æˆ·ç«¯åˆ°æœåŠ¡çš„é€šä¿¡(ç”±<a class="ae kv" href="https://portfolio.fabijanbajo.com/" rel="noopener ugc nofollow" target="_blank">æœ¬äºº</a>ç»˜åˆ¶)</p></figure><p id="7ed7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨APIç®¡ç†ä¸­ï¼Œç›´æ¥çš„å®¢æˆ·ç«¯åˆ°æœåŠ¡çš„é€šä¿¡å¾€å¾€ä¼šå¢åŠ APIçš„å¤æ‚æ€§ï¼Œå¹¶å¯èƒ½å¸¦æ¥æ„æƒ³ä¸åˆ°çš„åæœ:</p><ul class=""><li id="2823" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><strong class="ky ir">ç´§è€¦åˆã€‚</strong>å®¢æˆ·ç«¯åº”ç”¨ç›´æ¥ä¾èµ–äºåç«¯æœåŠ¡ä¸æ–­å˜åŒ–çš„APIå¥‘çº¦ã€‚</li><li id="4f2c" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><strong class="ky ir">çŸ¥è¯†é‡å¤ã€‚</strong>æ¯ä¸ªå…¬å¼€çš„æœåŠ¡å®ç°å®ƒè‡ªå·±çš„è¾¹ç¼˜åŠŸèƒ½ï¼Œæ¯”å¦‚SSLç»ˆæ­¢å’Œé€Ÿç‡é™åˆ¶ã€‚</li><li id="9c3c" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><strong class="ky ir">å¤šæ¬¡å¾€è¿”ã€‚</strong>ç”±äºå¤æ‚çš„APIç»„åˆæµï¼Œè¿‡å¤šçš„ç½‘ç»œå¾€è¿”å¯èƒ½ä¼šé™ä½æ€§èƒ½ã€‚</li><li id="6756" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><strong class="ky ir">å¢åŠ äº†æ”»å‡»é¢ã€‚</strong>ç°åœ¨å¼€æ”¾äº†æ›´å¤šçš„ç«¯å£ï¼Œå…¬å¼€äº†æ›´å¤šçš„æœåŠ¡ï¼Œèº«ä»½éªŒè¯ä¹Ÿå˜æˆäº†ä¸€ä¸ªåˆ†å¸ƒå¼é—®é¢˜ã€‚</li></ul><blockquote class="oa"><p id="377b" class="ob oc iq bd od oe oq or os ot ou lr dk translated">æé«˜å¯ç»´æŠ¤æ€§å¹¶ä¸ä¸€å®šæ„å‘³ç€å‡å°‘åŠŸèƒ½ï¼›è¿™ä¹Ÿæ„å‘³ç€é™ä½å¤æ‚æ€§ã€‚</p></blockquote><h1 id="9bb7" class="no lt iq bd lu np ok nr lx ns ol nu ma jw om jx md jz on ka mg kc oo kd mj ny bi translated">åç«¯çš„å¤–è§‚</h1><p id="93f5" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">æ­£ç¡®è®¾è®¡çš„æŠ½è±¡å¯ä»¥åœ¨ç®€å•çš„å¤–è§‚åé¢éšè—å¤§é‡çš„å®ç°ç»†èŠ‚ã€‚APIç½‘å…³é€šè¿‡å°è£…å¤æ‚çš„åç«¯æ¶æ„æ¥æä¾›è¿™ç§æŠ½è±¡ï¼ŒåŒæ—¶å…¬å¼€ä¸€ä¸ªä¸€è‡´çš„ã€å®¢æˆ·ç«¯å‹å¥½çš„APIæ¥å£ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi ow"><img src="../Images/ae501438f85c44c2365ebe9c8a014810.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*17EbCAaySFw_PR907Si9UA.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">é€šè¿‡APIç½‘å…³è¿›è¡Œé€šä¿¡(ç”±<a class="ae kv" href="https://portfolio.fabijanbajo.com/" rel="noopener ugc nofollow" target="_blank">æœ¬äºº</a>ç»˜åˆ¶)</p></figure><p id="c8be" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸ºäº†å°†(åˆ†å¸ƒå¼)ç³»ç»Ÿçš„APIå¤æ‚æ€§ä¿æŒåœ¨å¯ç®¡ç†çš„æ°´å¹³ï¼ŒAPIç½‘å…³é€šè¿‡ä»¥ä¸‹æ–¹å¼æä¾›å¸®åŠ©:</p><ul class=""><li id="850e" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><strong class="ky ir">å°†å®¢æˆ·ä¸åç«¯åˆåŒåˆ†ç¦»ã€‚</strong> APIè·¯ç”±é€šè¿‡å•ç‹¬çš„è¯·æ±‚è·¯ç”±é…ç½®è¿›è¡Œç®¡ç†ï¼Œä¿æŒå®¢æˆ·ç«¯æ¥å£çš„ä¸€è‡´æ€§ã€‚</li><li id="b8c2" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><strong class="ky ir">å°†è·¨é¢†åŸŸé—®é¢˜æ•´åˆåˆ°ä¸€ä¸ªå±‚çº§ã€‚</strong>ç½‘å…³é€šè¿‡é›†ä¸­å…³é”®è¾¹ç¼˜åŠŸèƒ½çš„èŒè´£æ¥å‡å°‘é‡å¤å¹¶ç®€åŒ–æ¯é¡¹æœåŠ¡ã€‚</li><li id="269d" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><strong class="ky ir">è·¨æœåŠ¡èšåˆæ•°æ®ã€‚</strong>æˆ‘ä»¬ç°åœ¨å¯ä»¥é€šè¿‡å°†å•ä¸ªå®¢æˆ·ç«¯è¯·æ±‚åˆ†æ´¾ç»™å‡ ä¸ªå†…éƒ¨æœåŠ¡å¹¶ä½¿ç”¨èšåˆçš„æœ‰æ•ˆè´Ÿè½½è¿›è¡Œå“åº”æ¥åº”ç”¨â€œæœåŠ¡å™¨ç«¯â€APIç»„åˆã€‚</li><li id="82b7" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><strong class="ky ir">å¯¹å¤–ç•Œéšè—å†…éƒ¨æœåŠ¡ã€‚</strong>ä»…æš´éœ²ç½‘å…³å‡å°‘äº†ç½‘ç»œæ”»å‡»é¢ï¼Œå¹¶å…è®¸é›†ä¸­å¼APIå®‰å…¨ç®¡ç†ã€‚</li></ul></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><h1 id="8f20" class="no lt iq bd lu np nq nr lx ns nt nu ma jw nv jx md jz nw ka mg kc nx kd mj ny bi translated">å¸¦æœ‰KrakenDçš„å£°æ˜å¼APIç½‘å…³</h1><p id="0a78" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">æœ¬æ–‡çš„å‰©ä½™éƒ¨åˆ†é€šè¿‡ä¸€ä¸ªç¤ºä¾‹é¡¹ç›®æ¼”ç¤ºäº†APIç½‘å…³æ‰§è¡Œçš„ä¸€äº›å¸¸è§ä»»åŠ¡ã€‚</p><p id="7fd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç›®å‰ä¸€äº›æµè¡Œçš„(å¼€æº)APIç½‘å…³åŒ…æ‹¬:</p><ul class=""><li id="6340" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><a class="ae kv" href="https://github.com/Kong/kong" rel="noopener ugc nofollow" target="_blank">å­”</a></li><li id="7d1a" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><a class="ae kv" href="https://github.com/TykTechnologies/tyk" rel="noopener ugc nofollow" target="_blank"> Tyk </a></li><li id="0c67" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated">å…‹æ‹‰è‚¯å¾·</li></ul><p id="f2b1" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘é€‰æ‹©KrakenDæ˜¯å› ä¸ºå®ƒ:</p><ul class=""><li id="871c" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><strong class="ky ir">ç®€çº¦ã€‚</strong>ä¸€ä¸ª<a class="ae kv" href="https://hub.docker.com/r/devopsfaith/krakend/" rel="noopener ugc nofollow" target="_blank"> dockeræ˜ åƒ</a>å’Œä¸€ä¸ªé…ç½®æ–‡ä»¶å°±è¶³å¤Ÿäº†ã€‚</li><li id="a94b" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><strong class="ky ir">æ— å›½ç±å’Œä¸å˜æ€§ã€‚æ— çŠ¶æ€ã€ä¸å¯å˜å’Œç‹¬ç«‹äºå‘¨å›´çš„å·¥ä½œè´Ÿè½½ç®€åŒ–äº†ç»´æŠ¤å¹¶å‡å°‘äº†è€¦åˆã€‚</strong></li><li id="d982" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><strong class="ky ir">æ€§èƒ½ã€‚</strong>å¸¦<strong class="ky ir"> </strong>ä¸€ä¸ª<strong class="ky ir"> </strong>é™„åŠ ç½‘ç»œè·³ï¼Œæ¯ä¸ªè¯·æ±‚éƒ½å¿…é¡»ç»è¿‡ï¼Œä½ å¸Œæœ›å®ƒå¿«ã€‚KrakenDçš„æ„å»ºè€ƒè™‘åˆ°äº†æ€§èƒ½(<a class="ae kv" href="https://www.krakend.io/docs/benchmarks/overview/" rel="noopener ugc nofollow" target="_blank"> ~æ¯ç§’18ï¼Œ000ä¸ªè¯·æ±‚</a>)ã€‚</li></ul><p id="ffb9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å®ƒéµå¾ªå¤§å¤šæ•°<a class="ae kv" href="https://12factor.net/" rel="noopener ugc nofollow" target="_blank">åäºŒå› ç´ åº”ç”¨å®è·µ</a>ï¼Œæ˜¯å®¹å™¨ç¯å¢ƒçš„ç†æƒ³å€™é€‰ã€‚</p><h1 id="ce1f" class="no lt iq bd lu np ok nr lx ns ol nu ma jw ox jx md jz oy ka mg kc oz kd mj ny bi translated">è¯¥é¡¹ç›®</h1><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pa"><img src="../Images/bc95f64029bb6b1f55b0fbd650f5ae70.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*E5pu2bcuOl7LfMV-wWI9YQ.png"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">é¡¹ç›®å·¥è‰ºæµç¨‹ç¤ºä¾‹(ç”±<a class="ae kv" href="https://portfolio.fabijanbajo.com/" rel="noopener ugc nofollow" target="_blank">æœ¬äºº</a>ç»˜åˆ¶)</p></figure><p id="71e7" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç¤ºä¾‹åº”ç”¨ç¨‹åºä»£è¡¨äº†ä¸€ä¸ªå¤§å‹ç”µå­å•†åŠ¡å¾®æœåŠ¡é¡¹ç›®çš„ä¸€éƒ¨åˆ†ï¼Œæˆ‘æ­£åœ¨è¯•éªŒä¸€ä¸ªiOSå‰ç«¯ã€‚æˆ‘ä»¬å°†åªä½¿ç”¨ä»¥ä¸‹éƒ¨åˆ†:</p><p id="d384" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åº”ç”¨:</p><ul class=""><li id="a8f3" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><strong class="ky ir">æ¨è½¦æœåŠ¡ã€‚</strong>ç”¨GOå†™çš„RESTæœåŠ¡ï¼Œä¸ºæ³¨å†Œå®¢æˆ·ç®¡ç†è´­ç‰©è½¦ã€‚</li><li id="8721" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><strong class="ky ir">èº«ä»½æœåŠ¡ã€‚</strong>ç”¨Typescriptç¼–å†™çš„RESTæœåŠ¡ï¼Œç®¡ç†å®¢æˆ·è´¦æˆ·å¹¶å‘å¸ƒJSON Webä»¤ç‰Œ(jwt)ã€‚</li><li id="14f0" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><strong class="ky ir">ç½‘å…³</strong>ã€‚ä¸€ä¸ªKrakenD(ç¤¾åŒºç‰ˆ)APIç½‘å…³ï¼Œå¤„ç†è¯·æ±‚è·¯ç”±ã€æˆæƒã€æœ‰æ•ˆè´Ÿè½½éªŒè¯å’Œé€Ÿç‡é™åˆ¶ã€‚</li></ul><p id="be31" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘ä¸ºæœ¬æ–‡æ‰©å±•äº†å­˜å‚¨å±‚ï¼Œä½¿å…¶ä¸ä¾èµ–äºPostgreså’ŒRedisï¼Œå¹¶ä¿æŒç®€æ´ã€‚</p><p id="11a5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åŸºç¡€è®¾æ–½:</p><ul class=""><li id="98e6" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated">åº“ä¼¯å†…ç‰¹ï¼Œèµ«å°”å§†&amp;æ–¯å¡ç¦å¾·ã€‚æ‰€æœ‰å·¥ä½œè´Ÿè½½éƒ½é€šè¿‡Kubernetes Helm chartsæ‰“åŒ…ã€‚Skaffoldå¤„ç†<em class="mz">å·¥ä½œæµ</em>æ¥æ„å»ºæ•´ä¸ªé¡¹ç›®å¹¶å°†å…¶éƒ¨ç½²åˆ°é›†ç¾¤ä¸­ã€‚</li><li id="34dc" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><strong class="ky ir">ç å¤´å·¥äººä½œæ›²ã€‚ä»£æ›¿Kubernetesï¼Œè¿™ä¸ªé¡¹ç›®ä¹Ÿå¯ä»¥é€šè¿‡Docker Composeæ¥æ„å»ºå’Œéƒ¨ç½²ã€‚</strong></li></ul><p id="6028" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘ä»¬å°†åœ¨ä¸‹é¢å‡ èŠ‚ä¸­ä½¿ç”¨Docker Composeæ¥æ„å»ºæˆ‘ä»¬çš„ç½‘å…³æ¸…å•ï¼Œå°½ç®¡å­˜å‚¨åº“ä¸­æä¾›äº†ä¸€ä¸ªå®Œå…¨å¯ç”¨çš„Kubernetesé…ç½®ã€‚</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="d084" class="ls lt iq pc b gy pg ph l pi pj">Project:</span><span id="9a6d" class="ls lt iq pc b gy pk ph l pi pj">.<br/>â”œâ”€â”€ <a class="ae kv" href="https://github.com/Bajocode/article-apigateways/tree/master/identity-service" rel="noopener ugc nofollow" target="_blank">identity-service/ (nodejs microservice)</a><br/>â”‚ â”œâ”€â”€ src/<br/>â”‚ â”œâ”€â”€ Dockerfile<br/>â”‚ â””â”€â”€ Makefile<br/>â”œâ”€â”€ <a class="ae kv" href="https://github.com/Bajocode/article-apigateways/tree/master/cart-service" rel="noopener ugc nofollow" target="_blank">cart-service/ (golang microservice)</a><br/>â”‚ â”œâ”€â”€ src/<br/>â”‚ â”œâ”€â”€ Dockerfile<br/>â”‚ â””â”€â”€ Makefile<br/>â”œâ”€â”€ <a class="ae kv" href="https://github.com/Bajocode/article-apigateways/tree/master/kubernetes-helmcharts" rel="noopener ugc nofollow" target="_blank">kubernetes-helmcharts/</a><br/>â”‚ â”œâ”€â”€ identity-service/<br/>â”‚ â”œâ”€â”€ cart-service/<br/>â”‚ â””â”€â”€ gateway/<br/>â”œâ”€â”€ krakend.yaml<br/>â”œâ”€â”€ docker-compose.yaml<br/>â””â”€â”€ skaffold.yaml</span><span id="d9b8" class="ls lt iq pc b gy pk ph l pi pj"><br/>Versions:</span><span id="631d" class="ls lt iq pc b gy pk ph l pi pj">Kubernetes:  1.21.2<br/>Helm:        3.3.3<br/>Skaffold:    1.27.0<br/>Docker:      20.10.5<br/>Go:          1.15.2<br/>NodeJS:      12.19.0<br/>KrakenD:     1.2</span></pre><blockquote class="pl pm pn"><p id="0e38" class="kw kx mz ky b kz la jr lb lc ld ju le po lg lh li pp lk ll lm pq lo lp lq lr ij bi translated">ç¤ºä¾‹åº”ç”¨ç¨‹åºçš„å®Œæ•´æºä»£ç å¯ä»¥åœ¨<a class="ae kv" href="https://github.com/Bajocode/article-apigateways" rel="noopener ugc nofollow" target="_blank"> GitHub </a>ä¸Šæ‰¾åˆ°ã€‚</p></blockquote><h2 id="c7fc" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">ä½¿ç”¨<a class="ae kv" href="https://docs.docker.com/compose/install/" rel="noopener ugc nofollow" target="_blank"> Docker Compose </a>æ„å»ºå’Œéƒ¨ç½²</h2><p id="c873" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">å®‰è£…<a class="ae kv" href="https://docs.docker.com/get-docker/" rel="noopener ugc nofollow" target="_blank">å¯¹æ¥å™¨</a>å¹¶è¿è¡Œ:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="867d" class="ls lt iq pc b gy pg ph l pi pj">$ docker compose up<br/>...<br/>[+] Running 3/3<br/> â ¿ Container cart-service      Started  4.0s<br/> â ¿ Container identity-service  Started  5.8s<br/> â ¿ Container gateway           Started  7.0s</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">dockerâ€”â€”æ„å»ºå’Œè¿è¡Œå®¹å™¨çš„é…ç½®</p></figure><h2 id="b2d1" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">ç”¨<a class="ae kv" href="https://docs.docker.com/desktop/kubernetes/#:~:text=The%20Kubernetes%20server%20runs%20within,not%20affect%20your%20other%20workloads." rel="noopener ugc nofollow" target="_blank">åº“ä¼¯å†…ç‰¹</a>ã€<a class="ae kv" href="https://helm.sh/" rel="noopener ugc nofollow" target="_blank">èµ«å°”å§†</a>å’Œ<a class="ae kv" href="https://skaffold.dev/" rel="noopener ugc nofollow" target="_blank">æ–¯å¡ç¦å¾·</a>å»ºé€ å’Œéƒ¨ç½²</h2><p id="219b" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">åœ¨æœ¬åœ°æˆ–äº‘ä¸­åˆ›å»ºä¸€ä¸ªKubernetesé›†ç¾¤ã€‚</p><blockquote class="pl pm pn"><p id="1a65" class="kw kx mz ky b kz la jr lb lc ld ju le po lg lh li pp lk ll lm pq lo lp lq lr ij bi translated">Dockeræ¡Œé¢åŒ…æ‹¬ä¸€ä¸ªç‹¬ç«‹çš„KubernetesæœåŠ¡å™¨å’Œè¿è¡Œåœ¨æ‚¨æœºå™¨ä¸Šçš„å®¢æˆ·ç«¯ã€‚è¦å¯ç”¨Kubernetesï¼Œè¯·è½¬åˆ°<strong class="ky ir"> Docker </strong> &gt; <strong class="ky ir">é¦–é€‰é¡¹</strong> &gt; <strong class="ky ir"> Kubernetes </strong>ï¼Œç„¶åç‚¹å‡»<strong class="ky ir">å¯ç”¨Kubernetes </strong>ã€‚</p></blockquote><p id="6abc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://skaffold.dev/docs/install/" rel="noopener ugc nofollow" target="_blank">å®‰è£…Skaffold </a>å’Œ<a class="ae kv" href="https://helm.sh/docs/intro/install/" rel="noopener ugc nofollow" target="_blank">èˆµ</a>ï¼Œå±•å¼€æ‰€æœ‰èˆµå›¾:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="1bc2" class="ls lt iq pc b gy pg ph l pi pj">$ skaffold run --port-forward=user --tail<br/>...<br/>Waiting for deployments to stabilize...<br/> - deployment/cart-service is ready.<br/> - deployment/gateway is ready.<br/> - deployment/identity-service is ready.<br/>Deployments stabilized in 19.0525727s</span></pre><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Skaffoldé…ç½®ç”¨äºæ„å»ºå®¹å™¨å¹¶é€šè¿‡èˆµå›¾éƒ¨ç½²å®ƒä»¬</p></figure><h2 id="2da7" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">ä½œä¸ºä»£ç çš„APIé…ç½®</h2><p id="f483" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">åœ¨<code class="fe pr ps pt pc b">project-root/krakend.yaml</code>åˆ›å»ºä¸€ä¸ªæ–°çš„KrakenDæ¸…å•ï¼Œå†…å®¹å¦‚ä¸‹:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="fba2" class="ls lt iq pc b gy pg ph l pi pj">krakend.yaml<br/>---<br/>version: 2<br/>endpoints: []</span></pre><p id="240c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘åœ¨è¿™é‡Œåšçš„åªæ˜¯æŒ‡å®šæ–‡ä»¶æ ¼å¼çš„ç‰ˆæœ¬ã€‚</p><h2 id="eae3" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">æŒ‰æŒ‡å®šè·¯çº¿å‘é€</h2><p id="eaf5" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">åœ¨<code class="fe pr ps pt pc b">endpoints</code>æ•°ç»„ä¸‹æ·»åŠ ä¸€ä¸ªç«¯ç‚¹å¯¹è±¡ï¼Œå¹¶å…¬å¼€<code class="fe pr ps pt pc b">GET /users</code>èº«ä»½æœåŠ¡ç«¯ç‚¹:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="f298" class="ls lt iq pc b gy pg ph l pi pj">krakend.yaml<br/>---<br/>...<br/>endpoints:</span><span id="6a6a" class="ls lt iq pc b gy pk ph l pi pj">- endpoint: /users<br/>  method: GET<br/>  output_encoding: no-op<br/>  backend:<br/>  - url_pattern: /users<br/>    encoding: no-op<br/>    sd: static<br/>    method: GET<br/>    host:<br/>    - <a class="ae kv" href="http://identity-service:9005" rel="noopener ugc nofollow" target="_blank">http://identity-service:9005</a></span></pre><ul class=""><li id="4024" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><code class="fe pr ps pt pc b">no-op</code>(æ— æ“ä½œ)ç¼–ç ç¡®ä¿å®¢æˆ·ç«¯è¯·æ±‚åƒä¸€æ ·è¢«è½¬å‘åˆ°åç«¯<em class="mz">ï¼Œåä¹‹äº¦ç„¶ã€‚</em></li><li id="0828" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><code class="fe pr ps pt pc b">static</code> resolutionæ˜¯é»˜è®¤çš„æœåŠ¡å‘ç°è®¾ç½®ï¼Œä¹Ÿæ˜¯æˆ‘ä»¬å°†ç”¨äºDocker Composeç½‘ç»œçš„è®¾ç½®ã€‚</li></ul><p id="5634" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¯¹äºKuberneteséƒ¨ç½²ï¼Œå°†<code class="fe pr ps pt pc b"><em class="mz">sd</em></code>è®¾ç½®ä¸º<code class="fe pr ps pt pc b"><em class="mz">dns</em></code>(å¯ç”¨<a class="ae kv" href="https://kubernetes.io/docs/concepts/services-networking/dns-pod-service/" rel="noopener ugc nofollow" target="_blank"> DNS SRV </a>æ¨¡å¼)</p><p id="3d26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">é‡å¯ç½‘å…³å¹¶æ‰§è¡Œä¸€ä¸ª<code class="fe pr ps pt pc b">GET /users</code>è¯·æ±‚:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="777a" class="ls lt iq pc b gy pg ph l pi pj">$ docker compose restart gateway</span><span id="4c1a" class="ls lt iq pc b gy pk ph l pi pj">$ curl '<a class="ae kv" href="http://0.0.0.0:8000/users'" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:8080/users'</a> \<br/>  --request GET \<br/>  --include</span><span id="aeb7" class="ls lt iq pc b gy pk ph l pi pj">HTTP/1.1 401 Unauthorized<br/>...<br/>{<br/>  "status": 401,<br/>  "message": "No Authorization header"<br/>}</span></pre><p id="753c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘å·²ç»ä¸ºèº«ä»½æœåŠ¡ç¼–å†™äº†<a class="ae kv" href="https://github.com/Bajocode/article-apigateways/blob/master/identity-service/src/middleware/authMiddleware.ts" rel="noopener ugc nofollow" target="_blank">è‡ªå®šä¹‰JWTæˆæƒä¸­é—´ä»¶</a>ï¼Œç”¨äºè§£ç å’ŒéªŒè¯<a class="ae kv" href="https://en.wikipedia.org/wiki/JSON_Web_Token" rel="noopener ugc nofollow" target="_blank"> JWT </a>æœ‰æ•ˆè´Ÿè½½ï¼Œå¯é€šè¿‡ä»¥ä¸‹æ–¹å¼é…ç½®:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="ee87" class="ls lt iq pc b gy pg ph l pi pj">docker-compose.yaml<br/>---<br/>...<br/>identity-service:<br/>    environment:<br/>    - JWT_VALIDATION_ENABLED=true<br/>    - JWT_PATHS_WHITELIST=/auth/register,/auth/login,/jwks.json</span></pre><p id="5e54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¿æŒä¸Šé¢çš„åŸæ ·ï¼Œç”¨<code class="fe pr ps pt pc b">register</code>å’Œ<code class="fe pr ps pt pc b">login</code>è·¯ç”±æ‰©å±•<code class="fe pr ps pt pc b">krakend.yaml</code>,ä»¥ä»èº«ä»½æœåŠ¡å‘å¸ƒJWTä»¤ç‰Œ:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="1d8b" class="ls lt iq pc b gy pg ph l pi pj">krakend.yaml<br/>---<br/>...<br/>endpoints:</span><span id="ad83" class="ls lt iq pc b gy pk ph l pi pj">- endpoint: /users<br/>  ...</span><span id="690f" class="ls lt iq pc b gy pk ph l pi pj">- endpoint: /auth/register<br/>  method: POST<br/>  output_encoding: no-op<br/>  backend:<br/>  - url_pattern: /auth/register<br/>    encoding: no-op<br/>    sd: static<br/>    method: POST<br/>    host:<br/>    - <a class="ae kv" href="http://identity-service:9005" rel="noopener ugc nofollow" target="_blank">http://identity-service:9005</a></span><span id="02eb" class="ls lt iq pc b gy pk ph l pi pj">- endpoint: /auth/login<br/>  method: POST<br/>  output_encoding: no-op<br/>  backend:<br/>  - url_pattern: /auth/login<br/>    encoding: no-op<br/>    sd: static<br/>    method: POST<br/>    host:<br/>    - <a class="ae kv" href="http://identity-service:9005" rel="noopener ugc nofollow" target="_blank">http://identity-service:9005</a></span></pre><p id="935f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">é€šè¿‡æ³¨å†Œæ–°ç”¨æˆ·æ¥é¢å‘JWTä»¤ç‰Œï¼Œå¹¶å°†å…¶å¯¼å‡ºåˆ°æ‚¨çš„shellç¯å¢ƒä¸­ä¾›ä»¥åä½¿ç”¨:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="5d1a" class="ls lt iq pc b gy pg ph l pi pj">$ docker compose restart gateway</span><span id="8bc3" class="ls lt iq pc b gy pk ph l pi pj">$ curl '<a class="ae kv" href="http://0.0.0.0:8000/auth/register'" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:</a><a class="ae kv" href="http://0.0.0.0:8000/users'" rel="noopener ugc nofollow" target="_blank">8080</a><a class="ae kv" href="http://0.0.0.0:8000/auth/register'" rel="noopener ugc nofollow" target="_blank">/auth/register'</a> \<br/>  --request POST \<br/>  --header "Content-type: application/json" \<br/>  --include \<br/>  --data '{<br/>    "email": "som@ebo.dy",<br/>    "password": "pass"<br/>  }'</span><span id="67a6" class="ls lt iq pc b gy pk ph l pi pj">HTTP/1.1 201 Created<br/>...<br/>{<br/>  "token": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InVzZX...",<br/>  "expiry": 1623536812<br/>}</span><span id="8f01" class="ls lt iq pc b gy pk ph l pi pj">$ export TOKEN=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InVzZX...</span></pre><p id="640a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å°†æ‚¨çš„ä»¤ç‰Œæ’å…¥åˆ°<code class="fe pr ps pt pc b">Authorization</code>å¤´ä¸­ï¼Œå¹¶å†æ¬¡å°è¯•è·å–æ‰€æœ‰ç”¨æˆ·:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="5a9f" class="ls lt iq pc b gy pg ph l pi pj">$ curl '<a class="ae kv" href="http://0.0.0.0:8000/users'" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:</a><a class="ae kv" href="http://0.0.0.0:8000/users'" rel="noopener ugc nofollow" target="_blank">8080</a><a class="ae kv" href="http://0.0.0.0:8000/users'" rel="noopener ugc nofollow" target="_blank">/users'</a> \<br/>    --request "GET" \<br/>    --header "Authorization: Bearer ${TOKEN}" \<br/>    --include</span><span id="fb88" class="ls lt iq pc b gy pk ph l pi pj">HTTP/1.1 401 Unauthorized<br/>...<br/>{<br/>  "status": 401,<br/>  "message": "No Authorization header"<br/>}</span></pre><p id="e08b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">é»˜è®¤æƒ…å†µä¸‹ï¼ŒKrakenDä¸ä¼šå°†å®¢æˆ·ç«¯å¤´å‘é€åˆ°åç«¯ã€‚</p><p id="3886" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨<code class="fe pr ps pt pc b">/users</code>ç«¯ç‚¹å¯¹è±¡ä¸‹æ·»åŠ ä¸€ä¸ª<code class="fe pr ps pt pc b">headers_to_pass</code>å±æ€§ï¼Œå°†<code class="fe pr ps pt pc b">Authorization</code>è¯·æ±‚å¤´è½¬å‘åˆ°åç«¯:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="bde8" class="ls lt iq pc b gy pg ph l pi pj">krakend.yaml<br/>---<br/>...<br/>endpoints:</span><span id="e690" class="ls lt iq pc b gy pk ph l pi pj">- endpoint: /users<br/>  ...<br/>  headers_to_pass:<br/>  - Authorization<br/>  backend:<br/>  ...</span></pre><p id="9bf5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">éšç€<code class="fe pr ps pt pc b">Authorization</code>å¤´çš„è½¬å‘ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥æ£€ç´¢æ‰€æœ‰ç”¨æˆ·:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="f6d8" class="ls lt iq pc b gy pg ph l pi pj">$ docker compose restart gateway</span><span id="9134" class="ls lt iq pc b gy pk ph l pi pj">curl '<a class="ae kv" href="http://0.0.0.0:8000/users'" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:</a><a class="ae kv" href="http://0.0.0.0:8000/users'" rel="noopener ugc nofollow" target="_blank">8080</a><a class="ae kv" href="http://0.0.0.0:8000/users'" rel="noopener ugc nofollow" target="_blank">/users'</a> \<br/>    --request "GET" \<br/>    --header "Authorization: Bearer ${TOKEN}" \<br/>    --include</span><span id="6c0d" class="ls lt iq pc b gy pk ph l pi pj">HTTP/1.1 200 OK </span><span id="d13f" class="ls lt iq pc b gy pk ph l pi pj">[{<br/>   "id":"f06b084b-9d67-4b01-926b-f90c6246eed9",<br/>   "email":"<a class="ae kv" href="mailto:somebody@nobody.com" rel="noopener ugc nofollow" target="_blank">som@ebo.dy</a>"<br/>}]</span></pre><p id="10ed" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç›®å‰ä¸ºæ­¢æˆ‘ä»¬çš„å…‹æ‹‰è‚¯æ¸…å•:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure><h2 id="920d" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">å¸è½½æˆæƒ</h2><p id="36c4" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">æˆ‘ä»¬ä¸è¦ä¸ºcartæœåŠ¡ç¼–å†™å®šåˆ¶çš„GOæˆæƒä¸­é—´ä»¶ï¼Œè€Œæ˜¯é€šè¿‡å°†è¿™ä¸ªæ¨ªåˆ‡å…³æ³¨ç‚¹å¸è½½åˆ°ç½‘å…³æ¥å±è”½å®ƒçš„ç«¯ç‚¹ã€‚</p><p id="36e8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://datatracker.ietf.org/doc/html/rfc7517#section-4.1" rel="noopener ugc nofollow" target="_blank"> JSON Webå¯†é’¥é›†</a>æ ¼å¼ç”¨äºå‘ç½‘å…³å…¬å¼€æˆ‘ä»¬çš„ä»¤ç‰Œå®Œæ•´æ€§éªŒè¯å¯†é’¥ã€‚ä¸ºäº†ç®€å•èµ·è§ï¼Œåœ¨ç¼–å†™èº«ä»½æœåŠ¡(æˆ‘ä»¬çš„<a class="ae kv" href="https://en.wikipedia.org/wiki/Identity_provider" rel="noopener ugc nofollow" target="_blank">èº«ä»½æä¾›è€…</a>)æ—¶ï¼Œæˆ‘ä½¿ç”¨äº†HS256ç®—æ³•(HMAC-SHA256)ç”Ÿæˆå¯¹ç§°ç­¾å:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="5e0f" class="ls lt iq pc b gy pg ph l pi pj">$ echo -n 'secret' | openssl base64<br/>c2VjcmV0</span></pre><p id="813f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi">ğŸ¤«</p><p id="e952" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘ä»¬çš„JWKSåŒ…å«ç›¸åŒçš„å¯¹ç§°å¯†é’¥ï¼Œé™æ€æ‰˜ç®¡åœ¨<code class="fe pr ps pt pc b">identity-service/jwks.json</code>:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="9218" class="ls lt iq pc b gy pg ph l pi pj"># identity-service/jwks.json</span><span id="01e6" class="ls lt iq pc b gy pk ph l pi pj">{<br/>  "keys": [<br/>    {<br/>      "kty": "oct",     # key type (octet string)<br/>      "kid": "userid",  # key id (identify the key in the set)<br/>      "k": "c2VjcmV0",  # key<br/>      "alg": "HS256".   # algorithm<br/>    }<br/>  ]<br/>}</span></pre><blockquote class="pl pm pn"><p id="a6c6" class="kw kx mz ky b kz la jr lb lc ld ju le po lg lh li pp lk ll lm pq lo lp lq lr ij bi translated">æœ‰å…³JWKæ ‡å‡†çš„æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è€ƒ<a class="ae kv" href="https://datatracker.ietf.org/doc/html/rfc7517" rel="noopener ugc nofollow" target="_blank"> RFCæ–‡ä»¶</a>ã€‚</p></blockquote><p id="2798" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å°†ä¸€ä¸ª<code class="fe pr ps pt pc b">PUT /cart</code>ç«¯ç‚¹é™„åŠ åˆ°æ¸…å•ä¸Šï¼Œå¹¶é€šè¿‡<code class="fe pr ps pt pc b">krakend-jose</code>éªŒè¯å™¨æ’ä»¶å±è”½æ‰æœªæ³¨å†Œçš„å®¢æˆ·:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="7d5c" class="ls lt iq pc b gy pg ph l pi pj">krakend.yaml<br/>---<br/>...<br/>- endpoint: /cart<br/>  method: PUT<br/>  output_encoding: no-op<br/>  extra_config:<br/>    github.com/devopsfaith/krakend-jose/validator:<br/>      alg: HS256<br/>      jwk-url: <a class="ae kv" href="http://identity-service:9005/jwks.json" rel="noopener ugc nofollow" target="_blank">http://identity-service:9005/jwks.json</a><br/>      disable_jwk_security: true<br/>      kid: userid<br/>  backend:<br/>  - url_pattern: /cart                   <br/>    encoding: no-op<br/>    sd: static<br/>    method: PUT<br/>    host:<br/>    - <a class="ae kv" href="http://cart-service:9002" rel="noopener ugc nofollow" target="_blank">http://cart-service:9002</a></span></pre><p id="2d9d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¿™é‡Œæˆ‘ä»¬æŒ‡å®šâ€œå¯†é’¥IDâ€ï¼Œå¹¶é€šè¿‡å°†<code class="fe pr ps pt pc b">disable_jwk_security</code>è®¾ç½®ä¸º<code class="fe pr ps pt pc b">false</code>æ¥å…è®¸HTTPè®¿é—®æˆ‘ä»¬ç§æœ‰çš„jwkã€‚</p><blockquote class="pl pm pn"><p id="1fb6" class="kw kx mz ky b kz la jr lb lc ld ju le po lg lh li pp lk ll lm pq lo lp lq lr ij bi translated">å¦‚æœæ‚¨å…³é—­äº†æ‚¨çš„shellä¼šè¯ï¼Œæ‰§è¡Œä¸€ä¸ª<code class="fe pr ps pt pc b">/login</code>è¯·æ±‚å¹¶å°†æ‚¨çš„ä»¤ç‰Œé‡æ–°å¯¼å‡ºåˆ°shellçš„ç¯å¢ƒä¸­:<br/> <code class="fe pr ps pt pc b">curl â€˜<a class="ae kv" href="http://0.0.0.0:8080/auth/login'" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:8080/auth/login'</a> -H â€œContent-type: application/jsonâ€ -d â€˜{â€œemailâ€: â€œ<a class="ae kv" href="mailto:som@ebo.dy" rel="noopener ugc nofollow" target="_blank">som@ebo.dy</a>â€,â€passwordâ€: â€œpassâ€}â€™</code></p></blockquote><p id="5f30" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä½¿ç”¨æœ‰æ•ˆä»¤ç‰Œæ‰§è¡Œ<code class="fe pr ps pt pc b">PUT /cart</code>è¯·æ±‚ï¼Œä»¥æ›´æ–°ç”¨æˆ·çš„è´­ç‰©è½¦:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="aa3a" class="ls lt iq pc b gy pg ph l pi pj">$ docker compose restart gateway</span><span id="9ff1" class="ls lt iq pc b gy pk ph l pi pj">$ curl '<a class="ae kv" href="http://0.0.0.0:8000/cart'" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:</a><a class="ae kv" href="http://0.0.0.0:8000/users'" rel="noopener ugc nofollow" target="_blank">8080</a><a class="ae kv" href="http://0.0.0.0:8000/cart'" rel="noopener ugc nofollow" target="_blank">/cart'</a> \<br/>  --request "PUT" \<br/>  --header "Content-type: application/json" \<br/>  --header "Authorization: Bearer ${TOKEN}" \<br/>  --include \<br/>  --data '{<br/>    "items": [{<br/>      "productid": "94e8d5de-2192-4419-b824-ccbe7b21fa6f",<br/>      "quantity": 2,<br/>      "price": 200<br/>    }]<br/>  }'</span><span id="d5ad" class="ls lt iq pc b gy pk ph l pi pj">HTTP/1.1 400 Bad Request<br/>...<br/>{<br/>  "message": "Bad request: no userID"<br/>}</span></pre><p id="72c2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">cartæœåŠ¡å¸Œæœ›å°†å®¢æˆ·ç«¯çš„ç”¨æˆ·IDæ·»åŠ åˆ°æ‰€æœ‰è·¯å¾„çš„å‰é¢ã€‚ç”¨æˆ·IDå¯ä»¥æ‰‹åŠ¨ä»JWTæœ‰æ•ˆè½½è·ä¸­æå–ï¼Œå› ä¸ºæˆ‘è‡ªå·±å°†å®ƒåµŒå…¥åœ¨ç”¨æˆ·id JWTå£°æ˜ä¸‹ã€‚</p><p id="dc29" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡KrakenD <code class="fe pr ps pt pc b">JWT</code>å˜é‡è®¿é—®ç»è¿‡éªŒè¯çš„JWTæœ‰æ•ˆè´Ÿè½½ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™è´­ç‰©è½¦ç«¯ç‚¹çš„åç«¯å¯¹è±¡:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="a3d2" class="ls lt iq pc b gy pg ph l pi pj">krakend.yaml<br/>---<br/>...<br/>- endpoint: /cart<br/>  ...<br/>  backend:<br/>  - url_pattern: /{JWT.userid}/cart                   <br/>    ...</span></pre><p id="a098" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¦‚æœæˆ‘ä»¬å†æ¬¡æ‰§è¡Œ<code class="fe pr ps pt pc b">PUT /cart</code>è¯·æ±‚ï¼Œå®ƒåº”è¯¥ä¼šæˆåŠŸåœ°åˆ›å»ºæˆ–æ›´æ–°<code class="fe pr ps pt pc b">cart</code>:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="3e9a" class="ls lt iq pc b gy pg ph l pi pj">$ docker compose restart gateway</span><span id="201a" class="ls lt iq pc b gy pk ph l pi pj">$ curl '<a class="ae kv" href="http://0.0.0.0:8000/cart'" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:</a><a class="ae kv" href="http://0.0.0.0:8000/users'" rel="noopener ugc nofollow" target="_blank">8080</a><a class="ae kv" href="http://0.0.0.0:8000/cart'" rel="noopener ugc nofollow" target="_blank">/cart'</a> \<br/>  --request "PUT" \<br/>  --header "Content-type: application/json" \<br/>  --header "Authorization: Bearer ${TOKEN}" \<br/>  --include \<br/>  --data '{<br/>    "items": [{<br/>      "productid": "94e8d5de-2192-4419-b824-ccbe7b21fa6f",<br/>      "quantity": 2,<br/>      "price": 200<br/>    }]<br/>  }'</span><span id="4caa" class="ls lt iq pc b gy pk ph l pi pj">HTTP/1.1 201 Created<br/>...<br/>{<br/>  "items": [<br/>    {<br/>      "productid": "94e8d5de-2192-4419...",<br/>      "quantity": 2,<br/>      "price":200<br/>    }<br/>  ]<br/>}</span></pre><p id="d7ac" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸‹ä¸€æ­¥å°†æ˜¯é‡æ„<code class="fe pr ps pt pc b">GET /users</code>ï¼Œå°†JWTéªŒè¯ä¹Ÿä»<code class="fe pr ps pt pc b">identity-service</code>ä¸­å¸è½½ã€‚</p><p id="4e26" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘å°†æŠŠè¿™ä½œä¸ºä¸€ä¸ªç»ƒä¹ ã€‚ä¸è¿‡ï¼Œåœ¨å¼€å§‹ä¹‹å‰ï¼Œè¯·ç¡®ä¿åœ¨èº«ä»½æœåŠ¡ä¸­ç¦ç”¨æœåŠ¡çº§åˆ«JWTéªŒè¯:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="8063" class="ls lt iq pc b gy pg ph l pi pj">docker-compose.yaml<br/>---<br/>identity-service:<br/>  ...<br/>  - JWT_VALIDATION_ENABLED=false    # offloaded to the gateway!<br/>  ...</span><span id="ca8b" class="ls lt iq pc b gy pk ph l pi pj">$ docker compose down &amp;&amp; docker compose up</span></pre><h2 id="5464" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">ç¡®è®¤</h2><p id="5c43" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">ä¸‹é¢çš„ä¾‹å­çº¯ç²¹æ˜¯ä¸ºäº†è¯´æ˜ï¼Œå±•ç¤ºäº†KrakenDå¦‚ä½•æ‰§è¡ŒåŸºäº<a class="ae kv" href="https://json-schema.org/" rel="noopener ugc nofollow" target="_blank">æ¨¡å¼</a>çš„JSONéªŒè¯ã€‚æ˜æ™ºçš„åšæ³•å¯èƒ½æ˜¯ä¸è¦å°†ç½‘å…³ä¸ä¸šåŠ¡é€»è¾‘è€¦åˆåœ¨ä¸€èµ·(ä¸åƒè¿™ä¸ªä¾‹å­)ï¼Œç¡®ä¿æœåŠ¡ä¿æŒåœ¨å®ƒä»¬çš„è¾¹ç•Œå†…ã€‚</p><p id="440b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å‡ºäºè¯´æ˜çš„ç›®çš„ï¼Œè®©æˆ‘ä»¬æŒ‡å®š<code class="fe pr ps pt pc b">/register</code>ç«¯ç‚¹çš„<code class="fe pr ps pt pc b">email</code>å’Œ<code class="fe pr ps pt pc b">password</code>å­—æ®µæ˜¯<code class="fe pr ps pt pc b">required</code>ï¼Œå¹¶ä¸”å¿…é¡»æ˜¯ç±»å‹<code class="fe pr ps pt pc b">string</code>:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="8b82" class="ls lt iq pc b gy pg ph l pi pj">krakend.yaml<br/>---<br/>...<br/>- endpoint: /auth/register<br/>  method: POST<br/>  output_encoding: no-op<br/>  extra_config:<br/>    github.com/devopsfaith/krakend-jsonschema:<br/>      type: object<br/>      required:<br/>      - email<br/>      - password<br/>      properties:<br/>        email:<br/>          type: string<br/>        password:<br/>          type: string<br/>  backend:<br/>  ...<br/>...</span></pre><p id="a963" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">é¦–å…ˆï¼Œæ›´æ”¹<code class="fe pr ps pt pc b">email</code>é”®ä»¥å‘é€æ— æ•ˆæœ‰æ•ˆè½½è·:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="586b" class="ls lt iq pc b gy pg ph l pi pj">$ docker compose restart gateway</span><span id="a36e" class="ls lt iq pc b gy pk ph l pi pj">$ curl '<a class="ae kv" href="http://0.0.0.0:8000/auth/register'" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:</a><a class="ae kv" href="http://0.0.0.0:8000/users'" rel="noopener ugc nofollow" target="_blank">8080</a><a class="ae kv" href="http://0.0.0.0:8000/auth/register'" rel="noopener ugc nofollow" target="_blank">/auth/register'</a> \<br/>    --request POST \<br/>    --header "Content-type: application/json" \<br/>    --include \<br/>    --data '{<br/>      "emai": "<a class="ae kv" href="mailto:no@ebo.dy" rel="noopener ugc nofollow" target="_blank">no@ebo.dy</a>",<br/>      "password": "pass"<br/>    }'</span><span id="5a0a" class="ls lt iq pc b gy pk ph l pi pj">HTTP/1.1 400 Bad Request</span></pre><p id="dd61" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ›´æ­£æ‚¨çš„æœ‰æ•ˆè´Ÿè½½å¹¶éªŒè¯è¯·æ±‚æ˜¯å¦æˆåŠŸ:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="415a" class="ls lt iq pc b gy pg ph l pi pj">$ curl '<a class="ae kv" href="http://0.0.0.0:8000/auth/register'" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:</a><a class="ae kv" href="http://0.0.0.0:8000/users'" rel="noopener ugc nofollow" target="_blank">8080</a><a class="ae kv" href="http://0.0.0.0:8000/auth/register'" rel="noopener ugc nofollow" target="_blank">/auth/register'</a> \<br/>    --request POST \<br/>    --header "Content-type: application/json" \<br/>    --include \<br/>    --data '{<br/>      "email": "<a class="ae kv" href="mailto:no@ebo.dy" rel="noopener ugc nofollow" target="_blank">no@ebo.dy</a>2",<br/>      "password": "pass"<br/>    }'</span><span id="494c" class="ls lt iq pc b gy pk ph l pi pj">HTTP/1.1 201 Created</span><span id="3188" class="ls lt iq pc b gy pk ph l pi pj">{<br/>  "token":"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCIsImtpZCI6InVzZXJ...",<br/>  "expiry":1625254416<br/>}</span></pre><h2 id="d8ea" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">é™é€Ÿ</h2><p id="9a23" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">æœ€åï¼Œæˆ‘ä»¬å°†å…³æ³¨äº¤é€šç®¡ç†ã€‚ä¸ºäº†ä¿æŠ¤æˆ‘ä»¬çš„æœåŠ¡ä¸è¢«è¿‡åº¦ä½¿ç”¨â€”â€”æ— è®ºæ˜¯æœ‰æ„è¿˜æ˜¯æ— æ„ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹å…³é”®è·¯å¾„æˆ–æœªå±è”½è·¯å¾„è¿›è¡Œé€Ÿç‡é™åˆ¶ï¼Œå¹¶ä¸ºæˆ‘ä»¬çš„å®¢æˆ·å»ºç«‹ä½¿ç”¨é…é¢ã€‚</p><p id="49e2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">é¦–å…ˆï¼Œç”¨100ä¸ªè¯·æ±‚è½°ç‚¸æˆ‘ä»¬çš„<code class="fe pr ps pt pc b">/register</code>ç«¯ç‚¹ï¼Œçœ‹çœ‹ä¼šå‘ç”Ÿä»€ä¹ˆ:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="046e" class="ls lt iq pc b gy pg ph l pi pj">for i in {1..100}; do curl '<a class="ae kv" href="http://0.0.0.0:8000/auth/login'" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:</a><a class="ae kv" href="http://0.0.0.0:8000/users'" rel="noopener ugc nofollow" target="_blank">8080</a><a class="ae kv" href="http://0.0.0.0:8000/auth/login'" rel="noopener ugc nofollow" target="_blank">/auth/register'</a> \<br/>  --request POST \<br/>  --header "Content-type: application/json" \<br/>  --include \<br/>  --data '{<br/>    "email": "d<a class="ae kv" href="mailto:somebody@nobody.com" rel="noopener ugc nofollow" target="_blank">@d.</a>os",<br/>    "password": "pass"<br/>  }';<br/>done</span><span id="dbc8" class="ls lt iq pc b gy pk ph l pi pj">HTTP/1.1 201 Created<br/>HTTP/1.1 409 Conflict<br/>HTTP/1.1 409 Conflict<br/>...<br/>HTTP/1.1 409 Conflict # 100</span></pre><p id="6236" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ¯ä¸ªè¯·æ±‚éƒ½ç”±èº«ä»½æœåŠ¡å¤„ç†ï¼Œå¯¼è‡´è¿‡å¤šçš„å¤„ç†å’Œæ•°æ®åº“é€šä¿¡ã€‚</p><p id="bec3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç°åœ¨ä¸º<code class="fe pr ps pt pc b">/register</code>ç«¯ç‚¹æ·»åŠ æ¯ç§’5ä¸ªè¯·æ±‚çš„é™åˆ¶(æ¯ä¸ªIPåœ°å€)å’Œæ¯ç§’100ä¸ªè¯·æ±‚çš„ä¸Šé™:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="9f57" class="ls lt iq pc b gy pg ph l pi pj">krakend.yaml<br/>---<br/>...<br/>- endpoint: /auth/register<br/>    ...<br/>    github.com/devopsfaith/krakend-jsonschema:<br/>    ...<br/>    github.com/devopsfaith/krakend-ratelimit/juju/router:<br/>      maxRate: 100<br/>      clientMaxRate: 5<br/>      strategy: ip<br/>    ...<br/>...</span></pre><p id="cefd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ³¨æ„ç½‘å…³æ˜¯å¦‚ä½•çŸ­è·¯æ‰€æœ‰è¶…è¿‡æˆ‘ä»¬é…é¢çš„è¯·æ±‚çš„:</p><pre class="kg kh ki kj gt pb pc pd pe aw pf bi"><span id="5e66" class="ls lt iq pc b gy pg ph l pi pj">$ docker compose restart gateway</span><span id="f8cd" class="ls lt iq pc b gy pk ph l pi pj">for i in {1..100}; do curl '<a class="ae kv" href="http://0.0.0.0:8000/auth/login'" rel="noopener ugc nofollow" target="_blank">http://0.0.0.0:</a><a class="ae kv" href="http://0.0.0.0:8000/users'" rel="noopener ugc nofollow" target="_blank">8080</a><a class="ae kv" href="http://0.0.0.0:8000/auth/login'" rel="noopener ugc nofollow" target="_blank">/auth/register'</a> \<br/>  --request POST \<br/>  --header "Content-type: application/json" \<br/>  --include \<br/>  --data '{<br/>    "email": "d<a class="ae kv" href="mailto:somebody@nobody.com" rel="noopener ugc nofollow" target="_blank">@d.</a>os",<br/>    "password": "pass"<br/>  }';<br/>done</span><span id="1038" class="ls lt iq pc b gy pk ph l pi pj">HTTP/1.1 201 Created<br/>HTTP/1.1 409 Conflict<br/>...<br/>HTTP/1.1 429 Too Many Requests<br/>...<br/>HTTP/1.1 429 Too Many Requests</span></pre><h2 id="14ef" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">çŸ¥é“ä»€ä¹ˆæ—¶å€™åœä¸‹æ¥</h2><p id="4603" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">éšç€APIå¸‚åœºä¸­çš„ä¾›åº”å•†ä¸æ–­æ·»åŠ ç‰¹æ€§æ¥åŒºåˆ†ä»–ä»¬çš„äº§å“ï¼ŒçŸ¥é“ä½•æ—¶åœæ­¢å°†è´£ä»»æ¨å¸åˆ°è¾¹ç¼˜å¾ˆé‡è¦ã€‚è‡ƒè‚¿å’Œè¿‡äºé›„å¿ƒå‹ƒå‹ƒçš„ç½‘å…³å¾ˆéš¾æµ‹è¯•å’Œéƒ¨ç½²ã€‚</p><p id="7695" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">é™¤äº†è´£ä»»è¿‡å¤šä¹‹å¤–ï¼Œå…¶ä»–å¯èƒ½çš„é¡¾è™‘åŒ…æ‹¬:</p><ul class=""><li id="b17a" class="mq mr iq ky b kz la lc ld lf ms lj mt ln mu lr mv mw mx my bi translated"><strong class="ky ir">å•ç‚¹æ•…éšœã€‚</strong>ä½œä¸ºåç«¯å±‚çš„å•ä¸€å…¥å£ç‚¹ï¼Œæˆ‘ä»¬å¿…é¡»ç¡®ä¿ç½‘å…³å…·æœ‰å¼¹æ€§ã€‚é€šè¿‡<a class="ae kv" href="https://en.wikipedia.org/wiki/Redundancy_(engineering)" rel="noopener ugc nofollow" target="_blank">å†—ä½™</a>ã€<a class="ae kv" href="https://en.wikipedia.org/wiki/Elasticity_(cloud_computing)" rel="noopener ugc nofollow" target="_blank">å¼¹æ€§</a>å’Œ<a class="ae kv" href="https://en.wikipedia.org/wiki/Recovery-oriented_computing" rel="noopener ugc nofollow" target="_blank">æ•…éšœæ¢å¤æœºåˆ¶</a>é¿å…å•ç‚¹æ•…éšœã€‚</li><li id="a928" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><strong class="ky ir">éœ€è¦ç»´æŠ¤çš„é¢å¤–æœåŠ¡ã€‚ç»´æŠ¤ç½‘å…³çš„å·¥ä½œä¼šæ‹›è‡´æŠ€æœ¯å€ºåŠ¡å—ï¼Ÿè¿™å¯¹å¼€å‘å›¢é˜Ÿçš„èŒè´£æ„å‘³ç€ä»€ä¹ˆï¼Ÿ</strong></li><li id="cd80" class="mq mr iq ky b kz na lc nb lf nc lj nd ln ne lr mv mw mx my bi translated"><strong class="ky ir">ä¸€ä¸ªé¢å¤–çš„ç½‘ç»œè·³ã€‚</strong>ç”±äºåˆ°åç«¯çš„é¢å¤–ç½‘ç»œè·³è·ƒï¼Œç½‘å…³å¯èƒ½ä¼šå¢åŠ å“åº”æ—¶é—´ã€‚è™½ç„¶è¿™æ¯”ç›´æ¥çš„å®¢æˆ·ç«¯åˆ°åç«¯çš„è¯·æ±‚å½±å“è¦å°ï¼Œä½†æ˜¯æŒç»­åœ°å¯¹ç³»ç»Ÿè¿›è¡Œè´Ÿè½½æµ‹è¯•ä»ç„¶æ˜¯è‡³å…³é‡è¦çš„ï¼Œè¿™å¯ä»¥ç¡®ä¿æˆ‘ä»¬æ»¡æ€€ä¿¡å¿ƒåœ°æ»¡è¶³æˆ‘ä»¬çš„SLOã€‚</li></ul><h2 id="2a64" class="ls lt iq bd lu lv lw dn lx ly lz dp ma lf mb mc md lj me mf mg ln mh mi mj mk bi translated">æœ€ç»ˆçš„å…‹æ‹‰è‚¯æ¸…å•</h2><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="nf ng l"/></div></figure></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><h1 id="d2f6" class="no lt iq bd lu np nq nr lx ns nt nu ma jw nv jx md jz nw ka mg kc nx kd mj ny bi translated">åŒ…æ‰</h1><p id="e350" class="pw-post-body-paragraph kw kx iq ky b kz ml jr lb lc mm ju le lf mn lh li lj mo ll lm ln mp lp lq lr ij bi translated">APIç½‘å…³ä¸ºå®¢æˆ·ç«¯æä¾›äº†ä¸€ä¸ªå¯é çš„æ¥å£ï¼Œä¹Ÿæ˜¯ç®¡ç†è¯·æ±‚å’Œå“åº”çš„ä¸­å¿ƒç‚¹ã€‚</p><p id="9c6a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨åˆ†å¸ƒå¼æ¶æ„ä¸­ï¼Œå®ƒä»¬å¯ä»¥ç”¨æ¥å¸è½½é‚£äº›åŸæœ¬å¿…é¡»å¤åˆ¶çš„æ¨ªåˆ‡åŠŸèƒ½ã€‚APIç½‘å…³æœ‰å¾ˆå¤šä¼˜ç‚¹ï¼Œä½†æ˜¯å®ƒä¹Ÿå¢åŠ äº†å¦ä¸€ä¸ªç»„ä»¶æ¥ç»´æŠ¤å’Œä¼˜åŒ–æ€§èƒ½å’Œå¯é æ€§ã€‚</p><p id="bc3b" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ„Ÿè°¢é˜…è¯»ã€‚</p></div><div class="ab cl nh ni hu nj" role="separator"><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm nn"/><span class="nk bw bk nl nm"/></div><div class="ij ik il im in"><p id="04e3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="mz">æœ¬æ–‡æœ€åˆå‘å¸ƒäº:</em><a class="ae kv" href="https://portfolio.fabijanbajo.com/api-gateways" rel="noopener ugc nofollow" target="_blank">https://portfo lio.fabijanbajo.com/api-gateways</a></p></div></div>    
</body>
</html>