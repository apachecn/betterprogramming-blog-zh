<html>
<head>
<title>Convert a PWA Into a Flutter App Using WebViews</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨WebViewså°†PWAè½¬æ¢ä¸ºFlutteråº”ç”¨ç¨‹åº</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/convert-a-pwa-into-a-flutter-app-using-webviews-387060548a37?source=collection_archive---------2-----------------------#2022-12-06">https://betterprogramming.pub/convert-a-pwa-into-a-flutter-app-using-webviews-387060548a37?source=collection_archive---------2-----------------------#2022-12-06</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="0c3e" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">äº†è§£å¦‚ä½•ä½¿ç”¨Flutterçš„InAppWebView 6æ’ä»¶å°†PWAè½¬æ¢ä¸ºFlutteråº”ç”¨ç¨‹åº</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/a2f6e94b23b647cbc9d059dbbf393ccc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*R2yKmdvL8E2l8u2i"/></div></div><p class="kr ks gj gh gi kt ku bd b be z dk translated"><a class="ae kv" href="https://unsplash.com/@olafval?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank">å¥¥æ‹‰å¤«ç“¦å°”</a>åœ¨<a class="ae kv" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šçš„ç…§ç‰‡</p></figure><p id="3ee5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æœ€æ–°ç‰ˆæœ¬6çš„<code class="fe ls lt lu lv b"><a class="ae kv" href="https://github.com/pichillilorenzo/flutter_inappwebview" rel="noopener ugc nofollow" target="_blank">flutter_inappwebview</a></code>æ’ä»¶ï¼Œå°†ä¸€ä¸ª<a class="ae kv" href="https://web.dev/progressive-web-apps/" rel="noopener ugc nofollow" target="_blank"> PWA (Progressive Web App) </a>è½¬æ¢ä¸ºä¸€ä¸ªé€‚ç”¨äºAndroidå’ŒiOSçš„Flutterç§»åŠ¨åº”ç”¨ã€‚</p><h1 id="86c3" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">ä»€ä¹ˆæ˜¯æ¸è¿›å¼ç½‘ç»œåº”ç”¨ï¼Ÿ</h1><p id="7772" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">æ¸è¿›å¼webåº”ç”¨ç¨‹åºæ˜¯ä¸€ä¸ªæœ¯è¯­ï¼ŒæŒ‡çš„æ˜¯åƒå¸¸è§„ç½‘é¡µä¸€æ ·å¼€å‘å’ŒåŠ è½½çš„Webåº”ç”¨ç¨‹åºï¼Œä½†å½“åœ¨ç§»åŠ¨è®¾å¤‡ä¸Šä½¿ç”¨æ—¶ï¼Œå…¶è¡Œä¸ºç±»ä¼¼äºæœ¬æœºåº”ç”¨ç¨‹åºã€‚</p><p id="2536" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å®ƒä»¬æ˜¯ç”¨ç°ä»£APIæ„å»ºå’Œå¢å¼ºçš„ï¼Œä»¥æä¾›å¢å¼ºçš„åŠŸèƒ½ã€å¯é æ€§å’Œå¯å®‰è£…æ€§ï¼ŒåŒæ—¶ç”¨å•ä¸ªä»£ç åº“åœ¨ä»»ä½•åœ°æ–¹ã€ä»»ä½•è®¾å¤‡ä¸Šè®¿é—®ä»»ä½•äººã€‚æ¸è¿›å¼webåº”ç”¨ç¨‹åºåˆ©ç”¨æ–°Webçš„è¿™ç§æ´»åŠ›ä»¥åŠæœåŠ¡å·¥ä½œè€…å’Œmanifestç­‰æŠ€æœ¯æ¥æä¾›ç±»ä¼¼æœ¬æœºåº”ç”¨ç¨‹åºçš„ç”¨æˆ·ä½“éªŒï¼Œå³ä½¿ç”¨æˆ·ç¦»çº¿ä¹Ÿèƒ½å·¥ä½œã€‚</p><p id="c6fc" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¼€å‘äººå‘˜å¯ä»¥åœ¨çº¿å‘å¸ƒwebåº”ç”¨ç¨‹åºï¼Œç¡®ä¿å®ƒæ»¡è¶³åŸºçº¿å®‰è£…è¦æ±‚ï¼Œå¹¶ä¸”ç”¨æˆ·å¯ä»¥å°†åº”ç”¨ç¨‹åºæ·»åŠ åˆ°ä»–ä»¬çš„ä¸»å±å¹•ä¸Šã€‚å°†åº”ç”¨ç¨‹åºå‘å¸ƒåˆ°è‹¹æœåº”ç”¨å•†åº—æˆ–Google Playç­‰æ•°å­—åˆ†å‘ç³»ç»Ÿæ˜¯å¯é€‰çš„ã€‚</p><h1 id="426b" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">ä»€ä¹ˆæ˜¯æ··åˆåº”ç”¨ï¼Ÿ</h1><p id="1d63" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">æ··åˆåº”ç”¨ç¨‹åºæ˜¯ç»“åˆäº†æœ¬åœ°åº”ç”¨ç¨‹åºå’Œwebåº”ç”¨ç¨‹åºåŠŸèƒ½çš„åº”ç”¨ç¨‹åºã€‚å®ƒä»¬åœ¨ä¸€ä¸ªå®¹å™¨ä¸­è¿è¡Œï¼Œåœ¨è¿™é‡Œæ˜¯ä¸€ä¸ª<code class="fe ls lt lu lv b">WebView</code>ã€‚</p><p id="3812" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å®ƒä»¬å¯ä»¥é€šè¿‡åº”ç”¨å•†åº—è·å¾—ï¼Œå¯ä»¥è®¿é—®æœ¬æœºAPIå’Œæ‰‹æœºçš„ç¡¬ä»¶ç»„ä»¶ï¼Œå¹¶å®‰è£…åœ¨æ‚¨çš„è®¾å¤‡ä¸Šï¼Œå°±åƒæœ¬æœºåº”ç”¨ç¨‹åºä¸€æ ·ã€‚</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><p id="3b94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æˆ‘ä¸ä¼šè§£é‡Špwaã€æœ¬æœºåº”ç”¨ç¨‹åºå’Œæ··åˆåº”ç”¨ç¨‹åºä¹‹é—´çš„ä¼˜ç¼ºç‚¹ï¼Œå› ä¸ºè¿™è¶…å‡ºäº†æœ¬æ–‡çš„èŒƒå›´ã€‚ä½ å·²ç»å¯ä»¥åœ¨ç½‘ä¸Šæœç´¢äº†ã€‚</p></div><div class="ab cl mt mu hu mv" role="separator"><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my mz"/><span class="mw bw bk mx my"/></div><div class="ij ik il im in"><h1 id="296a" class="lw lx iq bd ly lz na mb mc md nb mf mg jw nc jx mi jz nd ka mk kc ne kd mm mn bi translated">å¦‚ä½•å°†PWAè½¬æ¢ä¸ºFlutter App</h1><p id="315d" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">ä½œä¸ºä¸€ä¸ªpwaçš„ä¾‹å­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a class="ae kv" href="https://mdn.github.io/pwa-examples/js13kpwa/" rel="noopener ugc nofollow" target="_blank">https://mdn.github.io/pwa-examples/js13kpwa/</a>(GitHub repo:<a class="ae kv" href="https://github.com/mdn/pwa-examples/blob/master/js13kpwa" rel="noopener ugc nofollow" target="_blank">js13k PWA</a>)ï¼Œè¿™æ˜¯ä¸€ä¸ªå…¨åŠŸèƒ½çš„PWAï¼Œæ”¯æŒç¦»çº¿ã€‚</p><p id="4c48" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><a class="ae kv" href="https://github.com/mdn/pwa-examples/blob/master/js13kpwa" rel="noopener ugc nofollow" target="_blank"> js13kpwa </a>æ˜¯æäº¤ç»™js13kGames 2017ç«èµ›çš„Aå¸§å‚èµ›ä½œå“åˆ—è¡¨ï¼Œç”¨ä½œå…³äºæ¸è¿›å¼Webåº”ç”¨çš„MDNæ–‡ç« çš„ç¤ºä¾‹ã€‚js13kPWAå…·æœ‰åº”ç”¨ç¨‹åºå¤–å£³ç»“æ„ï¼Œä¸æœåŠ¡äººå‘˜ç¦»çº¿å·¥ä½œï¼Œç”±äºæ¸…å•æ–‡ä»¶å’Œæ·»åŠ åˆ°ä¸»å±å¹•åŠŸèƒ½è€Œå¯å®‰è£…ï¼Œå¹¶å¯é€šè¿‡ä½¿ç”¨é€šçŸ¥å’Œæ¨é€æ¥é‡æ–°å‚ä¸ã€‚</p><p id="6a54" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ­¤å¤–ï¼Œå¯¹äºè¿™ä¸ªç”¨ä¾‹ï¼Œæˆ‘ä»¬å°†åœ¨JavaScriptå’ŒFlutter/Dartä¹‹é—´æ·»åŠ ä¸€ä¸ªç®€å•çš„åŒå‘é€šä¿¡ã€‚</p><h2 id="bc25" class="nf lx iq bd ly ng nh dn mc ni nj dp mg lf nk nl mi lj nm nn mk ln no np mm nq bi translated">æœåŠ¡äººå‘˜</h2><p id="c02c" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">æœåŠ¡äººå‘˜æ˜¯PWAçš„åŸºæœ¬ç»„æˆéƒ¨åˆ†ã€‚å®ƒä»¬æ”¯æŒå¿«é€ŸåŠ è½½(ä¸è€ƒè™‘ç½‘ç»œ)ã€ç¦»çº¿è®¿é—®ã€æ¨é€é€šçŸ¥å’Œå…¶ä»–åŠŸèƒ½ã€‚</p><p id="2b94" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ£€æŸ¥<a class="ae kv" href="https://caniuse.com/serviceworkers" rel="noopener ugc nofollow" target="_blank">https://caniuse.com/serviceworkers</a>åŸºäºWebView/æµè§ˆå™¨ç‰ˆæœ¬çš„JavaScript Service Worker APIå¯ç”¨æ€§ã€‚</p><p id="4294" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä»â€œAndroid 5â€“6 . x WebView:Chromium 107â€å¼€å§‹åœ¨Androidä¸Šæä¾›æœåŠ¡äººå‘˜ï¼Œä»iOS 14.0+å¼€å§‹åœ¨iOSä¸Šæä¾›æœåŠ¡äººå‘˜ã€‚</p><p id="f347" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨iOSä¸Šï¼Œå¯ç”¨æœåŠ¡å·¥ä½œè€…APIéœ€è¦ä½¿ç”¨åº”ç”¨ç¨‹åºç»‘å®šçš„åŸŸè¿›è¡Œé¢å¤–è®¾ç½®(é˜…è¯»<a class="ae kv" href="https://webkit.org/blog/10882/app-bound-domains/" rel="noopener ugc nofollow" target="_blank"> WebKit â€”åº”ç”¨ç¨‹åºç»‘å®šçš„åŸŸ</a>æ–‡ç« äº†è§£æ›´å¤šè¯¦ç»†ä¿¡æ¯)ã€‚</p><p id="5cd9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åº”ç”¨ç¨‹åºç»‘å®šçš„åŸŸåŠŸèƒ½é€šè¿‡é™åˆ¶åº”ç”¨ç¨‹åºå¯ä»¥åˆ©ç”¨å¼ºå¤§çš„APIåœ¨åº”ç”¨ç¨‹åºå†…æµè§ˆæœŸé—´è·Ÿè¸ªç”¨æˆ·çš„åŸŸæ¥ä¿æŠ¤ç”¨æˆ·éšç§ã€‚</p><p id="ef96" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ‚¨å¯ä»¥ä½¿ç”¨<code class="fe ls lt lu lv b">Info.plist</code>é”®<code class="fe ls lt lu lv b">WKAppBoundDomains</code>æŒ‡å®šå¤šè¾¾åä¸ªâ€œåº”ç”¨ç»‘å®šâ€åŸŸã€‚</p><p id="6a89" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦å°†PWAçš„åŸŸæ·»åŠ åˆ°å…¶ä¸­ã€‚å¦åˆ™ï¼ŒæœåŠ¡å·¥ä½œå™¨APIå°†æ— æ³•å·¥ä½œã€‚å¯¹äºæˆ‘ä»¬çš„ç”¨ä¾‹ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ <code class="fe ls lt lu lv b">mdn.github.io</code>åŸŸã€‚ä¸‹é¢æ˜¯ä¸€ä¸ª<code class="fe ls lt lu lv b">ios/Runner/Info.plist</code>æ–‡ä»¶çš„ä¾‹å­:</p><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="e810" class="nv lx iq lv b be nw nx l ny nz">&lt;dict&gt;<br/>  &lt;!-- ... --&gt;<br/>  &lt;key&gt;WKAppBoundDomains&lt;/key&gt;<br/>  &lt;array&gt;<br/>    &lt;string&gt;mdn.github.io&lt;/string&gt;<br/>  &lt;/array&gt;<br/>  &lt;!-- ... --&gt;<br/>&lt;/dict&gt;</span></pre><h2 id="c61a" class="nf lx iq bd ly ng nh dn mc ni nj dp mg lf nk nl mi lj nm nn mk ln no np mm nq bi translated">äº’è”ç½‘ç½‘ç»œæ£€æµ‹</h2><p id="5f20" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">æ£€æµ‹ç”¨æˆ·çš„æ‰‹æœºæ˜¯å¦è¿æ¥åˆ°äº’è”ç½‘å¯¹äº<code class="fe ls lt lu lv b">WebView</code>ä»ç¼“å­˜ä¸­åŠ è½½PWAè€Œä¸æ˜¯åœ¨çº¿è¯·æ±‚èµ„æºæ˜¯å¾ˆé‡è¦çš„ã€‚</p><p id="32f6" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸ºäº†æ£€æŸ¥æ˜¯å¦æœ‰æœ‰æ•ˆçš„è¿æ¥ï¼Œå³èœ‚çªç½‘ç»œæˆ–Wi-Fiï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<code class="fe ls lt lu lv b"><a class="ae kv" href="https://pub.dev/packages/connectivity_plus" rel="noopener ugc nofollow" target="_blank">connectivity_plus</a></code>æ’ä»¶ã€‚ç›¸åï¼Œä¸ºäº†æµ‹è¯•ç½‘ç»œæ˜¯å¦è¿æ¥åˆ°äº’è”ç½‘ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•æŸ¥æ‰¾ä¸»æœºçš„åœ°å€ï¼Œä¾‹å¦‚<a class="ae kv" href="https://example.com/" rel="noopener ugc nofollow" target="_blank">https://example.com/</a>ã€‚</p><p id="4152" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸‹é¢æ˜¯å®Œæ•´çš„ä»£ç æ£€æµ‹:</p><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="2670" class="nv lx iq lv b be nw nx l ny nz">Future&lt;bool&gt; isNetworkAvailable() async {<br/>  // check if there is a valid network connection<br/>  final connectivityResult = await Connectivity().checkConnectivity();<br/>  if (connectivityResult != ConnectivityResult.mobile &amp;&amp;<br/>      connectivityResult != ConnectivityResult.wifi) {<br/>    return false;<br/>  }<br/><br/>  // check if the network is really connected to Internet<br/>  try {<br/>    final result = await InternetAddress.lookup('example.com');<br/>    if (result.isEmpty || result[0].rawAddress.isEmpty) {<br/>      return false;<br/>    }<br/>  } on SocketException catch (_) {<br/>    return false;<br/>  }<br/><br/>  return true;<br/>}</span></pre><h2 id="fae1" class="nf lx iq bd ly ng nh dn mc ni nj dp mg lf nk nl mi lj nm nn mk ln no np mm nq bi translated">InAppWebViewåŸºæœ¬è®¾ç½®</h2><p id="4b82" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">ä¸ºäº†ä½¿<code class="fe ls lt lu lv b">InAppWebView</code>æ­£å¸¸å·¥ä½œï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€äº›åŸºæœ¬è®¾ç½®:</p><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="3011" class="nv lx iq lv b be nw nx l ny nz">InAppWebViewSettings(<br/>    // enable opening windows support<br/>    supportMultipleWindows: true,<br/>    javaScriptCanOpenWindowsAutomatically: true,<br/><br/>    // useful for identifying traffic, e.g. in Google Analytics.<br/>    applicationNameForUserAgent: 'My PWA App Name',<br/>    // Override the User Agent, otherwise some external APIs, such as Google and Facebook logins, will not work<br/>    // because they recognize the default WebView User Agent.<br/>    userAgent:<br/>        'Mozilla/5.0 (Linux; Android 13) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/107.0.5304.105 Mobile Safari/537.36',<br/><br/>    disableDefaultErrorPage: true,<br/><br/>    // enable iOS service worker feature limited to defined App Bound Domains<br/>    limitsNavigationsToAppBoundDomains: true<br/>);</span></pre><p id="f47f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ ¹æ®ä½ çš„éœ€è¦æ”¹å˜å®ƒã€‚</p><p id="4576" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨æœ¬ä¾‹ä¸­ï¼Œæˆ‘ä»¬å¯ç”¨äº†å¯¹å¤šä¸ªçª—å£çš„æ”¯æŒï¼Œä»¥é˜²æˆ‘ä»¬æƒ³è¦æ‰“å¼€å¼¹å‡º<code class="fe ls lt lu lv b">WebView</code>çª—å£ã€‚</p><p id="0afb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½è¿˜éœ€è¦å°†ç”¨æˆ·ä»£ç†è¦†ç›–ä¸ºä¸åŒäºé»˜è®¤å€¼çš„å€¼ï¼Œä»¥ä¾¿èƒ½å¤Ÿä½¿ç”¨ä¸€äº›å¤–éƒ¨APIï¼Œä¾‹å¦‚Googleå’Œè„¸ä¹¦ç™»å½•ã€‚å¦åˆ™ï¼Œå®ƒä»¬å°†æ— æ³•å·¥ä½œï¼Œå› ä¸ºå®ƒä»¬è¯†åˆ«å¹¶é˜»æ­¢é»˜è®¤çš„<code class="fe ls lt lu lv b">WebView</code>ç”¨æˆ·ä»£ç†ã€‚</p><p id="95bb" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ­¤å¤–ï¼Œæ‚¨å¿…é¡»å°†<code class="fe ls lt lu lv b">limitsNavigationsToAppBoundDomains</code>è®¾ç½®è®¾ç½®ä¸º<code class="fe ls lt lu lv b">true</code>åœ¨iOSä¸Šå¯ç”¨æœåŠ¡å·¥ä½œè€…APIã€‚</p><h2 id="1521" class="nf lx iq bd ly ng nh dn mc ni nj dp mg lf nk nl mi lj nm nn mk ln no np mm nq bi translated">HTTP(éHTTPS)æ”¯æŒ</h2><p id="9d64" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">ä»Android 9 (APIçº§åˆ«28)å¼€å§‹ï¼Œé»˜è®¤æƒ…å†µä¸‹ç¦ç”¨æ˜æ–‡æ”¯æŒ:</p><ul class=""><li id="cb22" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated">æŸ¥çœ‹å®˜æ–¹<a class="ae kv" href="https://developer.android.com/training/articles/security-config#CleartextTrafficPermitted" rel="noopener ugc nofollow" target="_blank">ç½‘ç»œå®‰å…¨é…ç½®â€”â€œé€‰æ‹©é€€å‡ºæ˜æ–‡æµé‡â€</a>éƒ¨åˆ†ã€‚</li><li id="7384" class="oa ob iq ky b kz oj lc ok lf ol lj om ln on lr of og oh oi bi translated">å¦å¤–ï¼Œè¯·æ£€æŸ¥æ­¤StackOverflowé—®é¢˜ç­”æ¡ˆ:<a class="ae kv" href="https://stackoverflow.com/a/50834600/4637638" rel="noopener ugc nofollow" target="_blank">æ˜æ–‡HTTPæµé‡æ˜¯ä¸å…è®¸çš„</a>ã€‚</li></ul><p id="894d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">åœ¨iOSä¸Šï¼Œä½ éœ€è¦ç¦ç”¨<a class="ae kv" href="https://developer.apple.com/documentation/security/preventing_insecure_network_connections" rel="noopener ugc nofollow" target="_blank">è‹¹æœè¿è¾“å®‰å…¨</a> (ATS)åŠŸèƒ½ã€‚æœ‰ä¸¤ç§é€‰æ‹©:</p><ul class=""><li id="54d1" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated">ä»…ç¦ç”¨ç‰¹å®šåŸŸçš„ATS(<a class="ae kv" href="https://developer.apple.com/documentation/bundleresources/information_property_list/nsapptransportsecurity/nsexceptiondomains" rel="noopener ugc nofollow" target="_blank">å®˜æ–¹ç»´åŸº</a>):(å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°æ‚¨çš„<code class="fe ls lt lu lv b">Info.plist</code>æ–‡ä»¶ä¸­)</li></ul><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="c820" class="nv lx iq lv b be nw nx l ny nz">&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;<br/>&lt;dict&gt;<br/>  &lt;key&gt;NSExceptionDomains&lt;/key&gt;<br/>  &lt;dict&gt;<br/>    &lt;key&gt;www.yourserver.com&lt;/key&gt;<br/>    &lt;dict&gt;<br/>      &lt;!-- add this key to enable subdomains such as sub.yourserver.com --&gt;<br/>      &lt;key&gt;NSIncludesSubdomains&lt;/key&gt;<br/>      &lt;true/&gt;<br/>      &lt;!-- add this key to allow standard HTTP requests, thus negating the ATS --&gt;<br/>      &lt;key&gt;NSTemporaryExceptionAllowsInsecureHTTPLoads&lt;/key&gt;<br/>      &lt;true/&gt;<br/>      &lt;!-- add this key to specify the minimum TLS version to accept --&gt;<br/>      &lt;key&gt;NSTemporaryExceptionMinimumTLSVersion&lt;/key&gt;<br/>      &lt;string&gt;TLSv1.1&lt;/string&gt;<br/>    &lt;/dict&gt;<br/>  &lt;/dict&gt;<br/>&lt;/dict&gt;</span></pre><ul class=""><li id="b8cc" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated">å½»åº•ç¦ç”¨ATS ( <a class="ae kv" href="https://developer.apple.com/documentation/bundleresources/information_property_list/nsapptransportsecurity/nsallowsarbitraryloads" rel="noopener ugc nofollow" target="_blank">å®˜æ–¹ç»´åŸº</a>)ã€‚å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°æ‚¨çš„<code class="fe ls lt lu lv b">Info.plist</code>æ–‡ä»¶ä¸­:</li></ul><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="841e" class="nv lx iq lv b be nw nx l ny nz">&lt;key&gt;NSAppTransportSecurity&lt;/key&gt;<br/>&lt;dict&gt;<br/>  &lt;key&gt;NSAllowsArbitraryLoads&lt;/key&gt;&lt;true/&gt;<br/>&lt;/dict&gt;</span></pre><p id="a881" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å…¶ä»–æœ‰ç”¨çš„<code class="fe ls lt lu lv b">Info.plist</code>å±æ€§æœ‰:</p><ul class=""><li id="64c4" class="oa ob iq ky b kz la lc ld lf oc lj od ln oe lr of og oh oi bi translated"><code class="fe ls lt lu lv b">NSAllowsLocalNetworking</code>:å¸ƒå°”å€¼ï¼Œè¡¨ç¤ºæ˜¯å¦å…è®¸åŠ è½½æœ¬åœ°èµ„æº(<a class="ae kv" href="https://developer.apple.com/documentation/bundleresources/information_property_list/nsapptransportsecurity/nsallowslocalnetworking" rel="noopener ugc nofollow" target="_blank">å®˜æ–¹wiki </a>)</li><li id="985f" class="oa ob iq ky b kz oj lc ok lf ol lj om ln on lr of og oh oi bi translated"><code class="fe ls lt lu lv b">NSAllowsArbitraryLoadsInWebContent</code>:ä¸€ä¸ªå¸ƒå°”å€¼ï¼ŒæŒ‡ç¤ºæ˜¯å¦å¯¹æ¥è‡ªwebè§†å›¾çš„è¯·æ±‚ç¦ç”¨æ‰€æœ‰åº”ç”¨ä¼ è¾“å®‰å…¨é™åˆ¶(<a class="ae kv" href="https://developer.apple.com/documentation/bundleresources/information_property_list/nsapptransportsecurity/nsallowsarbitraryloadsinwebcontent" rel="noopener ugc nofollow" target="_blank">å®˜æ–¹ç»´åŸº</a>)</li></ul><h1 id="4fa2" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">WidgetsBindingObserver</h1><p id="9c70" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">æ­¤å¤–ï¼Œæˆ‘ä»¬å°†ä¸ºAndroidä½¿ç”¨<code class="fe ls lt lu lv b">WidgetsBindingObserver</code>,è¿™æœ‰åŠ©äºäº†è§£ç³»ç»Ÿä½•æ—¶å°†åº”ç”¨ç¨‹åºç½®äºåå°æˆ–å°†åº”ç”¨ç¨‹åºè¿”å›å‰å°ã€‚</p><p id="7061" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æœ‰äº†å®ƒï¼Œæˆ‘ä»¬å¯ä»¥åœæ­¢å’Œæ¢å¤JavaScriptæ‰§è¡Œä»¥åŠä»»ä½•å¯ä»¥å®‰å…¨æš‚åœçš„å¤„ç†ï¼Œæ¯”å¦‚è§†é¢‘ã€éŸ³é¢‘å’ŒåŠ¨ç”»ã€‚</p><p id="9e60" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸‹é¢æ˜¯<code class="fe ls lt lu lv b">didChangeAppLifecycleState</code>çš„ä¸€ä¸ªç®€å•å®ç°:</p><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="7af7" class="nv lx iq lv b be nw nx l ny nz">@override<br/>void didChangeAppLifecycleState(AppLifecycleState state) {<br/>  if (!kIsWeb) {<br/>    if (webViewController != null &amp;&amp;<br/>        defaultTargetPlatform == TargetPlatform.android) {<br/>      if (state == AppLifecycleState.paused) {<br/>        pauseAll();<br/>      } else {<br/>        resumeAll();<br/>      }<br/>    }<br/>  }<br/>}<br/><br/>void pauseAll() {<br/>  if (defaultTargetPlatform == TargetPlatform.android) {<br/>    webViewController?.pause();<br/>  }<br/>  webViewController?.pauseTimers();<br/>}<br/><br/>void resumeAll() {<br/>  if (defaultTargetPlatform == TargetPlatform.android) {<br/>    webViewController?.resume();<br/>  }<br/>  webViewController?.resumeTimers();<br/>}</span></pre><h1 id="3fea" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">WillPopScope</h1><p id="6a65" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">ä¸ºäº†æ£€æµ‹Androidåé€€æŒ‰é’®çš„ç‚¹å‡»ï¼Œæˆ‘ä»¬å°†ä¸»è¦çš„<code class="fe ls lt lu lv b">Scaffold</code>çª—å£å°éƒ¨ä»¶åº”ç”¨ç¨‹åºåŒ…è£…åˆ°ä¸€ä¸ª<code class="fe ls lt lu lv b">WillPopScope</code>çª—å£å°éƒ¨ä»¶ä¸­ï¼Œå¹¶å®ç°<code class="fe ls lt lu lv b">onWillPop</code>æ–¹æ³•ä»¥è¿”å›åˆ°<code class="fe ls lt lu lv b">WebView</code>çš„å†å²ä¸­ã€‚</p><p id="bfd3" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸‹é¢æ˜¯ä¸€ä¸ªå®ç°ç¤ºä¾‹:</p><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="d431" class="nv lx iq lv b be nw nx l ny nz">@override<br/>Widget build(BuildContext context) {<br/>  return WillPopScope(<br/>    onWillPop: () async {<br/>      // detect Android back button click<br/>      final controller = webViewController;<br/>      if (controller != null) {<br/>        if (await controller.canGoBack()) {<br/>          controller.goBack();<br/>          return false;<br/>        }<br/>      }<br/>      return true;<br/>    },<br/>    child: Scaffold(<br/>        appBar: AppBar(<br/>          // remove the toolbar<br/>          toolbarHeight: 0,<br/>        ),<br/>        body: // ...<br/>    ),<br/>  );<br/>}</span></pre><h1 id="cad3" class="lw lx iq bd ly lz ma mb mc md me mf mg jw mh jx mi jz mj ka mk kc ml kd mm mn bi translated">WebView PWAåŒ…è£…</h1><p id="a509" class="pw-post-body-paragraph kw kx iq ky b kz mo jr lb lc mp ju le lf mq lh li lj mr ll lm ln ms lp lq lr ij bi translated">åœ¨å°†PWA URLåŠ è½½åˆ°<code class="fe ls lt lu lv b">InAppWebView</code>åŒ…è£…å™¨ä¹‹å‰ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¹‹å‰å®šä¹‰çš„å®ç”¨ç¨‹åºæ£€æŸ¥äº’è”ç½‘è¿æ¥æ˜¯å¦å¯ç”¨ï¼Œå¹¶ä¸”ï¼ŒåŸºäºæ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¸ºAndroidå’ŒiOSè®¾ç½®ç¼“å­˜æ¨¡å¼å’Œç­–ç•¥ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="8efe" class="nv lx iq lv b be nw nx l ny nz">// Android-only<br/>final cacheMode = networkAvailable<br/>    ? CacheMode.LOAD_DEFAULT<br/>    : CacheMode.LOAD_CACHE_ELSE_NETWORK;<br/><br/>// iOS-only<br/>final cachePolicy = networkAvailable<br/>    ? URLRequestCachePolicy.USE_PROTOCOL_CACHE_POLICY<br/>    : URLRequestCachePolicy.RETURN_CACHE_DATA_ELSE_LOAD;</span></pre><p id="fa0c" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">cacheMode</code>å°†åœ¨<code class="fe ls lt lu lv b">initialSettings</code>å±æ€§ä¸­ä½¿ç”¨ï¼Œ<code class="fe ls lt lu lv b">cachePolicy</code>å°†åœ¨<code class="fe ls lt lu lv b">initialUrlRequest</code>å±æ€§çš„<code class="fe ls lt lu lv b">URLRequest</code>ä¸­ä½¿ç”¨ã€‚</p><p id="bc17" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¦‚æœäº’è”ç½‘è¿æ¥ä¸å¯ç”¨ï¼Œè¿™ä¸ªé€»è¾‘å…è®¸æˆ‘ä»¬åŠ è½½ç¼“å­˜çš„æ•°æ®ã€‚</p><p id="4a85" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸ºäº†å°†å¯¼èˆªä»…é™äºPWAä¸»æœºï¼Œæˆ‘ä»¬å®ç°äº†<code class="fe ls lt lu lv b">shouldOverrideUrlLoading</code>æ–¹æ³•æ¥æ£€æŸ¥ä¸»æ¡†æ¶çš„ç‰¹å®šHTTPè¯·æ±‚æ˜¯å¦ä¸PWAä¸»æœºä¸åŒ¹é…ï¼Œå› æ­¤æˆ‘ä»¬å°†ä½¿ç”¨<code class="fe ls lt lu lv b"><a class="ae kv" href="https://pub.dev/packages/url_launcher" rel="noopener ugc nofollow" target="_blank">url_launcher</a></code>æ’ä»¶åœ¨ç¬¬ä¸‰æ–¹åº”ç”¨ç¨‹åºä¸­æ‰“å¼€è¯¥è¯·æ±‚:</p><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="bda5" class="nv lx iq lv b be nw nx l ny nz">shouldOverrideUrlLoading:<br/>    (controller, navigationAction) async {<br/>  // restrict navigation to target host, open external links in 3rd party apps<br/>  final uri = navigationAction.request.url;<br/>  if (uri != null &amp;&amp;<br/>      navigationAction.isForMainFrame &amp;&amp;<br/>      uri.host != kPwaHost &amp;&amp;<br/>      await canLaunchUrl(uri)) {<br/>    launchUrl(uri);<br/>    return NavigationActionPolicy.CANCEL;<br/>  }<br/>  return NavigationActionPolicy.ALLOW;<br/>},</span></pre><p id="f4f5" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸ºäº†æ£€æµ‹PWAç¬¬ä¸€æ¬¡å®‰è£…æ˜¯å¦æ­£ç¡®ï¼Œæˆ‘ä»¬å®æ–½äº†<code class="fe ls lt lu lv b">onLoadStop</code> <code class="fe ls lt lu lv b">WebView</code>æ–¹æ³•æ¥æ£€æŸ¥äº’è”ç½‘è¿æ¥çš„å¯ç”¨æ€§ä»¥åŠPWAæ˜¯å¦å·²ç»å®‰è£…:</p><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="1962" class="nv lx iq lv b be nw nx l ny nz">onLoadStop: (controller, url) async {<br/>  if (await isNetworkAvailable() &amp;&amp; !(await isPWAInstalled())) {<br/>    // if network is available and this is the first time<br/>    setPWAInstalled();<br/>  }<br/>},</span></pre><p id="3a50" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä½¿ç”¨<code class="fe ls lt lu lv b"><a class="ae kv" href="https://pub.dev/packages/shared_preferences" rel="noopener ugc nofollow" target="_blank">shared_preferences</a></code>æ’ä»¶è·å–å¹¶ä¿å­˜PWAå®‰è£…çŠ¶æ€ï¼Œå¯ä»¥å¦‚ä¸‹å®ç°ä¸¤ä¸ªå®ç”¨ç¨‹åº<code class="fe ls lt lu lv b">isPWAInstalled</code>å’Œ<code class="fe ls lt lu lv b">setPWAInstalled</code>:</p><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="ab20" class="nv lx iq lv b be nw nx l ny nz">Future&lt;bool&gt; isPWAInstalled() async {<br/>  final prefs = await SharedPreferences.getInstance();<br/>  return prefs.getBool('isInstalled') ?? false;<br/>}<br/><br/>void setPWAInstalled({bool installed = true}) async {<br/>  final prefs = await SharedPreferences.getInstance();<br/>  await prefs.setBool('isInstalled', installed);<br/>}</span></pre><p id="fa35" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ‰€æœ‰è¿™äº›å®ç”¨ç¨‹åºéƒ½å…è®¸æˆ‘ä»¬æ£€æµ‹PWAçš„ç½‘ç»œå¯ç”¨æ€§å’Œå®‰è£…çŠ¶æ€ï¼Œä»¥ä¾¿æˆ‘ä»¬å¯ä»¥å®ç°è‡ªå®šä¹‰é”™è¯¯é¡µé¢ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="0a76" class="nv lx iq lv b be nw nx l ny nz">onReceivedError: (controller, request, error) async {<br/>  final isForMainFrame = request.isForMainFrame ?? true;<br/>  if (isForMainFrame &amp;&amp; !(await isNetworkAvailable())) {<br/>    if (!(await isPWAInstalled())) {<br/>      await controller.loadData(<br/>          data: kHTMLErrorPageNotInstalled);<br/>    }<br/>  }<br/>},</span></pre><p id="f34a" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å…¶ä¸­<code class="fe ls lt lu lv b">kHTMLErrorPageNotInstalled</code>æ˜¯åŒ…å«è‡ªå®šä¹‰HTMLçš„å­—ç¬¦ä¸²ã€‚</p><p id="f620" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¦‚æœéœ€è¦æ”¯æŒ<a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Notifications_API" rel="noopener ugc nofollow" target="_blank"> Webé€šçŸ¥JavaScript API </a>ï¼Œå¾ˆé—æ†¾ï¼ŒAndroidåŸç”Ÿçš„WebViewå’ŒiOSåŸç”Ÿçš„WKWebViewéƒ½ä¸æ”¯æŒé‚£ä¸ªç‰¹æ€§ï¼Œå¿…é¡»è‡ªå·±å®ç°ï¼å¯¹äºç¤ºä¾‹å®ç°ï¼Œæ‚¨å¯ä»¥æŸ¥çœ‹<a class="ae kv" href="https://github.com/pichillilorenzo/flutter_inappwebview_examples/tree/main/web_notification" rel="noopener ugc nofollow" target="_blank"> Webé€šçŸ¥é¡¹ç›®ç¤ºä¾‹</a>ã€‚å®ƒä½¿ç”¨ä¸€ä¸ª<code class="fe ls lt lu lv b"><a class="ae kv" href="https://inappwebview.dev/docs/webview/javascript/user-scripts" rel="noopener ugc nofollow" target="_blank">UserScript</a></code>åœ¨ç½‘é¡µå¯åŠ¨æ—¶æ³¨å…¥å®šåˆ¶çš„JavaScriptä»£ç æ¥å®ç°webé€šçŸ¥APIã€‚</p><p id="f42f" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ³¨å…¥çš„JavaScriptä»£ç è¯•å›¾ä¸º<code class="fe ls lt lu lv b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Notification" rel="noopener ugc nofollow" target="_blank">Notification</a></code>çª—å£å¯¹è±¡åˆ›å»ºä¸€ä¸ªâ€œpolyfill â€,å¹¶ä½¿ç”¨<a class="ae kv" href="https://inappwebview.dev/docs/webview/javascript/communication#JavaScript-Handlers" rel="noopener ugc nofollow" target="_blank"> JavaScriptå¤„ç†ç¨‹åº</a>ä¸Flutter/Dartç«¯è¿›è¡Œé€šä¿¡ï¼Œä»¥ç®¡ç†å’Œå®ç°ç›¸åº”çš„é€šçŸ¥UIï¼Œä¾‹å¦‚ï¼Œå½“æ‚¨å‘<code class="fe ls lt lu lv b"><a class="ae kv" href="https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission" rel="noopener ugc nofollow" target="_blank">Notification.requestPermission()</a></code>è¯·æ±‚æƒé™æˆ–æƒ³è¦æ˜¾ç¤ºé€šçŸ¥æ—¶ã€‚</p><p id="a9de" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æ­¤å¤–ï¼Œå¦‚æœä½ éœ€è¦æ”¯æŒæ‘„åƒå¤´å’Œéº¦å…‹é£çš„ä½¿ç”¨(ä¾‹å¦‚ï¼Œä¸€ä¸ªWebRTCåº”ç”¨ç¨‹åº)ï¼Œä½ éœ€è¦å®ç°<code class="fe ls lt lu lv b">onPermissionRequest</code>äº‹ä»¶ï¼Œå¹¶ä½¿ç”¨<code class="fe ls lt lu lv b"><a class="ae kv" href="https://pub.dev/packages/permission_handler" rel="noopener ugc nofollow" target="_blank">permission_handler</a></code>æ’ä»¶è¯·æ±‚è®¸å¯ã€‚æ›´å¤šè¯¦æƒ…ï¼Œè¯·è®¿é—®<a class="ae kv" href="https://inappwebview.dev/docs/web-rtc" rel="noopener ugc nofollow" target="_blank">å®˜æ–¹WebRTCæŒ‡å—</a>å’Œ<a class="ae kv" href="https://github.com/pichillilorenzo/flutter_inappwebview_examples/tree/main/webrtc" rel="noopener ugc nofollow" target="_blank"> WebRTCé¡¹ç›®ç¤ºä¾‹</a>ã€‚</p><p id="d2d4" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">è¦ç®¡ç†ä½¿ç”¨JavaScript ( <code class="fe ls lt lu lv b">window.open()</code>)æˆ–é€šè¿‡é“¾æ¥ä¸­çš„ç›®æ ‡å±æ€§(å¦‚<code class="fe ls lt lu lv b">target="_blank"</code>)æ‰“å¼€æ–°çª—å£çš„è¯·æ±‚ï¼Œæˆ‘ä»¬å¿…é¡»å®ç°<code class="fe ls lt lu lv b">onCreateWindow</code>äº‹ä»¶å¹¶è¿”å›<code class="fe ls lt lu lv b">true</code>ä»¥å£°æ˜æˆ‘ä»¬æ­£åœ¨å¤„ç†è¯·æ±‚ã€‚è¿™é‡Œæœ‰ä¸€ä¸ªç®€å•çš„ä¾‹å­:</p><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="bc31" class="nv lx iq lv b be nw nx l ny nz">onCreateWindow: (controller, createWindowAction) async {<br/>  showDialog(<br/>    context: context,<br/>    builder: (context) {<br/>      final popupWebViewSettings =<br/>          sharedSettings.copy();<br/>      popupWebViewSettings.supportMultipleWindows =<br/>          false;<br/>      popupWebViewSettings<br/>              .javaScriptCanOpenWindowsAutomatically =<br/>          false;<br/><br/>      return WebViewPopup(<br/>          createWindowAction: createWindowAction,<br/>          popupWebViewSettings: popupWebViewSettings);<br/>    },<br/>  );<br/>  return true;<br/>},</span></pre><p id="4fab" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><code class="fe ls lt lu lv b">WebViewPopup</code>æ˜¯<code class="fe ls lt lu lv b">AlertDialog</code>å°éƒ¨ä»¶ä¸­çš„å¦ä¸€ä¸ª<code class="fe ls lt lu lv b">InAppWebView</code>å®ä¾‹ï¼Œå®ƒæ¥å—<code class="fe ls lt lu lv b">createWindowAction</code>çš„è¾“å…¥ä»¥è·å¾—ç”¨äºæ–°<code class="fe ls lt lu lv b">WebView</code>çš„<code class="fe ls lt lu lv b">windowId</code>ã€‚<code class="fe ls lt lu lv b">windowId</code>æ˜¯ä¸€ä¸ªåœ¨æœ¬æœºç«¯ä½¿ç”¨çš„æ ‡è¯†ç¬¦ï¼Œç”¨æ¥è·å¾—Flutterå¿…é¡»æ˜¾ç¤ºçš„æ­£ç¡®çš„<code class="fe ls lt lu lv b">WebView</code>å¼•ç”¨ã€‚WebViewå¼¹å‡ºçª—å£è¿˜å°†å®ç°<code class="fe ls lt lu lv b">onCloseWindow</code>æ¥ç›‘å¬ä½•æ—¶åº”è¯¥å…³é—­å¼¹å‡ºçª—å£å¹¶å°†å…¶ä»çª—å£å°éƒ¨ä»¶æ ‘ä¸­åˆ é™¤:</p><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="e0e5" class="nv lx iq lv b be nw nx l ny nz">onCloseWindow: (controller) {<br/>  Navigator.pop(context);<br/>},</span></pre><p id="5e8d" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">æŸ¥çœ‹<a class="ae kv" href="https://github.com/pichillilorenzo/flutter_inappwebview_examples/tree/main/popup_window" rel="noopener ugc nofollow" target="_blank">å¼¹å‡ºçª—å£é¡¹ç›®ç¤ºä¾‹</a>ä¸­çš„ç¤ºä¾‹å®ç°ã€‚</p><p id="30a9" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸ºäº†å®ç°JavaScriptå’ŒFlutter/Dartç«¯ä¹‹é—´çš„åŒå‘é€šä¿¡ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨<a class="ae kv" href="https://inappwebview.dev/docs/webview/javascript/communication#JavaScript-Handlers" rel="noopener ugc nofollow" target="_blank"> JavaScriptå¤„ç†ç¨‹åº</a>ç‰¹æ€§ã€‚</p><p id="72d2" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å¯¹äºæˆ‘ä»¬çš„ç”¨ä¾‹ï¼Œæˆ‘ä»¬å¸Œæœ›ç›‘å¬idä¸º<code class="fe ls lt lu lv b">notifications</code>çš„â€œè¯·æ±‚è™šæ‹Ÿé€šçŸ¥â€æŒ‰é’®HTMLå…ƒç´ ä¸Šçš„ç‚¹å‡»ï¼Œå¹¶æ˜¾ç¤ºä¸€ä¸ªç”±JavaScriptç”Ÿæˆçš„éšæœºæ–‡æœ¬çš„<code class="fe ls lt lu lv b">SnackBar</code>ã€‚</p><p id="c7d8" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä¸ºæ­¤ï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„<a class="ae kv" href="https://inappwebview.dev/docs/webview/javascript/user-scripts" rel="noopener ugc nofollow" target="_blank">ç”¨æˆ·è„šæœ¬</a>ï¼Œå¹¶åœ¨é¡µé¢åŠ è½½åæ³¨å…¥å®ƒ:</p><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="630d" class="nv lx iq lv b be nw nx l ny nz">initialUserScripts: UnmodifiableListView&lt;UserScript&gt;([<br/>  UserScript(<br/>      source: """<br/>      document.getElementById('notifications').addEventListener('click', function(event) {<br/>        var randomText = Math.random().toString(36).slice(2, 7);<br/>        window.flutter_inappwebview.callHandler('requestDummyNotification', randomText);<br/>      });<br/>      """,<br/>      injectionTime:<br/>          UserScriptInjectionTime.AT_DOCUMENT_END)<br/>]),</span></pre><p id="1faf" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç„¶åï¼Œæˆ‘ä»¬åœ¨åˆ›å»ºäº†<code class="fe ls lt lu lv b">WebView</code>å®ä¾‹ä¹‹åæ·»åŠ ç›¸åº”çš„JavaScriptå¤„ç†ç¨‹åº:</p><pre class="kg kh ki kj gt nr lv ns bn nt nu bi"><span id="2ee1" class="nv lx iq lv b be nw nx l ny nz">onWebViewCreated: (controller) {<br/>  webViewController = controller;<br/><br/>  controller.addJavaScriptHandler(<br/>    handlerName: 'requestDummyNotification',<br/>    callback: (arguments) {<br/>      final String randomText =<br/>          arguments.isNotEmpty ? arguments[0] : '';<br/>      ScaffoldMessenger.of(context).showSnackBar(<br/>          SnackBar(content: Text(randomText)));<br/>    },<br/>  );<br/>},</span></pre><p id="ea75" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ç»“æœå¦‚ä¸‹:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi oo"><img src="../Images/cd248482ad77f8a1bc8eeb0ff0a4f298.png" data-original-src="https://miro.medium.com/v2/resize:fit:720/1*2t9L1UObcsrKYRRmKTGngw.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">Androidç¤ºä¾‹ç»“æœã€‚</p></figure><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div class="gh gi op"><img src="../Images/9771d646fe1f89ebe9990a5ed25f3846.png" data-original-src="https://miro.medium.com/v2/resize:fit:592/1*ICiUmH2pjITByEDwMhIPzg.gif"/></div><p class="kr ks gj gh gi kt ku bd b be z dk translated">iOSç¤ºä¾‹ç»“æœã€‚</p></figure><p id="8bec" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">å®Œæ•´çš„ä»£ç é¡¹ç›®ç¤ºä¾‹å¯ä»<a class="ae kv" href="https://github.com/pichillilorenzo/flutter_inappwebview_examples/tree/main/pwa_to_flutter_app" rel="noopener ugc nofollow" target="_blank">https://github . com/pichillilorenzo/flutter _ inappwebview _ examples/tree/main/pwa _ to _ flutter _ app</a>è·å¾—</p><p id="7414" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä»Šå¤©å°±åˆ°è¿™é‡Œå§ï¼</p><p id="f311" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated">ä½ åœ¨ç”¨è¿™ä¸ªæ’ä»¶å—ï¼Ÿé€šè¿‡<a class="ae kv" href="https://inappwebview.dev/submit-app/" rel="noopener ugc nofollow" target="_blank">æäº¤åº”ç”¨</a>é¡µé¢æäº¤æ‚¨çš„åº”ç”¨ï¼Œå¹¶æŒ‰ç…§è¯´æ˜è¿›è¡Œæ“ä½œã€‚æŸ¥çœ‹<a class="ae kv" href="https://inappwebview.dev/showcase/" rel="noopener ugc nofollow" target="_blank"> Showcase </a>é¡µé¢ï¼Œçœ‹çœ‹è°å·²ç»åœ¨ä½¿ç”¨å®ƒäº†ï¼</p><p id="e7dd" class="pw-post-body-paragraph kw kx iq ky b kz la jr lb lc ld ju le lf lg lh li lj lk ll lm ln lo lp lq lr ij bi translated"><em class="oq">æœ¬é¡¹ç›®éµå¾ª</em> <a class="ae kv" href="https://github.com/all-contributors/all-contributors" rel="noopener ugc nofollow" target="_blank"> <em class="oq">å…¨ä¾›ç¨¿</em> </a> <em class="oq">è§„èŒƒ(</em> <a class="ae kv" href="https://github.com/pichillilorenzo/flutter_inappwebview#contributors-" rel="noopener ugc nofollow" target="_blank"> <em class="oq">ä¾›ç¨¿</em> </a> <em class="oq">)ã€‚æˆ‘æƒ³æ„Ÿè°¢æ‰€æœ‰ä»¥ä»»ä½•æ–¹å¼æ”¯æŒè¿™ä¸ªé¡¹ç›®çš„äººã€‚éå¸¸æ„Ÿè°¢ä½ ä»¬æ‰€æœ‰äººï¼</em>ğŸ’™</p></div></div>    
</body>
</html>