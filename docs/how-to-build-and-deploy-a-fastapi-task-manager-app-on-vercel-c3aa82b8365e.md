# å¦‚ä½•åœ¨ Vercel ä¸Šæ„å»ºå’Œéƒ¨ç½² FastAPI ä»»åŠ¡ç®¡ç†å™¨åº”ç”¨ç¨‹åº

> åŸæ–‡ï¼š<https://betterprogramming.pub/how-to-build-and-deploy-a-fastapi-task-manager-app-on-vercel-c3aa82b8365e>

## **æ„å»ºå¹¶éƒ¨ç½² Postgres FastAPI åº”ç”¨ç¨‹åº**

![](img/3f5f2b481c30fe8b54e53309c95880b6.png)

è¿‘å¹´æ¥ï¼ŒAPI å·²ç»æ”¹å˜äº†è½¯ä»¶çš„æ„å»ºæ–¹å¼ï¼Œå…è®¸æ›´å¤šå¯é‡ç”¨çš„ä»£ç ä¸ä»»ä½•è½¯ä»¶å¼€å‘å·¥å…·è¿›è¡Œäº¤äº’ã€‚ç°ä»£çš„ API å·²ç»æœ‰äº†å®šä¹‰å¥½çš„æ ‡å‡†(é€šå¸¸æ˜¯ HTTP å’Œ REST ),è¿™äº›æ ‡å‡†å¯¹å¼€å‘äººå‘˜æ¥è¯´æ˜¯å‹å¥½çš„ã€å®¹æ˜“è·å¾—çš„ã€è¢«å¹¿æ³›ç†è§£çš„ï¼Œè¿™ä½¿å¾—å¼€å‘äººå‘˜å¯ä»¥æ›´å®¹æ˜“åœ°æ„å»ºå¸¦æœ‰å®‰å…¨æ£€æŸ¥çš„å¯ç»´æŠ¤ä»£ç ä»¥åŠå…¨é¢çš„æ–‡æ¡£ã€‚

[FastAPI](https://fastapi.tiangolo.com/) æ˜¯ä¸€ä¸ªé«˜æ€§èƒ½çš„ Python web æ¡†æ¶ï¼Œä½¿ç”¨æ ‡å‡†çš„ Python ç±»å‹æç¤ºåˆ›å»º APIï¼Œå…è®¸æ‚¨è½»æ¾åˆ›å»ºå¿«é€Ÿã€ç›´è§‚ã€å¥å£®çš„ web åº”ç”¨ç¨‹åºï¼Œå¹¶ä¸”é”™è¯¯æ›´å°‘ã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å†…ç½®äº†å¯¹ API æ–‡æ¡£çš„æ”¯æŒï¼Œç”± Swagger æä¾›æ”¯æŒã€‚

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†é€šè¿‡åˆ›å»ºä¸€ä¸ªç®€å•çš„ä»»åŠ¡ç®¡ç†å™¨åº”ç”¨ç¨‹åºæ¥å­¦ä¹ å¦‚ä½•åœ¨ Vercel ä¸Šæ„å»ºå’Œéƒ¨ç½² Postgres FastAPI åº”ç”¨ç¨‹åºã€‚ä¸ºäº†è·Ÿè¿›ï¼Œç¡®ä¿æ‚¨ä¸ºè¿™ä¸ªé¡¹ç›®å…‹éš†äº† [Github](https://github.com/icode247/PostgresWithFastAPI) åº“ã€‚æˆ‘ä»¬å¼€å§‹å§ï¼ã€‚

# å…ˆå†³æ¡ä»¶

æœ¬æ•™ç¨‹æ˜¯ä¸€ä¸ªå®è·µæ¼”ç¤ºã€‚è¦ç»§ç»­æ“ä½œï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»å®‰è£…äº†ä»¥ä¸‹è½¯ä»¶:

*   [**Arctype**](https://arctype.com/)
*   [**Postgres æ•°æ®åº“**](https://www.postgresql.org/download/)
*   [**é‚®é€’å‘˜**](https://www.postman.com/downloads/)
*   [**å·¨èŸ’**](https://www.python.org/downloads/)
*   [**Heroku CLI**](https://devcenter.heroku.com/articles/heroku-cli)

# **ä»€ä¹ˆæ˜¯ Vercelï¼Ÿ**

[**Vercel**](https://vercel.com/) **æ˜¯ä¸€ä¸ªäº‘æ‰˜ç®¡å¹³å°ï¼Œè¢«å¹¿æ³›è®¤ä¸ºæ˜¯éƒ¨ç½²ä»»ä½•å‰ç«¯åº”ç”¨ç¨‹åºçš„æœ€ä½³åœºæ‰€ã€‚Vercel ä¸ºå…¶å…¨çƒè¾¹ç¼˜ç½‘ç»œæä¾›äº†é›¶é…ç½®éƒ¨ç½²çš„çµæ´»æ€§ï¼Œæ— éœ€è´¹åŠ›å³å¯å®ç°åŠ¨æ€åº”ç”¨å¯æ‰©å±•æ€§ã€‚**

**Vercel ç»“åˆäº†æœ€å“è¶Šçš„å¼€å‘ä½“éªŒå’Œå¯¹æœ€ç»ˆç”¨æˆ·æ•ˆç‡çš„æ‰§ç€å…³æ³¨ï¼Œä»¥åŠä¸€ç³»åˆ—ä»¤äººå…´å¥‹çš„ç‰¹æ€§ï¼Œå¦‚:**

*   å¿«é€Ÿåˆ·æ–°:ä¸ºæ‚¨çš„ UI ç»„ä»¶æä¾›å¯é çš„å®æ—¶ç¼–è¾‘ä½“éªŒã€‚
*   **å¤šåŠŸèƒ½æ•°æ®è·å–:å°†æ‚¨çš„é¡µé¢è¿æ¥åˆ°ä»»ä½•æ•°æ®æºã€headless CMS æˆ– APIï¼Œä»¥ç¡®ä¿å®ƒä»¬å¯ä»¥åœ¨æ¯ä¸ªäººçš„å¼€å‘ç¯å¢ƒä¸­å·¥ä½œã€‚**
*   localhost å®Œç¾:æ‰€æœ‰çš„äº‘åŸè¯­ï¼Œä»ç¼“å­˜åˆ°æ— æœåŠ¡å™¨åŠŸèƒ½ï¼Œéƒ½å¯ä»¥åœ¨ Localhost ä¸Šå®Œç¾è¿è¡Œã€‚

## **å»ºç«‹æˆ‘ä»¬çš„é¡¹ç›®**

åœ¨æˆ‘ä»¬æ·±å…¥ç ”ç©¶ä¹‹å‰ï¼Œè®©æˆ‘ä»¬åˆ›å»ºé¡¹ç›®ç»“æ„å¹¶å®‰è£…åº”ç”¨ç¨‹åºæ‰€éœ€çš„ä¾èµ–é¡¹ã€‚æˆ‘ä»¬å°†ä»åˆ›å»ºé¡¹ç›®æ–‡ä»¶å¤¹å¼€å§‹ã€‚æ‰“å¼€æ‚¨çš„ç»ˆç«¯å¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤:

```
**mkdir PostgresWithFastAPI && cd PostgresWithFastAPI
touch {main,database,model,schema,session}.py**
```

**åœ¨è¿è¡Œä¸Šé¢çš„å‘½ä»¤å¹¶ä¸ºæˆ‘ä»¬çš„é¡¹ç›®åˆ›å»ºäº†ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒ(æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚ä¸­ä»‹ç»)ä¹‹åï¼Œæˆ‘ä»¬çš„é¡¹ç›®ç»“æ„å°†å¦‚ä¸‹æ‰€ç¤º:**

**ğŸ“¦â”£é‚®æ”¿æ€»å±€ğŸ“‚__pycache__
â”£ğŸ“‚ç¯å¢ƒ
â”£ğŸ“œdatabase.py
â”£ğŸ“œmain.py
â”£ğŸ“œmodel.py
â”£ğŸ“œrequirements.txt
â”£ğŸ“œschema.py
â”—ğŸ“œsession.py**

åœ¨æ•´ä¸ªæ•™ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨è¿™äº›æ–‡ä»¶ã€‚

# **åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ**

ä¸ºä½ æ„å»ºçš„ Python é¡¹ç›®åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒæ€»æ˜¯å¥½çš„ã€‚è™šæ‹Ÿç¯å¢ƒå°†åŒ…å«é¡¹ç›®çš„ä¾èµ–é¡¹å¹¶éš”ç¦»å®ƒä»¬ï¼Œä»è€Œä¿æŒé¡¹ç›®æ•´æ´æœ‰åºã€‚æˆ‘ä»¬å°†ä½¿ç”¨ `**virtualenv**` **:** ä¸ºè¿™ä¸ªé¡¹ç›®åˆ›å»ºä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒ

```
**pip install virtualenv**
```

**ç°åœ¨ï¼Œé€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºå¹¶æ¿€æ´»æ‚¨çš„è™šæ‹Ÿç¯å¢ƒ:**

```
**python3 -m venv env
source env/bin/activate**
```

æˆ‘ä»¬å·²ç»æˆåŠŸåœ°ä¸ºé¡¹ç›®åˆ›å»ºäº†ä¸€ä¸ªè™šæ‹Ÿç¯å¢ƒã€‚æˆ‘ä»¬è¿˜éœ€è¦ç”¨ä¸‹é¢çš„å‘½ä»¤å®‰è£… Fastapiã€Uvicornã€Sqlalchemy å’Œ psycopg 2-binary:

```
pip install fastapi uvicorn sqlalchemy psycopg2-binary
```

ç°åœ¨è¿è¡Œä¸‹é¢çš„å‘½ä»¤ï¼Œå°†æˆ‘ä»¬çš„ä¾èµ–å…³ç³»ä¿å­˜åœ¨ä¸€ä¸ª *requirements.txt* æ–‡ä»¶ä¸­ã€‚

```
pip freeze > requirements.txt
```

éå¸¸å¥½ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬ç»§ç»­åˆ›å»ºæˆ‘ä»¬çš„ FastAPI æœåŠ¡å™¨ã€‚

# åˆ›å»º FastAPI æœåŠ¡å™¨

éšç€é¡¹ç›®çš„å»ºç«‹ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥åˆ›å»ºæˆ‘ä»¬çš„ FastAPI æœåŠ¡å™¨äº†ã€‚é¦–å…ˆï¼Œæ‰“å¼€é¡¹ç›®æ ¹ç›®å½•ä¸­çš„`main.py`æ–‡ä»¶ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç :

```
from fastapi import FastAPI
app = FastAPI()

@app.get("/")
def read_root():
    return {"message": "Server is up and running!"}
```

æ¥ä¸‹æ¥ï¼Œå¯¼èˆªåˆ°ç»ˆç«¯ä¸Šçš„é¡¹ç›®æ ¹ç›®å½•ï¼Œå¹¶é€šè¿‡è¿è¡Œä»¥ä¸‹å‘½ä»¤æµ‹è¯•æœåŠ¡å™¨:

```
uvicorn main:app --reload
```

æˆ‘ä»¬æ·»åŠ åˆ°å‘½ä»¤ä¸­çš„`â€” reload`æ ‡å¿—å‘Šè¯‰ FastAPI å…³æ³¨æˆ‘ä»¬ä»£ç åº“çš„æ›´æ–°ï¼Œå¦‚æœå‘ç°æ›´æ–°ï¼Œå°±é‡æ–°åŠ è½½æœåŠ¡å™¨ã€‚ç°åœ¨ï¼Œå‘æœåŠ¡å™¨å‘å‡ºä¸€ä¸ª **Get è¯·æ±‚**ï¼Œä»¥ç¡®ä¿ä¸€åˆ‡éƒ½ä¸ [Postman](https://www.postman.com/downloads/) ä¸€èµ·å·¥ä½œã€‚

![](img/8a560b84dc49841ea7dd8036fd566729.png)

æˆ‘ä»¬çš„æœåŠ¡å™¨å·²ç»æˆåŠŸåˆ›å»ºå¹¶è¿è¡Œã€‚æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ•°æ®åº“æ¥ä¿å­˜æˆ‘ä»¬çš„ç”¨æˆ·è®°å½•ã€‚è®©æˆ‘ä»¬å¼€å§‹è®¾ç½®ä¸€ä¸ªã€‚

# è®¾ç½® Postgres æ•°æ®åº“

æˆ‘ä»¬ç°åœ¨å¯ä»¥è®¾ç½®æˆ‘ä»¬çš„ Postgres æ•°æ®åº“ï¼Œç”¨æˆ‘ä»¬çš„æœåŠ¡å™¨è®¾ç½®æ¥å­˜å‚¨æˆ‘ä»¬çš„ç”¨æˆ·è®°å½•ã€‚æˆ‘ä»¬å°†ä½¿ç”¨ [SQLAlchemy ORM](https://www.sqlalchemy.org/) (å¯¹è±¡å…³ç³»æ˜ å°„å™¨)æ¥è¿æ¥æˆ‘ä»¬çš„æ•°æ®åº“å’Œåº”ç”¨ç¨‹åºã€‚é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡ä»¥ä¸‹æ­¥éª¤åˆ›å»ºä¸€ä¸ªæ•°æ®åº“ã€‚é¦–å…ˆï¼Œåˆ‡æ¢åˆ°ç³»ç»Ÿçš„ Postgres ç”¨æˆ·å¸æˆ·ã€‚

```
sudo su - postgresChanging to the Postgres user account
```

ç„¶åï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„ç”¨æˆ·å¸æˆ·ã€‚ç„¶åï¼Œæ‚¨å¯ä»¥æŒ‰ç…§ä¸‹é¢çš„æˆªå›¾ç»§ç»­æ“ä½œã€‚

```
createuser --interactiveCreating a new user
```

![](img/bd6d3366957f1e0bd704ea146ec50b7f.png)

æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°æ®åº“ã€‚æ‚¨å¯ä»¥ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ¥å®ç°è¿™ä¸€ç‚¹:

```
createdb task
```

ç°åœ¨ï¼Œæˆ‘ä»¬å°†è¿æ¥åˆ°åˆšåˆšåˆ›å»ºçš„æ•°æ®åº“ã€‚æ‰“å¼€`database.py`æ–‡ä»¶ï¼Œå¹¶åœ¨ä¸‹é¢æ·»åŠ ä»¥ä¸‹ä»£ç ç‰‡æ®µ:

```
from sqlalchemy import create_engine
from sqlalchemy.ext.declarative import declarative_base
from sqlalchemy.orm import sessionmaker
SQLALCHEMY_DATABASE_URL = "postgresql://postgres:1234@localhost:5432/task"
engine = create_engine(SQLALCHEMY_DATABASE_URL)
SessionLocal = sessionmaker(autocommit=False, autoflush=False, bind=engine)
Base = declarative_base()
```

åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œä½¿ç”¨æˆ‘ä»¬ä»`**SqlAlchemy**`å¯¼å…¥çš„`**create_engine**`ç±»è¿æ¥åˆ°æˆ‘ä»¬çš„æ•°æ®åº“ã€‚æˆ‘ä»¬è¿˜ä»`**sessionmaker**` ç±»ä¸­åˆ›å»ºäº†ä¸€ä¸ª`**Sessionlocal**` å®ä¾‹ã€‚æˆ‘ä»¬ç¦ç”¨äº†`**autocommit**`å’Œ`**autoflush**`ï¼Œç„¶åå°†æ•°æ®åº“å¼•æ“ç»‘å®šåˆ°ä¼šè¯ã€‚æœ€åï¼Œæˆ‘ä»¬ä»`**declarative_base**` ç±»åˆ›å»ºäº†ä¸€ä¸ª`**Base**`å®ä¾‹ï¼Œæˆ‘ä»¬å°†ç”¨å®ƒæ¥åˆ›å»ºåº”ç”¨ç¨‹åºçš„æ•°æ®åº“æ¨¡å‹å’Œæ•°æ®åº“è¿æ¥ã€‚

# åˆ›å»ºæˆ‘ä»¬çš„æ•°æ®åº“æ¨¡å‹

ä½¿ç”¨æˆ‘ä»¬çš„ Postgres æ•°æ®åº“è®¾ç½®ï¼Œè®©æˆ‘ä»¬é€šè¿‡åˆ›å»ºä¸€ä¸ªæ¨¡å‹æ¥å®šä¹‰å¦‚ä½•å­˜å‚¨ç”¨æˆ·çš„æ•°æ®ã€‚æ‰“å¼€`model.py`æ–‡ä»¶ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ç‰‡æ®µã€‚

```
from sqlalchemy.schema import Column
from sqlalchemy.types import String, Integer, Text
from database import Base

class Task(Base):
   __tablename__ = "Tasks"
   id = Column(Integer, primary_key=True, index=True)
   task_name = Column(String(20))
   task_des = Column(Text())
   created_by = Column(String(20))
   date_created = Column(String(15))
```

åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å¯¼å…¥`Column`å¹¶ä¼ é€’æˆ‘ä»¬æœŸæœ›ä¸ºæ•°æ®åº“ä¸­çš„æ¯ä¸ªå­—æ®µå­˜å‚¨çš„æ•°æ®ç±»å‹(`Integer`ã€`String()`å’Œ`Text()`)æ¥å®šä¹‰æˆ‘ä»¬çš„æ•°æ®æ¨¡å‹ã€‚

æˆ‘ä»¬è¿˜å¯¼å…¥äº†åœ¨æˆ‘ä»¬çš„`database.py`æ–‡ä»¶ä¸­åˆ›å»ºçš„`Base`å®ä¾‹ï¼Œæˆ‘ä»¬ç”¨å®ƒæ¥åˆ›å»ºæˆ‘ä»¬çš„åŸºæœ¬æ¨¡å‹ç±»ã€‚ç„¶åæˆ‘ä»¬ä½¿ç”¨`__tablename__`å±æ€§è®¾ç½®æˆ‘ä»¬çš„è¡¨å(`Tasks`)ã€‚ä¸ºäº†åŒºåˆ†å­˜å‚¨åœ¨æ•°æ®åº“è¡¨ä¸­çš„æ•°æ®ï¼Œæˆ‘ä»¬å‘ id å­—æ®µæ·»åŠ äº†`primary_key`å’Œ`index`å‚æ•°ï¼Œå¹¶å°†å…¶è®¾ç½®ä¸º trueã€‚

# åˆ›å»ºæˆ‘ä»¬çš„æ•°æ®åº“æ¨¡å¼

è®©æˆ‘ä»¬ä¸ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå®šä¹‰ä¸€ä¸ªæ¨¡å¼ã€‚æˆ‘ä»¬éœ€è¦å®šä¹‰ä¸€ä¸ª [Pydantic](https://pydantic-docs.helpmanual.io/) æ¨¡å¼æ¥è¯»å–æ•°æ®å¹¶ä» API è¿”å›ã€‚æ‰“å¼€`Schema.py`æ–‡ä»¶ï¼Œå¹¶å‘å…¶ä¸­æ·»åŠ ä»¥ä¸‹ä»£ç ç‰‡æ®µ:

```
from pydantic import BaseModel
from typing import Optional

class task_schema(BaseModel):
   task_name :str
   task_des :str
   created_by : Optional[str]= None
   date_created : Optional[str]= None

   class Config:
       orm_mode = True
```

åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†æ¨¡å‹éªŒè¯ï¼Œè¿™ç¡®ä¿äº†æ¥è‡ªå®¢æˆ·ç«¯çš„æ•°æ®ä¸æˆ‘ä»¬å®šä¹‰çš„å­—æ®µå…·æœ‰ç›¸åŒçš„æ•°æ®ç±»å‹ã€‚æˆ‘ä»¬å°†æœŸå¾…`task_name`å’Œ`task_des`å­—æ®µçš„å­—ç¬¦ä¸²å€¼ï¼Œä»¥åŠ`created_by`å’Œ`date_created`å­—æ®µçš„å¯é€‰å­—ç¬¦ä¸²å€¼ã€‚å°†`orm_mode`è®¾ç½®ä¸º True çš„å­ç±» config å°†æŒ‡ç¤º Pydantic æ¨¡å‹ä»¥å­—å…¸å’Œå±æ€§çš„å½¢å¼è¯»å–æ•°æ®ã€‚

# åˆ›å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè·¯çº¿

åˆ›å»ºå¥½æ¨¡å¼åï¼Œè®©æˆ‘ä»¬å®šä¹‰åº”ç”¨ç¨‹åºçš„è·¯ç”±ã€‚é¦–å…ˆï¼Œæ‰“å¼€`session.py`æ–‡ä»¶å¹¶åˆ›å»ºä¸€ä¸ª`create_get_session()`å‡½æ•°ï¼Œç”¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µåˆ›å»ºå¹¶å…³é—­ä¼šè¯æˆ‘ä»¬çš„è·¯çº¿:

```
import model
from database import SessionLocal, engine

model.Base.metadata.create_all(bind=engine)
def create_get_session():
   try:
       db = SessionLocal()
       yield db
   finally:
       db.close()
```

åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬é€šè¿‡è°ƒç”¨`model.Base.metadata.create_all()`å‡½æ•°å¹¶å°†å…¶ç»‘å®šåˆ°æˆ‘ä»¬çš„æ•°æ®åº“å¼•æ“ï¼Œä½¿ç”¨æˆ‘ä»¬åœ¨æ¨¡å‹ä¸­å®šä¹‰çš„å­—æ®µåˆ›å»ºäº†æˆ‘ä»¬çš„è¡¨ã€‚

ç„¶åï¼Œæ‰“å¼€`main.py`æ–‡ä»¶ï¼Œç”¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µå¯¼å…¥æˆ‘ä»¬æ‰€æœ‰çš„æ¨¡å—:

```
from fastapi import FastAPI, Depends, HTTPException
from sqlalchemy.orm import Session
from typing import List
from model import Task
from schema import task_schema
from session import get_database_session
â€¦
```

æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µåˆ›å»º **read_tasks** è·¯çº¿:

```
â€¦
@app.get("/task", response_model=List[task_schema], status_code=200)
async def read_tasks(db: Session = Depends(create_get_session)):
   tasks = db.query(Task).all()
   return tasks
â€¦
```

åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª`read_tasks`è·¯ç”±æ¥ç›‘å¬ GET è¯·æ±‚ã€‚æˆ‘ä»¬ä¼ å…¥äº†å“åº”æ¨¡å‹ï¼Œè¯¥æ¨¡å‹è¿”å›æ•°æ®åº“ä¸­æ‰€æœ‰ä»»åŠ¡çš„åˆ—è¡¨å’ŒçŠ¶æ€ä»£ç  200 (OK)ã€‚åœ¨æˆ‘ä»¬çš„`read_tasks`å‡½æ•°ä¸­ï¼Œå¼•ç”¨äº†æˆ‘ä»¬çš„æ¨¡å‹ä¼šè¯ï¼Œè¿™å°†ä½¿æˆ‘ä»¬èƒ½å¤Ÿåœ¨æ•°æ®åº“ä¸­æ‰§è¡ŒæŸ¥è¯¢ã€‚

æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ª`create_task`è·¯ç”±ï¼Œç”¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µå‘æˆ‘ä»¬çš„æ•°æ®åº“æ·»åŠ æ–°ä»»åŠ¡:

```
â€¦
@app.post('/task', response_model = task_schema, status_code=201)
async def create_task(task: task_schema, db: Session = Depends(create_get_session)):
   new_task = Task(
        task_name = task.task_name,
        task_des = task.task_des,
        created_by =task.created_by,
        datecreated = task.date_created,
   )
   db.add(new_task)
   db.commit()

   return new_task
â€¦
```

åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª`create_task`è·¯ç”±ï¼Œå®ƒå°†ä¾¦å¬ POST è¯·æ±‚ã€‚è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬çš„å“åº”æ¨¡å‹å°†è¿”å›åˆšåˆšåˆ›å»ºçš„ä»»åŠ¡ï¼ŒçŠ¶æ€ä»£ç ä¸º 201(å·²åˆ›å»º)ã€‚ç„¶åï¼Œæˆ‘ä»¬é€šè¿‡ä¼ é€’ä¸€ä¸ªé¡¹ç›®å¹¶å°†å…¶åˆ†é…ç»™æˆ‘ä»¬çš„ Pydantic æ¨¡å‹ï¼Œä»è¯·æ±‚ä½“è·å–æ•°æ®ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬ä»æ¨¡å‹ç±»ä¸­åˆ›å»ºäº†ä¸€ä¸ª`new_task`å¯¹è±¡ï¼Œå¹¶å°†æ•°æ®ä»è¯·æ±‚ä½“ä¼ é€’åˆ°æ¨¡å‹ä¸­çš„å­—æ®µã€‚ç„¶åæˆ‘ä»¬å°†`new_task`å¯¹è±¡æ·»åŠ åˆ°æˆ‘ä»¬çš„æ•°æ®åº“ä¼šè¯ä¸­ï¼Œæäº¤å®ƒä»¬å¹¶è¿”å›åˆ›å»ºçš„å¯¹è±¡ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬åˆ›å»º`get_task`è·¯ç”±ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªä»»åŠ¡ï¼Œå…¶ id åœ¨è¯·æ±‚å‚æ•°ä¸­æŒ‡å®šï¼Œä»£ç ç‰‡æ®µå¦‚ä¸‹:

```
â€¦
@app.get("/task/{id}", response_model = task_schema, status_code=200)
async def get_task(id:int,db: Session = Depends(create_get_session)):
   task = db.query(Task).get(id)
   return task
â€¦
```

åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†æˆ‘ä»¬çš„`get_task`è·¯ç”±ï¼Œå®ƒä¹Ÿå°†ç›‘å¬ä¸€ä¸ª GET è¯·æ±‚ã€‚ä½†æ˜¯è¿™ä¸€æ¬¡ï¼Œæˆ‘ä»¬å°†ä»»åŠ¡çš„ id ä½œä¸ºå‚æ•°ä¼ å…¥ç«¯ç‚¹ã€‚æˆ‘ä»¬çš„å“åº”æ¨¡å‹å°†è¿”å›ä¸€ä¸ªçŠ¶æ€ä»£ç ä¸º 200(OK)çš„ item å¯¹è±¡ã€‚ç„¶åï¼Œæˆ‘ä»¬æŸ¥è¯¢æˆ‘ä»¬çš„æ•°æ®åº“æ¨¡å‹(Tasks ),ä»¥è·å–å…¶ id åœ¨è¯·æ±‚å‚æ•°ä¸­æŒ‡å®šçš„ä»»åŠ¡ï¼Œå¹¶å°†å…¶è¿”å›ç»™ç”¨æˆ·ã€‚

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†åˆ›å»ºæˆ‘ä»¬çš„`update_task`è·¯ç”±ï¼Œå®ƒå°†ç›‘å¬ä¸€ä¸ªè¡¥ä¸è¯·æ±‚ï¼Œæˆ‘ä»¬è¿˜å°†ä¼ å…¥æˆ‘ä»¬çš„å“åº”æ¨¡å‹ï¼Œå®ƒå°†è¿”å›ä¸€ä¸ªæ›´æ–°äº†çŠ¶æ€ä»£ç  200 (OK)çš„ä»»åŠ¡å¯¹è±¡ã€‚ç„¶åï¼Œæˆ‘ä»¬åœ¨æ¨¡å‹ä¸­æŸ¥è¯¢å…¶ id åœ¨è¯·æ±‚å‚æ•°ä¸­æŒ‡å®šçš„é¡¹ç›®ï¼Œé‡ç½®ä»»åŠ¡çš„å€¼ï¼Œå°†å…¶ä¿å­˜åˆ°æ•°æ®åº“ï¼Œåˆ·æ–°æ•°æ®åº“ï¼Œå¹¶å°†æ›´æ–°åçš„è®°å½•å¯¹è±¡è¿”å›ç»™ç”¨æˆ·ã€‚

```
â€¦
@app.patch("/task/{id}", response_model = task_schema, status_code=200)
async def update_task(id:int, task:task_schema, db: Session = Depends(create_get_session)):
   db_task = db.query(Task).get(id)
   db_task.task_name = task.task_name
   db_task.task_des =  task.task_des
   db.commit()
   db.refresh(db_task)

   return db_task
â€¦
```

æœ€åï¼Œæˆ‘ä»¬å°†åˆ›å»º`delete_task`è·¯ç”±ï¼Œå®ƒå°†ä¾¦å¬ä¸€ä¸ªåˆ é™¤è¯·æ±‚ï¼Œåˆ é™¤å…¶ id åœ¨è¯·æ±‚å‚æ•°ä¸­æŒ‡å®šçš„ä»»åŠ¡ï¼Œå¹¶è¿”å›ä¸€ä¸ªçŠ¶æ€ä»£ç  200 (OK)ã€‚æˆ‘ä»¬å°†åœ¨æ•°æ®åº“ä¸­æŸ¥è¯¢è¯¥é¡¹ï¼Œå¦‚æœæ•°æ®åº“ä¸­ä¸å­˜åœ¨è¯¥é¡¹ï¼Œå°†å¼•å‘ HTTPException é”™è¯¯ã€‚ç„¶åä¼ å…¥çŠ¶æ€ä»£ç  404(æœªæ‰¾åˆ°)ï¼Œå¹¶è¿”å› nullã€‚

```
@app.delete('/task/{id}', status_code=200)
async def delete_task(id:int, db: Session = Depends(create_get_session)):
   db_task = db.query(Task).get(id)
   if not db_task:
       raise HTTPException(status_code="404",detail="Task id does not exist")

   db.delete(db_task)
   db.commit()

   return None
```

å°±è¿™æ ·ï¼Œæˆ‘ä»¬å»ºç«‹äº†æ‰€æœ‰çš„è·¯çº¿ã€‚è®©æˆ‘ä»¬åœ¨æœ¬åœ°æµ‹è¯•æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºã€‚

# æµ‹è¯•åº”ç”¨ç¨‹åº

æœ‰äº†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºè®¾ç½®ï¼Œè®©æˆ‘ä»¬ç»§ç»­ç”¨ Postman æµ‹è¯•å®ƒã€‚æˆ‘ä»¬å°†ä»é‚®æ”¿è·¯çº¿å¼€å§‹ã€‚

![](img/d27ceeb06e4f6a34ff5ad4f59212a10d.png)

æ¥ä¸‹æ¥ï¼ŒGET è·¯çº¿ã€‚æˆ‘ä»¬ä¼šç”¨åŒæ ·çš„æ–¹æ³•æµ‹è¯•å®ƒã€‚

![](img/937202bc44c321b8e59d9e9b951e6436.png)

æ¥ä¸‹æ¥ï¼Œé€šè¿‡ id è·å–è·¯ç”±ã€‚æ‚¨åº”è¯¥ä¼šçœ‹åˆ°å¦‚ä¸‹æ‰€ç¤ºçš„ç»“æœã€‚

![](img/f170a3b9c5a0f66ca21fe2fe326abd6f.png)

æ¥ä¸‹æ¥æ˜¯è´´ç‰‡è·¯çº¿ã€‚åŒæ ·ï¼Œæ­£ç¡®çš„å›ç­”å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚

![](img/165a596cfabcb54a90b4e4b00057cc45.png)

æœ€åï¼Œ**åˆ é™¤**è·¯çº¿ã€‚

![](img/e2c5672ddb8a0629c1687b09d1bf286d.png)

ä¸€åˆ‡çœ‹èµ·æ¥éƒ½å¾ˆå¥½ã€‚ç°åœ¨ï¼Œè®©æˆ‘ä»¬å°†åº”ç”¨ç¨‹åºéƒ¨ç½²åˆ° Vercel ä¸Šçš„äº‘ä¸­ã€‚

# éƒ¨ç½²åˆ° Vercel

æµ‹è¯•å®Œæˆ‘ä»¬çš„è·¯çº¿åï¼Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå°±å¯ä»¥éƒ¨ç½²åˆ° Vercel çš„äº‘ä¸­äº†ã€‚åœ¨éƒ¨ç½²åº”ç”¨ç¨‹åºä¹‹å‰ï¼Œåœ¨ Heroku ä¸Šä¸ºé¡¹ç›®[åœ¨è¿™é‡Œ](https://devcenter.heroku.com/articles/getting-started-with-python#provision-a-database)æä¾›ä¸€ä¸ªè¿œç¨‹æ•°æ®åº“ï¼Œå¹¶åœ¨`database.py`æ–‡ä»¶ä¸­æ›´æ–°æ•°æ®åº“è¿æ¥å­—ç¬¦ä¸²ã€‚

```
SQLALCHEMY_DATABASE_URL = â€œRemote connection stringâ€
```

ç„¶å[åœ¨ Vercel ä¸Šæ³¨å†Œä¸€ä¸ªè´¦æˆ·](https://vercel.com/signup)ï¼Œç”¨ä¸‹é¢çš„å‘½ä»¤å®‰è£… Vercel CLI å·¥å…·:

```
//Ubuntu
sudo npm install vercel

//Windows
npm install -g vercel
```

å®‰è£…å®Œæˆåï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç™»å½•åˆ° Vercel CLI:

```
Vercel login
```

ä¸Šé¢çš„å‘½ä»¤å°†æç¤ºæ‚¨è¾“å…¥æƒ³è¦ç™»å½•çš„èº«ä»½éªŒè¯å¸æˆ·ã€‚åšå‡ºé€‰æ‹©ï¼Œç„¶åæŒ‰å›è½¦é”®ã€‚æ‚¨å°†è¢«é‡å®šå‘åˆ°æµè§ˆå™¨ä¸­çš„ä¸€ä¸ªæ–°é€‰é¡¹å¡ï¼Œå¦‚æœæ‚¨çœ‹åˆ°ä¸€æ¡æˆåŠŸæ¶ˆæ¯ï¼Œåˆ™è¡¨æ˜æ‚¨æˆåŠŸç™»å½•äº†æ‚¨çš„å¸æˆ·ã€‚è¿™æ„å‘³ç€æ‚¨ç°åœ¨å¯ä»¥ä»ç»ˆç«¯è®¿é—®æ‚¨çš„é¡¹ç›®ã€‚

æ¥ä¸‹æ¥ï¼Œæ‚¨éœ€è¦ä¸€ä¸ªé…ç½®æ–‡ä»¶æ¥å‘Šè¯‰ Vercel åœ¨å“ªé‡Œå¯ä»¥æ‰¾åˆ°æ‚¨çš„`main`é¡¹ç›®æ–‡ä»¶ã€‚åœ¨çˆ¶ç›®å½•ä¸­åˆ›å»ºä¸€ä¸ª`vercel.json`æ–‡ä»¶ï¼Œå¹¶æ·»åŠ ä»¥ä¸‹ JSON ä»£ç ç‰‡æ®µ:

```
{
 "builds": [{ "src": "main.py", "use": "@vercel/python" }],
 "routes": [{ "src": "/(.*)", "dest": "main.py" }]
}
```

åœ¨ä¸Šé¢çš„ä»£ç ç‰‡æ®µä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªå¯¹è±¡ï¼Œå®ƒæŒ‡ç¤ºäº†åº”ç”¨ç¨‹åºçš„`main`æ–‡ä»¶çš„è·¯å¾„ã€‚æˆ‘ä»¬è¿˜è¯´æ˜äº†åœ¨`routes`å¯¹è±¡ä¸­æ„å»ºæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºæ—¶è¦ä½¿ç”¨çš„åŒ…ã€‚æˆ‘ä»¬å°†æ‰€æœ‰è·¯ç”±æŒ‡å‘`main.py`æ–‡ä»¶ã€‚

ç°åœ¨ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸‹é¢çš„å‘½ä»¤åˆå§‹åŒ– Vercel:

```
Vercel .
```

ä¸Šè¿°å‘½ä»¤å°†æç¤ºæ‚¨å¡«å†™é¡¹ç›®è¯¦ç»†ä¿¡æ¯ã€‚æŒ‰ç…§ä¸‹é¢æˆªå›¾ä¸­çš„æç¤ºå»åšã€‚

![](img/be138aafebaab003f5685b560511b4d2.png)

è‡³æ­¤ï¼Œæˆ‘ä»¬çš„é¡¹ç›®å·²ç»æˆåŠŸéƒ¨ç½²åœ¨ Vercel ä¸Šã€‚ä½ å¯ä»¥ä»[é“¾æ¥](https://fastapidemo.vercel.app/docs)ä¸­æµ‹è¯•å‡ºæ¥ã€‚

# ä½¿ç”¨ arctype å¯è§†åŒ–æˆ‘ä»¬çš„æ•°æ®

å°†æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºéƒ¨ç½²åœ¨ Vercel ä¸Šåï¼Œè®©æˆ‘ä»¬é€šè¿‡å°†æ•°æ®åº“è¿æ¥åˆ° Arctype æ¥å¯è§†åŒ–æ•°æ®åº“ä¸­çš„è®°å½•ã€‚è¦å¼€å§‹ï¼Œè¯·ç¡®ä¿æ‚¨å·²ç»åœ¨æ‚¨çš„æœºå™¨ä¸Šä¸‹è½½å¹¶å®‰è£…äº† [Arctype](/arctype.com) ã€‚å¯åŠ¨ Arctype å¹¶å•å‡» Postgres æ¥åˆ›å»ºè¿æ¥ã€‚å¦‚æœæ‚¨éœ€è¦å¸®åŠ©ï¼Œè¯·ç‚¹å‡»æ­¤[é“¾æ¥](https://docs.arctype.com/connect/postgresql)ã€‚

![](img/3170c1bfff58c4021a4a4296a4da1d8a.png)

é€‰æ‹© **Postgres åï¼Œ**æ·»åŠ æ‚¨çš„æ•°æ®åº“å‡­è¯ï¼Œç‚¹å‡»**ä¿å­˜**æŒ‰é’®è¿æ¥æ•°æ®åº“ã€‚

![](img/bf579de2fda899d831800bdd2a4b6f72.png)

æˆ‘ä»¬å·²ç»è¿æ¥åˆ°æˆ‘ä»¬çš„è¿œç¨‹æ•°æ®åº“ã€‚å•å‡»**ä»»åŠ¡**è¡¨ï¼Œåœ¨ Arctype çš„æ•°æ®åº“ä¸Šè¿è¡Œä¸€äº›æŸ¥è¯¢ã€‚æ‚¨å¯ä»¥ä» **Arctype** ç›´æ¥å¯¹æ•°æ®åº“æ‰§è¡Œ CRUD æ“ä½œï¼Œäº§ç”Ÿå¦‚ä¸‹æ‰€ç¤ºçš„è¾“å‡ºã€‚

![](img/66b3f2a1639bc5a11c43d054d7c0b1ef.png)

Arctype æ˜¯ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„ SQL å®¢æˆ·ç«¯ï¼Œå…·æœ‰é«˜çº§åä½œå’Œæ•°æ®å¯è§†åŒ–å·¥å…·ã€‚è¯·åŠ¡å¿…å°è¯•æ‰¾åˆ°ç ”ç©¶åº”ç”¨ç¨‹åºæ•°æ®çš„æœ€ä½³æ–¹æ³•ã€‚

# ç»“è®º

åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæ‚¨å·²ç»å­¦ä¹ äº†å¦‚ä½•åœ¨ Vercel ä¸Šæ„å»ºå’Œéƒ¨ç½² Postgres FastAPI åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬ä»ç®€è¦æ¦‚è¿° Vercel å’Œ FastAPI å¼€å§‹ã€‚ç„¶åæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ª FastAPI æœåŠ¡å™¨ï¼Œè®¾ç½®äº†ä¸€ä¸ª Postgres æ•°æ®åº“ï¼Œå°†åº”ç”¨ç¨‹åºè¿æ¥åˆ° Postgresï¼Œæ‰§è¡Œ CRUD æ“ä½œï¼Œç”¨ Arctype å¯è§†åŒ–æ•°æ®ã€‚

ç°åœ¨æ‚¨å·²ç»äº†è§£äº†è¿™äº›çŸ¥è¯†ï¼Œé‚£ä¹ˆæ‚¨æ‰“ç®—å¦‚ä½•æ„å»ºä¸‹ä¸€ä¸ª FastAPI åº”ç”¨ç¨‹åºå‘¢ï¼Ÿæˆ–è®¸ä½ å¯ä»¥ä»ä»–ä»¬çš„ç½‘ç«™ä¸Šäº†è§£æ›´å¤šå…³äº [FastAPI](https://fastapi.tiangolo.com/) å’Œ [Arctype](https://arctype.com/) çš„ä¿¡æ¯ï¼Œå¹¶å°†ä½ æ‰€å­¦åˆ°çš„ä½œä¸ºä½ ä¸‹ä¸€ä¸ªé¡¹ç›®çš„çµæ„Ÿã€‚è¯·éšæ—¶åœ¨ [Twitter](https://twitter.com/EkekentaZion) ä¸Šåˆ†äº«æ‚¨çš„è¿›å±•å’Œé—®é¢˜ã€‚