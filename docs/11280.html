<html>
<head>
<title>Publish Node Packages to GitHub Packages With Azure Pipelines and Lerna.js</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Azureç®¡é“å’ŒLerna.jså°†èŠ‚ç‚¹åŒ…å‘å¸ƒåˆ°GitHubåŒ…</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/publish-node-packages-to-github-packages-with-azure-pipelines-and-lerna-js-de784d290674?source=collection_archive---------6-----------------------#2022-03-05">https://betterprogramming.pub/publish-node-packages-to-github-packages-with-azure-pipelines-and-lerna-js-de784d290674?source=collection_archive---------6-----------------------#2022-03-05</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="9d40" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">å‘å¸ƒèŠ‚ç‚¹åŒ…çš„å®è·µæŒ‡å—</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/5b773f4fef8d0f53f8af6554cb4622ee.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Wi2yIg7yDfdN4VtH.png"/></div></div></figure><p id="9499" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ç ”ç©¶ä¸¤ç§å°†Node.jsåŒ…å‘å¸ƒåˆ°GitHubåŒ…çš„æ–¹æ³•ï¼›å’ŒNPMä¸€èµ·å‡ºç‰ˆï¼Œç„¶åæ˜¯å‹’çº³ã€‚</p><p id="22c1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><a class="ae ln" href="https://github.com/cjh-cloud/github-node-package" rel="noopener ugc nofollow" target="_blank">æœ¬æ–‡ä¸­ä½¿ç”¨çš„ä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°ã€‚</a></p><h1 id="1f2d" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">ä½¿ç”¨Azure Pipelineså’ŒNPMå°†èŠ‚ç‚¹åŒ…å‘å¸ƒåˆ°GitHubåŒ…</h1><h2 id="6463" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">å›¾ä¹¦é¦†</h2><p id="7573" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">åˆ›å»ºä¸€ä¸ªåä¸ºâ€œGitHub Packagesâ€çš„åº“(åœ¨ä¸€ä¸ªæ–°çš„Azure DevOpsé¡¹ç›®ä¸­)ï¼Œä½¿ç”¨å˜é‡<code class="fe mx my mz na b">GH_TOKEN</code>å’Œä¸€ä¸ªå…·æœ‰<code class="fe mx my mz na b">write:packages</code>æƒé™çš„GitHubä¸ªäººè®¤è¯ä»¤ç‰Œçš„å€¼ã€‚é€šè¿‡å•å‡»æŒ‚é”å›¾æ ‡è®¾ç½®æ­¤å˜é‡secretçš„å€¼ğŸ”’ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/ce427aedb0876ee87c155f6bd0052203.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*LtoEdrhQLyoDWiI0WwZA5g.png"/></div></div></figure><h2 id="5626" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">å¯†ç </h2><p id="12fc" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated"><code class="fe mx my mz na b">.azure/publish.yml</code> â€”è¯¥æ–‡ä»¶å®šä¹‰ç®¡é“ï¼Œå®‰è£…Node.js 14.xå¹¶åˆ›å»ºä¸€ä¸ª<code class="fe mx my mz na b">.npmrc</code>æ–‡ä»¶ï¼Œå°†GitHub Packagesæ³¨å†Œè¡¨è®¾ç½®ä¸ºå‘å¸ƒåŒ…çš„ç›®çš„åœ°ï¼Œè¿è¡Œ<code class="fe mx my mz na b">npm publish</code>å‘å¸ƒè¯¥åŒ…ã€‚</p><pre class="kg kh ki kj gt nc na nd ne aw nf bi"><span id="2083" class="mg lp iq na b gy ng nh l ni nj">name: Publish Node GitHub Package<br/><br/>trigger:<br/>  - main<br/><br/>pr: none<br/><br/>variables:<br/>  - group: GitHub Packages<br/>  - name: vmImageName<br/>    value: 'ubuntu-latest'<br/><br/>stages:<br/>  - stage: Publish<br/>    displayName: Publish GitHub Package<br/>    jobs:<br/>    - job: Publish<br/>      displayName: Publish Job<br/>      pool:<br/>        vmImage: $(vmImageName)<br/>      steps:<br/>      - task: NodeTool@0<br/>        inputs:<br/>          versionSpec: '14.x'<br/>        displayName: 'Install Node.js version 14.x'<br/><br/>      - bash: |<br/>          echo //npm.pkg.github.com/:_authToken=${GH_TOKEN} &gt; ~/.npmrc<br/>          npm publish<br/>        env:<br/>          GH_TOKEN: $(GH_TOKEN)</span></pre><p id="2236" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mx my mz na b">package.json</code> â€”æ·»åŠ ä¸€ä¸ª<code class="fe mx my mz na b">publishConfig</code>éƒ¨åˆ†æ¥å®šä¹‰è¦å‘å¸ƒåˆ°çš„GitHubæ³¨å†Œè¡¨</p><pre class="kg kh ki kj gt nc na nd ne aw nf bi"><span id="b807" class="mg lp iq na b gy ng nh l ni nj">"publishConfig": {<br/>  "registry": "https://npm.pkg.github.com/[User or Org name]"<br/>},</span></pre><h1 id="b39d" class="lo lp iq bd lq lr ls lt lu lv lw lx ly jw lz jx ma jz mb ka mc kc md kd me mf bi translated">ä½¿ç”¨Lernaå‘å¸ƒç‰ˆæœ¬</h1><p id="fe66" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">æºä»£ç å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°:<a class="ae ln" href="https://github.com/cjh-cloud/github-node-package" rel="noopener ugc nofollow" target="_blank">https://github.com/cjh-cloud/github-node-package</a></p><h2 id="fc85" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">å›¾ä¹¦é¦†</h2><p id="b088" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated">è¿™ä¸ä¸Šé¢ä½¿ç”¨çš„åº“å¾ˆå¤§ç¨‹åº¦ä¸Šæ˜¯ç›¸åŒçš„ï¼Œä½†æ˜¯å¢åŠ äº†<code class="fe mx my mz na b">GH_USER</code>ï¼Œå®ƒåªæ˜¯GitHubç”¨æˆ·çš„åŒ…æ³¨å†Œä¸­å¿ƒçš„ç”¨æˆ·åï¼Œç”¨æ¥å‘å¸ƒNode.jsåŒ…ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi nb"><img src="../Images/e69e7fd9ebe154ceb3f6e43206b478fc.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*IcFCTm2x09JI2l4M6hfdMg.png"/></div></div></figure><h2 id="85f7" class="mg lp iq bd lq mh mi dn lu mj mk dp ly la ml mm ma le mn mo mc li mp mq me mr bi translated">å¯†ç </h2><p id="ac92" class="pw-post-body-paragraph kr ks iq kt b ku ms jr kw kx mt ju kz la mu lc ld le mv lg lh li mw lk ll lm ij bi translated"><code class="fe mx my mz na b">package.json</code> â€”åŒä¸Šï¼Œå¢åŠ äº†<code class="fe mx my mz na b">publishConfig</code>éƒ¨åˆ†ã€‚</p><p id="3687" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe mx my mz na b">.azure/publish.yml</code> â€”è¿™ä¸ªç®¡é“è¿˜æœ‰å‡ ä¸ªæ­¥éª¤:</p><ul class=""><li id="4c56" class="nk nl iq kt b ku kv kx ky la nm le nn li no lm np nq nr ns bi translated">æ£€å‡º<code class="fe mx my mz na b">main</code>åˆ†æ”¯</li><li id="8b96" class="nk nl iq kt b ku nt kx nu la nv le nw li nx lm np nq nr ns bi translated">é…ç½®Gitå‡­è¯ï¼Œä»¥ä¾¿Lernaå¯ä»¥åˆ¶ä½œGitæ ‡è®°å¹¶é‡Šæ”¾</li><li id="c101" class="nk nl iq kt b ku nt kx nu la nv le nw li nx lm np nq nr ns bi translated">Boostrap Lerna(ä¸ºæ‰€æœ‰è½¯ä»¶åŒ…å®‰è£…èŠ‚ç‚¹æ¨¡å—)</li><li id="7f6a" class="nk nl iq kt b ku nt kx nu la nv le nw li nx lm np nq nr ns bi translated">ç”¨<code class="fe mx my mz na b">--registry https://npm.pkg.github.com</code>å°†åŒ…å‘å¸ƒåˆ°GitHubåŒ…</li></ul><pre class="kg kh ki kj gt nc na nd ne aw nf bi"><span id="7821" class="mg lp iq na b gy ng nh l ni nj">name: Publish Node GitHub Package<br/><br/>trigger:<br/>  - main<br/><br/>pr: none<br/><br/>variables:<br/>  - group: GitHub Packages<br/>  - name: vmImageName<br/>    value: 'ubuntu-latest'<br/><br/>stages:<br/>  - stage: Publish<br/>    displayName: Publish GitHub Package<br/>    jobs:<br/>    - job: Publish<br/>      displayName: Publish Job<br/>      pool:<br/>        vmImage: $(vmImageName)<br/>      steps:<br/><br/>      - bash: git checkout main<br/>        displayName: 'Checkout main branch' # to avoid detached head<br/><br/>      - bash: |<br/>          git config user.name "$GH_USER"<br/>          git remote rm origin &amp;&amp; git remote add origin https://random_str:${GH_TOKEN}@github.com/${GH_USER}/github-node-package.git &amp;&amp; git fetch<br/>        displayName: 'Configure git'<br/>        env:<br/>          GH_TOKEN: $(GH_TOKEN)<br/><br/>      - task: NodeTool@0<br/>        inputs:<br/>          versionSpec: '14.x'<br/>        displayName: 'Install Node.js version 14.x'<br/><br/>      - bash: yarn install<br/>        displayName: Install Yarn dependencies<br/><br/>      - bash: yarn lerna bootstrap<br/>        displayName: Bootstrap Lerna<br/><br/>      - bash: |<br/>          echo //npm.pkg.github.com/:_authToken=${GH_TOKEN} &gt; ~/.npmrc<br/>          yarn lerna publish --yes --exact --conventional-commits --force-publish --create-release github --registry https://npm.pkg.github.com/<br/>        env:<br/>          GH_TOKEN: $(GH_TOKEN)</span></pre><p id="60b1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¸Œæœ›ä½ è§‰å¾—è¿™æœ‰ç”¨ï¼</p></div></div>    
</body>
</html>