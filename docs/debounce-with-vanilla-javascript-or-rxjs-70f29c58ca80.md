# ç”¨æ™®é€š JavaScript æˆ– RxJS å»æŠ–

> åŸæ–‡ï¼š<https://betterprogramming.pub/debounce-with-vanilla-javascript-or-rxjs-70f29c58ca80>

## å»æŠ–åŠ¨å»ç¥ç§˜åŒ–

![](img/c2994aae4c8eda0f226c26624c435ed5.png)

ç…§ç‰‡ç”±[æ‹œå°”å¨œÂ·å·´è’‚æ–¯](https://unsplash.com/@barnabartis?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText)åœ¨ [Unsplash](https://unsplash.com/?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText) ä¸Šæ‹æ‘„

æˆ‘æœ€è¿‘ä¸å¾—ä¸æ¸…ç†æˆ‘ä»¬åœ¨ [DeckDeckGo](https://deckdeckgo.com) ä¸­ä½¿ç”¨çš„ä»£ç ã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæˆ‘ä¸å¾—ä¸å°†å•ä¾‹æ–¹æ³•é‡æ„ä¸ºæ— çŠ¶æ€å‡½æ•°ã€‚å…¶ä¸­ä¸€ä¸ªç»™äº†æˆ‘ä¸€æ®µæ›´è‰°éš¾çš„æ—¶é—´ï¼Œè¿™å°±æ˜¯æˆ‘å†™è¿™ç¯‡æ–‡ç« çš„æƒ³æ³•ï¼

# ä»€ä¹ˆæ˜¯å»æŠ–ï¼Ÿ

å‡è®¾æ‚¨å·²ç»åœ¨åº”ç”¨ç¨‹åºä¸­å®ç°äº†ä¸€ä¸ª`<input/>`,å®ƒä¼šåœ¨æ¯æ¬¡æ•°æ®åº“å†…å®¹æ”¹å˜æ—¶è§¦å‘æ•°æ®åº“æ›´æ–°ã€‚å‡ºäºæ€§èƒ½åŸå› ï¼Œç”šè‡³å¯èƒ½å‡ºäºæˆæœ¬åŸå› (ä¾‹å¦‚ï¼Œå¦‚æœæ‚¨æ­£åœ¨ä½¿ç”¨ [Google Firestore](https://cloud.google.com/firestore/pricing) )ï¼Œæ‚¨å¯èƒ½ä¸å¸Œæœ›æ¯æ¬¡æŒ‰ä¸‹é”®ç›˜æŒ‰é”®æ—¶éƒ½è§¦å‘æ•°æ®åº“æ›´æ–°ï¼Œè€Œæ˜¯ä»…åœ¨éœ€è¦æ—¶æ‰§è¡Œä¿å­˜ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯èƒ½å¸Œæœ›ä»…å½“ç”¨æˆ·æ ‡è®°æš‚åœæ—¶ï¼Œæˆ–è€…å½“å¥¹/ä»–å·²ç»å®Œæˆäº†ä¸ç»„ä»¶çš„äº¤äº’æ—¶ï¼Œæ‰æ‰§è¡Œä¿å­˜ã€‚

åŒæ ·ï¼Œæ‚¨çš„åº”ç”¨ç¨‹åºä¸­å¯èƒ½æœ‰ä¸€ä¸ªå‡½æ•°ï¼Œå®ƒå¯èƒ½ä¼šè¢«è¿ç»­è°ƒç”¨å¤šæ¬¡ï¼Œæ‚¨æ›´æ„¿æ„åªè€ƒè™‘æœ€åä¸€æ¬¡è°ƒç”¨ã€‚

è¿™å°±æ˜¯å»æŠ–å¯¹æˆ‘çš„æ„ä¹‰â€”â€”ç¡®ä¿ä¸€ä¸ªæ–¹æ³•ä¸ä¼šè¢«è°ƒç”¨å¾—å¤ªé¢‘ç¹ã€‚

# å»æŠ–æ—¶é—´

é€šå¸¸ï¼Œä¸ºäº†æ£€æµ‹å“ªäº›åŠŸèƒ½åº”è¯¥è¢«æœ‰æ•ˆåœ°è§¦å‘ï¼Œè§‚å¯Ÿè°ƒç”¨ä¹‹é—´çš„å»¶è¿Ÿã€‚ä¾‹å¦‚ï¼Œå¦‚æœæˆ‘ä»¬å¯¹ä¸€ä¸ªå‡½æ•°è¿›è¡Œå»æŠ–ï¼Œå»æŠ–æ—¶é—´ä¸º 300 æ¯«ç§’ï¼Œä¸€æ—¦è§‚å¯Ÿåˆ°ä¸¤æ¬¡è°ƒç”¨ä¹‹é—´æœ‰ 300 æ¯«ç§’æˆ–æ›´é•¿æ—¶é—´ï¼Œè¯¥å‡½æ•°å°±ä¼šè¢«è§¦å‘ã€‚

# æ™®é€š Javascript

ç›®å‰æ²¡æœ‰è·¨æµè§ˆå™¨æ”¯æŒçš„æ ‡å‡†â€œå»æŠ–åŠ¨åŠŸèƒ½â€çš„å¹³å°å®ç°(å½“ç„¶ï¼Œå¦‚æœæˆ‘é”™äº†ï¼Œè¯·çº æ­£æˆ‘ï¼).å¹¸è¿çš„æ˜¯ï¼ŒJavascript æä¾›äº†ä½¿ç”¨`setTimeout`å»¶è¿Ÿå‡½æ•°è°ƒç”¨å’Œä½¿ç”¨`clearTimeout`å–æ¶ˆå‡½æ•°è°ƒç”¨çš„èƒ½åŠ›ã€‚æˆ‘ä»¬å¯ä»¥å°†è¿™äº›ç»“åˆèµ·æ¥å®æ–½æˆ‘ä»¬è‡ªå·±çš„è§£å†³æ–¹æ¡ˆ:

```
export function debounce(func: Function, timeout?: number) {
    let timer: number | undefined; return (...args: any[]) => {
        const next = () => func(...args); if (timer) {
            clearTimeout(timer);
        } timer = setTimeout(next, timeout > 0 ? timeout : 300);
    };
}
```

åœ¨ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬çš„å‡½æ•°(æˆ‘ä»¬å®é™…ä¸Šæƒ³è¦æ‰§è¡Œçš„å‡½æ•°ï¼Œä½œä¸ºå‚æ•°`func`ä¼ é€’)å°†è¢«å»¶è¿Ÿ(`setTimeout`)ã€‚åœ¨è¿™æ ·åšä¹‹å‰ï¼Œæˆ‘ä»¬é¦–å…ˆæ£€æŸ¥å®ƒä¹‹å‰æ˜¯å¦å·²ç»è¢«è°ƒç”¨è¿‡(ä½¿ç”¨`timer`å¼•ç”¨ä¹‹å‰çš„è°ƒç”¨)ã€‚å¦‚æœä¹‹å‰å·²ç»è°ƒç”¨è¿‡ï¼Œæˆ‘ä»¬åœ¨æœ‰æ•ˆå»¶è¿Ÿæˆ‘ä»¬çš„ç›®æ ‡ä¹‹å‰å–æ¶ˆä¹‹å‰çš„è°ƒç”¨(`clearTimeout`)ã€‚

æˆ‘ä»¬å¯ä»¥ç”¨ä¸€ä¸ªç®€å•çš„æµ‹è¯•æ¥éªŒè¯è¿™ä¸ªå®ç°ã€‚æˆ‘ä»¬å¯ä»¥è°ƒç”¨ä¸€ä¸ªå‡½æ•°ï¼Œå°†ä¸€ä¸ªå­—ç¬¦ä¸²è¿ç»­å¤šæ¬¡è®°å½•åˆ°æ§åˆ¶å°ã€‚å¦‚æœä¸€åˆ‡æ­£å¸¸ï¼Œè¾“å‡ºåº”è¯¥åªå‡ºç°ä¸€æ¬¡:

```
const myFunction: Function = debounce(() => {
  console.log('Triggered only once');
});myFunction(); // Cleared
myFunction(); // Cleared
myFunction(); // Cleared
myFunction(); // Cleared
myFunction(); // Performed and will output: Triggered only once
```

å¦‚æœä½ æƒ³è§‚å¯Ÿå’Œæµ‹è¯•è¿™ä¸€ç‚¹ï¼Œè¯•è¯•è¿™ä¸ª[ç¬”](https://codepen.io/peterpeterparker/pen/WNegLNb)ã€‚

# RxJS

ä¸Šè¿°ä½¿ç”¨æ™®é€š Javascript çš„è§£å†³æ–¹æ¡ˆå¾ˆé…·ï¼Œä½†æ˜¯ä½¿ç”¨[RxJS](https://rxjs-dev.firebaseapp.com)(Javascript çš„ååº”å¼æ‰©å±•åº“)è¾¾åˆ°åŒæ ·çš„ç»“æœæ€ä¹ˆæ ·å‘¢ï¼Ÿé‚£ä¼šå¾ˆå·§å¦™ï¼Œä¸æ˜¯å—ï¼Ÿå¹¸è¿çš„æ˜¯ï¼ŒRxJS æä¾›äº†ä¸€ä¸ªå¼€ç®±å³ç”¨çš„è§£å†³æ–¹æ¡ˆï¼Œä½¿ç”¨å¯è§‚æµ‹é‡è½»æ¾å®ç°å»æŠ–åŠŸèƒ½ã€‚æ­¤å¤–ï¼Œè¿™ä¸ªè§£å†³æ–¹æ¡ˆæ›´ç®€æ´ï¼Œå¯è¯»æ€§æ›´å¥½ã€‚

æˆ‘ä»¬è¦ç”¨çš„ RxJS å‡½æ•°æ˜¯`[debounceTime](https://rxjs-dev.firebaseapp.com/api/operators/debounceTime)`ã€‚å¦‚æ–‡æ¡£ä¸­æ‰€è§£é‡Šçš„ï¼Œå®ƒå»¶è¿Ÿç”±æºå¯è§‚æµ‹å€¼å‘å‡ºçš„å€¼ï¼Œä½†æ˜¯å¦‚æœæ–°çš„å€¼åˆ°è¾¾æºå¯è§‚æµ‹å€¼ï¼Œåˆ™ä¸¢å¼ƒå…ˆå‰æœªå†³çš„å»¶è¿Ÿå‘å°„ã€‚ä¸ºäº†é‡ç°ä¸Šé¢çš„ä¾‹å­å¹¶åˆ›å»ºä¸€ä¸ªå¯è§‚å¯Ÿçš„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ª`Subject`å¹¶è¿ç»­å¤šæ¬¡è§¦å‘`next()`ã€‚å¦‚æœä¸€åˆ‡éƒ½æŒ‰è®¡åˆ’è¿›è¡Œï¼Œæˆ‘ä»¬åº”è¯¥åœ¨æ§åˆ¶å°ä¸­åªçœ‹åˆ°ä¸€ä¸ªè¾“å‡ºã€‚

```
const mySubject: Subject<void> = new Subject();subject.pipe(debounceTime(300)).subscribe(() => {
  console.log('Triggered only once');
});mySubject.next(); // Cleared
mySubject.next(); // Cleared
mySubject.next(); // Cleared
mySubject.next(); // Cleared
mySubject.next(); // Performed and will output: Triggered only once
```

å°±æ˜¯è¿™æ ·ã€‚ä¸ç”¨å†™è‡ªå®šä¹‰å‡½æ•°ï¼ŒRxJS åªæ˜¯ä¸ºæˆ‘ä»¬è§£å†³äº†å»æŠ–ã€‚

å¦‚æœä½ ä¹Ÿæƒ³åœ¨è¡ŒåŠ¨ä¸­å°è¯•ä¸€ä¸‹ï¼Œçœ‹çœ‹å¦ä¸€ä¸ª [Codepen](https://codepen.io/peterpeterparker/pen/ZEzqXPw) ã€‚

*æ³¨æ„:åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œä¸ºäº†ç®€å•èµ·è§ï¼Œæˆ‘æ²¡æœ‰è€ƒè™‘å–æ¶ˆè®¢é˜…å¯è§‚å¯Ÿå¯¹è±¡ã€‚æ˜¾ç„¶ï¼Œå¦‚æœæ‚¨æƒ³åœ¨å®é™…åº”ç”¨ä¸­ä½¿ç”¨è¿™ç§è§£å†³æ–¹æ¡ˆï¼Œè¯·å°å¿ƒè°¨æ…ã€‚*

# è›‹ç³•ä¸Šçš„æ¨±æ¡ƒğŸ’ğŸ‚

åœ¨æˆ‘ä»¬çš„å¼€æºé¡¹ç›® [DeckDeckGo](https://deckdeckgo.com) ä¸­ï¼Œæˆ‘ä»¬åœ¨æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå’Œç»„ä»¶ä¸­ä½¿ç”¨äº†ä¸€ä¸ªåä¸º`deckdeckgo/utils`çš„å° utils åŒ…(å‘å¸ƒç»™ [npm](https://www.npmjs.com/package/@deckdeckgo/utils) )ï¼Œå®ƒæä¾›äº†å„ç§å®ç”¨ç¨‹åºï¼Œå…¶ä¸­ä¸€ä¸ªæ˜¯æ™®é€šçš„ Javascript `debounce`å‡½æ•°ã€‚å› æ­¤ï¼Œå¦‚æœæ‚¨éœ€è¦ä¸€ä¸ªå¿«é€Ÿå’Œè‚®è„çš„è§£å†³æ–¹æ¡ˆï¼Œè¯·æˆä¸ºæˆ‘ä»¬çš„å®¢äººï¼Œå¹¶å°è¯•ä¸€ä¸‹ï¼

 [## deckgo/deckdeckgo

### åœ¨ DeckDeckGo çš„åº”ç”¨ç¨‹åºå’Œç»„ä»¶ä¸­å¼€å‘å’Œä½¿ç”¨çš„ utils æ–¹æ³•å’Œå‡½æ•°çš„é›†åˆã€‚å¦‚æœä½ æ„¿æ„â€¦

github.com](https://github.com/deckgo/deckdeckgo/tree/master/webcomponents/utils) 

åˆ°æ— é™å’Œæ›´è¿œğŸš€

å¤§å«