<html>
<head>
<title>k0s: Kubernetes in a Single Binary</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">k0s:å•ä¸ªäºŒè¿›åˆ¶ä¸­çš„Kubernetes</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/k0s-kubernetes-in-a-single-binary-224bb43f4520?source=collection_archive---------7-----------------------#2020-12-07">https://betterprogramming.pub/k0s-kubernetes-in-a-single-binary-224bb43f4520?source=collection_archive---------7-----------------------#2020-12-07</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="1bc6" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">è¿™ç§æ–°çš„Kubernetesåˆ†å¸ƒçš„åˆæ­¥ç ”ç©¶</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/2216ca0fb33de312157cbcfcb1c79070.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/0*TIVX-JBq7-H9oNxh"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">å®‰å¦®Â·æ–¯æ™®æ‹‰ç‰¹åœ¨<a class="ae ky" href="https://unsplash.com?utm_source=medium&amp;utm_medium=referral" rel="noopener ugc nofollow" target="_blank"> Unsplash </a>ä¸Šçš„ç…§ç‰‡</p></figure><p id="17e6" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ğŸ”¥æ›´æ–°:è‡ªä»æ’°å†™æœ¬æ–‡ä»¥æ¥ï¼Œk0så·²ç»å¢åŠ äº†è®¸å¤šé™„åŠ ç‰¹æ€§ã€‚è¯·æŸ¥çœ‹<a class="ae ky" href="https://itnext.io/k0s-multi-node-cluster-with-k0sctl-922fc2cb4dc8" rel="noopener ugc nofollow" target="_blank">è¿™ç¯‡æ–°æ–‡ç« </a>ï¼Œå®ƒè¯¦ç»†ä»‹ç»äº†å•èŠ‚ç‚¹æˆ–å¤šèŠ‚ç‚¹k0sé›†ç¾¤çš„ç®€å•è®¾ç½®ã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><p id="661c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å‡ å¤©å‰ï¼Œä¸€ä¸ªæœ‹å‹å‘Šè¯‰æˆ‘å…³äº<a class="mc md ep" href="https://medium.com/u/fedcaa2e9074?source=post_page-----224bb43f4520--------------------------------" rel="noopener" target="_blank"> Mirantis </a>åä¸º<a class="ae ky" href="https://k0sproject.io" rel="noopener ugc nofollow" target="_blank"> k0s </a>çš„æ–°Kuberneteså‘è¡Œç‰ˆã€‚æˆ‘ä»¬éƒ½çŸ¥é“å¹¶çƒ­çˆ±K8sï¼Œå¯¹å§ï¼Ÿæˆ‘ä»¬ä¹Ÿå±ˆæœäº<a class="ae ky" href="https://k3s.io" rel="noopener ugc nofollow" target="_blank"> K3s </a>ï¼Œè¿™æ˜¯ç”±<a class="mc md ep" href="https://medium.com/u/bd97d20d9140?source=post_page-----224bb43f4520--------------------------------" rel="noopener" target="_blank"> Rancher Labs </a>åˆ¶é€ çš„è½»å‹Kubernetesï¼Œä¸ä¹…å‰æèµ ç»™äº†<a class="ae ky" href="https://cncf.io" rel="noopener ugc nofollow" target="_blank"> CNCF </a>ã€‚ç°åœ¨æ˜¯æ—¶å€™å‘ç°ä¸€ä¸ªæ–°çš„åˆ†å¸ƒ:<a class="ae ky" href="https://k0sproject.io" rel="noopener ugc nofollow" target="_blank"> k0s </a>ã€‚</p><p id="c268" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç®€è¦ä»‹ç»k0sä¹‹åï¼Œæˆ‘ä»¬å°†æŒ‰ç…§ä»¥ä¸‹æ­¥éª¤è®¾ç½®ä¸€ä¸ªä¸‰èŠ‚ç‚¹é›†ç¾¤:</p><ul class=""><li id="8f70" class="me mf it lb b lc ld lf lg li mg lm mh lq mi lu mj mk ml mm bi translated">é…ç½®ä¸‰å°è™šæ‹Ÿæœº(<a class="ae ky" href="https://multipass.run" rel="noopener ugc nofollow" target="_blank">å¤šè·¯</a>è¿è¡Œä¸­)</li><li id="7566" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">åœ¨æ¯ä¸ªæœåŠ¡å™¨ä¸Šå®‰è£…k0s</li><li id="725a" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">è®¾ç½®ç®€å•çš„k0sé›†ç¾¤é…ç½®æ–‡ä»¶</li><li id="d796" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">æ­£åœ¨åˆå§‹åŒ–é›†ç¾¤</li><li id="4f54" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">è®¿é—®é›†ç¾¤</li><li id="34ae" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">æ·»åŠ å·¥ä½œèŠ‚ç‚¹</li><li id="6607" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">æ·»åŠ ç”¨æˆ·</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="485d" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">k0sæ˜¯ä»€ä¹ˆï¼Ÿ</h1><p id="40ee" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">k0sæ˜¯ä¸€ä¸ªå…¨æ–°çš„Kuberneteså‘è¡Œç‰ˆã€‚å½“å‰ç‰ˆæœ¬æ˜¯0.8.0ã€‚2020å¹´12æœˆå‡ºç‰ˆï¼›æ•´ä¸ªé¡¹ç›®çš„ç¬¬ä¸€æ¬¡æäº¤æ˜¯åœ¨2020å¹´6æœˆã€‚</p><p id="9391" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">k0sä½œä¸ºå•ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æä¾›ï¼Œä¸ä¾èµ–äºä»»ä½•æ“ä½œç³»ç»Ÿã€‚å› æ­¤ï¼Œå®ƒè¢«å®šä¹‰ä¸ºé›¶æ‘©æ“¦/é›¶æ·±åº¦/é›¶æˆæœ¬åº“ä¼¯å†…ç‰¹åˆ†å¸ƒã€‚</p><p id="1241" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æœ€æ–°k0sç‰ˆæœ¬:</p><ul class=""><li id="84a0" class="me mf it lb b lc ld lf lg li mg lm mh lq mi lu mj mk ml mm bi translated">æä¾›ç»è¿‡è®¤è¯çš„(CISåŸºå‡†)Kubernetes 1.19</li><li id="f798" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">ä½¿ç”¨<a class="ae ky" href="https://containerd.io" rel="noopener ugc nofollow" target="_blank">å®¹å™¨id</a>ä½œä¸ºé»˜è®¤çš„å®¹å™¨è¿è¡Œæ—¶</li><li id="7373" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">æ”¯æŒè‹±ç‰¹å°”(x86-64)å’ŒARM (ARM64)æ¶æ„</li><li id="b1c4" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">ä½¿ç”¨é›†ç¾¤å†…<a class="ae ky" href="https://etcd.io" rel="noopener ugc nofollow" target="_blank"> etcd </a></li><li id="3b91" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">é»˜è®¤æƒ…å†µä¸‹ä½¿ç”¨<a class="ae ky" href="https://www.projectcalico.org/" rel="noopener ugc nofollow" target="_blank"> Calico </a>ç½‘ç»œæ’ä»¶(ä»è€Œå¯ç”¨ç½‘ç»œç­–ç•¥)</li><li id="fcfb" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">å¯ç”¨Podå®‰å…¨ç­–ç•¥å‡†å…¥æ§åˆ¶å™¨</li><li id="f668" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">ä½¿ç”¨å¸¦æœ‰<a class="ae ky" href="https://coredns.io" rel="noopener ugc nofollow" target="_blank">æ ¸å¿ƒDNS </a>çš„DNS</li><li id="ac9b" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">é€šè¿‡<a class="ae ky" href="https://github.com/kubernetes-sigs/metrics-server" rel="noopener ugc nofollow" target="_blank">æŒ‡æ ‡æœåŠ¡å™¨</a>å…¬å¼€é›†ç¾¤æŒ‡æ ‡</li><li id="054b" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">å…è®¸ä½¿ç”¨æ°´å¹³çª—æ ¼è‡ªåŠ¨ç¼©æ”¾(HPA)</li></ul><p id="efae" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æœªæ¥çš„ç‰ˆæœ¬ä¸­å°†ä¼šæ¨å‡ºè®¸å¤šå‡ºè‰²çš„åŠŸèƒ½ï¼Œå…¶ä¸­åŒ…æ‹¬:</p><ul class=""><li id="f3d9" class="me mf it lb b lc ld lf lg li mg lm mh lq mi lu mj mk ml mm bi translated">å¾®è™šæ‹Ÿæœºè¿è¡Œæ—¶(çœŸçš„å¾ˆæœŸå¾…æµ‹è¯•è¿™ä¸ª)</li><li id="50a4" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">é›¶åœæœºé›†ç¾¤å‡çº§</li><li id="f17d" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">é›†ç¾¤å¤‡ä»½å’Œæ¢å¤</li></ul><p id="42d0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¾ˆæ¼‚äº®ï¼Œå¯¹å§ï¼Ÿæˆ‘ä»¬ç°åœ¨å°†çœ‹åˆ°å¦‚ä½•ä½¿ç”¨k0sæ¥éƒ¨ç½²ä¸€ä¸ªä¸‰èŠ‚ç‚¹é›†ç¾¤ã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="87ac" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">è°ƒé…è™šæ‹Ÿæœº</h1><p id="c44b" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸‰ä¸ªè™šæ‹Ÿæœºï¼›æ¯ä¸ªéƒ½å°†æ˜¯æˆ‘ä»¬é›†ç¾¤ä¸­çš„ä¸€ä¸ªèŠ‚ç‚¹ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†é€‰æ‹©å¿«é€Ÿç®€å•çš„æ–¹æ³•ï¼Œä½¿ç”¨å¼ºå¤§çš„<a class="ae ky" href="https://multipass.run" rel="noopener ugc nofollow" target="_blank"> Multipass </a>(éå¸¸å–œæ¬¢è¿™ä¸ªå·¥å…·)åœ¨MacOSä¸Šé…ç½®æœ¬åœ°è™šæ‹Ÿæœºã€‚</p><p id="5885" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä»¥ä¸‹å‘½ä»¤åœ¨xhyveä¸Šåˆ›å»ºäº†ä¸‰ä¸ªUbuntuå®ä¾‹ã€‚æ¯ä¸ªè™šæ‹Ÿæœºæœ‰5 GBç£ç›˜ã€2 GBå†…å­˜å’Œ2ä¸ªè™šæ‹ŸCPU:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="12f1" class="nu mt it nq b gy nv nw l nx ny">for i in 1 2 3; do <br/>  multipass launch -n node$i -c 2 -m 2G<br/>done</span></pre><p id="cdfd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åï¼Œæˆ‘ä»¬å¯ä»¥åˆ—å‡ºè™šæ‹Ÿæœºï¼Œä»¥ç¡®ä¿å®ƒä»¬éƒ½è¿è¡Œè‰¯å¥½:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="b4ad" class="nu mt it nq b gy nv nw l nx ny"><strong class="nq iu">$ multipass list</strong><br/>Name      State       IPv4             Image<br/>node1     Running     192.168.64.11    Ubuntu 20.04 LTS<br/>node2     Running     192.168.64.12    Ubuntu 20.04 LTS<br/>node3     Running     192.168.64.13    Ubuntu 20.04 LTS</span></pre><p id="b753" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨ä¸‹é¢ï¼Œæˆ‘ä»¬å°†åœ¨æ¯ä¸ªèŠ‚ç‚¹ä¸Šå®‰è£…k0sã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a5bd" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">è·å–æœ€æ–°çš„k0sç‰ˆæœ¬</h1><p id="3bb5" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">æœ€æ–°çš„k0sç‰ˆæœ¬å¯ä»¥ä»<a class="ae ky" href="https://github.com/k0sproject/k0s/releases/" rel="noopener ugc nofollow" target="_blank"> GitHubåº“</a>ä¸‹è½½ã€‚</p><p id="a33e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿˜æœ‰ä¸€ä¸ªæ–¹ä¾¿çš„å®‰è£…è„šæœ¬:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="5eb6" class="nu mt it nq b gy nv nw l nx ny">curl -sSLf get.k0s.sh | sudo sh</span></pre><p id="7944" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬ä½¿ç”¨å®ƒåœ¨æ‰€æœ‰èŠ‚ç‚¹ä¸Šå®‰è£…k0s:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="7a46" class="nu mt it nq b gy nv nw l nx ny">for i in 1 2 3; do<!-- --> <br/>  multipass exec node$i -- bash -c "<!-- -->curl -sSLf get.k0s.sh | sudo sh"<br/>done</span></pre><p id="3b08" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿™ä¸ªè„šæœ¬åœ¨<code class="fe nz oa ob nq b">/usr/bin/k0s</code>ä¸­å®‰è£…k0sã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸å¸¦ä»»ä½•å‚æ•°åœ°è¿è¡ŒäºŒè¿›åˆ¶æ–‡ä»¶æ¥è·å¾—æ‰€æœ‰å¯ç”¨çš„å‘½ä»¤ã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oc"><img src="../Images/4a8c8fe97146ee0ff253294ce35bacc5.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*jp3MRxk1-ldH7v6IeAZDDg.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">k0så¯ç”¨å‘½ä»¤</p></figure><p id="bfb9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬å¯ä»¥æŸ¥çœ‹å½“å‰ç‰ˆæœ¬:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="e8fe" class="nu mt it nq b gy nv nw l nx ny">$ k0s version<br/>v0.8.0</span></pre><p id="0a40" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬å°†åœ¨ä¸‹é¢çš„æ­¥éª¤ä¸­ä½¿ç”¨å…¶ä¸­çš„ä¸€äº›å‘½ä»¤ã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="526d" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">åˆ›å»ºé…ç½®æ–‡ä»¶</h1><p id="090a" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬å¿…é¡»å®šä¹‰ä¸€ä¸ªåŒ…å«k0såˆ›å»ºé›†ç¾¤æ‰€éœ€ä¿¡æ¯çš„é…ç½®æ–‡ä»¶ã€‚ä»<code class="fe nz oa ob nq b">node1</code>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code class="fe nz oa ob nq b">default-config </code>å‘½ä»¤æ¥è·å¾—å®Œæ•´çš„é»˜è®¤é…ç½®ã€‚</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="e1d0" class="nu mt it nq b gy nv nw l nx ny"><strong class="nq iu">ubuntu@node1:~$ k0s default-config<br/></strong>apiVersion: k0s.k0sproject.io/v1beta1<br/>kind: Cluster<br/>metadata:<br/>  name: k0s<br/>spec:<br/>  api:<br/>    address: 192.168.64.11<br/>    sans:<br/>    - 192.168.64.11<br/>    - 192.168.64.11<br/>    extraArgs: {}<br/>  controllerManager:<br/>    extraArgs: {}<br/>  scheduler:<br/>    extraArgs: {}<br/>  storage:<br/>    type: etcd<br/>    kine: null<br/>    etcd:<br/>      peerAddress: 192.168.64.11<br/>  network:<br/>    podCIDR: 10.244.0.0/16<br/>    serviceCIDR: 10.96.0.0/12<br/>    provider: calico<br/>    calico:<br/>      mode: vxlan<br/>      vxlanPort: 4789<br/>      vxlanVNI: 4096<br/>      mtu: 1450<br/>      wireguard: false<br/>  podSecurityPolicy:<br/>    defaultPolicy: 00-k0s-privileged<br/>  workerProfiles: []<br/>extensions: null<br/>images:<br/>  konnectivity:<br/>    image: us.gcr.io/k8s-artifacts-prod/kas-network-proxy/proxy-agent<br/>    version: v0.0.13<br/>  metricsserver:<br/>    image: gcr.io/k8s-staging-metrics-server/metrics-server<br/>    version: v0.3.7<br/>  kubeproxy:<br/>    image: k8s.gcr.io/kube-proxy<br/>    version: v1.19.4<br/>  coredns:<br/>    image: docker.io/coredns/coredns<br/>    version: 1.7.0<br/>  calico:<br/>    cni:<br/>      image: calico/cni<br/>      version: v3.16.2<br/>    flexvolume:<br/>      image: calico/pod2daemon-flexvol<br/>      version: v3.16.2<br/>    node:<br/>      image: calico/node<br/>      version: v3.16.2<br/>    kubecontrollers:<br/>      image: calico/kube-controllers<br/>      version: v3.16.2<br/>  repository: ""<br/>telemetry:<br/>  interval: 10m0s<br/>  enabled: true</span></pre><p id="e4a1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å®ƒå…è®¸æˆ‘ä»¬å®šä¹‰ï¼Œé™¤äº†åˆ«çš„ä»¥å¤–:</p><ul class=""><li id="4a7e" class="me mf it lb b lc ld lf lg li mg lm mh lq mi lu mj mk ml mm bi translated">APIæœåŠ¡å™¨ã€æ§åˆ¶å™¨ç®¡ç†å™¨å’Œè°ƒåº¦ç¨‹åºçš„å¯åŠ¨é€‰é¡¹</li><li id="ca8f" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">å¯ç”¨äºä¿å­˜é›†ç¾¤ä¿¡æ¯çš„å­˜å‚¨å™¨(<a class="ae ky" href="https://etcd.io" rel="noopener ugc nofollow" target="_blank"> etcd </a>)</li><li id="33e4" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">ç½‘ç»œæ’ä»¶åŠå…¶é…ç½®(<a class="ae ky" href="https://www.projectcalico.org/" rel="noopener ugc nofollow" target="_blank"> Calico </a>)</li><li id="beea" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">æ§åˆ¶å¹³é¢ç»„ä»¶çš„å®¹å™¨å›¾åƒçš„ç‰ˆæœ¬</li><li id="c3a8" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated">å¯åŠ¨é›†ç¾¤æ—¶åº”è¯¥éƒ¨ç½²çš„ä¸€äº›é™„åŠ èˆµå›¾</li></ul><p id="9c66" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬å¯ä»¥å°†è¿™ä¸ªé…ç½®ä¿å­˜åˆ°ä¸€ä¸ªæ–‡ä»¶ä¸­ï¼Œå¹¶æ ¹æ®æˆ‘ä»¬çš„éœ€è¦è¿›è¡Œä¿®æ”¹ã€‚åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ä¸€ä¸ªéå¸¸ç®€å•çš„é…ç½®ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨<code class="fe nz oa ob nq b">/etc/k0s/k0s.yaml</code> <em class="od">ä¸­ã€‚</em></p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="2183" class="nu mt it nq b gy nv nw l nx ny">apiVersion: k0s.k0sproject.io/v1beta1<br/>kind: Cluster<br/>metadata:<br/>  name: k0s<br/>spec:<br/>  api:<br/>    address: 192.168.64.11<br/>    sans:<br/>    - 192.168.64.11<br/>  network:<br/>    podCIDR: 10.244.0.0/16<br/>    serviceCIDR: 10.96.0.0/12</span></pre><p id="e17b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">æ³¨æ„:</strong>å› ä¸ºæˆ‘ä»¬å°†åœ¨<code class="fe nz oa ob nq b">node1</code>åˆå§‹åŒ–é›†ç¾¤ï¼Œè¿™ä¸ªèŠ‚ç‚¹å°†æ˜¯æœåŠ¡äºAPIæœåŠ¡å™¨çš„èŠ‚ç‚¹ã€‚è¯¥èŠ‚ç‚¹çš„IPåœ°å€ç”¨äºä¸Šè¿°é…ç½®æ–‡ä»¶ä¸­çš„<code class="fe nz oa ob nq b">api.address</code>å’Œ<code class="fe nz oa ob nq b">api.sans</code> <em class="od"> </em>(ä¸»é¢˜åˆ«å)ã€‚å¦‚æœæˆ‘ä»¬æœ‰é¢å¤–çš„ä¸»èŠ‚ç‚¹å’Œä¸€ä¸ªè´Ÿè½½å¹³è¡¡å™¨ï¼Œæˆ‘ä»¬å°†åœ¨<code class="fe nz oa ob nq b">api.sans</code>è®¾ç½®ä¸­ä½¿ç”¨æ¯ä¸ªèŠ‚ç‚¹çš„IPåœ°å€å’Œä¸€ä¸ªè´Ÿè½½å¹³è¡¡å™¨(æˆ–ç›¸å…³çš„åŸŸå)ã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="b4f2" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">é›†ç¾¤çš„åˆå§‹åŒ–</h1><p id="a10f" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">é¦–å…ˆï¼Œåœ¨<code class="fe nz oa ob nq b">node1</code>ä¸Šï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªsystemd <code class="fe nz oa ob nq b">Unit</code>æ–‡ä»¶æ¥ç®¡ç†k0sã€‚</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="9048" class="nu mt it nq b gy nv nw l nx ny">[Unit]<br/>Description="k0s server"<br/>After=network-online.target<br/>Wants=network-online.target<br/> <br/>[Service]<br/>Type=simple<br/>ExecStart=/usr/bin/k0s server -c /etc/k0s/k0s.yaml --enable-worker<br/>Restart=always</span></pre><p id="6627" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿™é‡Œçš„ä¸»å‘½ä»¤æ˜¯åœ¨<code class="fe nz oa ob nq b">ExecStart</code>ä¸­æŒ‡å®šçš„å‘½ä»¤ï¼›å®ƒè¿è¡Œk0sæœåŠ¡å™¨ï¼Œæä¾›æˆ‘ä»¬åœ¨ä¸Šä¸€æ­¥ä¸­åˆ›å»ºçš„é…ç½®æ–‡ä»¶ã€‚æˆ‘ä»¬è¿˜æŒ‡å®šäº†<code class="fe nz oa ob nq b">--enable-worker</code>é€‰é¡¹ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªä¸»èŠ‚ç‚¹ä¹Ÿä½œä¸ºä¸€ä¸ªå·¥ä½œèŠ‚ç‚¹ã€‚</p><p id="6c49" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°†è¿™ä¸ªæ–‡ä»¶å¤åˆ¶åˆ°<code class="fe nz oa ob nq b">/lib/systemd/system/k0s.service</code>ï¼Œé‡æ–°åŠ è½½systemdï¼Œå¹¶å¯åŠ¨æˆ‘ä»¬æ–°åˆ›å»ºçš„æœåŠ¡</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="cf4c" class="nu mt it nq b gy nv nw l nx ny">ubuntu@node1:~$ sudo systemctl daemon-reload</span><span id="a4aa" class="nu mt it nq b gy oe nw l nx ny">ubuntu@node1:~$ sudo systemctl start k0s.service</span></pre><p id="59b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å‡ºäºå¥½å¥‡ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥k0sæœåŠ¡å™¨å¯åŠ¨çš„è¿›ç¨‹:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="04c1" class="nu mt it nq b gy nv nw l nx ny"><strong class="nq iu">ubuntu@node1:~$ sudo ps aux | awk â€˜{print $11}â€™ | grep k0s<br/></strong>/usr/bin/k0s<br/>/var/lib/k0s/bin/etcd<br/>/var/lib/k0s/bin/konnectivity-server<br/>/var/lib/k0s/bin/kube-controller-manager<br/>/var/lib/k0s/bin/kube-scheduler<br/>/var/lib/k0s/bin/kube-apiserver<br/>/var/lib/k0s/bin/containerd<br/>/var/lib/k0s/bin/kubelet</span></pre><p id="eec7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä»ä¸Šé¢çš„è¾“å‡ºä¸­ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰ä¸»ç»„ä»¶éƒ½åœ¨è¿è¡Œ(<code class="fe nz oa ob nq b">kube-apiserver</code>ã€<code class="fe nz oa ob nq b">kube-controller-manager</code>ã€<code class="fe nz oa ob nq b">kube-scheduler</code>ç­‰)ã€‚)ä»¥åŠå¸ˆå‚…å’Œå·¥äººé€šç”¨çš„éƒ¨ä»¶(<code class="fe nz oa ob nq b">containerd</code>ã€<code class="fe nz oa ob nq b">kubelet</code>)ã€‚k0sè´Ÿè´£ç®¡ç†å…¨éƒ¨ã€‚</p><p id="4afc" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬ç°åœ¨æœ‰äº†ä¸€ä¸ªå•èŠ‚ç‚¹é›†ç¾¤ã€‚åœ¨ä¸‹ä¸€æ­¥ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°å¦‚ä½•è®¿é—®å®ƒã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a84a" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">è®¿é—®é›†ç¾¤</h1><p id="bf11" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦è·å¾—é›†ç¾¤åˆ›å»ºæœŸé—´ç”Ÿæˆçš„<code class="fe nz oa ob nq b">kubeconfig</code>æ–‡ä»¶ï¼›é‚£ä¸ªæ˜¯åœ¨<code class="fe nz oa ob nq b">/var/lib/k0s/pki/admin.conf</code>çš„<code class="fe nz oa ob nq b">node1</code>ä¸Šåˆ›å»ºçš„ã€‚æˆ‘ä»¬éœ€è¦ä½¿ç”¨è¯¥æ–‡ä»¶åœ¨æ‚¨çš„æœ¬åœ°æœºå™¨ä¸Šé…ç½®<a class="ae ky" href="https://kubernetes.io/docs/tasks/tools/install-kubectl/" rel="noopener ugc nofollow" target="_blank"> kubectl </a>ã€‚</p><p id="6209" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬ä»<code class="fe nz oa ob nq b">node1</code>ä¸­è·å¾—é›†ç¾¤çš„<code class="fe nz oa ob nq b">kubeconfig</code>:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="eeb0" class="nu mt it nq b gy nv nw l nx ny"># Get kubeconfig file<br/>$ multipass exec node1 cat /var/lib/k0s/pki/admin.conf &gt; k0s.cfg</span></pre><p id="e182" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬ç”¨<code class="fe nz oa ob nq b">node1</code>çš„å¤–éƒ¨IPåœ°å€æ›¿æ¢å†…éƒ¨IPåœ°å€:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="cff1" class="nu mt it nq b gy nv nw l nx ny"># Replace IP address<br/>$ NODE1_IP=$(multipass info node1 | grep IP | awk '{print $2}')<br/>sed -i '' "s/localhost/$NODE1_IP/" k0s.cfg</span></pre><p id="b98f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åï¼Œæˆ‘ä»¬é…ç½®æœ¬åœ°kubectlå®¢æˆ·æœºä¸k0s APIæœåŠ¡å™¨é€šä¿¡:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="9aa1" class="nu mt it nq b gy nv nw l nx ny">export KUBECONFIG=$PWD/k0s.cfg</span></pre><p id="087f" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬åœ¨è®¿é—®æ–°é›†ç¾¤æ—¶è¿è¡Œçš„ç¬¬ä¸€ä¸ªå‘½ä»¤å¯èƒ½æ˜¯åˆ—å‡ºæ‰€æœ‰å¯ç”¨èŠ‚ç‚¹çš„å‘½ä»¤ï¼Œè®©æˆ‘ä»¬è¯•è¯•:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="60a1" class="nu mt it nq b gy nv nw l nx ny"><strong class="nq iu">$ kubectl get no</strong><br/>NAME    STATUS   ROLES    AGE   VERSION<br/>node1   Ready    &lt;none&gt;   78s   v1.19.4</span></pre><p id="cc81" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿™å¹¶ä¸å¥‡æ€ªã€‚<code class="fe nz oa ob nq b">node1</code>æ˜¯æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªé›†ç¾¤çš„ä¸»èŠ‚ç‚¹ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬åœ¨å¯åŠ¨å‘½ä»¤ä¸­æŒ‡å®šçš„<em class="od"> </em> <code class="fe nz oa ob nq b">--enable-worker</code>æ ‡å¿—ï¼Œå®ƒä¹Ÿæ˜¯ä¸€ä¸ªå·¥ä½œè€…èŠ‚ç‚¹ã€‚å¦‚æœæ²¡æœ‰é‚£ä¸ªæ ‡å¿—ï¼Œ<code class="fe nz oa ob nq b">node1</code>å°†åªæ˜¯ä¸€ä¸ªå·¥äººï¼Œä¸ä¼šå‡ºç°åœ¨è¿™é‡Œçš„èŠ‚ç‚¹åˆ—è¡¨ä¸­ã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="61fd" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">æ·»åŠ å·¥ä½œèŠ‚ç‚¹</h1><p id="9f01" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">ä¸ºäº†å°†<code class="fe nz oa ob nq b">node2</code>å’Œ<code class="fe nz oa ob nq b">node3</code>æ·»åŠ åˆ°æˆ‘ä»¬çš„é›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆéœ€è¦ä»<code class="fe nz oa ob nq b">node1</code>åˆ›å»ºä¸€ä¸ªjoinä»¤ç‰Œ(è¿™ä¸€æ­¥å¾ˆå¸¸è§ï¼Œå› ä¸ºå®ƒç”¨åœ¨ç”¨kubeadmåˆ›å»ºçš„Docker Swarmå’ŒKubernetesé›†ç¾¤ä¸­)ã€‚</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="9e5f" class="nu mt it nq b gy nv nw l nx ny">$ TOKEN=$(k0s token create --role=worker)</span></pre><p id="138d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸Šé¢çš„å‘½ä»¤ç”Ÿæˆä¸€ä¸ªé•¿(éå¸¸é•¿)çš„ä»¤ç‰Œã€‚ä½¿ç”¨å®ƒï¼Œæˆ‘ä»¬å¯ä»¥å°†<code class="fe nz oa ob nq b">node2</code>å’Œ<code class="fe nz oa ob nq b">node3</code>åŠ å…¥æˆ‘ä»¬çš„é›†ç¾¤:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="ad9d" class="nu mt it nq b gy nv nw l nx ny">ubuntu@node2:~$ k0s worker $TOKEN</span><span id="9102" class="nu mt it nq b gy oe nw l nx ny">ubuntu@node3:~$ k0s worker $TOKEN</span></pre><p id="49a4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">æ³¨æ„:</strong>åœ¨ä¸€ä¸ªçœŸå®çš„é›†ç¾¤ä¸­ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨systemd(æˆ–å¦ä¸€ä¸ªsupervisor)æ¥ç®¡ç†å·¥ä½œèŠ‚ç‚¹çš„k0sè¿›ç¨‹ï¼Œå°±åƒæˆ‘ä»¬å¯¹ä¸»èŠ‚ç‚¹æ‰€åšçš„é‚£æ ·ã€‚</p><p id="06f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬çš„ä¸‰èŠ‚ç‚¹é›†ç¾¤ç°åœ¨å·²ç»å¯åŠ¨å¹¶è¿è¡Œï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å†æ¬¡åˆ—å‡ºèŠ‚ç‚¹æ¥çœ‹åˆ°è¿™ä¸€ç‚¹:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="4321" class="nu mt it nq b gy nv nw l nx ny"><strong class="nq iu">$ kubectl get no<br/></strong>NAME    STATUS  ROLES    AGE   VERSION<br/>node1   Ready   &lt;none&gt;   30m   v1.19.4<br/>node2   Ready   &lt;none&gt;   35s   v1.19.4<br/>node3   Ready   &lt;none&gt;   32s   v1.19.4</span></pre><p id="dcb8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æˆ‘ä»¬è¿˜å¯ä»¥æ£€æŸ¥è·¨æ‰€æœ‰åç§°ç©ºé—´è¿è¡Œçš„pod:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi of"><img src="../Images/19f4e3b9ce7a9ff1a2aea2a2ffa04c21.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*X1V0hLmoT_zcGe-3OS1UtQ.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">è·¨æ‰€æœ‰å‘½åç©ºé—´åœ¨é›†ç¾¤ä¸­è¿è¡Œçš„podåˆ—è¡¨</p></figure><p id="c315" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿™é‡Œéœ€è¦æ³¨æ„ä¸€äº›äº‹æƒ…:</p><ul class=""><li id="49f6" class="me mf it lb b lc ld lf lg li mg lm mh lq mi lu mj mk ml mm bi translated">åƒå¾€å¸¸ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°<code class="fe nz oa ob nq b">kube-proxy</code>è±†èšï¼Œç½‘ç»œæ’ä»¶(åŸºäºCalico)ï¼Œä»¥åŠä¸€ä¸ªæ ¸å¿ƒåŸŸåè±†èš</li><li id="c048" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated"><code class="fe nz oa ob nq b">api-server</code>ã€<code class="fe nz oa ob nq b">scheduler</code>å’Œ<code class="fe nz oa ob nq b">controller-manager</code>çª—æ ¼æ²¡æœ‰å‡ºç°åœ¨æ­¤åˆ—è¡¨ä¸­ï¼Œå› ä¸ºå®ƒä»¬ä½œä¸ºå¸¸è§„è¿›ç¨‹è¿è¡Œï¼Œä¸åœ¨çª—æ ¼å†…</li></ul></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a4f2" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">æ·»åŠ ç”¨æˆ·</h1><p id="fc05" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">k0s 0 . 8 . 0ç‰ˆæœ¬å¸¦æ¥äº†<code class="fe nz oa ob nq b">user</code>å­å‘½ä»¤ã€‚å®ƒå…è®¸æˆ‘ä»¬ä¸ºé¢å¤–çš„ç”¨æˆ·/ç»„åˆ›å»ºä¸€ä¸ª<code class="fe nz oa ob nq b">kubeconfig</code>ã€‚ä¾‹å¦‚ï¼Œä¸‹é¢çš„å‘½ä»¤åˆ›å»ºåä¸º<code class="fe nz oa ob nq b">demo</code>çš„æ–°ç”¨æˆ·çš„<code class="fe nz oa ob nq b">kubeconfig</code>æ–‡ä»¶ï¼Œè¯¥æ–‡ä»¶ä½äºåä¸º<code class="fe nz oa ob nq b">development</code>çš„è™šæ‹Ÿç»„ä¸­ã€‚</p><p id="ec68" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><strong class="lb iu">æ³¨æ„:</strong>åœ¨Kubernetesä¸­ï¼Œç”¨æˆ·å’Œç»„ç”±é›†ç¾¤å¤–çš„ç®¡ç†å‘˜ç®¡ç†ï¼Œè¿™æ„å‘³ç€K8sä¸­æ²¡æœ‰ç”¨æˆ·-éç»„èµ„æºã€‚</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="f465" class="nu mt it nq b gy nv nw l nx ny">$ sudo k0s user create demo --groups development &gt; demo.kubeconfig</span></pre><p id="55d2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä¸ºäº†æ›´å¥½åœ°ç†è§£ï¼Œæˆ‘ä»¬å°†ä»è¿™ä¸ª<code class="fe nz oa ob nq b">kubeconfig</code>æ–‡ä»¶ä¸­æå–å®¢æˆ·ç«¯çš„è¯ä¹¦ï¼Œå¹¶ä»å…¶base64è¡¨ç¤ºä¸­å¯¹å…¶è¿›è¡Œè§£ç :</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="ba34" class="nu mt it nq b gy nv nw l nx ny">$ cat demo.kubeconfig | grep client-certificate-data | awk '{print $2}' | base64 --decode &gt; demo.crt</span></pre><p id="ad02" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ª<code class="fe nz oa ob nq b">openssl</code>å‘½ä»¤æ¥è·å–è¯¥è¯ä¹¦çš„å†…å®¹:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="594f" class="nu mt it nq b gy nv nw l nx ny"><strong class="nq iu">ubuntu@node1:~$ openssl x509 -in demo.crt -noout -text<br/></strong>Certificate:<br/>    Data:<br/>        Version: 3 (0x2)<br/>        Serial Number:<br/>            71:8b:a4:4d:be:76:70:8a:...:07:60:67:c1:2d:51:94<br/>        Signature Algorithm: sha256WithRSAEncryption<br/>        <strong class="nq iu">Issuer: CN = kubernetes-ca</strong><br/>        Validity<br/>            Not Before: Dec  2 13:50:00 2020 GMT<br/>            Not After : Dec  2 13:50:00 2021 GMT<br/>        <strong class="nq iu">Subject: O = development, CN = demo</strong><br/>        Subject Public Key Info:<br/>            Public Key Algorithm: rsaEncryption<br/>                RSA Public-Key: (2048 bit)<br/>                Modulus:<br/>                    00:be:87:dd:15:46:91:98:eb:b8:38:34:77:a4:99:<br/>                    da:4b:d6:ca:09:92:f3:29:28:2d:db:7a:0b:9f:91:<br/>                    65:f3:11:bb:6c:88:b1:8f:46:6e:38:71:97:b7:b5:<br/>                    9b:8d:32:86:1f:0b:f8:4e:57:4f:1c:5f:9f:c5:ee:<br/>                    40:23:80:99:a1:77:30:a3:46:c1:5b:3e:1c:fa:5c:</span></pre><ul class=""><li id="5de2" class="me mf it lb b lc ld lf lg li mg lm mh lq mi lu mj mk ml mm bi translated"><code class="fe nz oa ob nq b">issuer</code>å±æ€§æ˜¯<code class="fe nz oa ob nq b">kubernetes-ca</code>ï¼Œæ˜¯æˆ‘ä»¬k0sé›†ç¾¤çš„è®¤è¯æœºæ„</li><li id="4174" class="me mf it lb b lc mn lf mo li mp lm mq lq mr lu mj mk ml mm bi translated"><code class="fe nz oa ob nq b">Subject</code>æ˜¯<code class="fe nz oa ob nq b">O = development, CN = demo</code>ï¼›è¿™ä¸€éƒ¨åˆ†å¾ˆé‡è¦ï¼Œå› ä¸ºè¿™æ˜¯ç”¨æˆ·åå’Œç”¨æˆ·ç»„å‡ºç°çš„åœ°æ–¹ã€‚å› ä¸ºè¯ä¹¦æ˜¯ç”±é›†ç¾¤çš„CAç­¾ç½²çš„ï¼Œ<code class="fe nz oa ob nq b">api-server</code>ä¸­çš„ä¸€ä¸ªæ’ä»¶èƒ½å¤Ÿæ ¹æ®è¯ä¹¦ä¸»é¢˜ä¸­çš„é€šç”¨åç§°(CN)å’Œç»„ç»‡(O)æ¥è®¤è¯ç”¨æˆ·/ç»„ã€‚</li></ul><p id="74e8" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬å‘Šè¯‰kubectlä½¿ç”¨è¿™ä¸ªæ–°çš„<code class="fe nz oa ob nq b">kubeconfig</code>æ–‡ä»¶ä¸­å®šä¹‰çš„ä¸Šä¸‹æ–‡:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="b1a8" class="nu mt it nq b gy nv nw l nx ny">$ export KUBECONFIG=$PWD/demo.kubeconfig</span></pre><p id="37b7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åï¼Œæˆ‘ä»¬å†æ¬¡åˆ—å‡ºé›†ç¾¤çš„èŠ‚ç‚¹:</p><pre class="kj kk kl km gt np nq nr ns aw nt bi"><span id="09da" class="nu mt it nq b gy nv nw l nx ny"><strong class="nq iu">$ kubectl get no<br/></strong>Error from server (Forbidden): nodes is forbidden: User â€œdemoâ€ cannot list resource â€œnodesâ€ in API group â€œâ€ at the cluster scope</span></pre><p id="7b46" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ­¤é”™è¯¯æ¶ˆæ¯æ˜¯æ„æ–™ä¹‹ä¸­çš„ã€‚å³ä½¿ç”¨æˆ·å·²ç»é€šè¿‡äº†<code class="fe nz oa ob nq b">api-server</code>çš„è®¤è¯(ä¸ç”¨æˆ·è¯·æ±‚ä¸€èµ·å‘é€çš„è¯ä¹¦å·²ç»ç”±é›†ç¾¤è¯ä¹¦é¢å‘æœºæ„ç­¾å)ï¼Œä»–ä»¬ä¹Ÿæ— æƒåœ¨é›†ç¾¤ä¸­æ‰§è¡Œä»»ä½•æ“ä½œã€‚</p><p id="c2ce" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">é€šè¿‡åˆ›å»º<code class="fe nz oa ob nq b">Role</code> / <code class="fe nz oa ob nq b">ClusterRole</code>å¯ä»¥å¾ˆå®¹æ˜“åœ°æ·»åŠ é¢å¤–çš„æƒé™ï¼Œå¹¶é€šè¿‡<code class="fe nz oa ob nq b">RoleBinding</code> / <code class="fe nz oa ob nq b">ClusterRoleBinding</code>ç»‘å®šåˆ°ç”¨æˆ·ï¼Œä½†æˆ‘å°†æ­¤ä½œä¸ºè¯»è€…çš„ç»ƒä¹ ã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="ce93" class="ms mt it bd mu mv mw mx my mz na nb nc jz nd ka ne kc nf kd ng kf nh kg ni nj bi translated">ç»“è®º</h1><p id="ccd9" class="pw-post-body-paragraph kz la it lb b lc nk ju le lf nl jx lh li nm lk ll lm nn lo lp lq no ls lt lu im bi translated">k0sç»å¯¹å€¼å¾—ä¸€çœ‹ã€‚ç”¨ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶æ¥ç®¡ç†æ‰€æœ‰çš„è¿›ç¨‹æ˜¯ä¸€ä¸ªéå¸¸æœ‰è¶£çš„æ–¹æ³•ã€‚</p><p id="23a0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘ä»¬åªæ˜¯å¿«é€Ÿæµè§ˆäº†ä¸€ä¸‹k0sï¼Œä½†æ˜¯æˆ‘ä¼šç¡®ä¿è·Ÿè¸ªå®ƒçš„å‘å±•ï¼Œå¹¶åœ¨ä»¥åçš„æ–‡ç« ä¸­ä¸“é—¨ä»‹ç»è¿™ä¸ªæ–°çš„ã€æœ‰å‰é€”çš„Kuberneteså‘è¡Œç‰ˆã€‚ä¸€äº›æœªæ¥çš„åŠŸèƒ½çœ‹èµ·æ¥å¾ˆæœ‰å‰é€”ï¼Œæˆ‘çœŸçš„å¾ˆæœŸå¾…æµ‹è¯•å®ƒä»¬ã€‚</p></div></div>    
</body>
</html>