# å¦‚ä½•åœ¨ JavaScript é¡¹ç›®ä¸­ä½¿ç”¨ Git æŒ‚é’©

> åŸæ–‡ï¼š<https://betterprogramming.pub/git-hooks-in-javascript-projects-f23a6a096830>

## æˆ‘åæ‚”æ²¡æœ‰æ—©ç‚¹çŸ¥é“çš„é’©å­

![](img/0653da4fda8c581c3952785d3eea90ee.png)

ç…§ç‰‡ç”±[ç½—æ›¼Â·è¾›å…‹ç»´å¥‡Â·ğŸ‡ºğŸ‡¦](https://unsplash.com/@synkevych?utm_source=medium&utm_medium=referral)åœ¨ [Unsplash](https://unsplash.com?utm_source=medium&utm_medium=referral) ä¸Šæ‹æ‘„

å½“ Git å­˜å‚¨åº“ä¸­å‘ç”Ÿç‰¹å®šäº‹ä»¶æ—¶ï¼ŒGit æŒ‚é’©å°†è‡ªåŠ¨è§¦å‘å®šåˆ¶è„šæœ¬ã€‚æœ‰ä¸¤ç»„é’©å­ï¼Œå®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ã€‚

æ‚¨å¯ä»¥æŸ¥çœ‹è¿™ä¸ª[é“¾æ¥](https://git-scm.com/docs/githooks)ä»¥è·å¾— Git æŒ‚é’©çš„å®Œæ•´æ–‡æ¡£ï¼Œä½†æ˜¯åœ¨æœ¬æ–‡ä¸­ï¼Œæˆ‘å°†åªè®¨è®º`pre-commit`å’Œ`pre-push`ã€‚æ‚¨å¯ä»¥ä»å¤´å¼€å§‹ç¼–å†™è‡ªå·±çš„è„šæœ¬ï¼Œä¹Ÿå¯ä»¥æŸ¥çœ‹è¿™ä¸ª [GitHub repo](https://github.com/aitemr/awesome-git-hooks#tools) ä»¥è·å¾—ç°æˆçš„å·¥å…·ã€‚å¯¹æˆ‘æ¥è¯´ï¼Œæˆ‘æ›´å–œæ¬¢[å“ˆå£«å¥‡](https://typicode.github.io/husky/#/)ã€‚æ±ªæ±ªï¼æ±ªæ±ªï¼

# é—®é¢˜

ä½ èƒ½æƒ³è±¡è®¸å¤šå¼€å‘äººå‘˜åœ¨ä¸€ä¸ªé¡¹ç›®ä¸Šå·¥ä½œï¼Œæ¯ä¸ªäººéƒ½æœ‰è‡ªå·±çš„ä»£ç é£æ ¼å—ï¼Ÿæ˜¯çš„ï¼Œæˆ‘çŸ¥é“æœ‰ä¸€äº›å·¥å…·å«åš [ESLint](https://eslint.org/) ã€[beautiful](https://prettier.io/)å’Œ [Stylelint](https://stylelint.io/) ï¼Œä½†æ˜¯ä½ å¦‚ä½•ç¡®ä¿æ¯ä¸ªäººéƒ½åœ¨ä»–ä»¬çš„ IDE ä¸­å®‰è£…äº†å®ƒæˆ–è€…æ‰‹åŠ¨è¿è¡Œè¿™ä¸ªå‘½ä»¤å‘¢ï¼Ÿ

æ‚¨çš„é¡¹ç›®å¯èƒ½å·²ç»é›†æˆäº†[å“¨å…µ](https://sentry.io/)ï¼Œæ‚¨å¿…é¡»å°†å‘å¸ƒç‰ˆæœ¬ä»ä¸»è¦ç‰ˆæœ¬æ›´æ–°ä¸ºæ¬¡è¦ç‰ˆæœ¬ã€‚äººç±»ä¼šçŠ¯é”™ï¼›æˆ‘ä»¬ä¸èƒ½ä¿è¯æˆ‘ä»¬æ°¸è¿œä¸ä¼šå¿˜è®°åœ¨æäº¤ä¹‹å‰æ›´æ–°å“¨å…µç‰ˆæœ¬ã€‚

# è§£å†³æ–¹æ¡ˆ

ç”±äºæˆ‘ä»¬æ—¢éœ€è¦`pre-commit`åˆéœ€è¦`pre-push`åŠé’©ï¼Œæˆ‘ä»¬é€‰æ‹©å·¦[ç²—](https://typicode.github.io/husky/#/)å’Œ[å·¦åŠé’©](https://github.com/evilmartians/lefthook)ã€‚ä¸ Lefthook ç›¸æ¯”ï¼ŒHusky çš„é…ç½®æ›´ç®€å•ã€‚ç„¶åï¼Œæˆ‘ä»¬éœ€è¦æ¥è‡ª lint-staged çš„å¸®åŠ©ï¼Œä»¥è¿«ä½¿æ¯ä¸ªäººåœ¨å°†ä»–ä»¬çš„ä»£ç æäº¤åˆ°å­˜å‚¨åº“ä¹‹å‰éµå®ˆæ ‡å‡†ï¼›æ‰¾åˆ°å“¨å…µé‡Šæ”¾çº¿ï¼Œå¹¶åœ¨`pre-push`ä¸­å°†å…¶æ›¿æ¢ä¸ºæ­£ç¡®çš„ç‰ˆæœ¬

# å…¥é—¨æŒ‡å—

è£…ç½®

```
npm i -D husky lint-staged
// or
pnpm i -D husky lint-staged
// or
yarn add husky lint-staged -D
```

å¯ç”¨ Git æŒ‚é’©

```
npx husky install
```

ç¡®ä¿é¡¹ç›®ä¸­çš„æ¯ä¸ªå¼€å‘äººå‘˜éƒ½å¯ç”¨äº† Git æŒ‚é’©ã€‚åœ¨æ‚¨çš„`package.json`ä¸­è¿™æ ·åšï¼Œæ¯å½“æ‚¨æœ¬åœ°è¿è¡Œ`npm install`æ—¶ï¼Œå®ƒå°†è‡ªåŠ¨å¯ç”¨`husky`ã€‚

```
// package.json
{   
  "scripts": {     
    "prepare": "husky install"   
  } 
}
```

# é¢„æäº¤

å°†ä¸‹é¢çš„ç‰‡æ®µæ·»åŠ åˆ°`package.json`:

```
// package.json
{
  "lint-staged": {
    "*.{js,vue}": "eslint --cache --fix"
  }
}
```

ä¸Šé¢çš„ä»£ç ç‰‡æ®µå¯ä»¥è¿™æ ·ç†è§£:æ¯å½“ä¸€ä¸ªæ‰©å±•åä¸º`js`æˆ–`vue`çš„æ–‡ä»¶è¢«ç™»å°æ—¶ï¼Œå®ƒå°±ä¼šè¿è¡Œå‘½ä»¤`eslint --cache --fix`ã€‚è¿™å°†å°½å¯èƒ½å°è¯•ä¿®å¤ ESLint é—®é¢˜ã€‚å¦åˆ™ï¼Œå®ƒå°†è¿”å›é”™è¯¯ï¼Œæ‚¨å¿…é¡»åœ¨å†æ¬¡æäº¤ä¹‹å‰ä¿®å¤é”™è¯¯ã€‚

åœ¨`.husky/pre-commit`åˆ›å»ºä¸€ä¸ªæ–‡ä»¶

```
*#!/bin/sh
.* "*$*(*dirname* "$0")/_/husky.sh"*npx* lint-staged
```

å½“æ‚¨è¿è¡Œ`git commit`æ—¶ï¼Œå‘½ä»¤`npx lint-staged`å°†åœ¨æˆåŠŸæäº¤ä¹‹å‰è¿è¡Œã€‚

# é¢„æ¨

æˆ‘ä»¬éœ€è¦ä¸€ä¸ªè‡ªå®šä¹‰è„šæœ¬æ¥æ›´æ–°æ¨å‰é‡Šæ”¾å“¨å…µã€‚

Sentry å‘å¸ƒåœ¨`vite.config.js`ä¸­ï¼Œå› æ­¤è„šæœ¬å°†å®šä½åˆ°`release:`çš„å…³é”®å­—æ‰€åœ¨çš„è¡Œï¼Œå¹¶ç”¨æ­£ç¡®çš„å‘å¸ƒåç§°æ›¿æ¢å®ƒã€‚

å°†ä¸‹é¢çš„ç‰‡æ®µæ·»åŠ åˆ°`package.json`

```
// package.json
{
  "scripts": {
    "prepush": "node scripts/update-sentry-release.js"
  }
}
```

å¹¶ä½¿ç”¨ä¸‹é¢çš„ä»£ç ç‰‡æ®µåˆ›å»ºä¸€ä¸ªæ–‡ä»¶`.husky/pre-push`

```
*#!/bin/sh
.* "*$*(*dirname* "$0")/_/husky.sh"*npm* run prepush
```

å°±æ˜¯è¿™æ ·ï¼

# å·²çŸ¥é—®é¢˜

`lint-staged`å½“æ‚¨å°è¯•åœ¨ Windows ä¸­æäº¤å¤§é‡æš‚å­˜æ–‡ä»¶æ—¶ï¼Œä¼šæŠ›å‡ºé”™è¯¯ã€‚åœ¨å¤„æ£€æŸ¥æœªå†³é—®é¢˜[ã€‚](https://github.com/okonet/lint-staged/issues/420)

è‡ªå®šä¹‰è„šæœ¬`update-sentry-release`åªæœ‰åœ¨æ²¡æœ‰æ¢è¡Œç¬¦æ—¶æ‰èµ·ä½œç”¨ã€‚

å½“æœ‰äººç»•è¿‡ Git é’©å­ï¼Œä½ åˆå¹¶ä»–ä»¬çš„æäº¤æ—¶ï¼Œä½ å¿…é¡»ä¿®å¤ä»–ä»¬çš„ linter é”™è¯¯ã€‚

æ„Ÿè°¢é˜…è¯»ã€‚æ•¬è¯·å…³æ³¨æ›´å¤šå†…å®¹ã€‚