# ä½¿ç”¨ AWS å’Œ Python ç”Ÿæˆä»¤äººæƒŠå¹çš„ PDF æŠ¥å‘Š

> åŸæ–‡ï¼š<https://betterprogramming.pub/generating-stunning-pdf-reports-with-aws-and-python-a47274afe03d>

## ç”¨ Amazon Web Services å’Œ Python æ„å»ºä¸€ä¸ªå®Œæ•´çš„ PDF ç”Ÿæˆç³»ç»Ÿ

![](img/75e53666c3aceddbc8f10536ed84e72c.png)

æ’å›¾ç”± [Gianca Chavest](https://www.instagram.com/niimde/) ç»˜åˆ¶

å‡ å¹´å‰ï¼Œæˆ‘å‚ä¸äº†ä¸€ä¸ªä¸ºå°å…¬å¸å’Œä¼ä¸šå®¶è®¾è®¡çš„é¡¹ç›®ã€‚è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ [SaaS åº”ç”¨](https://en.wikipedia.org/wiki/Software_as_a_service)ï¼Œå¸¦æœ‰ç”¨æˆ·æ³¨å†Œå’Œç™»å½•æœºåˆ¶ï¼›ç”¨æˆ·å¯ä»¥åœ¨å¹³å°ä¸Šè®°å½•å…¬å¸çš„äº§å“ã€è®¢å•å’Œé”€å”®é¢ã€‚ç„¶åï¼Œä»–ä»¬å¯ä»¥çœ‹åˆ°è®¸å¤šä»¤äººæƒŠå¹çš„å›¾è¡¨å’Œé¢„æµ‹ï¼Œå¹¶ä¸‹è½½æˆ PDF æ ¼å¼çš„æŠ¥å‘Šã€‚

ä»æŠ€æœ¯è§’åº¦æ¥çœ‹ï¼Œæ•´ä¸ªé¡¹ç›®éå¸¸ä¼ ç»Ÿï¼Œä½†æŠ¥å‘Šç”Ÿæˆéƒ¨åˆ†éå¸¸æœ‰è¶£ï¼Œæˆ‘å°†åœ¨æœ¬æ–‡ä¸­åˆ†äº«å®ƒã€‚

# è¦æ±‚

*   åœ¨æ­¤æœŸé—´ï¼Œæˆ‘åœ¨äºšé©¬é€Šä¸Šä½¿ç”¨ä¸€ä¸ªå¯æ‰©å±•çš„æ— æœåŠ¡å™¨æ¶æ„ï¼Œæ‰€ä»¥æˆ‘éœ€è¦è®© PDF ç”Ÿæˆåœ¨**Î»**ä¸Šå·¥ä½œã€‚
*   æˆ‘å·²ç»å¼€å‘äº†æ•´ä¸ªä¸šåŠ¡æ ¸å¿ƒ(è®¡ç®—ã€é¢„æµ‹ç­‰)ã€‚)ä½¿ç”¨ **Python** ï¼Œæ‰€ä»¥æˆ‘å°±å°½é‡æ‰¾ Python çš„è§£å†³æ–¹æ¡ˆã€‚
*   PDF æŠ¥å‘Šå¿…é¡»ä¸å¹³å°ä¸Šæ˜¾ç¤ºçš„å†…å®¹**ç›¸ä¼¼æˆ–å…·æœ‰**ç›¸åŒçš„è§†è§‰è¯†åˆ«:æ ·å¼ã€é¢œè‰²ã€å­—ä½“ç­‰ã€‚

# å·¥ä½œåŒº

æˆ‘é¦–å…ˆæƒ³åˆ°ä½¿ç”¨ PDF ç”Ÿæˆåº“ï¼Œä¾‹å¦‚åƒ [HTML2PDF](https://pypi.org/project/html2pdf/) æˆ– [FPDF](https://pypi.org/project/fpdf/) ã€‚ä½†æ˜¯å‡ å¹´å‰ï¼Œè¿™äº›åº“éå¸¸æœ‰é™:ç”Ÿæˆçš„ pdf åœ¨è§†è§‰ä¸Šå¾ˆå·®ï¼Œå›¾è¡¨ä¹Ÿæœ‰ç‚¹éš¾çœ‹ã€‚

ç„¶åï¼Œæˆ‘æƒ³çŸ¥é“æˆ‘æ˜¯å¦å¯ä»¥ç”¨æˆ‘éœ€è¦çš„æ‰€æœ‰ç²¾å½©çš„è§†è§‰ä¸œè¥¿æ¥æ„å»ºä¸€ä¸ª HTML æ¨¡æ¿ï¼Œâ€œæ‹ä¸€å¼ ç…§ç‰‡â€ï¼Œç„¶åâ€œç²˜è´´â€åˆ° PDF ä¸­ã€‚å¥½æ¶ˆæ¯:æœ‰äº†åº“[æœ¨å¶å¸ˆ](https://pptr.dev/)å’Œå®ƒçš„ Python ç­‰ä»·ç‰© [Pyppeteer](https://pypi.org/project/pyppeteer/) è¿™æ˜¯å¯èƒ½çš„ã€‚

æŒ‰ç…§è¿™ä¸ªæƒ³æ³•ï¼Œæˆ‘ä»¬å°†åšä»¥ä¸‹äº‹æƒ…:åœ¨ Lambda ä¸Šè¿è¡Œä¸€ä¸ªæµè§ˆå™¨å®ä¾‹ï¼Œè½¬åˆ° HTML æ¨¡æ¿ï¼Œç”¨ç”¨æˆ·æ•°æ®å¡«å……å®ƒï¼Œç”Ÿæˆä¸€ä¸ª PDF æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä¿å­˜åœ¨ S3 æ¡¶ä¸­ã€‚

è¿™å°†æ˜¯æˆ‘ä»¬åº”ç”¨çš„æœ€ç»ˆæ¶æ„:

![](img/7093c2bd0858346e37b6d6c1c26dc75f.png)

æœ¬æ–‡å°†å…³æ³¨ Lambda éƒ¨åˆ†å’Œ PDF ç”Ÿæˆï¼›æˆ‘å‡è®¾æˆ‘ä»¬å·²ç»æœ‰äº†ç”¨æˆ·æ•°æ®ã€‚å¦‚æœæ‚¨æƒ³ä¸ Cognitoã€API Gateway + Authorizer å’Œ RDS æ•°æ®åº“è¿›è¡Œå¾ˆå¥½çš„é›†æˆï¼Œæˆ‘é‚€è¯·æ‚¨é˜…è¯»æˆ‘ä»¥å‰çš„æ–‡ç« :

[](/how-i-built-a-hotel-platform-with-unity3d-and-aws-22bd3c315d81) [## æˆ‘å¦‚ä½•ä½¿ç”¨ Unity3D å’Œ AWS æ„å»ºé…’åº—å¹³å°

### ä½¿ç”¨ Amazon Web Services æ„å»ºä¸€ä¸ªå®Œæ•´çš„å¯æ‰©å±•äº‘æ¶æ„

better ç¼–ç¨‹. pub](/how-i-built-a-hotel-platform-with-unity3d-and-aws-22bd3c315d81) 

# HTML æ¨¡æ¿

## æ„å»ºæ¨¡æ¿

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ªå¥½çœ‹çš„ HTML æ¨¡æ¿ã€‚å› ä¸ºæˆ‘æ—¢ä¸æ˜¯è®¾è®¡å¸ˆä¹Ÿä¸æ˜¯å‰ç«¯å¼€å‘äººå‘˜ï¼Œå¯¹æˆ‘æ¥è¯´ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©æ˜¯è´­ä¹°ä¸€ä¸ª HTML æ¨¡æ¿ï¼Œæ¯”å¦‚ä¾¿å®œåˆæ¼‚äº®çš„[æ¡†æ ¼æ¨¡æ¿](https://spruko.com/demo/sash/sash/html/index.html)ã€‚

ç»è¿‡ä¸€äº› HTMLã€CSS å’Œ Javascript çš„ç ´è§£ï¼Œæˆ‘è·å¾—äº†è¿™ä¸ªæ²¡æœ‰ç”¨æˆ·æ•°æ®çš„è™šæ‹Ÿæ¨¡æ¿:

![](img/14a817f449cb27de3c940ccd6f71725f.png)

æ²¡æœ‰ç”¨æˆ·æ•°æ®çš„ HTML æ¨¡æ¿

**æç¤º 1** :å°½å¯èƒ½åœ°åˆ›å»ºä¸€ä¸ªè½»é‡çº§çš„æ¨¡æ¿ï¼Œä½äºä¸€ä¸ªå¿«é€Ÿä¸»æœºä¸Šï¼Œä¸éœ€è¦åŠ è½½å¤§å›¾ç‰‡æˆ–å¤§æ–‡ä»¶ã€‚æ­¤å¤–ï¼ŒPDF æ–‡ä»¶å°†åœ¨è°ƒç”¨[åŠ è½½äº‹ä»¶](https://developer.mozilla.org/es/docs/Web/API/Window/load_event)ååˆ›å»ºï¼Œå› æ­¤é¿å…å¼‚æ­¥åŠ è½½å’Œç¼“å­˜èµ„æºã€‚

åœ¨ Chrome æ§åˆ¶å°ä¸­ï¼Œå¼‚æ­¥åŠ è½½å’Œç¼“å­˜èµ„æºæ˜¾ç¤ºåœ¨çº¢çº¿ä¹‹å:

![](img/cd1fe4a112b7f3b598afc7047300743b.png)

Chrome æ§åˆ¶å°

**æç¤º 2**:PDF æŠ¥å‘Šçš„æ¯ä¸€é¡µéƒ½å¯ä»¥ç”¨ä¸€ä¸ªå›ºå®šå¤§å°çš„å®¹å™¨æ¥è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œå¦‚æœ PDF æŠ¥å‘Šå°†å…·æœ‰ [A4 æ ¼å¼](https://en.wikipedia.org/wiki/ISO_216)ï¼Œåˆ™å®¹å™¨å°†å…·æœ‰ä»¥ä¸‹æ ·å¼:

**æç¤º 3** :æˆ‘ä»¬å°†è¦åˆ›å»ºçš„ PDF æ–‡ä»¶å¯èƒ½ä¼šæœ‰é¢œè‰²å¤±çœŸçš„é—®é¢˜ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæœ‰å¿…è¦ä½¿ç”¨[æ‰“å°é¢œè‰²è°ƒæ•´å±æ€§](https://developer.mozilla.org/en-US/docs/Web/CSS/print-color-adjust)å¼ºåˆ¶è·å¾—å‡†ç¡®çš„é¢œè‰²ã€‚

**æç¤º 4** :é¿å…å›¾è¡¨åŠ¨ç”»ã€‚æ¯ä¸ªå›¾è¡¨åº“éƒ½æœ‰è‡ªå·±çš„æ–¹æ³•ï¼Œä¸‹é¢æ˜¯å¦‚ä½•ä½¿ç”¨ **Chart.js** åº“æ¥å®Œæˆçš„:

## ç”¨æ•°æ®å¡«å……æ¨¡æ¿

å¥½äº†ï¼Œç°åœ¨è®©æˆ‘ä»¬ç”¨æ•°æ®å¡«å……æ¨¡æ¿ã€‚åšè¿™ä»¶äº‹æœ‰è®¸å¤šæ–¹æ³•ã€‚

**â¡ï¸æŸ¥è¯¢å­—ç¬¦ä¸²çš„æ–¹æ³•**

ä¸€ç§ç®€å•çš„æ–¹æ³•æ˜¯é€šè¿‡ URL å°†æ•°æ®ä½œä¸ºæŸ¥è¯¢å­—ç¬¦ä¸²å‘é€ã€‚æˆ‘é€‰æ‹©å‘é€ä¸€ä¸ªåä¸º`**data**`çš„å¤§ JSON å‚æ•°ï¼Œå¹¶é€šè¿‡ [URLSearchParams](https://developer.mozilla.org/en-US/docs/Web/API/URLSearchParams) æ¥å£æ¥æ”¶å®ƒã€‚ç”±äºæœ¬åœ° Javascript æˆ– JQueryï¼Œå¦‚æœæ¨¡æ¿æ”¯æŒçš„è¯ï¼Œå¯ä»¥å¾ˆå®¹æ˜“åœ°ç”¨æ•°æ®å¡«å……æ¨¡æ¿ã€‚

çœ‹èµ·æ¥[å¾ˆæ£’](https://alexandrebruffa.com/pdfreport/?data=%7B%22general%22%3A%7B%22company%22%3A%22PowerReportS.A.%22%2C%22period%22%3A%22Q12022%22%7D%2C%22sales%22%3A%7B%22chart%22%3A%5B19%2C15%2C17%2C14%2C13%2C15%2C16%5D%2C%22total%22%3A%2244%2C278%22%2C%22evolution%22%3A5%7D%2C%22leads%22%3A%7B%22chart%22%3A%5B45%2C23%2C32%2C67%2C49%2C72%2C52%2C55%2C46%2C54%2C32%2C74%2C88%2C36%2C36%2C32%2C48%2C54%5D%2C%22total%22%3A%2267%2C987%22%2C%22evolution%22%3A0.75%7D%2C%22profit%22%3A%7B%22chart%22%3A%5B14%2C17%2C12%2C13%2C11%2C15%2C16%5D%2C%22total%22%3A%22%2476%2C965%22%2C%22evolution%22%3A0.9%7D%2C%22cost%22%3A%7B%22chart%22%3A%5B28%2C56%2C36%2C32%2C48%2C54%2C37%2C58%2C66%2C53%2C21%2C24%2C14%2C45%2C0%2C32%2C67%2C49%2C52%2C55%2C46%2C54%2C130%5D%2C%22total%22%3A%22%2459%2C765%22%2C%22evolution%22%3A-0.6%7D%2C%22transactions%22%3A%7B%22chart1%22%3A%5B100%2C210%2C180%2C454%2C454%2C230%2C230%2C656%2C656%2C350%2C350%2C210%5D%2C%22chart2%22%3A%5B200%2C530%2C110%2C110%2C480%2C520%2C780%2C435%2C475%2C738%2C454%2C454%5D%7D%2C%22geo%22%3A%7B%22markers%22%3A%5B%7B%22latLng%22%3A%5B40.3%2C-101.38%5D%2C%22name%22%3A%22USA%22%7D%2C%7B%22latLng%22%3A%5B28.644800%2C77.216721%5D%2C%22name%22%3A%22India%22%7D%2C%7B%22latLng%22%3A%5B-12.04318%2C-77.02824%5D%2C%22name%22%3A%22Peru%22%7D%5D%2C%22countries%22%3A%5B%22USA%22%2C%22India%22%2C%22Peru%22%5D%2C%22mobiles%22%3A%5B%2217%25%22%2C%2222%25%22%2C%2211%25%22%5D%2C%22desktops%22%3A%5B%2234%25%22%2C%2276%25%22%2C%2258%25%22%5D%2C%22tablets%22%3A%5B%2256%25%22%2C%2283%25%22%2C%2266%25%22%5D%7D%2C%22products%22%3A%5B%7B%22id%22%3A%22%2398765490%22%2C%22slug%22%3A%22headsets%22%2C%22name%22%3A%22Headsets%22%2C%22quantity%22%3A%221%2C895%22%2C%22amount%22%3A%22%246%2C721.5%22%2C%22country%22%3A%22Peru%22%2C%22status%22%3A5.2%7D%2C%7B%22id%22%3A%22%2376348798%22%2C%22slug%22%3A%22flower_pot%22%2C%22name%22%3A%22FlowerPot%22%2C%22quantity%22%3A%225%2C719%22%2C%22amount%22%3A%22%2435%2C7863%22%2C%22country%22%3A%22India%22%2C%22status%22%3A3.2%7D%2C%7B%22id%22%3A%22%2323986456%22%2C%22slug%22%3A%22pen_drive%22%2C%22name%22%3A%22PenDrive%22%2C%22quantity%22%3A%22789%2C123%22%2C%22amount%22%3A%22%245%2C896%2C437%22%2C%22country%22%3A%22USA%22%2C%22status%22%3A15.8%7D%2C%7B%22id%22%3A%22%2387456325%22%2C%22slug%22%3A%22new_bowl%22%2C%22name%22%3A%22NewBowl%22%2C%22quantity%22%3A%222%2C856%22%2C%22amount%22%3A%22%2417.98%22%2C%22country%22%3A%22Peru%22%2C%22status%22%3A-5.5%7D%5D%7D)ï¼

![](img/94afe31c42403a2ed1d2ed960865b096.png)

åŒ…å«ç”¨æˆ·æ•°æ®çš„ HTML æ¨¡æ¿

**æ³¨æ„**:ç½‘ç»œæµè§ˆå™¨é™åˆ¶ URL çš„æœ€å¤§é•¿åº¦(Chrome æµè§ˆå™¨[2MB](https://chromium.googlesource.com/chromium/src/+/main/docs/security/url_display_guidelines/url_display_guidelines.md#URL-Length))ã€‚å¦‚æœæ‚¨éœ€è¦å‘é€æ›´å¤šçš„æ•°æ®ï¼Œæˆ‘å¼ºçƒˆå»ºè®®æ‚¨ä½¿ç”¨ localStorage æ–¹æ³•ã€‚

**â¡ï¸æœ¬åœ°å­˜å‚¨æ–¹æ³•**

[æœ¬åœ°å­˜å‚¨](https://developer.mozilla.org/en-US/docs/Web/API/Window/localStorage)å…è®¸åœ¨ç½‘ç»œæµè§ˆå™¨ä¼šè¯ä¸­å­˜å‚¨æ•°æ®ã€‚æˆ‘ä»¬å°†æŒ‰å¦‚ä¸‹æ–¹å¼è¯»å–æ•°æ®:

# æœåŠ¡å™¨ç«¯å®ç°

## S3

S3 æ˜¯ä¸€ä¸ªé™æ€å†…å®¹çš„å¯æ‰©å±•å­˜å‚¨æœåŠ¡ï¼Œæˆ‘ä»¬å°†åœ¨é‚£é‡Œå­˜å‚¨ç”± Lambda ç”Ÿæˆçš„ PDF æ–‡ä»¶ã€‚

â¡ï¸ **æ–—**

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„å­˜å‚¨æ¡¶(åˆåå­˜å‚¨åº“)ã€‚

![](img/07757a5179491ea9457facc9e7326b53.png)

â¡ï¸ **æ–—ç­–**

æˆ‘ä»¬ç¼–è¾‘å­˜å‚¨æ¡¶ç­–ç•¥ï¼Œåªå…è®¸å­˜å‚¨æ¡¶å†…å®¹è¢«è¯»å–ã€‚

## Î»å±‚

Lambda æ˜¯ä¸€ä¸ªå¾ˆæ£’çš„æ— æœåŠ¡å™¨æœåŠ¡ï¼Œå…è®¸è¿è¡Œä»£ç è®© Amazon ä¸ºä½ ç®¡ç†æœåŠ¡å™¨èµ„æºã€‚ä½†æ˜¯åœ¨ç¼–å†™ lambda å‡½æ•°ä¹‹å‰ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª Lambda å±‚ï¼Œæä¾›æ‰€æœ‰å¿…è¦çš„èµ„æºæ¥ç”Ÿæˆ PDFã€‚

**â¡ï¸æµè§ˆå™¨**

æˆ‘ä»¬å°†ä½¿ç”¨ Chromeï¼Œè¿™æ˜¯å…¨çƒä½¿ç”¨æœ€å¤šçš„æµè§ˆå™¨ã€‚AWS Lambda æ²¡æœ‰å®˜æ–¹ç‰ˆæœ¬çš„ Chromeï¼Œä½†å¸Œæœ›è¿™ä¸ªä¸–ç•Œä¸Šæœ‰ä¸€äº›è‹±é›„ï¼Œæ¯”å¦‚ [Marco LÃ¼thy](https://github.com/adieuadieu) ç»™äº†æˆ‘ä»¬â€”â€”ä»…ä»…æ˜¯å‡¡äººâ€”â€”ä¸€ä»½ç¾å¦™çš„ç¤¼ç‰©:AWS Lambda çš„æ— å¤´ Chrome ç‰ˆæœ¬ã€‚

æˆ‘ä»¬åœ¨è¿™é‡Œä¸‹è½½äº†ä¸€ä¸ªç¨³å®šçš„ç‰ˆæœ¬[å¹¶è§£å‹ã€‚](https://github.com/adieuadieu/serverless-chrome/releases/tag/v1.0.0-55)

â¡ï¸Â·çš®ä½©å°”

è¿™æ˜¯æ£˜æ‰‹çš„éƒ¨åˆ†:æˆ‘ä»¬éœ€è¦åšä¸€äº›ä¿®æ”¹æ¥è®© Pyppeteer åœ¨ Lambda ä¸Šå·¥ä½œã€‚æˆ‘ä»¬åœ¨ [Pypi](https://pypi.org/project/pyppeteer/) ä¸Šä¸‹è½½ Pyppeteer çš„æœ€æ–°å¯ç”¨ç‰ˆæœ¬ï¼Œå¹¶æ‰“å¼€`**__init__.py**`æ–‡ä»¶ã€‚

ç”±äºæœªçŸ¥çš„åŸå› ï¼Œåº“**ç‰ˆæœ¬**ä½¿ Pyppeteer åœ¨ Lambda ä¸Šå´©æºƒï¼Œæ‰€ä»¥æˆ‘ä»¬æ³¨é‡Šäº†æ•´ä¸ªç›¸åº”çš„å—ï¼Œå¹¶ç”¨ç¡¬ç¼–ç çš„ç‰ˆæœ¬å·æ›¿æ¢å®ƒ:

lambda å‡½æ•°ä¸Šå”¯ä¸€å¯å†™çš„ç›®å½•æ˜¯ [tmp ç›®å½•](https://aws.amazon.com/blogs/compute/choosing-between-aws-lambda-data-storage-options-in-web-apps/)ï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ç¡¬ç¼–ç  Pyppeteer çš„ä¸»ç›®å½•æ¥æ”¹å˜å®ƒ:

**æ³¨æ„**:æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ Pyppeteer [å¯åŠ¨å™¨](https://miyakogi.github.io/pyppeteer/reference.html#launcher)çš„`**userDataDir**`é€‰é¡¹æ¥è®¾ç½®æ­£ç¡®çš„ç›®å½•ï¼Œä½†æ˜¯è¿™æ ·åšæˆ‘ä»¬ç§»é™¤äº†`**AppDirs**`ä¾èµ–å’Œå…¶ä»–åµŒå…¥çš„ä¾èµ–ã€‚

**â¡ï¸å±åœ°**

Pyppeteer æœ‰ä»¥ä¸‹ä¾èµ–å…³ç³»: [pyee](https://pypi.org/project/pyee/) ã€ [tqdm](https://pypi.org/project/tqdm/) å’Œ [websockets](https://pypi.org/project/websockets/) ã€‚æˆ‘ä»¬ä¸‹è½½è¿™äº›åº“ï¼Œå¹¶æŠŠå®ƒä»¬æ”¾åœ¨ä¸ headless chromium å’Œ Pyppeteer ç›¸åŒçš„æ–‡ä»¶å¤¹ä¸­ã€‚

**â¡ï¸ Zip æ–‡ä»¶**

æˆ‘ä»¬æ­£åœ¨æ„å»ºçš„é…ç½®ä»…é€‚ç”¨äº Python ç‰ˆæœ¬â‰¤ 3.7ï¼Œå› æ­¤æˆ‘ä»¬çš„å±‚å’Œå‡½æ•°å°†ä¸ Python 3.7 å…¼å®¹ã€‚

æˆ‘ä»¬å°† headless chromium å’Œåº“æ”¾åœ¨ä¸€ä¸ªåŒ…å«ä»¥ä¸‹å­ç›®å½•çš„ç›®å½•ä¸­:`**lib > python3.7 > site-packages**`å¹¶æœ€ç»ˆå‹ç¼©å®ƒã€‚

![](img/a36e0b9c721e39e8c26f98381cdd6c47.png)

**â¡ï¸ä¸Šä¼ åˆ°å›¾å±‚**

å¤ªå¥½äº†ï¼æˆ‘ä»¬æœ€ç»ˆå¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„ Lambda å±‚:æˆ‘ä»¬ä¸Šä¼ ä¹‹å‰åˆ›å»ºçš„ zip æ–‡ä»¶ï¼Œå¹¶é€‰æ‹©`**Python 3.7**`ä½œä¸ºå…¼å®¹çš„è¿è¡Œæ—¶ã€‚

![](img/7768c4ea56afffa52bfb7d7adc5cde7e.png)

æˆ‘ä»¬çš„å±‚å‡†å¤‡å¥½äº†ï¼ï¼

![](img/9a603e526caebe94898e7739f9450b01.png)

## Î»å‡½æ•°

**â¡ï¸åˆ›å»ºå‡½æ•°**

æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„ Lambda å‡½æ•°ï¼Œè¿è¡Œæ—¶ä½¿ç”¨`**Python 3.7**`ã€‚

![](img/42da9806b08ea8635cc2a05127adcf7d.png)

**â¡ï¸å°† Pyppeteer å±‚æ·»åŠ åˆ°å‡½æ•°ä¸­**

åœ¨ç¼–ç ä¹‹å‰ï¼Œæˆ‘ä»¬å¿…é¡»å°†ä¹‹å‰åˆ›å»ºçš„å±‚æ·»åŠ åˆ°å‡½æ•°ä¸­:

![](img/a2e848f0b02cd3b60916cddb576fc766.png)

**â¡ï¸ç¼–ç åŠŸèƒ½ğŸš€**

ç°åœ¨æœ€æ¿€åŠ¨äººå¿ƒçš„éƒ¨åˆ†ï¼Œè®©æˆ‘ä»¬æ¥ç¼–ç åŠŸèƒ½ï¼

**æ³¨æ„äº‹é¡¹**:

*   æˆ‘ä»¬å‡è®¾æˆ‘ä»¬å·²ç»æœ‰äº†`data`å’Œ`user_id`å€¼ã€‚å¦‚æœä½ æƒ³ä¸å…¶ä»– AWS æœåŠ¡è¿›è¡Œå¾ˆå¥½çš„é›†æˆï¼Œä½ å¯ä»¥æŸ¥çœ‹æˆ‘ä»¥å‰çš„æ–‡ç« ã€‚
*   æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå”¯ä¸€çš„ PDF æ–‡ä»¶åã€ç”¨æˆ· id å’Œå®é™…æ—¥æœŸçš„è¿æ¥ã€‚
*   æˆ‘ä»¬ä½¿ç”¨ [urllib](https://docs.python.org/3/library/urllib.html) åº“çš„ [quote](https://docs.python.org/3/library/urllib.parse.html#urllib.parse.quote) å‡½æ•°å¯¹æ•°æ®è¿›è¡Œç¼–ç ï¼Œç„¶åå¯ä»¥æˆä¸º URL çš„ä¸€éƒ¨åˆ†ã€‚
*   æˆ‘ä»¬ä½¿ç”¨ [Pyppeteer æ–‡æ¡£](https://miyakogi.github.io/pyppeteer/reference.html#debugging)ä¸­æŒ‡å®šçš„ [asyncio](https://docs.python.org/3/library/asyncio.html) åº“ã€‚
*   Lambda å°†æˆ‘ä»¬ä¸Šä¼ çš„æ–‡ä»¶ä¿å­˜åœ¨`/opt`ç›®å½•ä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯åŠ¨æ— å¤´ Chromium è°ƒç”¨`/opt/python/lib/python3.7/site-packages/headless-chromium`ï¼Œè¿™è¦æ„Ÿè°¢ [launch](https://miyakogi.github.io/pyppeteer/reference.html#launcher) å‡½æ•°çš„`executablePath`é€‰é¡¹ã€‚
*   æˆ‘ä»¬ä½¿ç”¨ [goto](https://miyakogi.github.io/pyppeteer/reference.html#pyppeteer.page.Page.goto) å‡½æ•°è®¿é—® HTML æ¨¡æ¿ï¼Œä½¿ç”¨ [pdf](https://miyakogi.github.io/pyppeteer/reference.html#pyppeteer.page.Page.pdf) å‡½æ•°ç”Ÿæˆ pdf å†…å®¹ã€‚
*   æˆ‘ä»¬ä½¿ç”¨ [boto3](https://boto3.amazonaws.com/v1/documentation/api/latest/index.html) åº“çš„ [put_object](https://boto3.amazonaws.com/v1/documentation/api/latest/reference/services/s3.html#S3.Client.put_object) å‡½æ•°å°†æˆ‘ä»¬çš„ PDF æ–‡ä»¶å­˜å‚¨åœ¨æˆ‘ä»¬åˆ›å»ºçš„ S3 æ¡¶ä¸­ã€‚

**â¡ï¸åŠŸèƒ½æç¤º**

æˆ‘æä¾›äº†ä¸€äº›å¯ä»¥åœ¨å¼‚æ­¥å‡½æ•°ä¸­ä½¿ç”¨çš„ç²¾å½©æŠ€å·§:

*   å¦‚æœè¦æ£€ç´¢æµè§ˆå™¨æ§åˆ¶å°æ˜¾ç¤ºçš„æ¶ˆæ¯ï¼Œä½¿ç”¨[æ§åˆ¶å°äº‹ä»¶](https://miyakogi.github.io/pyppeteer/reference.html#page-class)å’Œ[æ§åˆ¶å°æ¶ˆæ¯ç±»](https://miyakogi.github.io/pyppeteer/reference.html#consolemessage-class)ï¼Œ
*   å¦‚æœæ‚¨åœ¨ç”Ÿæˆçš„ pdf ä¸­çœ‹åˆ°ä¸€äº›åƒç´ åŒ–çš„å†…å®¹ï¼Œè¯·ä½¿ç”¨`[setViewport](https://miyakogi.github.io/pyppeteer/reference.html#pyppeteer.page.Page.setViewport)` [å‡½æ•°](https://miyakogi.github.io/pyppeteer/reference.html#pyppeteer.page.Page.setViewport)çš„`**deviceScaleFactor**`å‚æ•°ã€‚é»˜è®¤å€¼ä¸º 1.0ã€‚
*   å¦‚æœæ‚¨æƒ³ä½¿ç”¨ localStorage æ–¹æ³•ï¼Œè¯·è½¬åˆ°é¡µé¢ï¼Œä½¿ç”¨[è¯„ä¼°å‡½æ•°](https://miyakogi.github.io/pyppeteer/reference.html#pyppeteer.page.Page.evaluate)å°†æ•°æ®å€¼æ’å…¥ localStorageï¼Œç„¶åå†æ¬¡è½¬åˆ°é¡µé¢ã€‚
*   é»˜è®¤æƒ…å†µä¸‹ï¼Œç”Ÿæˆçš„ PDF æ–‡ä»¶å…·æœ‰ä¿¡å‡½æ ¼å¼ã€‚æ‚¨å¯ä»¥é€šè¿‡`**format**`é€‰é¡¹è¿›è¡Œæ”¹å˜ã€‚

**â¡ï¸åŠŸèƒ½ä½œç”¨**

æˆ‘ä»¬è½¬åˆ°ä¸è¯¥å‡½æ•°ç›¸å…³è”çš„è§’è‰²ï¼Œæ·»åŠ `**AmazonS3FullAccess**`ç­–ç•¥ï¼Œè¿™æ ·æˆ‘ä»¬çš„å‡½æ•°å°±å¯ä»¥ç¼–å†™åœ¨ bucket ä¸­ç”Ÿæˆçš„ PDF æ–‡ä»¶ã€‚

![](img/85b7f183e54191ee2fb8128ba2fce5f7.png)

**â¡ï¸åŠŸèƒ½è®¾ç½®**

æˆ‘ä»¬çš„ Lambda å‡½æ•°å°†è¿è¡Œä¸€ä¸ª Chromium å®ä¾‹ï¼Œå› æ­¤å¯èƒ½éœ€è¦å‡ ç§’é’Ÿçš„æ—¶é—´å¹¶ä½¿ç”¨åç»­å†…å­˜ã€‚

æˆ‘å‘ç°åœ¨åˆ†é…äº† 2048Mb å†…å­˜çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ª PDF æ–‡ä»¶åœ¨å¤§çº¦ 3.5 ç§’å†…ç”Ÿæˆå¹¶å†™å…¥ä¸€ä¸ªæ¡¶ä¸­ï¼Œå› æ­¤æˆ‘ä»¬å°†å‡½æ•°è¶…æ—¶å€¼æ›´æ”¹ä¸º 5 ç§’ã€‚

![](img/1207fa7c7d683f140fc7b4cb944ee212.png)

# å†³èµ›æˆç»©

[è¿™æ˜¯](https://drive.google.com/file/d/1Ot5pbaFsQQHUIETvjOPPQmZLd6DRzRLN/view)[https://alexandrebruffa.com/pdfreport/](https://alexandrebruffa.com/pdfreport/)ä¸Šæ‰˜ç®¡çš„æ¨¡æ¿ç”Ÿæˆçš„ PDF çš„ç¤ºä¾‹ã€‚å®ƒæ‹¥æœ‰æˆ‘ä»¬éœ€è¦çš„ä¸€åˆ‡:ä»¤äººæƒŠå¹çš„å›¾è¡¨ã€è‡ªå®šä¹‰å­—ä½“ã€é¢œè‰²å’Œå›¾ç‰‡ä¸Šçš„ç”¨æˆ·æ•°æ®ã€‚å®ƒä¹Ÿæœ‰å¯é€‰çš„æ–‡æœ¬å’ŒåµŒå…¥çš„é“¾æ¥ã€‚

å¦‚æœä½ å°è¯•æŒ‰ç…§è¿™ç¯‡æ–‡ç« ç”Ÿæˆ PDFï¼Œè¯·åœ¨è¯„è®ºä¸­ç»™æˆ‘çœ‹ä½ çš„ PDF æ–‡ä»¶ï¼Œæˆ‘ä¼šå¾ˆé«˜å…´çœ‹åˆ°å®ƒä»¬ï¼

# ç»“æŸè¯­

æœ¬æ–‡å‘æ‚¨å±•ç¤ºäº†å¦‚ä½•åœ¨ AWS Lambda ä¸Šä» HTML æ¨¡æ¿ç”Ÿæˆä»¤äººæƒŠå¹çš„ PDF æ–‡ä»¶ã€‚æˆ‘ä»¬äº†è§£äº† AWS Lambda å±‚ã€Pyppeteer åº“å’Œä¸€äº›æˆ‘ä»¬åœ¨é€”ä¸­å‘ç°çš„æ–°å¥‡äº‹ç‰©ã€‚

åœ¨æˆ‘çš„ç ”ç©¶è¿‡ç¨‹ä¸­ï¼Œæˆ‘å‘ç°äº†è¿™ç¯‡ç”± Rafael Brand æ’°å†™çš„[åª’ä½“æ–‡ç« ](https://medium.com/limehome-engineering/running-pyppeteer-on-aws-lambda-with-serverless-62313b3fe3e2)ï¼Œå®ƒå¯èƒ½å¯¹æˆ‘çš„æ–‡ç« æœ‰æ‰€å¸®åŠ©ã€‚

æœ¬æ–‡ä¸­æ˜¾ç¤ºçš„æ‰€æœ‰ id å’Œä»¤ç‰Œéƒ½æ˜¯å‡çš„æˆ–è¿‡æœŸçš„ï¼Œå¦‚æœæ‚¨è¯•å›¾ä½¿ç”¨å®ƒä»¬ï¼Œæ‚¨å°†æ— æ³•å»ºç«‹ä»»ä½•è¿æ¥ã€‚

ç‰¹åˆ«æ„Ÿè°¢ [Gianca Chavest](https://www.instagram.com/niimde/) è®¾è®¡äº†è¿™å¹…ä»¤äººæƒŠå¹çš„æ’å›¾ã€‚