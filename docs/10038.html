<html>
<head>
<title>Real-Time Video Streams With Streamlit-WebRTC</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">ä½¿ç”¨Streamlit-WebRTCçš„å®æ—¶è§†é¢‘æµ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/real-time-video-streams-with-streamlit-webrtc-bd38d15f2ef3?source=collection_archive---------0-----------------------#2021-11-17">https://betterprogramming.pub/real-time-video-streams-with-streamlit-webrtc-bd38d15f2ef3?source=collection_archive---------0-----------------------#2021-11-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="b217" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">é€šè¿‡ç½‘ç»œå¤„ç†å’Œä¼ è¾“å®æ—¶è§†é¢‘</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/377c7e3f83d4f2d8e9e68d2ca3fb3a32.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*H3h0awJSPITIaiw3_86Qaw.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae ky" href="https://unsplash.com/s/photos/video-call?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">ä¸Šçš„<a class="ae ky" href="https://unsplash.com/@surface?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" rel="noopener ugc nofollow" target="_blank">è¡¨é¢</a>å’Œ</a>ç»„æˆ</p></figure><p id="841b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">é€šè¿‡é˜…è¯»è¿™ç¯‡æ–‡ç« ï¼Œä½ å°†å­¦ä¼šç”¨å®æ—¶è§†é¢‘å’ŒéŸ³é¢‘æµæ„å»ºä¸€ä¸ªå¯å…±äº«çš„webåº”ç”¨ç¨‹åºã€‚è¿™å¯¹äºå±•ç¤ºä»»ä½•è®¡ç®—æœºè§†è§‰å’ŒéŸ³é¢‘å¤„ç†ç›¸å…³çš„é¡¹ç›®éƒ½éå¸¸æœ‰ç”¨ã€‚æ•´ä¸ªå®ç°å°†å®Œå…¨åœ¨Pythonä¸­ï¼Œå¯ä»¥é€šè¿‡URLä»ä»–ä»¬çš„æ™ºèƒ½æ‰‹æœºæˆ–å…·æœ‰ç½‘ç»œæ‘„åƒå¤´åŠŸèƒ½çš„è®¡ç®—æœºè®¿é—®å®ƒã€‚</p><p id="061c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">çœ‹çœ‹ä¸‹é¢çš„gifï¼Œå®ƒå±•ç¤ºäº†æˆ‘è¿‡å»çš„ä¸€ä¸ªåŸºäºAnimeGANv2 çš„<a class="ae ky" href="https://github.com/bryandlee/animegan2-pytorch" rel="noopener ugc nofollow" target="_blank"> PyTorchå®ç°çš„ç ”ç©¶é¡¹ç›®ã€‚</a></p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi lv"><img src="../Images/9102100f94aa0509e2788e8e814dedf9.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/1*FRKkjpc__UNlakpvQxwjIg.gif"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ä½œè€…Gif</p></figure><p id="c1ed" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æœ¬æ•™ç¨‹æ¶µç›–äº†ä½¿ç”¨åä¸º<a class="ae ky" href="https://github.com/whitphx/streamlit-webrtc" rel="noopener ugc nofollow" target="_blank"> streamlit-webrtc </a>çš„PythonåŒ…åˆ›å»ºå®æ—¶è§†é¢‘æµwebåº”ç”¨ç¨‹åºçš„åŸºæœ¬å®ç°ã€‚åŸºäºGithubä¸­çš„å®˜æ–¹åº“ï¼Œè¿™ä¸ªåŒ…æä¾›äº†</p><blockquote class="lw lx ly"><p id="c5a4" class="kz la lz lb b lc ld ju le lf lg jx lh ma lj lk ll mb ln lo lp mc lr ls lt lu im bi translated">â€¦é€šè¿‡Streamlitå®ç°ç½‘ç»œä¸Šçš„å®æ—¶è§†é¢‘å’ŒéŸ³é¢‘æµã€‚</p></blockquote><p id="bfc9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å®ƒå»ºç«‹åœ¨<a class="ae ky" href="https://streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit </a>ä¹‹ä¸Šï¼ŒStreamlitæ˜¯ä¸€ä¸ªå¼€æºæ¡†æ¶ï¼Œå¯ä»¥å°†Pythonæ•°æ®è„šæœ¬è½¬æ¢ä¸ºå¯å…±äº«çš„webåº”ç”¨ã€‚</p><p id="ab47" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è®©æˆ‘ä»¬ç»§ç»­ä¸‹ä¸€éƒ¨åˆ†ï¼Œå¼€å§‹å®‰è£…å¿…è¦çš„æ¨¡å—ã€‚</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="3e53" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">è®¾ç½®</h1><p id="e3ff" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">å¼ºçƒˆå»ºè®®æ‚¨åœ¨ç»§ç»­å®‰è£…ä¹‹å‰åˆ›å»ºä¸€ä¸ªæ–°çš„è™šæ‹Ÿç¯å¢ƒã€‚</p><p id="8767" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ¿€æ´»å®ƒå¹¶è¿è¡Œä»¥ä¸‹å‘½ä»¤æ¥å®‰è£…<code class="fe nh ni nj nk b">streamlit-webrtc</code>:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="fe2e" class="np ml it nk b gy nq nr l ns nt">pip install streamlit-webrtc</span></pre><p id="d7e0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å®‰è£…å¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´ï¼Œå› ä¸ºstreamlitéœ€è¦ç›¸å½“å¤šçš„ä¾èµ–é¡¹ã€‚</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="89af" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">å±¥è¡Œ</h1><p id="10fa" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">åœ¨åŒä¸€ä¸ªå·¥ä½œç›®å½•ä¸­ï¼Œåˆ›å»ºä¸€ä¸ªåä¸º<code class="fe nh ni nj nk b">app.py</code>çš„æ–°æ–‡ä»¶ã€‚</p><h2 id="84d6" class="np ml it bd mm nu nv dn mq nw nx dp mu li ny nz mw lm oa ob my lq oc od na oe bi translated">å¯¼å…¥</h2><p id="6bd9" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">åœ¨æ–‡ä»¶é¡¶éƒ¨æ·»åŠ ä»¥ä¸‹å¯¼å…¥è¯­å¥:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="09de" class="np ml it nk b gy nq nr l ns nt">import streamlit as st<br/>from streamlit_webrtc import webrtc_streamer, VideoProcessorBase, RTCConfiguration<br/>import av<br/>import threading</span></pre><p id="72e7" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nh ni nj nk b">av</code>åŒ…å«FFmpegåº“çš„Pythonicç»‘å®šã€‚å®ƒå°†ç”¨äºä»ä¸€ä¸ª<code class="fe nh ni nj nk b">PIL.Image</code>æˆ–numpyæ•°ç»„æ„å»ºä¸€ä¸ªå¸§ã€‚</p><p id="96c3" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¦ä¸€æ–¹é¢ï¼Œ<code class="fe nh ni nj nk b">threading</code>åœ¨å›è°ƒä¸­è®¿é—®/ä¼ é€’å˜é‡æ—¶æä¾›äº†çº¿ç¨‹å®‰å…¨ã€‚</p><h2 id="6204" class="np ml it bd mm nu nv dn mq nw nx dp mu li ny nz mw lm oa ob my lq oc od na oe bi translated">é¡µé¢é…ç½®</h2><p id="169f" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">æ‚¨å¯ä»¥é€šè¿‡è°ƒç”¨<code class="fe nh ni nj nk b">set_page_config</code>å‡½æ•°æ¥è®¾ç½®ç½‘é¡µçš„æ ‡é¢˜å’Œå›¾æ ‡ã€‚</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="edca" class="np ml it nk b gy nq nr l ns nt">st.set_page_config(page_title="Streamlit WebRTC Demo", page_icon="ğŸ¤–")</span></pre><h2 id="5cd6" class="np ml it bd mm nu nv dn mq nw nx dp mu li ny nz mw lm oa ob my lq oc od na oe bi translated">è¡¥å……æŠ¥é“</h2><p id="92fb" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">æ¥ä¸‹æ¥ï¼Œæ·»åŠ ä¸‹é¢çš„ä»£ç ï¼Œå®ƒå°†ä¸ºä»»åŠ¡é€‰æ‹©åˆ›å»ºä¸€ä¸ªä¾§æ ã€‚</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="af35" class="np ml it nk b gy nq nr l ns nt">task_list = ["Video Stream"]</span><span id="4039" class="np ml it nk b gy of nr l ns nt">with st.sidebar:<br/>    st.title('Task Selection')<br/>    task_name = st.selectbox("Select your tasks:", task_list)<br/>st.title(task_name)</span></pre><p id="5635" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘åªä¸ºè¿™ä¸ªåº”ç”¨ç¨‹åºè®¾ç½®äº†ä¸€ä¸ªä»»åŠ¡ã€‚å®ƒå°†åœ¨webåº”ç”¨ç¨‹åºçš„å·¦ä¾§å‘ˆç°ä»¥ä¸‹ç”¨æˆ·ç•Œé¢:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi og"><img src="../Images/97a606847dd19eecf73a767cf5f80c67.png" data-original-src="https://miro.medium.com/v2/resize:fit:994/format:webp/1*wLvMwriOszOEt0i7pcdNCA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ä½œè€…å›¾ç‰‡</p></figure><p id="a2b0" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ‚¨å¯ä»¥è½»æ¾è®¾ç½®å¤šä¸ªä»»åŠ¡ï¼Œå¹¶åœ¨å•ä¸ªåº”ç”¨ç¨‹åºä¸­ç‹¬ç«‹è¿è¡Œå®ƒä»¬ã€‚æ‚¨éœ€è¦åšçš„å°±æ˜¯æ·»åŠ æ¡ä»¶æ£€æŸ¥ä»£ç ï¼Œå¹¶ç›¸åº”åœ°å®ä¾‹åŒ–ç›¸åº”çš„å°éƒ¨ä»¶ã€‚ä¸¾ä¸ªä¾‹å­ï¼Œ</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="42d2" class="np ml it nk b gy nq nr l ns nt">if task_name == task_list[0]:<br/>    style_list = ['color', 'black and white']</span><span id="4c58" class="np ml it nk b gy of nr l ns nt">st.sidebar.header('Style Selection')<br/>    style_selection = st.sidebar.selectbox("Choose your style:", style_list)</span></pre><p id="8a31" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å½“ç”¨æˆ·é€‰æ‹©ç¬¬ä¸€ä¸ªä»»åŠ¡æ—¶ï¼Œä¸Šé¢çš„ä»£ç å°†åœ¨ä¾§è¾¹æ åˆ›å»ºä¸€ä¸ªé¢å¤–çš„æ ‡ç­¾å’Œä¸‹æ‹‰åˆ—è¡¨:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi oh"><img src="../Images/0f3faa46ade21984f0c73f5f93221ff1.png" data-original-src="https://miro.medium.com/v2/resize:fit:1002/format:webp/1*v4N00p2aTRBOnmgavFHYvA.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ä½œè€…å›¾ç‰‡</p></figure><h2 id="75ce" class="np ml it bd mm nu nv dn mq nw nx dp mu li ny nz mw lm oa ob my lq oc od na oe bi translated">è§†é¢‘å¤„ç†å™¨</h2><p id="60a1" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">å®Œæˆåï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç»§æ‰¿è‡ª<code class="fe nh ni nj nk b">VideoProcessorBase</code>çš„<code class="fe nh ni nj nk b">VideoProcessor</code>ç±»ï¼Œå‡½æ•°å¦‚ä¸‹:</p><ul class=""><li id="c652" class="oi oj it lb b lc ld lf lg li ok lm ol lq om lu on oo op oq bi translated"><code class="fe nh ni nj nk b">init</code>:ä»»ä½•åˆå§‹åŒ–ä»£ç éƒ½åº”è¯¥æ”¾åœ¨è¿™é‡Œ</li><li id="de39" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated"><code class="fe nh ni nj nk b">recv</code>:æ¥æ”¶å¹¶è¿”å›å¸§çš„å›è°ƒæ–¹æ³•ã€‚è¯¥å¸§æ˜¯<a class="ae ky" href="https://pyav.org/docs/develop/api/video.html#av.video.frame.VideoFrame" rel="noopener ugc nofollow" target="_blank"> avçš„å®ä¾‹ã€‚è§†é¢‘æ¡†</a>ã€‚ä½ åº”è¯¥åœ¨è¿™ä¸ªå›è°ƒä¸­è°ƒç”¨æ‰€æœ‰çš„å›¾åƒå¤„ç†æ–¹æ³•ã€‚</li></ul><p id="0438" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åï¼Œå®ä¾‹åŒ–è¯¥ç±»ï¼Œå¹¶ä¼ å…¥ä»¥ä¸‹å‚æ•°:</p><ul class=""><li id="0300" class="oi oj it lb b lc ld lf lg li ok lm ol lq om lu on oo op oq bi translated"><code class="fe nh ni nj nk b">key</code>:å”¯ä¸€æ ‡è¯†ç¬¦ã€‚åªéœ€ä½¿ç”¨ä»»æ„å­—ç¬¦ä¸²</li><li id="f2c5" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated"><code class="fe nh ni nj nk b">video_processor_factory</code> : <code class="fe nh ni nj nk b">VideoProcessorBase</code>å®ä¾‹ç±»</li></ul><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="59b5" class="np ml it nk b gy nq nr l ns nt">class VideoProcessor(VideoProcessorBase):<br/>    def __init__(self):<br/>        self.style = 'color'</span><span id="5021" class="np ml it nk b gy of nr l ns nt">    def recv(self, frame):<br/>        img = frame.to_image()<br/>        <br/>        # image processing code here<br/>    <br/>        return av.VideoFrame.from_image(img)</span><span id="2f72" class="np ml it nk b gy of nr l ns nt">webrtc_streamer(key="vpf", video_processor_factory=VideoProcessor)</span></pre><p id="903b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe nh ni nj nk b">recv</code>å‡½æ•°ä¸­çš„ä»£ç åŸºäºPILã€‚å¦‚æœæ‚¨æ›´å–œæ¬¢ä½¿ç”¨opencvï¼Œè¯·ä¿®æ”¹å¦‚ä¸‹:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="fe02" class="np ml it nk b gy nq nr l ns nt">class VideoProcessor(VideoProcessorBase):<br/>    def __init__(self):<br/>        self.style = 'color'</span><span id="4b94" class="np ml it nk b gy of nr l ns nt">def recv(self, frame):<br/>        img = frame.to_ndarray(format="bgr24")<br/>        <br/>        # image processing code here<br/>    <br/>        return av.VideoFrame.from_ndarray(img, format="bgr24")</span><span id="68d4" class="np ml it nk b gy of nr l ns nt">webrtc_streamer(key="vpf", video_processor_factory=VideoProcessor)</span></pre><p id="4554" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å‡è®¾å½“ç”¨æˆ·é€‰æ‹©ç¬¬äºŒç§é£æ ¼é€‰é¡¹æ—¶ï¼Œæ‚¨æ‰“ç®—å°†è§†é¢‘æµæ›´æ”¹ä¸ºé»‘ç™½ã€‚æ‚¨å¯ä»¥ç®€å•åœ°ä¿®æ”¹<code class="fe nh ni nj nk b">recv</code>åŠŸèƒ½ï¼Œå¦‚ä¸‹æ‰€ç¤º:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="4064" class="np ml it nk b gy nq nr l ns nt">def recv(self, frame):<br/>    img = frame.to_image()<br/>        <br/>    # image processing code here<br/>    # using PIL to convert img to greyscale<br/>    if self.style == style_list[1]:<br/>        img = img.convert("L")</span><span id="b5fd" class="np ml it nk b gy of nr l ns nt">    return av.VideoFrame.from_image(img)</span></pre><p id="2303" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¯·æ³¨æ„ï¼Œå›è°ƒæ–¹æ³•åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­æ‰§è¡Œæ—¶æœ‰ä¸€äº›é™åˆ¶:</p><ul class=""><li id="ba78" class="oi oj it lb b lc ld lf lg li ok lm ol lq om lu on oo op oq bi translated">ä»»ä½•streamlitæ–¹æ³•åœ¨<code class="fe nh ni nj nk b">recv()</code>å†…éƒ¨éƒ½ä¸èµ·ä½œç”¨ã€‚è¿™åŒ…æ‹¬æ‰€æœ‰çš„<code class="fe nh ni nj nk b">st.</code>åŠŸèƒ½ï¼Œå¦‚<code class="fe nh ni nj nk b">st.write()</code></li><li id="6440" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated">æ‚¨ä¸èƒ½å¼•ç”¨å›è°ƒä¹‹å¤–çš„ä»»ä½•å˜é‡(å³ä½¿æ‚¨ä½¿ç”¨äº†globalå…³é”®å­—)</li><li id="334d" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated">å½“ä»å›è°ƒå¤–éƒ¨å’Œå†…éƒ¨è®¿é—®ç›¸åŒçš„å¯¹è±¡æ—¶ï¼Œæ‚¨éœ€è¦å°å¿ƒå¹¶å®ç°çº¿ç¨‹å®‰å…¨çš„ä»£ç ã€‚</li></ul><p id="e6be" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¯è™½å¦‚æ­¤ï¼Œæ‚¨å¯ä»¥åˆ©ç”¨ä»¥ä¸‹æŠ€å·§æ¥ä¼ é€’å˜é‡:</p><ul class=""><li id="a2bc" class="oi oj it lb b lc ld lf lg li ok lm ol lq om lu on oo op oq bi translated">åˆå§‹åŒ–<code class="fe nh ni nj nk b">init</code>åŠŸèƒ½ä¸­çš„å˜é‡</li><li id="a3e7" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated">ä»<code class="fe nh ni nj nk b">webrtc_streamer</code>è·å–ä¸Šä¸‹æ–‡å¯¹è±¡å¹¶ç›´æ¥æ“ä½œå˜é‡</li></ul><p id="d7f9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä»¥ä¸‹ç¤ºä¾‹è¯´æ˜äº†å½“ç”¨æˆ·ä»ä¸‹æ‹‰åˆ—è¡¨ä¸­é€‰æ‹©ä¸€ä¸ªé€‰é¡¹æ—¶ï¼Œå¦‚ä½•æ›´æ”¹<code class="fe nh ni nj nk b">style</code>å€¼ã€‚</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="599d" class="np ml it nk b gy nq nr l ns nt">st.sidebar.header('Style Selection')<br/>style_selection = st.sidebar.selectbox("Choose your style:", style_list)</span><span id="e585" class="np ml it nk b gy of nr l ns nt">...</span><span id="1370" class="np ml it nk b gy of nr l ns nt">ctx = webrtc_streamer(key="vpf", video_processor_factory=VideoProcessor)</span><span id="af61" class="np ml it nk b gy of nr l ns nt">if ctx.video_processor:<br/>    ctx.video_processor.style = style_selection</span></pre><p id="9e55" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¤„ç†å¤æ‚ç‰©ä½“æ—¶è€ƒè™‘ä½¿ç”¨<code class="fe nh ni nj nk b">threading.Lock</code>ã€‚ä¾‹å¦‚ï¼Œæ‚¨å¯ä»¥æŒ‰å¦‚ä¸‹æ–¹å¼æ›´æ–°æ ·å¼:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="ffcf" class="np ml it nk b gy nq nr l ns nt">st.sidebar.header('Style Selection')<br/>style_selection = st.sidebar.selectbox("Choose your style:", style_list)</span><span id="1fe4" class="np ml it nk b gy of nr l ns nt">...</span><span id="9dd9" class="np ml it nk b gy of nr l ns nt">class VideoProcessor(VideoProcessorBase):<br/>    def __init__(self):<br/>        self.model_lock = threading.Lock()<br/>        self.style = style_list[0]</span><span id="f3fc" class="np ml it nk b gy of nr l ns nt">    def update_style(self, new_style):<br/>        if self.style != new_style:<br/>            with self.model_lock:<br/>                self.style = new_style</span><span id="2d9b" class="np ml it nk b gy of nr l ns nt">...</span><span id="618f" class="np ml it nk b gy of nr l ns nt">ctx = webrtc_streamer(key="vpf", video_processor_factory=VideoProcessor)</span><span id="0bfc" class="np ml it nk b gy of nr l ns nt">if ctx.video_processor:<br/>    ctx.video_transformer.update_style(style_selection)</span></pre><h2 id="4eba" class="np ml it bd mm nu nv dn mq nw nx dp mu li ny nz mw lm oa ob my lq oc od na oe bi translated">WebRTCé…ç½®</h2><p id="4e07" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">é™¤æ­¤ä¹‹å¤–ï¼Œæ‚¨å¯ä»¥å‘<code class="fe nh ni nj nk b">webrtc_stream</code>ä¼ é€’é¢å¤–çš„å‚æ•°:</p><ul class=""><li id="a31b" class="oi oj it lb b lc ld lf lg li ok lm ol lq om lu on oo op oq bi translated"><code class="fe nh ni nj nk b">media_stream_constraints</code>:æ¥å—ä»£è¡¨<code class="fe nh ni nj nk b">getUserMedia</code>å‡½æ•°çš„<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia#parameters" rel="noopener ugc nofollow" target="_blank">çº¦æŸ</a>çš„å­—å…¸ã€‚</li><li id="685b" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu on oo op oq bi translated"><code class="fe nh ni nj nk b">rtc_configuration</code> : <code class="fe nh ni nj nk b">RTCConfiguration</code>çœ©æ™•æˆ–è½¬èº«æœåŠ¡å™¨çš„å¯¹è±¡ã€‚ä¾›æ‚¨å‚è€ƒï¼ŒSTUNæŒ‡çš„æ˜¯NATçš„ä¼šè¯éå†å®ç”¨ç¨‹åºã€‚å®ƒèƒ½å¤Ÿè¯†åˆ«å®¢æˆ·ç«¯çš„å…¬å…±åœ°å€ã€å®ƒä»¬èƒŒåçš„NATç±»å‹ä»¥åŠé€šè¿‡NATä¸ç‰¹å®šæœ¬åœ°ç«¯å£å…³è”çš„äº’è”ç½‘ç«¯ç«¯å£ã€‚å¦‚æœæ‚¨æ‰“ç®—é€šè¿‡IPæˆ–åŸŸåè¿œç¨‹æä¾›åº”ç”¨ç¨‹åºï¼Œåˆ™éœ€è¦æ­¤è®¾ç½®ã€‚å¦‚æœæ‚¨åœ¨localhostä¸‹å·¥ä½œï¼Œå¯ä»¥å®‰å…¨åœ°å¿½ç•¥è¿™ä¸€ç‚¹ã€‚</li></ul><p id="1497" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åˆå§‹åŒ–ä¸‹é¢çš„é…ç½®ï¼Œå®ƒåŒ…å«äº†Googleçš„STUNæœåŠ¡å™¨çš„urlã€‚æ‚¨å¯ä»¥æ ¹æ®è‡ªå·±çš„å–œå¥½éšæ„ä½¿ç”¨ä»»ä½•å…¶ä»–STUNæœåŠ¡å™¨:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="2af7" class="np ml it nk b gy nq nr l ns nt">RTC_CONFIGURATION = RTCConfiguration(<br/>    {"iceServers": [{"urls": ["stun:stun.l.google.com:19302"]}]}<br/>)</span></pre><p id="9d58" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åï¼Œç®€å•åœ°å¦‚ä¸‹åˆå§‹åŒ–<code class="fe nh ni nj nk b">webrtc_streamer</code>:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="e214" class="np ml it nk b gy nq nr l ns nt">ctx = webrtc_streamer(<br/>        key="example",<br/>        video_processor_factory=VideoProcessor,<br/>        rtc_configuration=RTC_CONFIGURATION,<br/>        media_stream_constraints={<br/>            "video": True,<br/>            "audio": False<br/>        }<br/>    )</span></pre><p id="80e9" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹<a class="ae ky" href="https://gist.github.com/wfng92/c60994e046df02065827d1ef3832977d" rel="noopener ugc nofollow" target="_blank">è¦ç‚¹</a>ä¸­æ‰¾åˆ°å®Œæ•´çš„ä»£ç :</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="ow ox l"/></div></figure></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="b42f" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">è¯•éªŒ</h1><p id="8b98" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">ä¿å­˜æ–‡ä»¶å¹¶åœ¨ç»ˆç«¯ä¸Šè¿è¡Œä»¥ä¸‹å‘½ä»¤:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="3f98" class="np ml it nk b gy nq nr l ns nt">streamlit run app.py</span></pre><p id="b1e2" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å®ƒå°†é€šè¿‡æ‚¨çš„é»˜è®¤æµè§ˆå™¨æ‰“å¼€ä¸€ä¸ªæŒ‡å‘ä»¥ä¸‹URLçš„æ–°ç½‘é¡µ:</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="6149" class="np ml it nk b gy nq nr l ns nt">http://localhost:8501/</span></pre><p id="68e1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹ç”¨æˆ·ç•Œé¢:</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi oy"><img src="../Images/04a796af4fc4ac26064a6bd7c0252b3a.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*9JCRuJ2FDMp4MaSswfqYBA.png"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ä½œè€…å›¾ç‰‡</p></figure><p id="ff6b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç‚¹å‡»<code class="fe nh ni nj nk b">START</code>æŒ‰é’®ï¼Œå®ƒä¼šè¯¢é—®æ‚¨æ˜¯å¦å…è®¸ä½¿ç”¨ç›¸æœºå’ŒéŸ³é¢‘ã€‚ä¹‹åï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°æ‚¨çš„ç½‘ç»œæ‘„åƒå¤´æ‹æ‘„çš„è§†é¢‘æµã€‚</p><p id="ae13" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å½“è°ƒç”¨<code class="fe nh ni nj nk b">streamlit run</code>å‘½ä»¤æ—¶ï¼Œæ‚¨å¯ä»¥ä¼ é€’é¢å¤–çš„é€‰é¡¹ã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹å‘½ä»¤å°†å…¶è®¾ç½®ä¸ºæ— å¤´ï¼Œå¹¶å°†ç«¯å£æ›´æ”¹ä¸º8005è€Œä¸æ˜¯8051(é»˜è®¤):</p><pre class="kj kk kl km gt nl nk nm nn aw no bi"><span id="021d" class="np ml it nk b gy nq nr l ns nt">streamlit run app.py --server.headless true --server.port 8005</span></pre></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="60ab" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">HTTPS</h1><p id="82ca" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">è¯·æ³¨æ„ï¼Œæ­¤åŒ…ä»…åœ¨å®‰å…¨ä¸Šä¸‹æ–‡ä¸­å·¥ä½œï¼Œå› ä¸ºå®ƒä½¿ç”¨<a class="ae ky" href="https://developer.mozilla.org/en-US/docs/Web/API/MediaDevices/getUserMedia" rel="noopener ugc nofollow" target="_blank"> getUserMedia </a>æ¥è®¿é—®æœ¬åœ°åª’ä½“è®¾å¤‡ã€‚ä»å®˜æ–¹æ–‡ä»¶æ¥çœ‹ï¼Œå®ƒå£°æ˜â€¦</p><blockquote class="lw lx ly"><p id="a43c" class="kz la lz lb b lc ld ju le lf lg jx lh ma lj lk ll mb ln lo lp mc lr ls lt lu im bi translated">ç®€è€Œè¨€ä¹‹ï¼Œå®‰å…¨ä¸Šä¸‹æ–‡æ˜¯ä½¿ç”¨HTTPSæˆ–file:/// URLæ–¹æ¡ˆåŠ è½½çš„é¡µé¢ï¼Œæˆ–è€…æ˜¯ä»localhoståŠ è½½çš„é¡µé¢ã€‚</p></blockquote><p id="a95e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¦‚æœæ‚¨å°†åº”ç”¨ç¨‹åºæ‰˜ç®¡åœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šï¼Œåˆ™å¿…é¡»å°†å…¶éƒ¨ç½²ä¸ºHTTPSã€‚è€ƒè™‘é˜…è¯»æˆ‘ä»¥å‰çš„<a class="ae ky" href="https://levelup.gitconnected.com/how-to-proxy-https-traffic-to-your-development-server-63c9980d5899" rel="noopener ugc nofollow" target="_blank">æ–‡ç« </a>,äº†è§£å¼€å‘æœŸé—´ä»£ç†HTTPSæµé‡çš„å¿«é€Ÿè§£å†³æ–¹æ¡ˆ:</p><ul class=""><li id="1cfd" class="oi oj it lb b lc ld lf lg li ok lm ol lq om lu on oo op oq bi translated"><a class="ae ky" href="https://levelup.gitconnected.com/how-to-proxy-https-traffic-to-your-development-server-63c9980d5899" rel="noopener ugc nofollow" target="_blank">å¦‚ä½•å°†HTTPSæµé‡ä»£ç†åˆ°æ‚¨çš„å¼€å‘æœåŠ¡å™¨</a></li></ul></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="4651" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">ç»“è®º</h1><p id="0206" class="pw-post-body-paragraph kz la it lb b lc nc ju le lf nd jx lh li ne lk ll lm nf lo lp lq ng ls lt lu im bi translated">è®©æˆ‘ä»¬å›é¡¾ä¸€ä¸‹ä½ ä»Šå¤©æ‰€å­¦çš„å†…å®¹ã€‚</p><p id="8f0c" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æœ¬æ–‡é¦–å…ˆç®€è¦ä»‹ç»äº†streamlitå’Œwebrtcã€‚ç„¶åï¼Œå®ƒé€šè¿‡<code class="fe nh ni nj nk b">pip install</code>è¿›å…¥å®‰è£…è¿‡ç¨‹ã€‚</p><p id="300b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¿˜ä»‹ç»äº†è®¾ç½®ä¾§æ å’Œæ›´æ”¹é¡µé¢é…ç½®ã€‚éšåï¼Œå®ƒä¸º<code class="fe nh ni nj nk b">VideoProcessor</code>ç±»æä¾›äº†æ·±å…¥çš„è§£é‡Šï¼Œä»¥åŠå¦‚ä½•ä¸ºæ‚¨è‡ªå·±çš„ç”¨ä¾‹æ‰©å±•å®ƒã€‚</p><p id="25fa" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æœ€åï¼Œå®ƒè®¨è®ºäº†åœ¨å‘½ä»¤è¡Œä¸Šè¿è¡Œåº”ç”¨ç¨‹åºï¼Œä»¥åŠåœ¨è¿œç¨‹æœåŠ¡å™¨ä¸Šæ‰˜ç®¡æ—¶ï¼Œåœ¨å®‰å…¨çš„ä¸Šä¸‹æ–‡ä¸­æœåŠ¡webåº”ç”¨ç¨‹åºçš„éœ€è¦ã€‚</p><p id="f54e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ„Ÿè°¢ä½ é˜…è¯»è¿™ç¯‡æ–‡ç« ã€‚ç¥ä½ æœ‰ç¾å¥½çš„ä¸€å¤©ï¼</p></div><div class="ab cl md me hx mf" role="separator"><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi mj"/><span class="mg bw bk mh mi"/></div><div class="im in io ip iq"><h1 id="0037" class="mk ml it bd mm mn mo mp mq mr ms mt mu jz mv ka mw kc mx kd my kf mz kg na nb bi translated">å‚è€ƒ</h1><ol class=""><li id="3a18" class="oi oj it lb b lc nc lf nd li oz lm pa lq pb lu pc oo op oq bi translated"><a class="ae ky" href="https://github.com/whitphx/streamlit-webrtc" rel="noopener ugc nofollow" target="_blank"> GitHub â€” streamlit-webrtc </a></li><li id="862d" class="oi oj it lb b lc or lf os li ot lm ou lq ov lu pc oo op oq bi translated"><a class="ae ky" href="https://docs.streamlit.io/" rel="noopener ugc nofollow" target="_blank"> Streamlit â€”æ–‡æ¡£</a></li></ol></div></div>    
</body>
</html>