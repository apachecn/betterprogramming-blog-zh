<html>
<head>
<title>AR Face Tracking in an Agora iOS Conference Call</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">Agora iOSç”µè¯ä¼šè®®ä¸­çš„ARäººè„¸è·Ÿè¸ª</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/ar-face-tracking-in-an-agora-ios-conference-call-fb85b40c1fe0?source=collection_archive---------8-----------------------#2019-07-17">https://betterprogramming.pub/ar-face-tracking-in-an-agora-ios-conference-call-fb85b40c1fe0?source=collection_archive---------8-----------------------#2019-07-17</a></blockquote><div><div class="fc ih ii ij ik il"/><div class="im in io ip iq"><div class=""/><div class=""><h2 id="3d92" class="pw-subtitle-paragraph jq is it bd b jr js jt ju jv jw jx jy jz ka kb kc kd ke kf kg kh dk translated">ä½¿ç”¨ARé¢éƒ¨è·Ÿè¸ªä½¿å¤šäººé€šè¯æ¯”æ™®é€šç”µè¯ä¼šè®®æ›´å…·å‚ä¸æ€§</h2></div><figure class="kj kk kl km gt kn gh gi paragraph-image"><div role="button" tabindex="0" class="ko kp di kq bf kr"><div class="gh gi ki"><img src="../Images/4ef8fef4d858e085fa9f3f2a967e469f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/1*60HBrh6iA-ULTFU7k5kFOg.jpeg"/></div></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ç…§ç‰‡ç”±<a class="ae ky" href="https://www.pexels.com/photo/close-up-photo-of-smiling-woman-sitting-on-sofa-using-smartphone-1919238/" rel="noopener ugc nofollow" target="_blank"> Raxpixel </a>åœ¨<a class="ae ky" href="https://www.pexels.com/photo/close-up-photo-of-smiling-woman-sitting-on-sofa-using-smartphone-1919238/" rel="noopener ugc nofollow" target="_blank">åƒç´ </a>ä¸Šæ‹æ‘„</p></figure><p id="76e5" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ä½¿ç”¨ARäººè„¸è·Ÿè¸ªæ¥å¢å¼ºå®æ—¶è™šæ‹Ÿå®¶åº­èšä¼šå¯¹è¯çš„çœŸå®æ€§æ˜¯ä¸€ç§è™šæ‹Ÿå®éªŒçš„å¥½æ–¹æ³•ã€‚è¿™ä¹Ÿæ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹å¼ï¼Œä½ å¯ä»¥æˆ´ç€è™šæ‹Ÿçš„æ´¾å¯¹é¢å…·å’Œä½ çš„æœ‹å‹åœ¨ç½‘ä¸Šç©å•¤é…’ä¹’ä¹“ï¼Œæˆ–è€…å‚ä¸å…¶ä»–ç½‘ç»œæ¶ä½œå‰§ã€‚</p></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="a19d" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">è®¾ç½®Agoraçš„iOS SDK</h1><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi mu"><img src="../Images/2b7eea6b95e71dc30d35001c5534ac7f.png" data-original-src="https://miro.medium.com/v2/resize:fit:450/format:webp/1*CuJmKrqgprkQ_U9thbWnyQ.png"/></div></figure><p id="0d33" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è®¾ç½®Agoraçš„iOS SDKçœŸçš„å¾ˆç®€å•ã€‚æ ¸å¿ƒæ˜¯ä¸€ä¸ªSingletonï¼Œæ‚¨å¯ä»¥éšæ„ä½¿ç”¨å®ƒæ¥å®ç°AgoraåŠŸèƒ½ã€‚ç®€è€Œè¨€ä¹‹:æ‚¨åœ¨ç›®å½•ä¸Šè¿è¡ŒCocoapodsï¼Œå‘AppDelegate.swiftæ·»åŠ ä¸€ä¸ªAppIDï¼Œå¹¶æ·»åŠ æ‘„åƒå¤´å’Œéº¦å…‹é£æƒé™(åˆ«å¿˜äº†è¿™ä¸€æ­¥ï¼).ç„¶åï¼Œå°†<code class="fe mv mw mx my b">AgoraRtcEngineKit</code>å¯¼å…¥è§†å›¾æ§åˆ¶å™¨ï¼Œæ·»åŠ è®¾ç½®æœ¬åœ°å’Œè¿œç¨‹è§†é¢‘çš„åŠŸèƒ½ï¼ŒåŠ å…¥é€šé“ï¼Œå¹¶è®¾ç½®ä»£ç†ã€‚æ‚¨å¯ä»¥ä¸€æ­¥ä¸€æ­¥åœ°å®Œæˆé›†æˆã€‚</p><h2 id="a455" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">ç¬¬ä¸€æ­¥:æ¤°å­</h2><p id="476c" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">å¯¼èˆªåˆ°æ ¹ç›®å½•ã€‚å¦‚æœä½ è¿˜æ²¡æœ‰é…é…¿å¥½ï¼Œç°åœ¨å°±æ˜¯å¼€å§‹çš„å¥½æ—¶æœºã€‚å¦‚æœæ²¡æœ‰å®‰è£…Cocoapodsï¼Œè¿è¡Œ:<code class="fe mv mw mx my b">brew install cocoapods</code>ã€‚å¦‚æœæœ‰ï¼Œè·‘:<code class="fe mv mw mx my b">pod init</code>ã€‚</p><p id="ec0a" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ¥ä¸‹æ¥ï¼Œå°†ä»¥ä¸‹å†…å®¹æ·»åŠ åˆ°æ‚¨çš„<code class="fe mv mw mx my b">Podfile</code>:</p><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="27df" class="mz md it my b gy nu nv l nw nx">platform :ios, â€˜9.0â€™<br/>use_frameworks!<br/>   target â€˜Your Appâ€™ do<br/>   pod â€˜AgoraRtcEngine_iOSâ€™<br/>end</span></pre><p id="5a21" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ›´æ–°æ‚¨çš„æœ¬åœ°Cocoapodsåº“:</p><p id="48b1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mv mw mx my b">pod update</code></p><p id="854e" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ›´æ–°podåï¼Œå®‰è£…:</p><p id="bc00" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mv mw mx my b">pod install</code></p><p id="e5f4" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ‰“å¼€ä½ çš„åº”ç”¨ç¨‹åº:</p><p id="798d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mv mw mx my b">open YourApp.xcworkspace</code></p><p id="1753" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç°åœ¨ï¼Œæ·»åŠ æ‘„åƒå¤´å’Œéº¦å…‹é£çš„æƒé™ã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi ny"><img src="../Images/4544cbb0cf37d2b041ebba8ffb783540.png" data-original-src="https://miro.medium.com/v2/resize:fit:598/format:webp/1*Oc1iXaiCGeKtM9YDMd7kqA.png"/></div></figure><h2 id="4780" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">ç¬¬äºŒæ­¥:åº”ç”¨ç¨‹åºå§”æ‰˜å’Œå•ä¾‹</h2><p id="0387" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">åœ¨ä½ çš„<code class="fe mv mw mx my b">AppDelegate.swift</code>é¡¶éƒ¨æ·»åŠ ä¸€ä¸ªå¸¸é‡:</p><p id="1479" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mv mw mx my b"><strong class="lb iu">let</strong> AppID = â€œâ€</code></p><p id="096d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨é‚£é‡ŒåŠ ä¸Šä½ çš„<code class="fe mv mw mx my b">AppID</code>ã€‚</p><p id="2629" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç„¶åï¼Œè½¬åˆ°æ‚¨çš„è§†å›¾æ§åˆ¶å™¨æ–‡ä»¶ã€‚åœ¨è¿™é‡Œï¼Œæ‚¨éœ€è¦åœ¨é¡¶éƒ¨æ·»åŠ ä»¥ä¸‹å†…å®¹:</p><p id="cce1" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated"><code class="fe mv mw mx my b">import AgoraRtcEngineKit</code></p><p id="2cff" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">Agoraç”¨äºè°ƒç”¨<code class="fe mv mw mx my b">AgoraRtcEngine</code>å®ä¾‹çš„<code class="fe mv mw mx my b">Singleton</code>è®¾è®¡æ¨¡å¼æ˜¯é€šè¿‡è°ƒç”¨<code class="fe mv mw mx my b">sharedEngine:withAppID:delegate</code>æ–¹æ³•è§¦å‘çš„ï¼Œå…¶ä¸­<code class="fe mv mw mx my b">agoraKit.enableWebSdkInteroperability(<strong class="lb iu">true</strong>)</code>ã€‚</p><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="303e" class="mz md it my b gy nu nv l nw nx">func initializeAgoraEngine() {<br/>    agoraKit = AgoraRtcEngineKit.sharedEngine(withAppId: AppID, delegate: self)<br/>    agoraKit.enableWebSdkInteroperability(<strong class="my iu">true</strong>)<br/>}</span></pre><h2 id="8df1" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">ç¬¬ä¸‰æ­¥:è®¾ç½®è§†é¢‘</h2><ul class=""><li id="e84b" class="nz oa it lb b lc nl lf nm li ob lm oc lq od lu oe of og oh bi translated">å¯ç”¨è§†é¢‘:</li></ul><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="7acc" class="mz md it my b gy nu nv l nw nx">func setupVideo() {</span><span id="c178" class="mz md it my b gy oi nv l nw nx">    agoraKit.enableVideo()<br/>       agoraKit.setVideoEncoderConfiguration(AgoraVideoEncoderConfiguration(size: AgoraVideoDimension640x360, frameRate: .fps15, bitrate: AgoraVideoBitrateStandard, orientationMode: .adaptative) ) // Default video profile is 360P </span><span id="ab51" class="mz md it my b gy oi nv l nw nx">}</span></pre><ul class=""><li id="7891" class="nz oa it lb b lc ld lf lg li oj lm ok lq ol lu oe of og oh bi translated">åŠ å…¥é¢‘é“:</li></ul><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="3e38" class="mz md it my b gy nu nv l nw nx">func joinChannel() {<br/>    agoraKit.setDefaultAudioRouteToSpeakerphone(true)<br/>    agoraKit.joinChannel(byToken: nil, channelId: â€œdemoChannel1â€, info:nil, uid:0){[weak self] (sid, uid, elapsed) -&gt; Void in<br/>    // Join channel â€œdemoChannel1â€<br/>    }<br/>   UIApplication.shared.isIdleTimerDisabled = true<br/>}</span></pre><ul class=""><li id="643d" class="nz oa it lb b lc ld lf lg li oj lm ok lq ol lu oe of og oh bi translated">è°ƒç”¨<code class="fe mv mw mx my b">viewDidLoad()</code>ä¸­çš„æ–¹æ³•:</li></ul><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="32cd" class="mz md it my b gy nu nv l nw nx">override func viewDidAppear(_ animated: Bool) {           <br/>    super.viewDidAppear(animated)<br/>    <br/>    initializeAgoraEngine()<br/>    setupVideo()<br/>    showJoinAlert()<br/>}</span><span id="51c8" class="mz md it my b gy oi nv l nw nx">func showJoinAlert() {<br/>    let alertController = UIAlertController(title: nil, message: â€œReady to join channel.â€, preferredStyle: .alert)<br/>    let action = UIAlertAction(title: â€œJoinâ€, style: .destructive) { (action:UIAlertAction) in<br/>    self.joinChannel()<br/>  }<br/>  alertController.addAction(action)<br/>  present(alertController, animated: true, completion: nil)</span><span id="fd67" class="mz md it my b gy oi nv l nw nx">}</span></pre><ul class=""><li id="00c5" class="nz oa it lb b lc ld lf lg li oj lm ok lq ol lu oe of og oh bi translated">ä»£ç†åˆ†æœº:</li></ul><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="d9e5" class="mz md it my b gy nu nv l nw nx">extension VideoCallViewController: AgoraRtcEngineDelegate {<br/>   func rtcEngine(_ engine: AgoraRtcEngineKit,      <br/>   firstRemoteVideoDecodedOfUid uid:UInt, size:CGSize, elapsed:Int) {<br/>   if (remoteVideo.isHidden) {<br/>   remoteVideo.isHidden = false<br/>}</span><span id="624c" class="mz md it my b gy oi nv l nw nx">let videoCanvas = AgoraRtcVideoCanvas()<br/>    videoCanvas.uid = uid<br/>    videoCanvas.view = remoteVideo<br/>    videoCanvas.renderMode = .hidden<br/>    agoraKit.setupRemoteVideo(videoCanvas)<br/>}</span><span id="2290" class="mz md it my b gy oi nv l nw nx">internal func rtcEngine(_ engine: AgoraRtcEngineKit, didOfflineOfUid uid:UInt, reason:AgoraUserOfflineReason) {</span><span id="3f1a" class="mz md it my b gy oi nv l nw nx">self.remoteVideo.isHidden = true<br/>}</span><span id="cf1c" class="mz md it my b gy oi nv l nw nx">func rtcEngine(_ engine: AgoraRtcEngineKit, didVideoMuted muted:Bool, byUid:UInt) {</span><span id="d137" class="mz md it my b gy oi nv l nw nx">remoteVideo.isHidden = muted<br/>    remoteVideoMutedIndicator.isHidden = !muted<br/>    }<br/>}</span></pre><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi om"><img src="../Images/f8000c9fb175df7d0034303a538ad48c.png" data-original-src="https://miro.medium.com/v2/resize:fit:512/format:webp/1*BYQR236Y7dhCjmKFN6jXKg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">é˜¿å°”åŸºç‰¹</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="9c15" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">ç”µè¯ä¼šè®®</h1><p id="7bc1" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">å°†Agora SDKè¿æ¥åˆ°ARKitå¯ä»¥åœ¨å®æ—¶ç”µè¯ä¼šè®®ä¸­å®ç°å¢å¼ºç°å®ã€‚æ­£å¦‚ARSCNViewæ–‡æ¡£ä¸­æ‰€æè¿°çš„:â€œè§†å›¾è‡ªåŠ¨å‘ˆç°æ¥è‡ªè®¾å¤‡æ‘„åƒæœºçš„å®æ—¶è§†é¢‘ä½œä¸ºåœºæ™¯èƒŒæ™¯ã€‚â€åœ¨æˆ‘ä»¬çš„ARäººè„¸è·Ÿè¸ªå®ç°ä¸­ï¼Œæˆ‘ä»¬å°†è®¾ç½®ARKitåœ¨æœ¬åœ°è€Œä¸æ˜¯è¿œç¨‹è·Ÿè¸ªæˆ‘ä»¬çš„äººè„¸ã€‚</p><h2 id="fbb9" class="mz md it bd me na nb dn mi nc nd dp mm li ne nf mo lm ng nh mq lq ni nj ms nk bi translated">é˜¿å°”åŸºç‰¹</h2><p id="d4ab" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">è¦å¯ç”¨æœ¬åœ°è§†é¢‘çš„ARäººè„¸è·Ÿè¸ªï¼Œè¯·å°†æœ¬åœ°è§†é¢‘æ–¹æ³•é…ç½®åˆ°<code class="fe mv mw mx my b">ARSCNView()</code>ã€‚ç„¶åï¼Œé…ç½®è§†å›¾æ§åˆ¶å™¨ï¼Œé€šè¿‡ä»¥ä¸‹æ–¹å¼æ£€æŸ¥æ˜¯å¦æ”¯æŒAR:</p><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="8961" class="mz md it my b gy nu nv l nw nx">func setupLocalVideo(uid: UInt) {<br/>        <br/>        <br/>        let videoView = ARSCNView()<br/>        videoView.tag = Int(uid)<br/>        videoView.backgroundColor = UIColor.orange<br/>        <br/>//        let videoCanvas = AgoraRtcVideoCanvas()<br/>//        videoCanvas.uid = uid<br/>//        videoCanvas.view = videoView<br/>//        videoCanvas.renderMode = .hidden<br/>//        agoraKit.setupLocalVideo(videoCanvas)</span><span id="ea51" class="mz md it my b gy oi nv l nw nx">        self.sceneView = videoView<br/>        self.sceneView?.delegate = self<br/>        <br/>        if isARSupported {<br/>            let configuration = ARFaceTrackingConfiguration()<br/>            sceneView?.session.run(configuration)<br/>        }<br/>        <br/>        let tapGuesture = UITapGestureRecognizer(target: self, action: #selector(handleTap(_:)))<br/>        tapGuesture.numberOfTapsRequired = 1<br/>        self.sceneView?.addGestureRecognizer(tapGuesture)</span><span id="da92" class="mz md it my b gy oi nv l nw nx">stackView.addArrangedSubview(videoView)<br/>    }</span></pre><p id="49fd" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¦ä½¿ARSCNView()èƒ½å¤Ÿæ˜¾ç¤ºè¡¨æƒ…ç¬¦å·ï¼Œæ‚¨å¿…é¡»é‡‡å–ä¸€äº›é¢å¤–çš„æ­¥éª¤ã€‚Ray Wenderlichçš„åšå®¢æ–‡ç« è¯¦ç»†ä»‹ç»äº†è¿™äº›æ­¥éª¤ã€‚</p><p id="cb44" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç®€è€Œè¨€ä¹‹ï¼Œè®©æˆ‘ä»¬åœ¨è¿™é‡Œå›é¡¾ä¸€ä¸‹è¿™äº›æ­¥éª¤:</p><ul class=""><li id="b871" class="nz oa it lb b lc ld lf lg li oj lm ok lq ol lu oe of og oh bi translated">å¯¼å…¥ARKit:</li></ul><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="fb0e" class="mz md it my b gy nu nv l nw nx">import ARKit </span></pre><ul class=""><li id="d5e7" class="nz oa it lb b lc ld lf lg li oj lm ok lq ol lu oe of og oh bi translated">æ·»åŠ é…ç½®:</li></ul><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="42a9" class="mz md it my b gy nu nv l nw nx">override func viewWillAppear(_ animated: Bool) {<br/>  super.viewWillAppear(animated)<br/>        <br/>  // 1<br/>  let configuration = ARFaceTrackingConfiguration()<br/>        <br/>  // 2<br/>  sceneView.session.run(configuration)<br/>}<br/>    <br/>override func viewWillDisappear(_ animated: Bool) {<br/>  super.viewWillDisappear(animated)<br/>        <br/>  // 1<br/>  sceneView.session.pause()<br/>}</span></pre><ul class=""><li id="b0ad" class="nz oa it lb b lc ld lf lg li oj lm ok lq ol lu oe of og oh bi translated">æ·»åŠ ç½‘æ ¼é®ç½©:</li></ul><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="049a" class="mz md it my b gy nu nv l nw nx">// 1<br/>extension Bling: ARSCNViewDelegate {<br/>  // 2<br/>  func renderer(_ renderer: SCNSceneRenderer, nodeFor anchor: ARAnchor) -&gt; SCNNode? {<br/>    <br/>    // 3<br/>    guard let device = sceneView.device else {<br/>      return nil<br/>    }<br/>    <br/>    // 4<br/>    let faceGeometry = ARSCNFaceGeometry(device: device)<br/>    <br/>    // 5<br/>    let node = SCNNode(geometry: faceGeometry)<br/>    <br/>    // 6<br/>    node.geometry?.firstMaterial?.fillMode = .lines<br/>    <br/>    // 7<br/>    return node<br/>  }<br/>}</span></pre><ul class=""><li id="6643" class="nz oa it lb b lc ld lf lg li oj lm ok lq ol lu oe of og oh bi translated">å°†ä»¥ä¸‹ä»£ç æ·»åŠ åˆ°<code class="fe mv mw mx my b">viewDidLoad()</code>:</li></ul><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="3425" class="mz md it my b gy nu nv l nw nx">sceneView.delegate = self</span></pre><ul class=""><li id="11ba" class="nz oa it lb b lc ld lf lg li oj lm ok lq ol lu oe of og oh bi translated">æ›´æ–°ç½‘æ ¼é®ç½©:</li></ul><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="7bc0" class="mz md it my b gy nu nv l nw nx">// 1<br/>func renderer(<br/>  _ renderer: SCNSceneRenderer, <br/>  didUpdate node: SCNNode, <br/>  for anchor: ARAnchor) {<br/>   <br/>  // 2<br/>  guard let faceAnchor = anchor as? ARFaceAnchor,<br/>    let faceGeometry = node.geometry as? ARSCNFaceGeometry else {<br/>      return<br/>  }<br/>    <br/>  // 3<br/>  faceGeometry.update(from: faceAnchor.geometry)<br/>}</span></pre><ul class=""><li id="6ea6" class="nz oa it lb b lc ld lf lg li oj lm ok lq ol lu oe of og oh bi translated">æ·»åŠ è¡¨æƒ…ç¬¦å·bling:</li></ul><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="8af4" class="mz md it my b gy nu nv l nw nx">let noseOptions = ["ğŸ‘ƒ", "ğŸ½", "ğŸ’§", " "]</span></pre><ul class=""><li id="8545" class="nz oa it lb b lc ld lf lg li oj lm ok lq ol lu oe of og oh bi translated">æ·»åŠ è¡¨æƒ…ç¬¦å·èŠ‚ç‚¹:</li></ul><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="f7e4" class="mz md it my b gy nu nv l nw nx">// 1<br/>node.geometry?.firstMaterial?.transparency = 0.0<br/><br/>// 2<br/>let noseNode = EmojiNode(with: noseOptions)<br/><br/>// 3<br/>noseNode.name = "nose"<br/><br/>// 4<br/>node.addChildNode(noseNode)<br/><br/>// 5<br/>updateFeatures(for: node, using: faceAnchor)</span></pre><p id="6238" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">æ„å»ºå¹¶è¿è¡Œåº”ç”¨ç¨‹åºã€‚å¦‚æœä¸€åˆ‡å·¥ä½œæ­£å¸¸ï¼Œé‚£ä¹ˆä½ æœ‰ä¸€ä¸ªæœ¬åœ°è§†é¢‘çš„ç½‘æ ¼é®ç½©ã€‚ç‚¹å‡»å®ƒå¯ä»¥ä»è¡¨æƒ…æ•°ç»„ä¸­çš„ä¸€ä¸ªå…ƒç´ æ·»åŠ ä¸€ä¸ªæ‰‹åŠ¿ï¼å¦‚æœä½ éœ€è¦ä»£ç åº“çš„ç²¾ç¡®å‰¯æœ¬ï¼Œé‚£ä¹ˆå°±åœ¨<a class="ae ky" href="https://pastebin.com/0ZrSb1aX" rel="noopener ugc nofollow" target="_blank">çš„å‰ªè´´æ¿</a>ä¸ŠæŸ¥çœ‹ã€‚</p><figure class="kj kk kl km gt kn gh gi paragraph-image"><div class="gh gi on"><img src="../Images/56cb5d443dd8d7bc057beb4a29a91a15.png" data-original-src="https://miro.medium.com/v2/resize:fit:1182/format:webp/1*kJRIWlGVmGkK1EYruajtqg.png"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">iPhone X iOSä¸Šçš„ARKitç½‘ç»œè§†é¢‘é€šè¯</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="c935" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">ARKitçš„å…¶ä»–é¢éƒ¨è·Ÿè¸ªé›†æˆ</h1><p id="3606" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">ä½¿ç”¨ä»¥ä¸‹ç³»åˆ—ä¸ºæ‚¨çš„çœ¼ç›ã€å˜´å·´æˆ–å¤´éƒ¨æ·»åŠ æ–°é€‰é¡¹:</p><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="e6c6" class="mz md it my b gy nu nv l nw nx">let eyeOptions = ["ğŸ‘", "ğŸŒ•", "ğŸŒŸ", "ğŸ”¥", "âš½ï¸", "ğŸ”", " "]<br/>let mouthOptions = ["ğŸ‘„", "ğŸ‘…", "â¤ï¸", " "]<br/>let hatOptions = ["ğŸ“", "ğŸ©", "ğŸ§¢", "â›‘", "ğŸ‘’", " "]</span></pre><p id="0f91" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">åœ¨æ‚¨çš„<code class="fe mv mw mx my b">renderer(_:nodeFor:)</code>ä¸­æ·»åŠ è¯¦ç»†ä¿¡æ¯:</p><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="dbbf" class="mz md it my b gy nu nv l nw nx">let leftEyeNode = EmojiNode(with: eyeOptions)<br/>leftEyeNode.name = "leftEye"<br/>leftEyeNode.rotation = SCNVector4(0, 1, 0, GLKMathDegreesToRadians(180.0))<br/>node.addChildNode(leftEyeNode)<br/>    <br/>let rightEyeNode = EmojiNode(with: eyeOptions)<br/>rightEyeNode.name = "rightEye"<br/>node.addChildNode(rightEyeNode)<br/>    <br/>let mouthNode = EmojiNode(with: mouthOptions)<br/>mouthNode.name = "mouth"<br/>node.addChildNode(mouthNode)<br/>    <br/>let hatNode = EmojiNode(with: hatOptions)<br/>hatNode.name = "hat"<br/>node.addChildNode(hatNode)</span></pre><p id="de3b" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">è¦ç´¢å¼•è¿™äº›åŠŸèƒ½ï¼Œè¯·æ·»åŠ ä»¥ä¸‹å†…å®¹:</p><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="424f" class="mz md it my b gy nu nv l nw nx">let features = ["nose", "leftEye", "rightEye", "mouth", "hat"]<br/>let featureIndices = [[9], [1064], [42], [24, 25], [20]]</span></pre><p id="a00d" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">ç”¨ä»¥ä¸‹ä»£ç æ›´æ–°<code class="fe mv mw mx my b">updateFeatures(for:using:)</code>æ–¹æ³•:</p><pre class="kj kk kl km gt nq my nr ns aw nt bi"><span id="4fff" class="mz md it my b gy nu nv l nw nx">// 1<br/>for (feature, indices) in zip(features, featureIndices)  {<br/>  // 2<br/>  let child = node.childNode(withName: feature, recursively: false) as? EmojiNode<br/>  <br/>  // 3<br/>  let vertices = indices.map { anchor.geometry.vertices[$0] }<br/>  <br/>  // 4<br/>  child?.updatePosition(for: vertices)<br/>}</span></pre><p id="3e51" class="pw-post-body-paragraph kz la it lb b lc ld ju le lf lg jx lh li lj lk ll lm ln lo lp lq lr ls lt lu im bi translated">å¦‚æœæ‚¨æ­£ç¡®åœ°å®ç°äº†æœ¬èŠ‚ä¸­çš„ä»£ç ç‰‡æ®µï¼Œæ‚¨åº”è¯¥èƒ½å¤Ÿæ·»åŠ çœ¼ç›ã€å˜´å·´æˆ–å¸½å­ã€‚ä»¥ä¸‹æ˜¯è§†å›¾æ§åˆ¶å™¨çš„ä»£ç :</p><figure class="kj kk kl km gt kn"><div class="bz fp l di"><div class="oo op l"/></div><p class="ku kv gj gh gi kw kx bd b be z dk translated">ViewControllerçš„ä»£ç åº“</p></figure></div><div class="ab cl lv lw hx lx" role="separator"><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma mb"/><span class="ly bw bk lz ma"/></div><div class="im in io ip iq"><h1 id="12eb" class="mc md it bd me mf mg mh mi mj mk ml mm jz mn ka mo kc mp kd mq kf mr kg ms mt bi translated">ä¸‹ä¸€æ­¥æ˜¯ä»€ä¹ˆï¼Ÿ</h1><p id="e3de" class="pw-post-body-paragraph kz la it lb b lc nl ju le lf nm jx lh li nn lk ll lm no lo lp lq np ls lt lu im bi translated">ARäººè„¸è·Ÿè¸ªæ˜¯ä¸€ç§å¾ˆå¥½çš„æ–¹å¼ï¼Œå¯ä»¥è®©å¤šæˆå‘˜é€šè¯æ¯”ä¸€èˆ¬çš„ç”µè¯ä¼šè®®æ›´æ´»è·ƒã€‚å¦‚æœä½ å–œæ¬¢ç¾å®¹äº§å“ã€æœè£…æˆ–å…¶ä»–ç±»å‹çš„è´­ç‰©ï¼Œé‚£ä¹ˆä½ å’Œä½ çš„æœ‹å‹å¯èƒ½ä¼šå–œæ¬¢å°è¯•ARåŒ–å¦†ã€æŸ“å‘ã€çš®è‚¤å…‰æ»‘ã€å…‰æ³½ã€å£çº¢ã€ç‰™é½¿ç¾ç™½æˆ–é¢éƒ¨æ•´å½¢ã€‚æœ‰å¾ˆå¤šä¸åŒçš„æ–¹æ³•å¯ä»¥é›†æˆARäººè„¸è·Ÿè¸ªä»¥å®ç°å®æ—¶äº’åŠ¨ã€‚</p></div></div>    
</body>
</html>