<html>
<head>
<title>How to Build a Fault Tolerant Redis Network With Spring Boot and Docker</title>
<link href="../Styles/Style.css" type="text/css" rel="stylesheet"/>
</head>
<body>
<h1 class="translated">å¦‚ä½•ç”¨Spring Bootå’Œå¤šå…‹æ„å»ºå®¹é”™Redisç½‘ç»œ</h1>
<blockquote>åŸæ–‡ï¼š<a href="https://betterprogramming.pub/how-to-build-a-fault-tolerant-redis-network-with-spring-boot-and-docker-17e16ad898ed?source=collection_archive---------4-----------------------#2020-06-10">https://betterprogramming.pub/how-to-build-a-fault-tolerant-redis-network-with-spring-boot-and-docker-17e16ad898ed?source=collection_archive---------4-----------------------#2020-06-10</a></blockquote><div><div class="fc ie if ig ih ii"/><div class="ij ik il im in"><div class=""/><div class=""><h2 id="1dba" class="pw-subtitle-paragraph jn ip iq bd b jo jp jq jr js jt ju jv jw jx jy jz ka kb kc kd ke dk translated">å…·æœ‰å¤åˆ¶å’Œæ•…éšœè½¬ç§»åŠŸèƒ½çš„é›†ç¾¤</h2></div><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/123c59ee6c172a5679b6d0ea7b624a58.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5uKbeF6UNpZOphpM.jpg"/></div></div></figure><p id="d122" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ln">ç¼–è€…æŒ‰:è¿™ç¯‡æ–‡ç« ç»è¿‡ç¼–è¾‘ï¼Œä½¿ç”¨äº†ä¸€ä¸ªæ›´æœ‰æ€æƒ³çš„æœºå™¨ä¹‹é—´çš„ä¸»è¦/æ¬¡è¦å…³ç³»ï¼Œè€Œä¸æ˜¯ä»¥å‰çš„ã€æ–‡åŒ–ä¸Šä¸æ•æ„Ÿçš„æœ¯è¯­ã€‚æ ¹æ®æ‚¨åœ¨å½“åœ°ä½¿ç”¨çš„æœ¯è¯­ï¼Œæ‚¨å¯èƒ½éœ€è¦æ›´æ–°æˆ‘ä»¬åœ¨è¿™é‡Œç§°ä¸ºä¸»/æ¬¡çš„æœ¯è¯­ï¼Œä»¥åŒ¹é…æ‚¨çš„ç³»ç»Ÿã€‚è°¢è°¢ï¼</em></p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><p id="4ed3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­ï¼Œå®ç°å®¹é”™æ˜¯æˆåŠŸçš„å…³é”®æ ‡å‡†ä¹‹ä¸€ã€‚</p><p id="41f1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬çœ‹ä¸€ä¸‹åœ¨Redisç½‘ç»œä¸­ä½¿ç”¨Redisé›†ç¾¤å’Œsentinelså®ç°å®¹é”™å’Œå¤åˆ¶ã€‚</p><p id="5ea3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨æœ¬æ•™ç¨‹ä¸­ï¼Œæˆ‘å°†ä»‹ç»:</p><ul class=""><li id="d82b" class="lv lw iq kt b ku kv kx ky la lx le ly li lz lm ma mb mc md bi translated"><a class="ae me" href="#83e7" rel="noopener ugc nofollow">Redisç®€ä»‹</a></li><li id="1f93" class="lv lw iq kt b ku mf kx mg la mh le mi li mj lm ma mb mc md bi translated">ä½¿ç”¨Dockeråˆ›å»ºå¸¦æœ‰Redisç¼“å­˜çš„spring bootåº”ç”¨ç¨‹åº</li><li id="85cb" class="lv lw iq kt b ku mf kx mg la mh le mi li mj lm ma mb mc md bi translated">æ„å»ºå®¹é”™Redisç½‘ç»œçš„ä¸åŒæ–¹æ³•</li><li id="5501" class="lv lw iq kt b ku mf kx mg la mh le mi li mj lm ma mb mc md bi translated"><em class="ln">ç”¨redisé›†ç¾¤åˆ†ç‰‡</em></li><li id="a5ed" class="lv lw iq kt b ku mf kx mg la mh le mi li mj lm ma mb mc md bi translated"><em class="ln">ä½¿ç”¨redisé›†ç¾¤è¿›è¡Œå¤åˆ¶</em></li><li id="9bb2" class="lv lw iq kt b ku mf kx mg la mh le mi li mj lm ma mb mc md bi translated"><em class="ln">å¸¦sentinel(æ— åˆ†ç‰‡)çš„Redisä¸»ä»ç½‘ç»œ</em></li></ul></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="83e7" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">Redisç®€ä»‹</h1><blockquote class="nc nd ne"><p id="932a" class="kr ks ln kt b ku kv jr kw kx ky ju kz nf lb lc ld ng lf lg lh nh lj lk ll lm ij bi translated">Redisæ˜¯ä¸€ä¸ªå¼€æºçš„(BSDè®¸å¯çš„)ã€å†…å­˜ä¸­çš„æ•°æ®ç»“æ„å­˜å‚¨ï¼Œç”¨ä½œæ•°æ®åº“ã€ç¼“å­˜å’Œæ¶ˆæ¯ä»£ç†ã€‚</p><p id="1b27" class="kr ks ln kt b ku kv jr kw kx ky ju kz nf lb lc ld ng lf lg lh nh lj lk ll lm ij bi translated">Rediså…·æœ‰å†…ç½®çš„å¤åˆ¶ã€LRUé©±é€ã€äº‹åŠ¡å’Œä¸åŒçº§åˆ«çš„ç£ç›˜æŒä¹…æ€§ï¼Œå¹¶é€šè¿‡Redis Sentinelå’ŒRedis Clusterçš„è‡ªåŠ¨åˆ†åŒºæä¾›é«˜å¯ç”¨æ€§ã€‚</p><p id="1607" class="kr ks ln kt b ku kv jr kw kx ky ju kz nf lb lc ld ng lf lg lh nh lj lk ll lm ij bi translated">ä¸ºäº†å®ç°å…¶å‡ºè‰²çš„æ€§èƒ½ï¼ŒRediså·¥ä½œåœ¨å†…å­˜ä¸­ã€‚</p></blockquote><p id="ef83" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">â€”<a class="ae me" href="https://redis.io/topics/introduction#:~:text=In%20order%20to%20achieve%20its,each%20command%20to%20a%20log." rel="noopener ugc nofollow" target="_blank">Redisç®€ä»‹</a></p><h2 id="fcfd" class="ni ml iq bd mm nj nk dn mq nl nm dp mu la nn no mw le np nq my li nr ns na nt bi translated">åœ¨æˆ‘ä»¬æ·±å…¥ç ”ç©¶ç¼–ç ä¹‹å‰ï¼Œéœ€è¦æ³¨æ„ä¸€äº›å…³é”®çš„Redisç‰¹æ€§</h2><ul class=""><li id="ca65" class="lv lw iq kt b ku nu kx nv la nw le nx li ny lm ma mb mc md bi translated"><strong class="kt ir">æœ€å¤§å†…å­˜:</strong>é»˜è®¤æƒ…å†µä¸‹ï¼ŒRedisåœ¨64ä½ç³»ç»Ÿä¸Šæ²¡æœ‰å†…å­˜é™åˆ¶ï¼Œåœ¨32ä½ç³»ç»Ÿä¸Šæœ‰3 GBå†…å­˜é™åˆ¶ã€‚å¤§å†…å­˜å¯ä»¥åŒ…å«æ›´å¤šçš„æ•°æ®ï¼Œå¹¶æé«˜å‘½ä¸­ç‡ï¼Œè¿™æ˜¯æœ€é‡è¦çš„æŒ‡æ ‡ä¹‹ä¸€ï¼Œä½†åœ¨å†…å­˜çš„æŸä¸ªé™åˆ¶ä¸‹ï¼Œå‘½ä¸­ç‡å°†å¤„äºç›¸åŒçš„æ°´å¹³ã€‚</li><li id="3974" class="lv lw iq kt b ku mf kx mg la mh le mi li mj lm ma mb mc md bi translated"><strong class="kt ir">é©±é€ç®—æ³•:</strong>å½“ç¼“å­˜å¤§å°è¾¾åˆ°å†…å­˜é™åˆ¶æ—¶ï¼Œæ—§æ•°æ®å°†è¢«åˆ é™¤ï¼Œä»¥ä¾¿ä¸ºæ–°æ•°æ®è…¾å‡ºç©ºé—´ã€‚Redisæä¾›<code class="fe nz oa ob oc b">Last Recently Used</code>å’Œ<code class="fe nz oa ob oc b">Least Frequently Used</code>é©±é€ç®—æ³•ã€‚RDBæ—¶é—´ç‚¹å¿«ç…§åœ¨ç‰¹å®šçš„æ—¶é—´é—´éš”æˆ–å†™å…¥æ¬¡æ•°åï¼ŒAOFä¼šä¸ºæ¯ä¸ªå†™å…¥æ“ä½œåˆ›å»ºæŒä¹…æ€§æ—¥å¿—ã€‚</li><li id="10e5" class="lv lw iq kt b ku mf kx mg la mh le mi li mj lm ma mb mc md bi translated"><strong class="kt ir">æŒä¹…æ€§:</strong>å‡ºäºå„ç§åŸå› ï¼Œæ‚¨å¯èƒ½æƒ³è¦æŒä¹…åŒ–æ‚¨çš„ç¼“å­˜ã€‚å¯åŠ¨åï¼Œç¼“å­˜æœ€åˆæ˜¯ç©ºçš„ï¼Œåœ¨åœæœºåæ¢å¤çš„æƒ…å†µä¸‹ï¼Œç”¨å¿«ç…§æ•°æ®å¡«å……å®ƒå°†æ˜¯æœ‰ç”¨çš„ã€‚Redisæ”¯æŒä¸åŒçš„æ–¹å¼æ¥å®ç°æŒä¹…æ€§ã€‚</li></ul></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="eb26" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">å¼€å‘Spring Boot + Redis + Dockeråº”ç”¨ç¨‹åº</h1><p id="251b" class="pw-post-body-paragraph kr ks iq kt b ku nu jr kw kx nv ju kz la od lc ld le oe lg lh li of lk ll lm ij bi translated">åœ¨æœ¬æ–‡çš„æœ€åï¼Œæˆ‘å°†é’ˆå¯¹è¿™ä¸ªæ¼”ç¤ºå¯¹Github repoè¿›è¡Œä¸€äº›æ›´æ–°ã€‚å¦‚æœæ‚¨æƒ³åœ¨æœ¬æ–‡çš„ä¸åŒåœ°æ–¹æŸ¥çœ‹ä»£ç ï¼Œè¯·æŸ¥çœ‹å‘å¸ƒç‰ˆã€‚</p><div class="og oh gp gr oi oj"><a href="https://github.com/avinash10584/spring-boot-redis-cluster.git" rel="noopener  ugc nofollow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">avinash 10584/spring-boot-redis-cluster</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">spring-boot-redis-clusterã€‚åœ¨â€¦ä¸Šåˆ›å»ºä¸€ä¸ªå¸æˆ·ï¼Œä¸ºavinash 10584/spring-boot-redis-clusterå¼€å‘åšå‡ºè´¡çŒ®</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">github.com</p></div></div><div class="os l"><div class="ot l ou ov ow os ox kp oj"/></div></div></a></div><p id="0672" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬å»ºç«‹æˆ‘ä»¬çš„Redisåº”ç”¨ç¨‹åºï¼</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="c377" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">æ­¥éª¤1:åˆ›å»ºä¸€ä¸ªç®€å•çš„Spring Bootå¾…åŠäº‹é¡¹åº”ç”¨ç¨‹åº</h1><p id="78c3" class="pw-post-body-paragraph kr ks iq kt b ku nu jr kw kx nv ju kz la od lc ld le oe lg lh li of lk ll lm ij bi translated">é¦–å…ˆï¼Œè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªç®€å•çš„å¾…åŠäº‹é¡¹åº”ç”¨ç¨‹åºã€‚æˆ‘ä»¬ä¸ä¼šä¸ºå¤šä¸ªç”¨æˆ·åˆ›å»ºå®ƒï¼Œåªæ˜¯ä¸ºäº†ä¿æŒç®€å•ã€‚</p><p id="b4e4" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ç›®å‰ï¼Œæˆ‘ä»¬åªæ˜¯åœ¨åº”ç”¨ç¨‹åºä¸­å­˜å‚¨ä¸€ä¸ªç®€å•çš„å¾…åŠäº‹é¡¹åˆ—è¡¨ä½œä¸ºç¼“å­˜ã€‚æˆ‘ä»¬è¿˜æ²¡æœ‰ä½¿ç”¨æ•°æ®åº“ã€‚</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oy oz l"/></div></figure></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="c95e" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">æ­¥éª¤2:ä¸‹è½½å¹¶å¯åŠ¨Redis Dockeræ˜ åƒ</h1><p id="b077" class="pw-post-body-paragraph kr ks iq kt b ku nu jr kw kx nv ju kz la od lc ld le oe lg lh li of lk ll lm ij bi translated">ä»Docker hubä¸‹è½½å®˜æ–¹Rediså›¾åƒ:</p><p id="40f1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob oc b">docker pull redis</code></p><p id="d406" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨è¿™ä¸ªå‘½ä»¤ä¹‹åï¼Œæ–°çš„æ˜ åƒåº”è¯¥å‡ºç°åœ¨æ‚¨çš„æœ¬åœ°å­˜å‚¨åº“ä¸­(é”®å…¥Docker imagesè¿›è¡Œæ£€æŸ¥)ã€‚</p><p id="ad55" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">GitHubä¸­çš„é¡¹ç›®è¢«é…ç½®ä¸ºä½¿ç”¨ç‹¬ç«‹æ¨¡å¼å’Œé›†ç¾¤æ¨¡å¼ã€‚</p><p id="9b23" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">é¦–å…ˆï¼Œè®©æˆ‘ä»¬åœ¨ç‹¬ç«‹æ¨¡å¼ä¸‹ä½¿ç”¨Redisã€‚æˆ‘ä»¬ä»Dockerhubä¸­æå–çš„Rediså›¾åƒå¼€å§‹:</p><p id="86f9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob oc b">docker run --rm -p 4025:6379 -d --name redis-1 redis redis-server</code></p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="3309" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">æ­¥éª¤3:å°†Redisé›†æˆåˆ°Spring Bootåº”ç”¨ç¨‹åºä¸­</h1><p id="ee84" class="pw-post-body-paragraph kr ks iq kt b ku nu jr kw kx nv ju kz la od lc ld le oe lg lh li of lk ll lm ij bi translated">æˆ‘ä»¬å°†ä½¿ç”¨spring boot cacheä¸Rediså¯¹è¯ã€‚Springé™„å¸¦äº†å‡ ä¸ªæ³¨é‡Šï¼Œæ‚¨å¯ä»¥æ·»åŠ è¿™äº›æ³¨é‡Šæ¥å¸®åŠ©å®ƒä½¿ç”¨Redisç¼“å­˜ã€‚</p><p id="49b8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å°†<code class="fe nz oa ob oc b">@EnableCaching</code>æ·»åŠ åˆ°æ‚¨çš„åº”ç”¨ç¨‹åºé…ç½®ä¸­ï¼Œä»¥å¯ç”¨è¿™äº›æ³¨é‡Š:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oy oz l"/></div></figure><p id="ab58" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ„å»ºæˆ‘ä»¬çš„Dockeråº”ç”¨ç¨‹åºï¼Œä»¥ç¡®ä¿spring bootåº”ç”¨ç¨‹åºå¯ä»¥ä¸Rediså¯¹è¯ã€‚è¯¥é¡¹ç›®çš„dockeræ–‡ä»¶ä½äºgithub repoä¸­ã€‚æˆ‘å°†é‡ç‚¹æ”¾åœ¨Redisä¸Šï¼Œæ‰€ä»¥æˆ‘å°†é¿å…spring bootåº”ç”¨ç¨‹åºçš„dockeræ–‡ä»¶çš„ç»†èŠ‚ã€‚</p><p id="4aeb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚æœæ‚¨æƒ³äº†è§£é¡¹ç›®ä¸­ä½¿ç”¨çš„Dockeræ–‡ä»¶çš„æ›´å¤šä¿¡æ¯ï¼Œå¹¶äº†è§£å¦‚ä½•é¿å…Dockeræ„å»ºæ—¶é—´å’Œä½¿ç”¨ç¼“å­˜ï¼Œé‚£ä¹ˆè¯·çœ‹è¿™ç¯‡æ–‡ç« :</p><div class="og oh gp gr oi oj"><a href="https://medium.com/codingfullstack/5-essential-docker-tips-for-your-spring-boot-images-8f570270d9ba" rel="noopener follow" target="_blank"><div class="ok ab fo"><div class="ol ab om cl cj on"><h2 class="bd ir gy z fp oo fr fs op fu fw ip bi translated">Spring Bootå½¢è±¡çš„5ä¸ªé‡è¦æç¤ºğŸ³</h2><div class="oq l"><h3 class="bd b gy z fp oo fr fs op fu fw dk translated">è·Ÿä¸Šæœ€æ–°å’Œæœ€ä½³å®è·µï¼Œæ„å»ºspring boot dockeræ˜ åƒã€‚</h3></div><div class="or l"><p class="bd b dl z fp oo fr fs op fu fw dk translated">medium.com</p></div></div><div class="os l"><div class="pa l ou ov ow os ox kp oj"/></div></div></a></div><p id="3204" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob oc b">DOCKER_BUILDKIT=1 docker build -t learnings/spring-boot-redis-cluster .</code></p><p id="803e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ä¸€æ—¦æ„å»ºäº†æˆ‘ä»¬çš„æ˜ åƒï¼Œä¸‹ä¸€æ­¥å°±æ˜¯è¿è¡Œè¯¥æ˜ åƒ:</p><p id="d177" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob oc b">docker run --rm -p 4024:4024 --name spring-boot-redis learnings/spring-boot-redis-cluster</code></p><p id="87bb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚æœæ‚¨è¿è¡Œåº”ç”¨ç¨‹åºå¹¶è®¿é—®<code class="fe nz oa ob oc b">http://localhost:4024/app/</code>ï¼Œæ‚¨å°†å¾—åˆ°é”™è¯¯<code class="fe nz oa ob oc b">.ConnectTimeoutException: connection timed out</code>ã€‚</p><p id="feae" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¸Œæœ›æˆ‘ä»¬çš„ä¸¤ä¸ªDockeræ˜ åƒèƒ½å¤Ÿç›¸äº’å¯¹è¯â€”â€”é»˜è®¤æƒ…å†µä¸‹ï¼Œå®ƒä»¬ä½äºè‡ªå·±çš„ç½‘ç»œä¸Šï¼Œå¹¶ä¸”ç›¸äº’éš”ç¦»ã€‚</p><p id="7610" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æ­¤æ—¶æˆ‘ä»¬æœ‰ä¸¤ä¸ªé€‰æ‹©:</p><ul class=""><li id="914b" class="lv lw iq kt b ku kv kx ky la lx le ly li lz lm ma mb mc md bi translated"><strong class="kt ir">ä½¿ç”¨Dockerç½‘ç»œ</strong></li></ul><p id="39c9" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ–è€…ï¼Œ</p><ul class=""><li id="ca09" class="lv lw iq kt b ku kv kx ky la lx le ly li lz lm ma mb mc md bi translated"><strong class="kt ir">åˆ›å»ºä¸€ä¸ªæ„å»ºé»˜è®¤ç½‘ç»œçš„docker-compose</strong></li></ul><p id="de07" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘å°†ä¸ºè¿™ä¸ªæ¼”ç¤ºåˆ›å»ºdockerç½‘ç»œï¼Œæˆ‘æ­£åœ¨åˆ›å»ºä¸€ä¸ªDockerç½‘ç»œï¼Œä½†å¦‚æœä½ æƒ³åœ¨é¡¹ç›®ä¸­æ·»åŠ docker-composeæ–‡ä»¶ï¼Œè¯·åœ¨è¯„è®ºä¸­å‘Šè¯‰æˆ‘ã€‚</p><p id="dd95" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob oc b">docker network create spring-redis-network</code></p><p id="cf25" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ç°åœ¨è®©æˆ‘ä»¬å°†Rediså’Œspring bootæ˜ åƒè¿æ¥åˆ°è¿™ä¸ªç½‘ç»œ:</p><p id="adbb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob oc b">docker network connect spring-redis-network redis-1</code></p><p id="a41e" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬ç°åœ¨å¯ä»¥å¯»æ‰¾Rediså®ä¾‹çš„IPåœ°å€ï¼Œå¹¶åœ¨<code class="fe nz oa ob oc b">application.yml</code>ä¸­è¿›è¡Œæ›´æ–°ã€‚</p><p id="6470" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ln">å¦‚æœæ‚¨ä½¿ç”¨</em> <code class="fe nz oa ob oc b"><em class="ln">docker-compose </em></code> <em class="ln">å¯ä»¥é¿å…è¿™ç§æŸ¥æ‰¾ï¼Œå› ä¸ºå®ƒå¯ä»¥ç»‘å®šæœåŠ¡ï¼Œè€Œæ— éœ€ç»™å‡ºIPåœ°å€çš„ç»†èŠ‚:</em></p><p id="e745" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob oc b">docker inspect spring-redis-network</code></p><p id="7ce3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘çš„IPåœ°å€æ˜¯<code class="fe nz oa ob oc b">172.18.0.2</code></p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="87ef" class="ni ml iq oc b gy pf pg l ph pi">"Name": "redis-1", <br/>"EndpointID": "88b100f3569bb4ed68ac8cbf84f4b5a20493e11c5e7336a052bbbd25bb5f4205", "MacAddress": "02:42:ac:12:00:02", <br/>"IPv4Address": "<strong class="oc ir">172.18.0.2</strong>/16", <br/>"IPv6Address": ""</span></pre><p id="cec3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬ç°åœ¨å¯ä»¥åœ¨<code class="fe nz oa ob oc b">application.yml</code>æ›´æ–°è¿™ä¸ª:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="caf6" class="ni ml iq oc b gy pf pg l ph pi">redis: <br/>   host: 172.18.0.2 <br/>   port: 6379</span></pre><p id="e510" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><em class="ln">æ³¨æ„:æˆ‘ä»¬ä½¿ç”¨ç«¯å£6379ï¼Œå› ä¸ºæˆ‘ä»¬åœ¨Dockerç½‘ç»œä¸­ï¼Œå¯¹ä¸»æœºå…¬å¼€çš„ç«¯å£æ˜¯4025ã€‚</em></p><p id="80da" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ç°åœ¨ï¼Œè®©æˆ‘ä»¬å†æ¬¡æ„å»ºåº”ç”¨ç¨‹åºçš„æ˜ åƒï¼Œå¹¶è¿æ¥åˆ°æˆ‘ä»¬åˆ›å»ºçš„ç½‘ç»œ:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="c9ae" class="ni ml iq oc b gy pf pg l ph pi">DOCKER_BUILDKIT=1 docker build -t learnings/spring-boot-redis-cluster</span></pre><p id="7789" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿è¡ŒDockeræ˜ åƒæ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡ä¼ é€’<code class="fe nz oa ob oc b">--net</code>è¿æ¥åˆ°ç½‘ç»œ:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="165c" class="ni ml iq oc b gy pf pg l ph pi">docker run --rm --net spring-redis-network -p 4024:4024 --name spring-boot-redis learnings/spring-boot-redis-cluster</span></pre><p id="506a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æ‚¨åº”è¯¥åœ¨<code class="fe nz oa ob oc b"><a class="ae me" href="http://localhost:4024/app/" rel="noopener ugc nofollow" target="_blank">http://localhost:4024/app/</a></code>å¤„çœ‹åˆ°å¾…åŠäº‹é¡¹åˆ—è¡¨é¡¹</p><p id="d151" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬å¯ä»¥éªŒè¯ç¼“å­˜æ˜¯åœ¨Docker Redisæ˜ åƒä¸­åˆ›å»ºçš„:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="99b9" class="ni ml iq oc b gy pf pg l ph pi">docker exec -it redis-1 redis-cli --scan</span></pre></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h2 id="824c" class="ni ml iq bd mm nj nk dn mq nl nm dp mu la nn no mw le np nq my li nr ns na nt bi translated">æ­¥éª¤4:ä¿®æ”¹æˆ‘ä»¬çš„åº”ç”¨ç¨‹åºä»¥ä½¿ç”¨Spring Cacheæ³¨é‡Š</h2><p id="814d" class="pw-post-body-paragraph kr ks iq kt b ku nu jr kw kx nv ju kz la od lc ld le oe lg lh li of lk ll lm ij bi translated">Spring Cacheé€šå¸¸ä½¿ç”¨äº”ç§åŸºæœ¬çš„æ³¨é‡Š:</p><ul class=""><li id="dbc7" class="lv lw iq kt b ku kv kx ky la lx le ly li lz lm ma mb mc md bi translated"><code class="fe nz oa ob oc b">@CachePut</code>:ç”¨äºæ›´æ–°ç¼“å­˜ã€‚</li><li id="562c" class="lv lw iq kt b ku mf kx mg la mh le mi li mj lm ma mb mc md bi translated"><code class="fe nz oa ob oc b">@Cacheable</code>:è¿”å›ä¸€ä¸ªæ–¹æ³•çš„ç¼“å­˜å“åº”</li><li id="ac3c" class="lv lw iq kt b ku mf kx mg la mh le mi li mj lm ma mb mc md bi translated"><code class="fe nz oa ob oc b">@CacheEvict</code>:è¦åˆ é™¤ä¸å†éœ€è¦çš„ç¼“å­˜æ¡ç›®ï¼Œå¯ä»¥è€ƒè™‘åˆ é™¤ä¸€ä¸ªå®ä½“ã€‚</li><li id="2b4d" class="lv lw iq kt b ku mf kx mg la mh le mi li mj lm ma mb mc md bi translated"><code class="fe nz oa ob oc b">@Caching</code> : Javaä¸å…è®¸åœ¨ä¸€ä¸ªæ–¹æ³•æˆ–ç±»ä¸­ä¸¤æ¬¡ä½¿ç”¨ç›¸åŒçš„æ³¨é‡Šç±»å‹ã€‚æ‰€ä»¥ï¼Œå¦‚æœä½ æƒ³è¯´<code class="fe nz oa ob oc b">@CacheEvict</code>åœ¨ä¸¤ä¸ªä¸åŒçš„ç¼“å­˜ä¸­ç”¨åŒä¸€ä¸ªæ–¹æ³•<code class="fe nz oa ob oc b">@Cacheable</code>å¯ä»¥ç”¨æ¥èšåˆå…¶ä»–ç¼“å­˜æ³¨é‡Šã€‚</li></ul><p id="b021" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘å·²ç»å°†è¿™äº›æ·»åŠ åˆ°æˆ‘ä»¬çš„<code class="fe nz oa ob oc b">ToDoListController</code>ä¸­ï¼Œçœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oy oz l"/></div></figure><p id="61fc" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬å†æ¬¡è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºå¹¶æ£€æŸ¥Redisç»Ÿè®¡æ•°æ®ï¼Œ</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="c9dd" class="ni ml iq oc b gy pf pg l ph pi">DOCKER_BUILDKIT=1 docker build -t learnings/spring-boot-redis-cluster . </span><span id="20bd" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -p 4024:4024 --name spring-boot-redis learnings/spring-boot-redis-cluster </span><span id="651f" class="ni ml iq oc b gy pj pg l ph pi">docker exec -it redis-1 redis-cli info stats</span></pre><p id="f5c8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚æœä½ æƒ³æ£€æŸ¥åˆ°ç›®å‰ä¸ºæ­¢çš„ä»£ç ï¼Œ<a class="ae me" href="https://github.com/avinash10584/spring-boot-redis-cluster/releases/tag/REDIS-CACHE" rel="noopener ugc nofollow" target="_blank">çœ‹ä¸€ä¸‹æ ‡ç­¾</a>ã€‚</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="98bb" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">ä½¿ç”¨Redisé›†ç¾¤è¿›è¡Œåˆ†ç‰‡</h1><p id="6621" class="pw-post-body-paragraph kr ks iq kt b ku nu jr kw kx nv ju kz la od lc ld le oe lg lh li of lk ll lm ij bi translated">æˆ‘ä»¬å·²ç»ç”¨Redisç¼“å­˜æ„å»ºäº†ä¸€ä¸ªåŸºæœ¬çš„spring bootåº”ç”¨ç¨‹åºã€‚</p><p id="a184" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬å¤„ç†çš„æ˜¯æ— æ³•åŒ…å«åœ¨ä¸€ä¸ªèŠ‚ç‚¹ä¸­çš„å¤§é‡æ•°æ®ï¼Œè¯¥æ€ä¹ˆåŠå‘¢ï¼ŸRedisæ”¯æŒé›†ç¾¤åœ¨å¤šä¸ªèŠ‚ç‚¹ä¸Šå…±äº«æ•°æ®ã€‚</p><p id="9266" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Redisé›†ç¾¤ä¸­çš„æ•´ä¸ªé”®ç©ºé—´è¢«åˆ†æˆ16384ä¸ªæ§½(ç§°ä¸ºå“ˆå¸Œæ§½)ï¼Œè¿™äº›æ§½è¢«åˆ†é…ç»™å¤šä¸ªRedisèŠ‚ç‚¹ã€‚ç»™å®šçš„é”®è¢«æ˜ å°„åˆ°è¿™äº›æ§½ä¸­çš„ä¸€ä¸ªï¼Œå¹¶ä¸”é”®çš„æ•£åˆ—æ§½è¢«è®¡ç®—:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="8c87" class="ni ml iq oc b gy pf pg l ph pi">HASH_SLOT = CRC16(key) mod 16384</span></pre><p id="e023" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼Œæ‚¨ä¸éœ€è¦çŸ¥é“è¿™äº›å†…éƒ¨ä¿¡æ¯ï¼Œå› ä¸ºRedisä¼šå¤„ç†æ¥è‡ªæ­£ç¡®é›†ç¾¤çš„æ•°æ®çš„æ¨é€å’Œæå–ã€‚</p><p id="0285" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬åœæ­¢Redisæ˜ åƒå¹¶æ„å»ºä¸€ä¸ªé›†ç¾¤:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="1d81" class="ni ml iq oc b gy pf pg l ph pi">docker stop redis-1 <br/>docker stop spring-boot-redis</span></pre><p id="2fc6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬å†æ—‹è½¬ä¸¤ä¸ªRedisèŠ‚ç‚¹æ¥æ„å»ºä¸€ä¸ªé›†ç¾¤ã€‚æˆ‘ä»¬è¿˜ä¼ é€’äº†ä¸€ä¸ªä½äºé¡¹ç›®/ <code class="fe nz oa ob oc b">redis-conf</code>ä¸­çš„Redisé…ç½®æ–‡ä»¶ã€‚</p><p id="80f1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> Redisè‡³å°‘éœ€è¦ä¸‰ä¸ªèŠ‚ç‚¹æ‰èƒ½è®©é›†ç¾¤å·¥ä½œã€‚</strong></p><p id="cae2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Redisæ˜ åƒé»˜è®¤ç¦ç”¨Redisé›†ç¾¤æ”¯æŒï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ·»åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶ï¼Œå¹¶å°†å…¶ä¼ é€’ç»™æˆ‘ä»¬çš„Redis Dockeræ˜ åƒã€‚æˆ‘å·²ç»å°†å®ƒæ·»åŠ åˆ°é¡¹ç›®æ ¹ç›®å½•ä¸‹çš„<code class="fe nz oa ob oc b">/redis-conf</code>ä¸­ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/ce50580023fb138d441d4e5041bd54f7.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kwCQQi7et3KnU1wC.png"/></div></div></figure><p id="49d3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬å¼€å§‹ç¢ç‰‡:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="b150" class="ni ml iq oc b gy pf pg l ph pi">docker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf:/redis_config -p 4025:6379 -d --name redis-1 redis redis-server /redis_config/node1.conf </span><span id="973d" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf:/redis_config -p 4026:6379 -d --name redis-2 redis redis-server /redis_config/node2.conf </span><span id="e4ee" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf:/redis_config -p 4027:6379 -d --name redis-3 redis redis-server /redis_config/node3.conf</span></pre><p id="9aa6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">Redisæ˜ åƒå·²ç»ä»¥é›†ç¾¤æ¨¡å¼å¯åŠ¨ï¼Œä½†æ˜¯æˆ‘ä»¬ä»ç„¶éœ€è¦åˆ›å»ºä¸€ä¸ªé›†ç¾¤æ¥å°†å®ƒä»¬ç»‘å®šåœ¨ä¸€èµ·ã€‚æˆ‘ä»¬å¯ä»¥è¿›è¡Œä¸»ä»é…ç½®ï¼Œä½†ç›®å‰ï¼Œæˆ‘ä»¬åªéœ€è¦æ•°æ®åˆ†ç‰‡å¹¶åˆ›å»ºä¸å¸¦æ•…éšœè½¬ç§»çš„é›†ç¾¤ã€‚</p><p id="8f33" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬å°†åœ¨ä¸‹ä¸€èŠ‚è®¨è®ºæ•…éšœè½¬ç§»ã€‚</p><p id="2ca5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºé›†ç¾¤:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="d3f7" class="ni ml iq oc b gy pf pg l ph pi">docker exec -it redis-1 redis-cli --cluster create 172.18.0.2:6379 172.18.0.3:6379 172.18.0.4:6379</span></pre><p id="c466" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æ‚¨åº”è¯¥ä¼šåœ¨è¾“å‡ºä¸­çœ‹åˆ°ç±»ä¼¼è¿™æ ·çš„å†…å®¹:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pk"><img src="../Images/51ae154255382e0b057e575fd4e8a711.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*3OWOOHEJ4PEWmVwD.png"/></div></div></figure><p id="c6d2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬å¯ä»¥æ£€æŸ¥æˆ‘ä»¬çš„Dockerç½‘ç»œï¼Œä»¥è·å–RedisèŠ‚ç‚¹çš„æ–°IPåœ°å€</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="d30c" class="ni ml iq oc b gy pf pg l ph pi">docker inspect spring-redis-network</span></pre><p id="80ba" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬çš„<code class="fe nz oa ob oc b">application-cluster.yml</code>é•¿è¿™æ ·:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oy oz l"/></div></figure><p id="c008" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬åœæ­¢Docker spring bootåº”ç”¨ç¨‹åºï¼Œå¹¶ä½¿ç”¨é›†ç¾¤é…ç½®é‡æ–°å¯åŠ¨å®ƒ:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="5220" class="ni ml iq oc b gy pf pg l ph pi">docker stop spring-boot-redis </span><span id="f447" class="ni ml iq oc b gy pj pg l ph pi">DOCKER_BUILDKIT=1 docker build -t learnings/spring-boot-redis-cluster . </span><span id="c601" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -e "SPRING_PROFILES_ACTIVE=cluster" -p 4024:4024 --name spring-boot-redis learnings/spring-boot-redis-cluster</span></pre><p id="0e48" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æ‚¨å¯ä»¥åœ¨æµè§ˆå™¨ä¸­åˆ·æ–°åº”ç”¨ç¨‹åºï¼Œä»¥éªŒè¯åº”ç”¨ç¨‹åºæ˜¯å¦æ­£å¸¸å·¥ä½œã€‚</p><p id="a1ff" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬è¿˜å¯ä»¥éªŒè¯ä»»ä½•èŠ‚ç‚¹ä¸­çš„ç¾¤é›†é…ç½®:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="2b63" class="ni ml iq oc b gy pf pg l ph pi">docker exec -it redis-2 redis-cli cluster nodes</span></pre><p id="069b" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">åˆ†ç‰‡å…è®¸æˆ‘ä»¬çš„æ•°æ®åˆ†å¸ƒåœ¨å¤§å‹æ•°æ®é›†çš„å¤šä¸ªèŠ‚ç‚¹ä¸­ï¼Œå¹¶é€šè¿‡å“ˆå¸Œå‡å°‘æŸ¥æ‰¾ã€‚</p><p id="86a6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬çš„é›†ç¾¤ç¼ºå°‘åˆ†å¸ƒå¼ç³»ç»Ÿçš„ä¸¤ä¸ªå…³é”®å®‰å…¨æ£€æŸ¥:æ•…éšœè½¬ç§»å¤„ç†å’Œå¤åˆ¶ã€‚</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="9e71" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">ä½¿ç”¨Redisé›†ç¾¤è¿›è¡Œå¤åˆ¶</h1><p id="0a59" class="pw-post-body-paragraph kr ks iq kt b ku nu jr kw kx nv ju kz la od lc ld le oe lg lh li of lk ll lm ij bi translated">Redisé›†ç¾¤å…è®¸æˆ‘ä»¬å®ç°æ•…éšœè½¬ç§»å¤„ç†å’Œå¤åˆ¶ã€‚</p><p id="613c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬å°†åœ¨ä¸»ä»é…ç½®ä¸­è®¾ç½®èŠ‚ç‚¹ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªçˆ¶èŠ‚ç‚¹å’Œä¸¤ä¸ªå‰¯æœ¬èŠ‚ç‚¹ã€‚</p><p id="5505" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿™æ ·ï¼Œå¦‚æœæˆ‘ä»¬å¤±å»ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç¾¤é›†ä»ç„¶èƒ½å¤Ÿé€‰ä¸¾æ–°çš„ä¸»èŠ‚ç‚¹ã€‚åœ¨æ­¤è®¾ç½®ä¸­ï¼Œå†™å…¥å¿…é¡»é€šè¿‡ä¸»æœåŠ¡å™¨ï¼Œå› ä¸ºå‰¯æœ¬æœåŠ¡å™¨æ˜¯åªè¯»çš„ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pl"><img src="../Images/9b38363dd267c45ac6b3bfe7cf70b5a4.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*di41EYcxOHeysAsi.png"/></div></div></figure><p id="6fe1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œå¦‚æœä¸»èŠ‚ç‚¹æ¶ˆå¤±ï¼Œå®ƒçš„æ•´ä¸ªçŠ¶æ€å·²ç»å¤åˆ¶åˆ°è¾…åŠ©èŠ‚ç‚¹ï¼Œè¿™æ„å‘³ç€å½“ä¸€ä¸ªèŠ‚ç‚¹è¢«é€‰ä¸ºä¸»èŠ‚ç‚¹æ—¶ï¼Œå®ƒå¯ä»¥ç«‹å³å¼€å§‹æ¥å—å†™å…¥ã€‚</p><h2 id="93ef" class="ni ml iq bd mm nj nk dn mq nl nm dp mu la nn no mw le np nq my li nr ns na nt bi translated">æˆ‘ä»¬éœ€è¦å“¨å…µå—ï¼Ÿ</h2><p id="87fb" class="pw-post-body-paragraph kr ks iq kt b ku nu jr kw kx nv ju kz la od lc ld le oe lg lh li of lk ll lm ij bi translated">Sentinelsæ˜¯ç‹¬ç«‹çš„Rediså®ä¾‹ï¼Œå®ƒä»¬ä¸RedisèŠ‚ç‚¹ä¸€èµ·è¿è¡Œï¼Œä»¥å†³å®šå®ƒä»¬åœ¨é›†ç¾¤ä¸­çš„è§’è‰²ï¼Œå¹¶åœ¨å‘ç”Ÿæ•…éšœè½¬ç§»æ—¶æ ¹æ®éœ€è¦æ”¹å˜ä¸»ä»å…³ç³»ã€‚</p><blockquote class="nc nd ne"><p id="63cc" class="kr ks ln kt b ku kv jr kw kx ky ju kz nf lb lc ld ng lf lg lh nh lj lk ll lm ij bi translated"><strong class="kt ir">ä½¿ç”¨Redisé›†ç¾¤æ—¶ä¸éœ€è¦Sentinelã€‚</strong></p></blockquote><p id="bd3c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><strong class="kt ir"> <em class="ln">å¦‚æœä»»ä½•ä¸»å®ä¾‹ä¸­å‡ºç°ä»»ä½•é—®é¢˜ï¼ŒRedisé›†ç¾¤å°†æ‰§è¡Œè‡ªåŠ¨æ•…éšœè½¬ç§»ã€‚</em> </strong></p><p id="a2ec" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬åº”è¯¥å°†æˆ‘ä»¬çš„é›†ç¾¤è½¬æ¢ä¸ºä¸»ä»é›†ç¾¤ã€‚è®©æˆ‘ä»¬å†æ·»åŠ ä¸‰ä¸ªèŠ‚ç‚¹ï¼Œä½œä¸ºä¸‰ä¸ªä¸»èŠ‚ç‚¹çš„å‰¯æœ¬ã€‚</p><p id="0139" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">é¦–å…ˆï¼Œæˆ‘ä»¬åœæ­¢èŠ‚ç‚¹ï¼Œç„¶åå†æ¬¡å¯åŠ¨å®ƒä»¬:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="52e4" class="ni ml iq oc b gy pf pg l ph pi">docker stop redis-1 <br/>docker stop redis-2 <br/>docker stop redis-3 </span><span id="8111" class="ni ml iq oc b gy pj pg l ph pi"># Start redis nodes </span><span id="d3b2" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf:/redis_config -p 4025:6379 -d --name redis-1 redis redis-server /redis_config/node1.conf </span><span id="2526" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf:/redis_config -p 4026:6379 -d --name redis-2 redis redis-server /redis_config/node2.conf </span><span id="a9fe" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf:/redis_config -p 4027:6379 -d --name redis-3 redis redis-server /redis_config/node3.conf </span><span id="5709" class="ni ml iq oc b gy pj pg l ph pi"># Start replicas </span><span id="5836" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf:/redis_config -p 5025:6379 -d --name redis-1-replica redis redis-server /redis_config/node1-replica.conf</span><span id="a1ab" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf:/redis_config -p 5026:6379 -d --name redis-2-replica redis redis-server /redis_config/node2-replica.conf</span><span id="7eb1" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf:/redis_config -p 5027:6379 -d --name redis-3-replica redis redis-server /redis_config/node3-replica.conf</span></pre><p id="cc00" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬æ£€æŸ¥ä¸€ä¸‹Dockerç½‘ç»œï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦IPåœ°å€æ¥åˆ›å»ºé›†ç¾¤:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="cb4e" class="ni ml iq oc b gy pf pg l ph pi">docker inspect spring-redis-network </span><span id="ad67" class="ni ml iq oc b gy pj pg l ph pi">docker exec -it redis-1 redis-cli --cluster create 172.18.0.2:6379 172.18.0.3:6379 172.18.0.4:6379 172.18.0.6:6379 172.18.0.7:6379 172.18.0.8:6379 --cluster-replicas 1</span></pre><p id="41d6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚æœæ‚¨çœ‹åˆ°ä»¥ä¸‹é”™è¯¯ï¼Œè¯·åœæ­¢æ­£åœ¨è¿è¡Œçš„èŠ‚ç‚¹ï¼Œå› ä¸ºå®ƒä»¬å…·æœ‰å†…å­˜ä¸­çš„æ•°æ®ï¼Œå¹¶ä¸”åœ¨åˆ›å»ºé›†ç¾¤æ—¶éœ€è¦ä¸ºç©º:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="033b" class="ni ml iq oc b gy pf pg l ph pi">[ERR] Node 172.18.0.3:6379 is not empty. Either the node already knows other nodes (check with CLUSTER NODES) or contains some key in database 0.</span></pre><p id="d1f2" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚æœä¸€åˆ‡é¡ºåˆ©ï¼Œæ‚¨åº”è¯¥ä¼šçœ‹åˆ°ä»¥ä¸‹è¾“å‡º:</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pm"><img src="../Images/214fe3b261b9948bde9129e1b381f848.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*6ChcDMq0OVdDYErb.png"/></div></div></figure><p id="8538" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼éªŒè¯æˆ‘ä»¬çš„ç¾¤é›†:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="cd5e" class="ni ml iq oc b gy pf pg l ph pi">docker exec -it redis-2 redis-cli cluster nodes</span></pre><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi pn"><img src="../Images/4573631f3aedf60a6ae24895491c911f.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*4v1eHBSktir-_MHg.png"/></div></div></figure><p id="3a0a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬æœ€ç»ˆçš„<code class="fe nz oa ob oc b">application-cluster.yml</code>çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oy oz l"/></div></figure><p id="bed6" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬å†æ¬¡è¿è¡Œæˆ‘ä»¬çš„åº”ç”¨ç¨‹åºï¼Œå¹¶æ£€æŸ¥Redisç»Ÿè®¡æ•°æ®:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="461c" class="ni ml iq oc b gy pf pg l ph pi">DOCKER_BUILDKIT=1 docker build -t learnings/spring-boot-redis-cluster . </span><span id="7d7b" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -p 4024:4024 --name spring-boot-redis learnings/spring-boot-redis-cluster </span><span id="ce86" class="ni ml iq oc b gy pj pg l ph pi">docker exec -it redis-1 redis-cli info stats</span></pre><p id="c5f0" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬ç°åœ¨åº”è¯¥æµ‹è¯•æˆ‘ä»¬çš„æ•…éšœè½¬ç§»ã€‚è®©æˆ‘ä»¬ç”¨<code class="fe nz oa ob oc b">docker stop redis-2</code>åœæ­¢æˆ‘ä»¬çš„ä¸€ä¸ªæœåŠ¡å™¨ã€‚</p><p id="deb5" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚æœæ‚¨è¿è¡Œ<code class="fe nz oa ob oc b">docker exec -it redis-1 redis-cli cluster nodes</code>ï¼Œæ‚¨ä¼šçœ‹åˆ°ä¹‹å‰çš„æ¬¡æ˜ åƒç°åœ¨è¢«æå‡ä¸ºä¸»æ˜ åƒã€‚</p><p id="f0db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚æœçˆ¶å‰¯æœ¬å‡ºç°æ•…éšœï¼ŒRedisä¼šè‡ªåŠ¨å°†è¾…åŠ©å‰¯æœ¬æå‡ä¸ºä¸»å‰¯æœ¬ã€‚</p></div><div class="ab cl lo lp hu lq" role="separator"><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt lu"/><span class="lr bw bk ls lt"/></div><div class="ij ik il im in"><h1 id="4ee4" class="mk ml iq bd mm mn mo mp mq mr ms mt mu jw mv jx mw jz mx ka my kc mz kd na nb bi translated">Redisåˆçº§-æ¬¡çº§(å‰¯æœ¬)ç½‘ç»œï¼Œå¸¦Sentinelï¼Œæ— åˆ†ç‰‡</h1><p id="e5a8" class="pw-post-body-paragraph kr ks iq kt b ku nu jr kw kx nv ju kz la od lc ld le oe lg lh li of lk ll lm ij bi translated">åœ¨ä¸éœ€è¦åˆ†ç‰‡å¹¶ä¸”ä¸€ä¸ªèŠ‚ç‚¹è¶³ä»¥æ»¡è¶³å†…å­˜éœ€æ±‚çš„åœºæ™¯ä¸­ï¼Œæ‚¨å¯ä»¥é€šè¿‡åœ¨RedisèŠ‚ç‚¹çš„<code class="fe nz oa ob oc b">replica</code>é…ç½®ä¸­æŒ‡å®š<code class="fe nz oa ob oc b">replicaof</code>æ¥é¿å…åˆ›å»ºé›†ç¾¤å¹¶æ„å»ºä¸»ä»å‰¯æœ¬ã€‚</p><p id="80b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚æœæˆ‘ä»¬ä¸ä½¿ç”¨Redisé›†ç¾¤ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦å“¨å…µæ¥å®ç°æ•…éšœè½¬ç§»ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/1e90f1426812f3c6d62a6b75813be399.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bR1nXCVbrioOojfX.png"/></div></div></figure><p id="0913" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å“¨å…µå’ŒRedisé›†ç¾¤æ˜¯ä¸åŒçš„æ¦‚å¿µã€‚å¦‚æœä¸»è¦çš„æ­»äº¡ï¼Œç„¶åå“¨å…µäº’ç›¸äº¤è°ˆï¼Œä»¥å†³å®šæ–°çš„ä¸»è¦ã€‚</p><figure class="kg kh ki kj gt kk gh gi paragraph-image"><div role="button" tabindex="0" class="kl km di kn bf ko"><div class="gh gi kf"><img src="../Images/84c72f6e21eca8b3cae4aa70c4decd83.png" data-original-src="https://miro.medium.com/v2/resize:fit:1400/format:webp/0*IGgbxV23uxX2BjlF.png"/></div></div></figure><p id="620a" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">ç”±äºsentinelé…ç½®ä¸é›†ç¾¤æœ‰å¾ˆå¤§ä¸åŒï¼Œæˆ‘æŠŠè¿™ä¸ªé…ç½®æ”¾åœ¨äº†<code class="fe nz oa ob oc b">/redis-conf-sentinel</code></p><p id="b9d1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬æ·»åŠ sentinelæœåŠ¡å™¨ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥å®ç°è‡ªåŠ¨æ•…éšœè½¬ç§»ï¼Œ</p><p id="bedb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å“¨å…µåªéœ€è¦æŸ¥çœ‹ä¸»èŠ‚ç‚¹å°±å¯ä»¥å†³å®šæ•…éšœè½¬ç§»ã€‚</p><p id="bbc1" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob oc b">sentinel monitor redis-cluster 172.18.0.2 6379 2</code></p><p id="a813" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸‹é¢çš„é…ç½®æ¥å†³å®šä¸€ä¸ªé›†ç¾¤èŠ‚ç‚¹åœ¨å¤šé•¿æ—¶é—´åè¢«è§†ä¸ºå…³é—­ã€‚</p><p id="6609" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob oc b">sentinel down-after-milliseconds redis-cluster 5000</code></p><p id="c27f" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬å¯ä»¥æ·»åŠ ä»¥ä¸‹å†…å®¹ï¼Œä»¥ä¾¿åœ¨æ•…éšœåˆ‡æ¢å¼€å§‹å‰å…è®¸å½“å‰å¤åˆ¶å†™å…¥è¶…æ—¶å®Œæˆ:</p><p id="cc7c" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob oc b">sentinel failover-timeout redis-cluster 10000</code></p><p id="9b47" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬åœæ­¢æ‰€æœ‰çš„ç å¤´é›†è£…ç®±:</p><p id="6803" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated"><code class="fe nz oa ob oc b">docker stop $(docker ps -a -q)</code></p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="18e2" class="ni ml iq oc b gy pf pg l ph pi">docker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf-sentinel:/redis_config -p 4025:6379 -d --name redis-1 redis redis-server /redis_config/node1.conf d</span><span id="4269" class="ni ml iq oc b gy pj pg l ph pi">ocker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf-sentinel:/redis_config -p 5025:6379 -d --name redis-1-replica redis redis-server /redis_config/node1-replica-1.conf</span><span id="b106" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf-sentinel:/redis_config -p 5026:6379 -d --name redis-2-replica redis redis-server /redis_config/node1-replica-2.conf</span><span id="af8a" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf-sentinel:/redis_config -p 6025:6379 -d --name sentinel-1 redis redis-server /redis_config/sentinel1.conf --sentinel </span><span id="b82f" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf-sentinel:/redis_config -p 6026:6379 -d --name sentinel-2 redis redis-server /redis_config/sentinel2.conf --sentinel </span><span id="d247" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -v /mnt/c/Development/github/spring-boot-redis-cluster/redis-conf-sentinel:/redis_config -p 6027:6379 -d --name sentinel-3 redis redis-server /redis_config/sentinel3.conf --sentinel </span><span id="49bb" class="ni ml iq oc b gy pj pg l ph pi">docker logs sentinel-2</span></pre><p id="14db" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬éœ€è¦æ›´æ–°æˆ‘ä»¬çš„spring bootåº”ç”¨ç¨‹åºæ¥ä½¿ç”¨sentinelé…ç½®ã€‚</p><p id="0bfb" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">è®©æˆ‘ä»¬æ·»åŠ ä¸€ä¸ªå•ç‹¬çš„<code class="fe nz oa ob oc b">application-sentinel.yml</code>å¹¶å¯åŠ¨åº”ç”¨ç¨‹åº:</p><figure class="kg kh ki kj gt kk"><div class="bz fp l di"><div class="oy oz l"/></div></figure><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="a671" class="ni ml iq oc b gy pf pg l ph pi">docker stop spring-boot-redis DOCKER_BUILDKIT=1 </span><span id="d135" class="ni ml iq oc b gy pj pg l ph pi">docker build -t learnings/spring-boot-redis-cluster . </span><span id="2f68" class="ni ml iq oc b gy pj pg l ph pi">docker run --rm --net spring-redis-network -e "SPRING_PROFILES_ACTIVE=sentinel" -p 4024:4024 --name spring-boot-redis learnings/spring-boot-redis-cluster</span></pre><p id="acf3" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æˆ‘ä»¬å¯ä»¥åœæ­¢æˆ‘ä»¬çš„ä¸»å®ä¾‹æ¥éªŒè¯sentinelsæ­£åœ¨å·¥ä½œ:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="0ff6" class="ni ml iq oc b gy pf pg l ph pi">docker stop redis-1</span></pre><p id="33c8" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">æ‚¨åº”è¯¥åœ¨æ‚¨çš„sentinel <code class="fe nz oa ob oc b">docker logs sentinel-1</code>ä¸­çœ‹åˆ°è¿™æ ·çš„æ—¥å¿—:</p><pre class="kg kh ki kj gt pb oc pc pd aw pe bi"><span id="42c1" class="ni ml iq oc b gy pf pg l ph pi">1:X 18 Jun 2020 21:25:06.046 # +sdown primary redis-cluster 172.18.0.2 6379 1:X 18 Jun 2020 21:25:07.679 # +new-epoch 1 1:X 18 Jun 2020 21:25:07.891 # <strong class="oc ir">+vote-for-leader </strong>bfebc5c7d07121c78633024dcbc89a14bf1e4563 1 1:X 18 Jun 2020 21:25:07.948 # +odown primary redis-cluster 172.18.0.2 6379 #quorum 3/2 1:X 18 Jun 2020 21:25:07.948 # Next failover delay: I will not start a failover before Thu Jun 18 21:25:28 2020 1:X 18 Jun 2020 21:25:08.580 # <strong class="oc ir">+config-update-from sentinel </strong>bfebc5c7d07121c78633024dcbc89a14bf1e4563 172.18.0.7 6379 @ redis-cluster 172.18.0.2 6379 1:X 18 Jun 2020 21:25:08.580 # <strong class="oc ir">+switch-primary redis-cluster </strong>172.18.0.2 6379 172.18.0.4 6379 1:X 18 Jun 2020 21:25:08.581 * </span></pre><p id="75b7" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å°±æ˜¯è¿™æ ·ï¼æˆ‘ä»¬å®ç°äº†ä¸€ä¸ªspring boot Redisåº”ç”¨ç¨‹åºï¼Œå¹¶å­¦ä¹ äº†å¦‚ä½•åˆ›å»ºä¸åŒçš„Redisç½‘ç»œã€‚</p><p id="a210" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¦‚æœæ‚¨æœ‰ä»»ä½•é—®é¢˜æˆ–åé¦ˆï¼Œè¯·ä¸è¦çŠ¹è±«ï¼Œåœ¨è¯„è®ºåŒºç•™ä¸‹æ‚¨çš„æƒ³æ³•ã€‚</p><p id="94cf" class="pw-post-body-paragraph kr ks iq kt b ku kv jr kw kx ky ju kz la lb lc ld le lf lg lh li lj lk ll lm ij bi translated">å¯¹äºä¸ä»£ç ç›¸å…³çš„é—®é¢˜ï¼Œè¯·éšæ„ç›´æ¥åœ¨<a class="ae me" href="https://github.com/avinash10584/spring-boot-redis-cluster" rel="noopener ugc nofollow" target="_blank"> GitHubåº“</a>ä¸­åˆ›å»ºé—®é¢˜ã€‚</p></div></div>    
</body>
</html>