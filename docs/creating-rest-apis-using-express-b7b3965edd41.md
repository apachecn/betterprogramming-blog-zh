# ä½¿ç”¨ Express åˆ›å»º Rest APIs

> åŸæ–‡ï¼š<https://betterprogramming.pub/creating-rest-apis-using-express-b7b3965edd41>

![](img/8cefd6da758976e7898201e8ec56b390.png)

è¿™æ˜¯[*ç³»åˆ—*](https://medium.com/@pankaj.panigrahi/list-of-node-js-articles-ededa6dd304b) çš„ç¬¬å››éƒ¨åˆ†ï¼Œæ—¨åœ¨å¸®åŠ©æ‚¨æŒæ¡ Node.js èƒŒåçš„ä¸åŒæ¦‚å¿µï¼Œå¹¶ä½¿æ‚¨èƒ½å¤Ÿåˆ›å»ºç”Ÿäº§å°±ç»ªçš„åº”ç”¨ç¨‹åºã€‚

å¯¹äºè¿™ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨æœ€æµè¡Œçš„åº“ä¹‹ä¸€ï¼Œ [Express](https://www.npmjs.com/package/express) æ¥æ„å»º rest APIsã€‚æˆ‘ä»¬å‡è®¾è¯»è€…ç†Ÿæ‚‰å·´åˆ«å¡”ã€‚å¦‚æœä½ ä¸æ˜¯ï¼Œè¯·é˜…è¯»è¿™ç¯‡[æ–‡ç« ](https://medium.com/@pankaj.panigrahi/using-babel-and-other-dependencies-in-node-js-18f74973c1f0)æ¥ç†Ÿæ‚‰è‡ªå·±ï¼

# å¿«é€Ÿå…¥é—¨

Express æ˜¯ Node æœ€æµè¡Œçš„è½»é‡çº§ web åº”ç”¨ç¨‹åºæ¡†æ¶ä¹‹ä¸€ï¼Œå®ƒé€šè¿‡è·¯ç”±æ”¯æŒå¸®åŠ©æ‚¨å“åº”è¯·æ±‚ï¼Œä»¥ä¾¿æ‚¨å¯ä»¥ç¼–å†™å¯¹ç‰¹å®š URL çš„å“åº”ã€‚å®ƒæ˜¯æœ€ç®€å•å’Œæœ€é€šç”¨çš„åº“ä¹‹ä¸€ã€‚

é¦–å…ˆï¼Œåœ¨æ‚¨çš„ repo ä¸­å®‰è£… Express:

```
npm i express --save
```

æ¥ä¸‹æ¥ï¼Œä½¿ç”¨ä»¥ä¸‹ä»£ç è¡Œåˆ›å»ºä¸€ä¸ª app.js æ–‡ä»¶:

```
import express from 'express';
let app = express();
```

è¿™å°†å¯¼å…¥ Express å¹¶å®ä¾‹åŒ– Express å¯¹è±¡ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨`express.get()`æ–¹æ³•ï¼Œè¯¥æ–¹æ³•é€šè¿‡æŒ‡å®šçš„å›è°ƒå‡½æ•°å°† HTTP get è¯·æ±‚è·¯ç”±åˆ°æŒ‡å®šçš„è·¯å¾„ã€‚

> `app.get(path, callback [, callback â€¦])`
> 
> *è·¯å¾„:*ä¸­é—´ä»¶åŠŸèƒ½è¢«è°ƒç”¨çš„è·¯å¾„ã€‚
> 
> *å›è°ƒ:*ä¸­é—´ä»¶å‡½æ•°æˆ–ä¸­é—´ä»¶å‡½æ•°æ•°ç»„
> 
> ä½ å¯ä»¥åœ¨è¿™é‡Œé˜…è¯»æ›´å¤šå…³äº Express APIs çš„ä¿¡æ¯:[http://expressjs.com/en/4x/api.html](http://expressjs.com/en/4x/api.html)

# å»ºç«‹åŸºç¡€

åœ¨å‰ä¸¤è¡Œä¹‹åï¼Œç¼–å†™ä»¥ä¸‹ä»£ç :

`req`å¯¹è±¡è¡¨ç¤º HTTP è¯·æ±‚ï¼Œå¹¶å…·æœ‰è¯·æ±‚æŸ¥è¯¢å­—ç¬¦ä¸²ã€å‚æ•°ã€ä¸»ä½“ã€HTTP å¤´ç­‰å±æ€§ã€‚å®ƒè¡¨ç¤º Express åº”ç”¨ç¨‹åºåœ¨è·å¾— HTTP è¯·æ±‚æ—¶å‘é€çš„ HTTP å“åº”ã€‚

`res`ç»™äº†æˆ‘ä»¬`status()`å’Œ`send()` ä¸¤ä¸ªæ–¹æ³•ï¼Œå¯ä»¥åƒä¸Šé¢ä¸€æ ·é“¾æ¥ä½¿ç”¨ã€‚`status()`ç”¨äºè®¾ç½®å“åº”çš„ HTTP ä»£ç ã€‚`send()`è®¾ç½®å“åº”ä½“å¹¶å…³é—­å“åº”æµã€‚

ç„¶åæˆ‘ä»¬å°†ä½¿ç”¨`app.listen()`:

`app.listen(path, [callback])`

è¿™å°†å¯åŠ¨ä¸€ä¸ª UNIX å¥—æ¥å­—ï¼Œå¹¶ç›‘å¬ç»™å®šè·¯å¾„ä¸Šçš„è¿æ¥ã€‚è¯¥æ–¹æ³•ä¸èŠ‚ç‚¹çš„`[http.Server.listen()](https://nodejs.org/api/http.html#http_server_listen)`ç›¸åŒã€‚

```
app.listen(30006,()=>{
   console.log(' ********** : running on 30006');
})
```

ç°åœ¨æˆ‘ä»¬å·²ç»ä½¿ç”¨äº†ä¸€äº› ES6 è¯­æ³•ï¼Œè®©æˆ‘ä»¬å°†è¿™ä¸ªæ–‡ä»¶å¯¼å‡ºä¸ºä¸€ä¸ªæ¨¡å—ï¼Œå¹¶åœ¨ index.js æ–‡ä»¶ä¸­è°ƒç”¨å®ƒã€‚app.js çš„å®Œæ•´ä»£ç åº”è¯¥å¦‚ä¸‹æ‰€ç¤º:

æ¥ä¸‹æ¥ï¼Œåˆ›å»ºä¸€ä¸ª index.js æ–‡ä»¶:

å¹¶ä½¿ç”¨`node index.js` *:* è¿è¡Œé¡¹ç›®

![](img/6236918890c3a74c42fb17d28427f1bf.png)![](img/be8c634509fe4e0243a4640321077de7.png)

# å®æ–½è·¯çº¿

æˆ‘ä»¬æ¥å­¦ä¹ ä¸€ä¸‹å¦‚ä½•ä½¿ç”¨ app.use() & app.route()ã€‚

`app.use([path,] callback [, callbackâ€¦])`åœ¨æŒ‡å®šè·¯å¾„æŒ‚è½½æŒ‡å®šçš„[ä¸­é—´ä»¶](http://expressjs.com/guide/using-middleware.html)åŠŸèƒ½ã€‚å½“è¯·æ±‚è·¯å¾„çš„åŸºç¡€ä¸`path`åŒ¹é…æ—¶ï¼Œæ‰§è¡Œè¯¥åŠŸèƒ½ã€‚è®°ä½è·¯å¾„åœ¨è¿™é‡Œæ˜¯å¯é€‰çš„ã€‚

å®‰è£…ä¸­é—´ä»¶åŠŸèƒ½æ˜¯ Express æœ€å¥½çš„ç‰¹æ€§ä¹‹ä¸€ï¼Œå®ƒç»™æˆ‘ä»¬å¸¦æ¥äº†å¾ˆå¤§çš„èƒ½åŠ›å’Œçµæ´»æ€§ã€‚

æˆ‘ä»¬å°†ä½¿ç”¨å¦ä¸€ä¸ªæµè¡Œçš„åº“ [*body-parser*](https://www.npmjs.com/package/body-parser) ï¼Œå®ƒæ˜¯ Node.js body è§£æä¸­é—´ä»¶ã€‚å®ƒåœ¨æ‚¨çš„å¤„ç†ç¨‹åºä¹‹å‰è§£æä¸­é—´ä»¶ä¸­çš„ä¼ å…¥è¯·æ±‚ä½“ï¼Œå¯åœ¨`req.body`å±æ€§ä¸‹è·å¾—ã€‚

è®©æˆ‘ä»¬å®‰è£…æ¨¡å—â€œbody-parser â€,å¹¶åœ¨ä»£ç ä¸­å¯¼å…¥å®ƒ

```
import bodyParser from 'body-parser';
```

åœ¨æœ¬æ–‡çš„åé¢ï¼Œæˆ‘ä»¬å°†åˆ›å»ºä¸€ä¸ªå°† JSON æ•°æ®ä½œä¸ºè¾“å…¥çš„ APIã€‚é€šè¿‡æŒ‚è½½ body-parser æä¾›çš„ APIï¼Œæˆ‘ä»¬å¯ä»¥è®©æ‰€æœ‰ API è§£æ JSON æ•°æ®ï¼Œå¦‚ä¸‹æ‰€ç¤º:

åƒ`app.get()`æˆ‘ä»¬è¿˜æœ‰å…¶ä»–çš„æ–¹æ³•åƒ`app.post()`å’Œ`app.put()`ã€‚é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦è·¯çº¿ï¼Ÿ

æˆ‘ä»¬å¯ä»¥ä½¿ç”¨`app.get()`æˆ–`app.post()`æ¥ç¼–å†™æˆ‘ä»¬æ‰€æœ‰çš„ APIï¼Œä½†æ˜¯ä¸ºäº†é¿å…é‡å¤çš„è·¯å¾„æˆ–æ‰“å­—é”™è¯¯ï¼Œå¹¶æ¨¡å—åŒ–æˆ‘ä»¬çš„ä»£ç ï¼Œæˆ‘ä»¬ä½¿ç”¨ routesã€‚

æˆ‘ä»¬å¯ä»¥å†™å‡ºå¦‚ä¸‹çš„å¿«é€Ÿè·¯çº¿:

åœ¨ä¸Šé¢çš„å®ç°ä¸­ï¼Œä»»ä½•åˆ°è¾¾`â€˜/eventsâ€™` URL çš„`get`è¯·æ±‚å°†ç”±`â€˜Handler 1â€™`ä¸­é—´ä»¶å‡½æ•°å¤„ç†ï¼Œä»»ä½•åˆ°è¾¾`â€˜/eventsâ€™` URL çš„ post è¯·æ±‚å°†ç”±`â€˜Handler 2â€™`å¤„ç†ã€‚

ä½†æ˜¯æœ‰æ›´å¥½çš„æ–¹æ³•æ¥å®ç°è·¯ç”±ä½¿ç”¨ [*è·¯ç”±å™¨*](http://expressjs.com/en/4x/api.html#router) & `app.use()`ã€‚

ä¸€ä¸ª`router`å¯¹è±¡æ˜¯ä¸­é—´ä»¶å’Œè·¯ç”±çš„éš”ç¦»å®ä¾‹ã€‚ä½ å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªâ€œè¿·ä½ åº”ç”¨ç¨‹åºâ€,å®ƒåªèƒ½æ‰§è¡Œä¸­é—´ä»¶å’Œè·¯ç”±åŠŸèƒ½ã€‚æ¯ä¸ª Express åº”ç”¨ç¨‹åºéƒ½æœ‰ä¸€ä¸ªå†…ç½®çš„åº”ç”¨ç¨‹åºè·¯ç”±å™¨ã€‚

è·¯ç”±å™¨æœ¬èº«çš„è¡Œä¸ºå°±åƒä¸­é—´ä»¶ï¼Œæ‰€ä»¥ä½ å¯ä»¥æŠŠå®ƒç”¨ä½œ`[app.use()](http://expressjs.com/en/4x/api.html#app.use)`çš„å‚æ•°æˆ–è€…å¦ä¸€ä¸ªè·¯ç”±å™¨çš„`[use()](http://expressjs.com/en/4x/api.html#router.use)`æ–¹æ³•çš„å‚æ•°ã€‚

é¡¶å±‚çš„`express`å¯¹è±¡æœ‰ä¸€ä¸ª`[router()](http://expressjs.com/en/4x/api.html#express.router)`æ–¹æ³•æ¥åˆ›å»ºä¸€ä¸ªæ–°çš„`router`å¯¹è±¡ã€‚

# åˆ›å»º Rest APIs

è®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä¸ºæˆ‘ä»¬æ‰§è¡Œç”¨æˆ·ç‰¹å®šä»»åŠ¡çš„è·¯ç”±ã€‚

é¦–å…ˆåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹`routes`å’Œä¸€ä¸ªåä¸º user.js *çš„æ–‡ä»¶ã€‚*

æˆ‘ä»¬å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼è·å¾—è·¯ç”±å™¨å®ä¾‹:

ç„¶åæ·»åŠ ä»¥ä¸‹ä»£ç :

è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ router çš„`post()`æ–¹æ³•æ¥å¤„ç†åˆ°æŒ‡å®šè·¯å¾„çš„ post è¯·æ±‚ã€‚æˆ‘ä»¬å°†ä»`req.body object`è·å–ç”¨æˆ·è¾“å…¥ï¼Œç„¶åå‘é€å“åº”ã€‚è¯¥æ¨¡å—å°†è¢«å¯¼å‡ºå¹¶åœ¨æˆ‘ä»¬çš„ app.js ä¸­ä½¿ç”¨ã€‚

æ‰€ä»¥æˆ‘ä»¬æœ€ç»ˆçš„ routes/user.js ä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„:

ç°åœ¨ï¼Œåœ¨æˆ‘ä»¬çš„ app.js ä¸­å¯¼å…¥æ¨¡å—:

```
import user from './routes/user';
```

å¦‚å‰æ‰€è¿°ï¼Œè·¯ç”±å™¨çš„è¡Œä¸ºç±»ä¼¼äºä¸­é—´ä»¶æœ¬èº«ï¼Œå› æ­¤æ‚¨å¯ä»¥å°†å®ƒç”¨ä½œ`app.use()`çš„å‚æ•°ã€‚è®©æˆ‘ä»¬å°†è·¯ç”±å™¨å®‰è£…åˆ°è·¯å¾„'/user ':

```
app.use('/user',user);
```

æˆ‘ä»¬çš„ app.js åº”è¯¥æ˜¯è¿™æ ·çš„:

æˆ‘ä»¬ç¼–å†™çš„ä¸­é—´ä»¶å‡½æ•°å°†å¤„ç†å¯¹è·¯å¾„'/user/hello 'çš„æ‰€æœ‰ POST è¯·æ±‚ã€‚

é‡å¯åº”ç”¨ç¨‹åºï¼Œä½¿ç”¨ POSTMAN ç‚¹å‡» APIã€‚

![](img/aa78c5e7b0b666c73ff4136f5d387d5d.png)

æˆ‘ä»¬å°†æ”¶åˆ°ä½œä¸º JSON è¾“å…¥çš„æ•°æ®ã€‚æˆ‘ä»¬çš„ä»£ç èƒ½å¤Ÿè§£æå®ƒï¼Œå› ä¸ºæˆ‘ä»¬å·²ç»å®‰è£…äº†ä»¥ä¸‹å†…å®¹:

`app.use(bodyParser.json())`

ä¸ºäº†ç¡®è®¤æˆ‘ä»¬çš„ç†è§£ï¼Œè®©æˆ‘ä»¬å°†è¯¥è¡Œæ³¨é‡Šå¦‚ä¸‹:

```
//app.use(bodyParser.json())
```

å†æ¬¡é‡å¯ï¼Œé€šè¿‡ POSTMAN æ‰“ APIã€‚

![](img/af5ff63d376032f46a8f6e2320140e52.png)

å¦‚æ‚¨æ‰€è§ï¼Œæˆ‘ä»¬çš„ä»£ç æ— æ³•è·å¾—`req.body.username`ï¼Œç›¸åï¼Œæˆ‘ä»¬åœ¨å“åº”ä¸­æ”¶åˆ°äº†`undefined`ã€‚

# ç»“è®º

æˆ‘å¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¸®åŠ©ä½ æ¸…æ¥šåœ°ç†è§£ Expressã€‚åœ¨åé¢çš„æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬å°†çœ‹åˆ°æˆ‘ä»¬å¯ä»¥ç”¨ express.js åšæ›´å¤šçš„äº‹æƒ…ã€‚

> æ‚¨å¯ä»¥åœ¨æ­¤å¤„æ‰¾åˆ°ä»£ç :
> 
> [https://github.com/pankaj805/medium-04_rest-api.git](https://github.com/pankaj805/medium-04_rest-api.git)

![](img/0bf5df4c347f4b7878add00ed9d2eeef.png)

ä»Šå¤©åˆ°æ­¤ä¸ºæ­¢ã€‚

å¦‚æœä½ å–œæ¬¢è¿™ç¯‡æ–‡ç« ï¼Œä½ å¯ä»¥ğŸ‘å¹¶ä¸ä»–äººåˆ†äº«ã€‚ä½ å¯ä»¥åœ¨è¿™é‡Œæ‰¾åˆ°æ•´ä¸ª [***æ–‡ç« ç³»åˆ—***](https://medium.com/@pankaj.panigrahi/list-of-node-js-articles-ededa6dd304b) ã€‚